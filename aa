<form theme="dark">
  <label>Splunk - IDX - 06 - Global License Usage - Dashboard - v2</label>
  <search id="Splunk_IDX_06_Global_License_Usage_Dashboard_v2">
    <query>
      | tstats SUMMARIESONLY=TRUE ALLOW_OLD_SUMMARIES=FALSE 
      
      sum(TCPIN_Connections.kb) AS sum_kb
      latest(host) as host
      
      FROM DATAMODEL=Splunk_License_Ingestion
      
      WHERE nodename=TCPIN_Connections
      
      earliest="$TimeRangePkr.earliest$" latest="$TimeRangePkr.latest$"
      
      TCPIN_Connections.os = "$os$"
      TCPIN_Connections.version = "$version$"
      TCPIN_Connections.fwdType = "$fwdType$"
      TCPIN_Connections.connectionType = "$connectionType$"
      
      BY TCPIN_Connections.sourceHost TCPIN_Connections.sourceIp TCPIN_Connections.os TCPIN_Connections.version TCPIN_Connections.fwdType TCPIN_Connections.connectionType 
      
      | `drop_dm_object_name(TCPIN_Connections)` 
      | fields host sourceHost sourceIp os version fwdType connectionType sum_kb
      | lookup dnslookup clientip AS sourceIp OUTPUT clienthost AS "Forwarder Name" | rex field="Forwarder Name" mode=sed "s/\..*?$//g"
      | lookup splunk_assets_lookup host AS "Forwarder Name" OUTPUT Splunk_Role AS Forwarder_Splunk_Role
      | `get_splunk_env(host)`
      | search Splunk_Role = "$Splunk_Role$" Forwarder_Splunk_Role="$Forwarder_Splunk_Role$"
    
    </query>
    <earliest>$TimeRangePkr.earliest$</earliest>
    <latest>$TimeRangePkr.latest$</latest>
  </search>
  <fieldset submitButton="false" autoRun="true">
    <input type="time" token="TimeRangePkr" searchWhenChanged="true">
      <label>Time Range</label>
      <default>
        <earliest>-1m</earliest>
        <latest>now</latest>
      </default>
    </input>
    <input type="dropdown" token="Splunk_Role" searchWhenChanged="true">
      <label>Splunk_Role</label>
      <fieldForLabel>Splunk_Role</fieldForLabel>
      <fieldForValue>Splunk_Role</fieldForValue>
      <search base="Splunk_IDX_06_Global_License_Usage_Dashboard_v2">
        <query>| stats count by Splunk_Role</query>
      </search>
      <choice value="*">All</choice>
      <default>*</default>
      <initialValue>*</initialValue>
    </input>
    <input type="dropdown" token="fwdType" searchWhenChanged="true">
      <label>Forwarder Type</label>
      <fieldForLabel>fwdType</fieldForLabel>
      <fieldForValue>fwdType</fieldForValue>
      <choice value="*">All</choice>
      <choice value="uf">Universal Forwarders</choice>
      <choice value="full">Heavy Forwarders</choice>
      <choice value="lwf">Light Weight Forwarders</choice>
      <default>*</default>
      <initialValue>*</initialValue>
    </input>
    <input type="dropdown" token="Forwarder_Splunk_Role" searchWhenChanged="true">
      <label>Forwarder Splunk Role</label>
      <fieldForLabel>Forwarder_Splunk_Role</fieldForLabel>
      <fieldForValue>Forwarder_Splunk_Role</fieldForValue>
      <search base="Splunk_IDX_06_Global_License_Usage_Dashboard_v2">
        <query>| stats count by Forwarder_Splunk_Role</query>
      </search>
      <choice value="*">All</choice>
      <default>*</default>
      <initialValue>*</initialValue>
    </input>
    <input type="dropdown" token="os" searchWhenChanged="true">
      <label>Forwarder  Operating System</label>
      <fieldForLabel>os</fieldForLabel>
      <fieldForValue>os</fieldForValue>
      <choice value="*">All</choice>
      <choice value="AIX">AIX</choice>
      <choice value="Linux">Linux</choice>
      <choice value="Windows">Windows</choice>
      <default>*</default>
      <initialValue>*</initialValue>
    </input>
    <input type="dropdown" token="connectionType" searchWhenChanged="true">
      <label>Forwarder Connection Type</label>
      <fieldForLabel>connectionType</fieldForLabel>
      <fieldForValue>connectionType</fieldForValue>
      <choice value="*">All</choice>
      <choice value="cooked">Cooked</choice>
      <choice value="cookedSSL">Cooked SSL</choice>
      <default>*</default>
      <initialValue>*</initialValue>
    </input>
    <input type="dropdown" token="version" searchWhenChanged="true">
      <label>Forwarder  Version</label>
      <fieldForLabel>versio</fieldForLabel>
      <fieldForValue>version</fieldForValue>
      <search base="Splunk_IDX_06_Global_License_Usage_Dashboard_v2">
        <query>| stats count by version</query>
      </search>
      <choice value="*">All</choice>
      <default>*</default>
      <initialValue>*</initialValue>
    </input>
  </fieldset>
  <row>
    <panel>
      <single>
        <search base="Splunk_IDX_06_Global_License_Usage_Dashboard_v2">
          <query>| stats dc(sourceHost) as Forwarders</query>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </single>
    </panel>
    <panel>
      <table>
        <search base="Splunk_IDX_06_Global_License_Usage_Dashboard_v2">
          <query>| stats count by fwdType</query>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <chart>
        <search base="Splunk_IDX_06_Global_License_Usage_Dashboard_v2">
          <query>| chart eval(round(sum(sum_kb)/1024/1024,2)) AS Volume_GB by Splunk_Role</query>
        </search>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.axisTitleY.visibility">collapsed</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.showDataLabels">all</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.legend.placement">bottom</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <table>
        <search base="Splunk_IDX_06_Global_License_Usage_Dashboard_v2">
          <query>| stats sum(sum_kb) AS sum_kb last("Forwarder Name") as "Forwarder Name" values(Forwarder_Splunk_Role) AS "Forwarder Splunk Role" by Splunk_Role fwdType sourceHost 
| eval sum_mb=round(sum_kb/1024,2) , sum_gb=round(sum_kb/1024/1024,2) 
| table Splunk_Role fwdType sourceHost "Forwarder Name" "Forwarder Splunk Role" sum_kb sum_mb sum_gb 
| sort 0 - sum_kb 
| rename sum_kb AS "Volume (KB)" sum_mb AS "Volume (MB)" sum_gb AS "Volume (GB)" Splunk_Role AS "Splunk Role" sourceHost AS Forwarder fwdType AS "Forwarder Type"</query>
        </search>
        <option name="count">12</option>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">true</option>
        <option name="wrap">false</option>
        <format type="number" field="Volume (KB)"></format>
      </table>
    </panel>
  </row>
</form>
