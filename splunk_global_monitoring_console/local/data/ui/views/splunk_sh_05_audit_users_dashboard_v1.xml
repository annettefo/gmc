<form theme="dark">
  <label>Splunk - SH - 05 - Audit Users - Dashboard - v1</label>
  <search id="splunk_sh_05_audit_users_dashboard_v1">
    <query>| inputlookup splunk_sh_index_audit_user_login_kv_store_lookup
    | eval Days_Since_Latest_Login = round((now() - Latest_Login_Updated) / 86400 ) , Days_Since_Earliest_Login = round((now() - Earliest_Login_Updated) / 86400 ) , Earliest_Login=strftime(Earliest_Login,"%m/%d/%Y %H:%M:%S") , Latest_Login=strftime(Latest_Login,"%m/%d/%Y %H:%M:%S") , Earliest_Login_Updated=strftime(Earliest_Login_Updated,"%m/%d/%Y %H:%M:%S"), Latest_Login_Updated=strftime(Latest_Login_Updated,"%m/%d/%Y %H:%M:%S")
   
    | `get_identity_info(User)`
   
    | fields User Earliest_Login_Updated Latest_Login_Updated Login_Source Splunk_Roles Splunk_Instance first last full_name email phone managedBy bunit startDate endDate work_city work_region work_country work_lat work_long Title LOB Department Emp_Type Emp_Status Cost_Center Location_Code Floor_Number Contractor_Expiration Days_Since_Latest_Login Days_Since_Earliest_Login Earliest_Login_Updated Latest_Login_Updated
    
    | fillnull value="Undefined" first last full_name email work_city work_region work_country Title LOB Department managedBy Emp_Type Emp_Status Cost_Center Location_Code Floor_Number Splunk_Roles Splunk_Instance Login_Source
    
    | search full_name="$full_name$" managedBy="$managedBy$" Emp_Status="$Emp_Status$" Emp_Type="$Emp_Type$" Days_Since_Latest_Login &gt;= $Days_Since_Latest_Login$ Days_Since_Latest_Login &lt;= $Days_Since_Latest_Login2$ Department="$Department$" LOB="$LOB$" Title="$Title$" Cost_Center="$Cost_Center$" work_city="$work_city$" work_region="$work_region$" work_country="$work_country$" Splunk_Roles="$Splunk_Roles$" Splunk_Instance="$Splunk_Instance$" User="$User$" Login_Source="$Login_Source$"

      </query>
  </search>
  <fieldset submitButton="false" autoRun="true">
    <input type="dropdown" token="Splunk_Roles" searchWhenChanged="true">
      <label>Splunk Roles</label>
      <fieldForLabel>Splunk_Roles</fieldForLabel>
      <fieldForValue>Splunk_Roles</fieldForValue>
      <search base="splunk_sh_05_audit_users_dashboard_v1">
        <query>| stats count by Splunk_Roles</query>
      </search>
      <choice value="*">All</choice>
      <default>*</default>
      <initialValue>*</initialValue>
    </input>
    <input type="dropdown" token="Splunk_Instance" searchWhenChanged="true">
      <label>Splunk Instance</label>
      <fieldForLabel>Splunk_Instance</fieldForLabel>
      <fieldForValue>Splunk_Instance</fieldForValue>
      <search base="splunk_sh_05_audit_users_dashboard_v1">
        <query>| stats count by Splunk_Instance</query>
      </search>
      <choice value="*">All</choice>
      <default>*</default>
      <initialValue>*</initialValue>
    </input>
    <input type="dropdown" token="User" searchWhenChanged="true">
      <label>User</label>
      <fieldForLabel>User</fieldForLabel>
      <fieldForValue>User</fieldForValue>
      <search base="splunk_sh_05_audit_users_dashboard_v1">
        <query>| stats count by User</query>
      </search>
      <choice value="*">All</choice>
      <default>*</default>
      <initialValue>*</initialValue>
    </input>
    <input type="dropdown" token="full_name" searchWhenChanged="true">
      <label>Full Name</label>
      <fieldForLabel>full_name</fieldForLabel>
      <fieldForValue>full_name</fieldForValue>
      <search base="splunk_sh_05_audit_users_dashboard_v1">
        <query>| stats count by full_name</query>
      </search>
      <choice value="*">All</choice>
      <default>*</default>
      <initialValue>*</initialValue>
    </input>
    <input type="dropdown" token="Title" searchWhenChanged="true">
      <label>Employee Title</label>
      <fieldForLabel>Title</fieldForLabel>
      <fieldForValue>Title</fieldForValue>
      <search base="splunk_sh_05_audit_users_dashboard_v1">
        <query>| stats count by Title</query>
      </search>
      <choice value="*">All</choice>
      <default>*</default>
      <initialValue>*</initialValue>
    </input>
    <input type="dropdown" token="Department" searchWhenChanged="true">
      <label>Department</label>
      <fieldForLabel>Department</fieldForLabel>
      <fieldForValue>Department</fieldForValue>
      <search base="splunk_sh_05_audit_users_dashboard_v1">
        <query>| stats count by Department</query>
      </search>
      <choice value="*">All</choice>
      <default>*</default>
      <initialValue>*</initialValue>
    </input>
    <input type="dropdown" token="LOB" searchWhenChanged="true">
      <label>Line of Business</label>
      <fieldForLabel>LOB</fieldForLabel>
      <fieldForValue>LOB</fieldForValue>
      <search base="splunk_sh_05_audit_users_dashboard_v1">
        <query>| stats count by LOB</query>
      </search>
      <choice value="*">All</choice>
      <default>*</default>
      <initialValue>*</initialValue>
    </input>
    <input type="dropdown" token="Cost_Center" searchWhenChanged="true">
      <label>Cost Center</label>
      <fieldForLabel>Cost_Center</fieldForLabel>
      <fieldForValue>Cost_Center</fieldForValue>
      <search base="splunk_sh_05_audit_users_dashboard_v1">
        <query>| stats count by Cost_Center</query>
      </search>
      <choice value="*">All</choice>
      <default>*</default>
      <initialValue>*</initialValue>
    </input>
    <input type="dropdown" token="Emp_Type" searchWhenChanged="true">
      <label>Employee Type</label>
      <fieldForLabel>Emp_Type</fieldForLabel>
      <fieldForValue>Emp_Type</fieldForValue>
      <search base="splunk_sh_05_audit_users_dashboard_v1">
        <query>| stats count by Emp_Type</query>
      </search>
      <choice value="*">All</choice>
      <default>*</default>
      <initialValue>*</initialValue>
    </input>
    <input type="dropdown" token="Emp_Status" searchWhenChanged="true">
      <label>Employee Status</label>
      <fieldForLabel>Emp_Status</fieldForLabel>
      <fieldForValue>Emp_Status</fieldForValue>
      <search base="splunk_sh_05_audit_users_dashboard_v1">
        <query>| stats count by Emp_Status</query>
      </search>
      <choice value="*">All</choice>
      <default>*</default>
      <initialValue>*</initialValue>
    </input>
    <input type="dropdown" token="managedBy" searchWhenChanged="true">
      <label>Manager Name</label>
      <fieldForLabel>managedBy</fieldForLabel>
      <fieldForValue>managedBy</fieldForValue>
      <search base="splunk_sh_05_audit_users_dashboard_v1">
        <query>| stats count by managedBy</query>
      </search>
      <choice value="*">All</choice>
      <default>*</default>
      <initialValue>*</initialValue>
    </input>
    <input type="dropdown" token="work_country" searchWhenChanged="true">
      <label>Country</label>
      <fieldForLabel>work_country</fieldForLabel>
      <fieldForValue>work_country</fieldForValue>
      <search base="splunk_sh_05_audit_users_dashboard_v1">
        <query>| stats count by work_country</query>
      </search>
      <choice value="*">All</choice>
      <default>*</default>
      <initialValue>*</initialValue>
    </input>
    <input type="dropdown" token="work_region" searchWhenChanged="true">
      <label>Region</label>
      <fieldForLabel>work_region</fieldForLabel>
      <fieldForValue>work_region</fieldForValue>
      <search base="splunk_sh_05_audit_users_dashboard_v1">
        <query>| stats count by work_region</query>
      </search>
      <choice value="*">All</choice>
      <default>*</default>
      <initialValue>*</initialValue>
    </input>
    <input type="dropdown" token="work_city" searchWhenChanged="true">
      <label>City</label>
      <fieldForLabel>work_city</fieldForLabel>
      <fieldForValue>work_city</fieldForValue>
      <search base="splunk_sh_05_audit_users_dashboard_v1">
        <query>| stats count by work_city</query>
      </search>
      <choice value="*">All</choice>
      <default>*</default>
      <initialValue>*</initialValue>
    </input>
    <input type="dropdown" token="Login_Source" searchWhenChanged="true">
      <label>Login Source</label>
      <fieldForLabel>Login_Source</fieldForLabel>
      <fieldForValue>Login_Source</fieldForValue>
      <search base="splunk_sh_05_audit_users_dashboard_v1">
        <query>| stats count by Login_Source</query>
      </search>
      <choice value="*">All</choice>
      <default>*</default>
      <initialValue>*</initialValue>
    </input>
    <input type="dropdown" token="Days_Since_Latest_Login" searchWhenChanged="true">
      <label>Days Since Latest Login &gt;=</label>
      <fieldForLabel>Days_Since_Latest_Login</fieldForLabel>
      <fieldForValue>Days_Since_Latest_Login</fieldForValue>
      <search base="splunk_sh_05_audit_users_dashboard_v1">
        <query>| stats count by Days_Since_Latest_Login
| sort 0 - Days_Since_Latest_Login</query>
      </search>
      <choice value="-1">-1</choice>
      <default>-1</default>
      <initialValue>-1</initialValue>
    </input>
    <input type="dropdown" token="Days_Since_Latest_Login2" searchWhenChanged="true">
      <label>Days Since Latest Login &lt;=</label>
      <fieldForLabel>Days_Since_Latest_Login2</fieldForLabel>
      <fieldForValue>Days_Since_Latest_Login2</fieldForValue>
      <search base="splunk_sh_05_audit_users_dashboard_v1">
        <query>| stats count by Days_Since_Latest_Login
| sort 0 - Days_Since_Latest_Login|rename Days_Since_Latest_Login as Days_Since_Latest_Login2</query>
      </search>
      <choice value="999999">999999</choice>
      <default>999999</default>
      <initialValue>999999</initialValue>
    </input>
  </fieldset>
  <row id="style_settings" depends="$visible$">
    <panel depends="$alwaysHideCSS$">
      <html>
         <style>
           <!--.dashboard-body {-->
           <!--    background: #a6a6a6 !important;-->
           <!--}-->
           .dashboard-panel h2{
             background:#FFA500 !important;
             color:black !important;
             text-align: center !important;
             font-weight: bold !important;
             border-top-right-radius: 15px;
             border-top-left-radius: 15px; }
            .dashboard-panel h1.panel-title {
              font-weight: bold !important;
              font-size: 100% !important; }
                .table, th, td {
              border: 8px solid black !important; }
            { display: none;  }
         </style>
       </html>
    </panel>
  </row>
  <row>
    <panel>
      <title>Total Number of Users</title>
      <single>
        <search base="splunk_sh_05_audit_users_dashboard_v1">
          <query>| stats count</query>
        </search>
        <option name="drilldown">all</option>
        <option name="rangeColors">["0x53a051","0x53a051"]</option>
        <option name="rangeValues">[0]</option>
        <option name="unit">Users</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <title>Users By Splunk Environment</title>
      <chart>
        <search base="splunk_sh_05_audit_users_dashboard_v1">
          <query>| stats count by Splunk_Roles</query>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.drilldown">all</option>
      </chart>
    </panel>
    <panel>
      <title>Users By Splunk Instance</title>
      <chart>
        <search base="splunk_sh_05_audit_users_dashboard_v1">
          <query>| stats count by Splunk_Instance</query>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.sliceCollapsingThreshold">0</option>
        <option name="charting.drilldown">all</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
    <panel>
      <title>Users By LOB</title>
      <chart>
        <search base="splunk_sh_05_audit_users_dashboard_v1">
          <query>| stats count by LOB
| where LOB!="Undefined"</query>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.drilldown">all</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
    <panel>
      <title>Users By Login Source</title>
      <table>
        <search base="splunk_sh_05_audit_users_dashboard_v1">
          <query>| stats count by Login_Source
| sort 0 - count
| rename count AS "# of Login Sources" Login_Source AS "Login Sources"</query>
        </search>
        <option name="count">5</option>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">true</option>
        <option name="totalsRow">true</option>
        <option name="wrap">false</option>
        <format type="color" field="Login Sources">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
        <format type="number" field="# of Login Sources">
          <option name="precision">0</option>
        </format>
        <format type="color" field="# of Login Sources">
          <colorPalette type="minMidMax" maxColor="#B6C75A" midColor="#FFFFFF" minColor="#294E70"></colorPalette>
          <scale type="minMidMax" midType="percentile" midValue="50"></scale>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Users By Department</title>
      <table>
        <search base="splunk_sh_05_audit_users_dashboard_v1">
          <query>| stats count by Department
| where Department!="Undefined"
| sort - count
| rename count as Rank</query>
        </search>
        <option name="count">5</option>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">true</option>
        <option name="totalsRow">true</option>
        <option name="wrap">false</option>
        <format type="color" field="Department">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
        <format type="color" field="count">
          <colorPalette type="minMidMax" maxColor="#B6C75A" midColor="#FFFFFF" minColor="#294E70"></colorPalette>
          <scale type="minMidMax" midType="percentile" midValue="50"></scale>
        </format>
        <format type="color" field="Rank">
          <colorPalette type="minMidMax" maxColor="#5A4575" midColor="#FFFFFF" minColor="#708794"></colorPalette>
          <scale type="minMidMax" midType="percentile" midValue="50"></scale>
        </format>
      </table>
    </panel>
    <panel>
      <title>Users By Cost Center</title>
      <table>
        <search base="splunk_sh_05_audit_users_dashboard_v1">
          <query>| stats count by Cost_Center
| where Cost_Center!="Undefined"
| sort - count</query>
        </search>
        <option name="count">5</option>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">true</option>
        <option name="totalsRow">true</option>
        <option name="wrap">false</option>
        <format type="color" field="Cost_Center">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
        <format type="color" field="Cost_Center">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
        <format type="color" field="count">
          <colorPalette type="minMidMax" maxColor="#5A4575" midColor="#FFFFFF" minColor="#708794"></colorPalette>
          <scale type="minMidMax" midType="percentile" midValue="50"></scale>
        </format>
      </table>
    </panel>
    <panel>
      <title>Users By Employee Type</title>
      <viz type="semicircle_donut.semicircle_donut">
        <search base="splunk_sh_05_audit_users_dashboard_v1">
          <query>| stats count by Emp_Type</query>
        </search>
        <option name="refresh.display">progressbar</option>
        <option name="semicircle_donut.semicircle_donut.cutoutPercentage">70</option>
        <option name="semicircle_donut.semicircle_donut.legendPosition">bottom</option>
        <option name="semicircle_donut.semicircle_donut.type">full</option>
      </viz>
    </panel>
    <panel>
      <title>Users By Country</title>
      <chart>
        <search base="splunk_sh_05_audit_users_dashboard_v1">
          <query>| stats count by work_country
| where work_country!="Undefined"</query>
        </search>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.sliceCollapsingThreshold">0</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.legend.placement">right</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
    <panel>
      <title>Users By State</title>
      <chart>
        <search base="splunk_sh_05_audit_users_dashboard_v1">
          <query>| stats count by work_region
| where work_region!="Undefined"</query>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.sliceCollapsingThreshold">0</option>
        <option name="charting.drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
    <panel>
      <title>Users By City</title>
      <chart>
        <search base="splunk_sh_05_audit_users_dashboard_v1">
          <query>| stats count by work_city
| where work_city!="Undefined"</query>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.sliceCollapsingThreshold">0</option>
        <option name="charting.drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>Report on users logged on including the last time they logged into Splunk</title>
      <table>
        <search base="splunk_sh_05_audit_users_dashboard_v1">
          <query>| fields User Splunk_Instance Splunk_Roles full_name first last Login_Source Days_Since_Latest_Login Latest_Login_Updated managedBy work_city work_region work_country Title LOB Department Emp_Type Emp_Status Cost_Center 
| stats values(Splunk_Roles) AS Splunk_Roles values(Splunk_Instance) AS Splunk_Instance last(*) AS * by User 
| table User Splunk_Instance Splunk_Roles full_name first last Title Emp_Type Emp_Status LOB Department Cost_Center managedBy Latest_Login_Updated Days_Since_Latest_Login work_city work_region work_country Login_Source 
| rename full_name AS "Full Name" first AS "First Name" last AS "Last Name" Login_Source AS "Last Login Source" work_city AS City work_region AS "Region/State" work_country AS Country Latest_Login_Updated AS "Latest Login" Days_Since_Latest_Login AS "Days Since Last Login" managedBy AS Manager Cost_Center AS "Cost Center" Emp_Status AS "Employee Status" Emp_Type AS "Employee Type" Splunk_Instance AS "Splunk Instance" Splunk_Roles AS "Splunk Roles"</query>
        </search>
        <option name="count">5</option>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">true</option>
        <option name="wrap">false</option>
        <format type="color" field="User">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
        <format type="color" field="Splunk Instance">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
        <format type="color" field="Splunk Roles">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
        <format type="color" field="Login_Source">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
        <format type="color" field="Login_Source_Resolved">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
        <format type="color" field="Full Name">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
        <format type="color" field="First Name">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
        <format type="color" field="Last Name">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
        <format type="color" field="Title">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
        <format type="color" field="LOB">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
        <format type="color" field="Department">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
        <format type="color" field="Last Login Source">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
        <format type="number" field="Days Since Last Login">
          <option name="precision">0</option>
          <option name="unit">Days</option>
        </format>
        <format type="color" field="Days Since Last Login">
          <colorPalette type="minMidMax" maxColor="#5A4575" midColor="#FFFFFF" minColor="#708794"></colorPalette>
          <scale type="minMidMax" midType="percentile" midValue="50"></scale>
        </format>
        <format type="color" field="Latest Login">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
        <format type="color" field="Employee Type">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
        <format type="color" field="Employee Status">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
        <format type="color" field="Cost Center">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
        <format type="color" field="Manager">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
        <format type="color" field="City">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
        <format type="color" field="Region/State">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
        <format type="color" field="Country">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <map>
        <search base="splunk_sh_05_audit_users_dashboard_v1">
          <query>| rename work_city AS city , work_region AS region , work_country AS country , work_lat AS lat , work_lon AS lon 
| eval city = if(city="Undefined", null(), city), region = if(region="Undefined", null(), region) , country = if(country="Undefined", null(), country) 
| fields city region country lat lon 
| eval city = if ( isnull(city) AND isnull(region) AND isnull(country), "San Francisco", city) 
| eval region = if (isnull(city) AND isnull(region) AND isnull(country), "CA", region) 
| eval country = if (isnull(city) AND isnull(region) AND isnull(country), "United States", country) 
| lookup splunk_sh_cities_geo_lookup city region_code as region country as country OUTPUTNEW latitude AS lat longitude AS lon 
| lookup splunk_sh_cities_geo_lookup city country OUTPUTNEW latitude AS lat longitude AS lon 
| geostats count by city globallimit=0 locallimit=0 maxzoomlevel=18</query>
        </search>
        <option name="drilldown">none</option>
        <option name="height">800</option>
        <option name="mapping.data.maxClusters">100</option>
        <option name="mapping.map.center">(41.64,-93.49)</option>
        <option name="mapping.map.zoom">5</option>
        <option name="mapping.markerLayer.markerMaxSize">70</option>
        <option name="mapping.markerLayer.markerMinSize">20</option>
        <option name="mapping.markerLayer.markerOpacity">1</option>
        <option name="mapping.showTiles">1</option>
        <option name="mapping.tileLayer.maxZoom">19</option>
        <option name="mapping.tileLayer.minZoom">0</option>
        <option name="mapping.tileLayer.url">http://mt1.google.com/vt/lyrs=y&amp;x={x}&amp;y={y}&amp;z={z}</option>
        <option name="mapping.type">marker</option>
        <option name="refresh.display">progressbar</option>
      </map>
    </panel>
  </row>
</form>