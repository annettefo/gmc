"Splunk_Instance","Splunk_Roles",title,definition,args,app,sharing,author,description
CM1,"PROD-CM-1|cluster_master|search_head","add_dm_object_name(1)","rename * as ""$object$.*""",object,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cam_action_modes","inputlookup append=T cam_action_mode_lookup | eval action_mode=lower(action_mode) | dedup action_mode | sort + action_mode",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cam_action_statuses","inputlookup append=T cam_action_status_lookup | eval action_status=lower(action_status) | dedup action_status | sort + action_status",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cam_categories","inputlookup append=T cam_category_lookup | dedup category | sort + category",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cam_subjects","inputlookup append=T cam_subject_lookup | eval subject=lower(subject) | dedup subject | sort + subject",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cam_tasks","inputlookup append=T cam_task_lookup | eval task=lower(task) | dedup task | sort + task",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cam_workers","inputlookup append=T cam_worker_lookup | append[| makeresults | eval worker_set=""local"",cam_workers=""[\""local\""]""] | dedup worker_set | spath input=cam_workers | where isnotnull('{}') | table worker_set,cam_workers | sort + worker_set",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_Alerts_indexes","()",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_Application_State_indexes","()",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_Authentication_indexes","()",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_Certificates_indexes","()",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_Change_Analysis_indexes","()",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_Change_indexes","()",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_Compute_Inventory_indexes","()",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_DLP_indexes","()",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_Databases_indexes","()",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_Email_indexes","()",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_Endpoint_indexes","()",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_Event_Signatures_indexes","()",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_Interprocess_Messaging_indexes","()",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_Intrusion_Detection_indexes","()",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_JVM_indexes","()",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_Malware_indexes","()",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_Network_Resolution_indexes","()",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_Network_Sessions_indexes","()",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_Network_Traffic_indexes","()",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_Performance_indexes","()",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_Ticket_Management_indexes","()",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_Updates_indexes","()",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_Vulnerabilities_indexes","()",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_Web_indexes","()",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_access_actions","inputlookup append=T cim_access_action_lookup | eval action=lower(action) | dedup action",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_corporate_email_domain_search(1)","[| `cim_corporate_email_domains` | rename domain as $field$ | format | fields search]",field,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_corporate_email_domains","inputlookup append=T cim_corporate_email_domain_lookup",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_corporate_web_domain_search(1)","[| `cim_corporate_web_domains` | rename domain as $field$ | format | fields search]",field,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_corporate_web_domains","inputlookup append=T cim_corporate_web_domain_lookup",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_datamodelinfo","rest /services/admin/summarization by_tstats=t splunk_server=local count=0 | eval key=replace('title',""tstats:DM_"".'eai:acl.app'.""_"",""""),datamodel=replace('summary.id',""DM_"".'eai:acl.app'.""_"","""") | join type=left key [| rest /services/data/models splunk_server=local count=0 | table title acceleration.cron_schedule eai:digest | rename title as key | rename acceleration.cron_schedule AS cron] | table datamodel eai:acl.app summary.access_time summary.is_inprogress summary.size summary.latest_time summary.complete summary.buckets_size summary.buckets cron summary.last_error summary.time_range summary.id summary.mod_time eai:digest summary.earliest_time summary.last_sid summary.access_count | rename summary.id AS summary_id, summary.time_range AS retention, summary.earliest_time as earliest, summary.latest_time as latest, eai:digest as digest | rename summary.* AS *, eai:acl.* AS * | sort datamodel",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_dlp_actions","inputlookup append=T cim_dlp_action_lookup | eval action=lower(action) | dedup action | sort + action",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_dlp_object_categories","inputlookup append=T cim_dlp_object_category_lookup | eval object_category=lower(object_category) | dedup object_category | sort + object_category",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_dlp_types","inputlookup append=T cim_dlp_type_lookup | eval dlp_type=lower(dlp_type) | dedup dlp_type | sort + dlp_type",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_dns_reply_codes","inputlookup append=T cim_dns_reply_code_lookup | dedup reply_code | sort + reply_code",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_email_protocols","inputlookup append=T cim_email_protocol_lookup | sort + protocol",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_endpoint_actions","inputlookup append=T cim_endpoint_action_lookup | eval action=lower(action) | dedup action | sort + action",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_endpoint_object_categories","inputlookup append=T cim_endpoint_object_category_lookup | eval object_category=lower(object_category) | dedup object_category | sort + object_category",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_endpoint_severities","inputlookup append=T cim_endpoint_severity_lookup | eval severity=lower(severity) | dedup severity",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_endpoint_statuses","inputlookup append=T cim_endpoint_status_lookup | eval status=lower(status) | dedup status | sort + status",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_endpoint_user_types","inputlookup append=T cim_endpoint_user_type_lookup | eval user_type=lower(user_type) | dedup user_type | sort + user_type",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_filter_known_scanners","NOT (host_category=""known_scanner"" OR orig_host_category=""known_scanner"" OR dvc_category=""known_scanner"" OR src_category=""known_scanner"" OR dest_category=""known_scanner"")",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_filter_known_scanners(1)","NOT ($object$.host_category=""known_scanner"" OR $object$.orig_host_category=""known_scanner"" OR $object$.dvc_category=""known_scanner"" OR $object$.src_category=""known_scanner"" OR $object$.dest_category=""known_scanner"")",object,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_filter_unknown_values(1)","($field$!=""-"" $field$!=""n/a"" $field$!=""unknown"")",field,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_filter_vuln_severity","(severity!=""informational"" AND severity!=""low"")",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_filter_vuln_severity(1)","($object$.severity!=""informational"" AND $object$.severity!=""low"")",object,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_http_methods","inputlookup append=T cim_http_method_lookup | eval http_method=lower(http_method) | dedup http_method",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_http_statuses","inputlookup append=T cim_http_status_lookup",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_ids_severities","inputlookup append=T cim_ids_severity_lookup | eval severity=lower(severity) | dedup severity",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_ids_types","inputlookup append=T cim_ids_type_lookup | eval ids_type=lower(ids_type) | dedup ids_type | sort + ids_type",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_malware_actions","inputlookup append=T cim_malware_action_lookup | eval action=lower(action) | dedup action | sort + action",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_traffic_actions","inputlookup append=T cim_traffic_action_lookup | eval action=lower(action) | dedup action | sort + action",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_transport_protocols","inputlookup append=T cim_transport_protocol_lookup | eval transport=lower(transport) | dedup transport | sort + transport",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_update_statii","inputlookup append=T cim_update_status_lookup | eval status=lower(status) | dedup status | sort + status",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_vendor_product_tracker","inputlookup append=T cim_vendor_product_tracker",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cim_vuln_severities","inputlookup append=T cim_vuln_severity_lookup | eval severity=lower(severity) | dedup severity",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cloud_domain_search(1)","[| `cloud_domains` | rename domain as $field$ | fields $field$ | format | fields search]",field,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cloud_domains","inputlookup append=T cim_cloud_domain_lookup",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cloud_email_search(1)","[| `cloud_domains` | search is_email=true | rename domain as $field$ | fields $field$ | format | fields search]",field,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","cloud_storage_search(1)","[| `cloud_domains` | search is_storage=true | rename domain as $field$ | fields $field$ | format | fields search]",field,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","datamodel(2)","datamodel $model$ $object$ search","model,object","Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","drop_dm_object_name(1)","rename ""$object$.*"" as *",object,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","get_signature(1)","(signature=""*$value$*"" OR signature_id=""*$value$*"")",value,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","get_src_user_only(1)","(src_user=""$src_user$"" OR src_user_identity=""$src_user$"")","src_user","Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","get_subject(2)","($subjectField$=""$bestmatch$"" OR $subjectField$_ip=""$bestmatch$"" OR $subjectField$_mac=""$bestmatch$"" OR $subjectField$_nt_host=""$bestmatch$"" OR $subjectField$_dns=""$bestmatch$"")","subjectField, bestmatch","Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","get_user(1)","(`get_src_user_only($user$)` OR `get_user_only($user$)`)",user,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","get_user_only(1)","(user=""$user$"" OR user_identity=""$user$"")",user,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","get_vendor_product","eval vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!=""unknown"" AND isnotnull(product) AND product!=""unknown"",vendor."" "".product,isnotnull(vendor) AND vendor!=""unknown"" AND (isnull(product) OR product=""unknown""),vendor."" unknown"",(isnull(vendor) OR vendor=""unknown"") AND isnotnull(product) AND product!=""unknown"",""unknown "".product,isnotnull(sourcetype),sourcetype,1=1,""unknown"")",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","make_subject(1)","eval ""$subjectField$""=case(isnotnull('$subjectField$'), '$subjectField$', isnotnull('$subjectField$_dns'), '$subjectField$_dns', isnotnull('$subjectField$_nt_host'), '$subjectField$_nt_host', isnotnull('$subjectField$_mac'), '$subjectField$_mac', isnotnull('$subjectField$_ip'), '$subjectField$_ip')",subjectField,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","modular_action_invocations(2)","tstats summariesonly=false latest(Modular_Actions.action_status) as action_status from datamodel=Splunk_Audit.Modular_Actions where Modular_Actions.action_name!=""unknown"" (Modular_Actions.sid=$sid$ Modular_Actions.rid=$rid$) OR (Modular_Actions.orig_sid=$sid$ Modular_Actions.orig_rid=$rid$) by _time,nodename,Modular_Actions.action_name,Modular_Actions.sid,Modular_Actions.rid,Modular_Actions.action_mode,Modular_Actions.user span=1s | `drop_dm_object_name(""Modular_Actions"")` | eventstats latest(action_status) as action_status by action_name,sid,rid | search nodename=""Modular_Actions.Modular_Action_Invocations"" | sort 0 -_time | join type=outer action_name [| rest splunk_server=local count=0 /services/alerts/alert_actions | spath input=param._cam path=drilldown_uri output=action_drilldown_uri | rename title as action_name,label as action_label | fields action_name,action_label,action_drilldown_uri] | eval action_label=if(isnotnull(action_label),action_label,action_name),epoch_time=_time | fields _time,epoch_time,action_status,action_name,action_label,action_mode,action_drilldown_uri,sid,rid,user","sid,rid","Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","recommended_datamodel_attributes(2)","datamodel ""$model$"" ""$object$"" | spath output=calcs path=calculations{} | spath output=fields path=fields{} | eval outfields=mvappend(fields,NULL,calcs) | mvexpand outfields | spath output=fields input=outfields path=outputFields{} | eval fields=if(isnull(fields),outfields,fields) | mvexpand fields | spath output=field input=fields path=fieldName | spath output=recommended input=fields path=comment.recommended | search recommended=""true"" | table field | sort field","model,object","Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","remap_subjects","tags outputfield=evtTags | `swap_if_tagged(src, dest, evtTags)` | fields - evtTags",,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","swap_if_tagged(3)","eval swapTmp='$second$' | eval ""$second$""=if('$tagField$'=""swap_$first$_$second$"", '$first$', '$second$') | eval ""$first$""=if('$tagField$'=""swap_$first$_$second$"", swapTmp, '$first$') | fields - swapTmp","first, second, tagField","Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","vendor_product_tracker(1)","inputlookup append=T cim_vendor_product_tracker | search model=""$model$""",model,"Splunk_SA_CIM",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","nix-netmon-hosts-search","eventtype=netstat | stats count by host | sort +host",,"Splunk_TA_nix",global,system,
CM1,"PROD-CM-1|cluster_master|search_head","btool_multikv","multikv noheader=t | rex ""(?<SPLUNK_HOME>.*?)/etc/(?<app_folder>apps|master-apps|system|slave-apps)/((?<app>.*)/)?(?<directory>default|local)/(?<file>\w+\.conf)""",,btool,global,system,
CM1,"PROD-CM-1|cluster_master|search_head","file_quest_default",Linux,,"config_quest",app,admin,
CM1,"PROD-CM-1|cluster_master|search_head","file_quest_os","makeresults
| eval paths=mvappend(""Windows,c%3A%5Cprogram%20files%5Csplunk"",""Linux,%2Fopt%2Fsplunk"",""Mac,%2FApplications%2Fsplunk"")
| mvexpand paths
| rex field=paths ""(?<label>[^,]+),(?<value>[^,]+)$""
| fields - _time paths",,"config_quest",app,admin,
CM1,"PROD-CM-1|cluster_master|search_head","file_quest_paths(1)","makeresults
| eval paths=mvappend(
""SPLUNK_HOME,$slash$"",
""etc,$slash$etc"",
""etc/apps,$slash$etc$slash$apps"",
""etc/deployment-apps,$slash$etc$slash$deployment-apps"",
""etc/master-apps,$slash$etc$slash$master-apps"",
""var,$slash$var"",
""etc/system/local,$slash$etc$slash$system$slash$local"",
""etc/users,$slash$etc$slash$users"",
""etc/licenses,$slash$etc$slash$licenses""
)
| mvexpand paths
| rex field=paths ""(?<label>[^,]+),(?<value>.*)$""
| fields - _time, paths",slash,"config_quest",app,admin,
CM1,"PROD-CM-1|cluster_master|search_head","audit_rexsearch","rex ""search='(?<search>.*?)', autojoin""",,search,app,system,
CM1,"PROD-CM-1|cluster_master|search_head","audit_searchlocal","`audit_searchlocal(""search_id!=rt_*"")`",,search,app,system,
CM1,"PROD-CM-1|cluster_master|search_head","audit_searchlocal(1)","search index=_audit action=search (id=* OR search_id=*) | eval search_id = if(isnull(search_id), id, search_id) | replace '*' with * in search_id | search $filter$",filter,search,app,system,
CM1,"PROD-CM-1|cluster_master|search_head","comment(1)","""""",text,search,app,system,
CM1,"PROD-CM-1|cluster_master|search_head","histperc(3)","sort $le$
| eventstats max($hist_rate$) as total_hist_rate, last($le$) as uppermost_bound, count as num_buckets
| eval rank=exact($perc$)*total_hist_rate
| streamstats current=f last($le$) as gr, last($hist_rate$) as last_hist_rate
| eval gr=if(isnull(gr), 0, gr), last_hist_rate=if(isnull(last_hist_rate), 0, last_hist_rate)
| where $hist_rate$ >= rank
| head 1
| eval res=case(lower(uppermost_bound) != ""+inf"" or num_buckets < 2, ""NaN"", lower($le$) == ""+inf"", gr, gr == 0 and $le$ <= 0, $le$, true(), exact(gr + ($le$-gr)*(rank - last_hist_rate) / ($hist_rate$ - last_hist_rate)))
| fields res
| rename res as ""histperc""","perc, hist_rate, le",search,app,system,
CM1,"PROD-CM-1|cluster_master|search_head","histperc(4)","sort $groupby$, $le$
| eventstats max($hist_rate$) as total_hist_rate, last($le$) as uppermost_bound, count as num_buckets by $groupby$
| eval rank=exact($perc$)*total_hist_rate
| streamstats current=f last($le$) as gr, last($hist_rate$) as last_hist_rate by $groupby$
| eval gr=if(isnull(gr), 0, gr), last_hist_rate=if(isnull(last_hist_rate), 0, last_hist_rate)
| where $hist_rate$ >= rank
| dedup $groupby$
| eval res=case(lower(uppermost_bound) != ""+inf"" or num_buckets < 2, ""NaN"", lower($le$) == ""+inf"", gr, gr == 0 and $le$ <= 0, $le$, true(), exact(gr + ($le$-gr)*(rank - last_hist_rate) / ($hist_rate$ - last_hist_rate)))
| fields $groupby$, res
| rename res as ""histperc""","perc, hist_rate, le, groupby",search,app,system,
CM1,"PROD-CM-1|cluster_master|search_head","set_local_host","rest splunk_server=local /services/server/info | return host",,search,app,system,
CM1,"PROD-CM-1|cluster_master|search_head","truncate_search","eval search=if(length(search) > 150, substr(search, 0, 150) + ""..."", search)",,search,app,system,
CM1,"PROD-CM-1|cluster_master|search_head","instrumentation_distribution_strings(3)","""\""avg\"":""+`instrumentation_number_format($name$_avg,$multiplier$,$round_digits$)` + "","" + ""\""min\"":""+`instrumentation_number_format($name$_min,$multiplier$,$round_digits$)` + "","" + ""\""max\"":""+`instrumentation_number_format($name$_max,$multiplier$,$round_digits$)` + "","" + ""\""p10\"":""+`instrumentation_number_format($name$_p10,$multiplier$,$round_digits$)` + "","" + ""\""p20\"":""+`instrumentation_number_format($name$_p20,$multiplier$,$round_digits$)` + "","" + ""\""p30\"":""+`instrumentation_number_format($name$_p30,$multiplier$,$round_digits$)` + "","" + ""\""p40\"":""+`instrumentation_number_format($name$_p40,$multiplier$,$round_digits$)` + "","" + ""\""p50\"":""+`instrumentation_number_format($name$_p50,$multiplier$,$round_digits$)` + "","" + ""\""p60\"":""+`instrumentation_number_format($name$_p60,$multiplier$,$round_digits$)` + "","" + ""\""p70\"":""+`instrumentation_number_format($name$_p70,$multiplier$,$round_digits$)` + "","" + ""\""p80\"":""+`instrumentation_number_format($name$_p80,$multiplier$,$round_digits$)` + "","" + ""\""p90\"":""+`instrumentation_number_format($name$_p90,$multiplier$,$round_digits$)`","name,multiplier,round_digits","splunk_instrumentation",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","instrumentation_distribution_values(1)","avg($name$) as $name$_avg min($name$) as $name$_min max($name$) as $name$_max perc10($name$) as $name$_p10 perc20($name$) as $name$_p20 perc30($name$) as $name$_p30 perc40($name$) as $name$_p40 perc50($name$) as $name$_p50 perc60($name$) as $name$_p60 perc70($name$) as $name$_p70 perc80($name$) as $name$_p80 perc90($name$) as $name$_p90",name,"splunk_instrumentation",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","instrumentation_number_format(3)","tostring(coalesce(round($name$*$multiplier$,$round_digits$), ""null""))","name,multiplier,round_digits","splunk_instrumentation",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_audit_get_search_type","eval search_type = case( 
match(search_id, ""^SummaryDirector_""), ""summarization"", 
match(search_id, ""^((rt_)?scheduler__|alertsmanager_)""), ""scheduled"", 
match(search_id, ""\d{10}\.\d+(_[0-9A-F]{8}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{12})?$""), ""ad hoc"", 
true(), ""other"")",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_audit_get_searches(1)","`dmc_set_index_audit` host=$host$ action=search sourcetype=audittrail search_id!=""rsa_*"" 
| eval user = if(user=""n/a"", null(), user) 
| `dmc_audit_get_search_type` 
| eval search=if(isnull(savedsearch_name) OR savedsearch_name=="""", search, savedsearch_name)",host,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_audit_get_searches_for_groups(1)","`dmc_set_index_audit` search_group=dmc_group_search_head search_group=$search_group$ action=search sourcetype=audittrail search_id!=""rsa_*"" 
| eval user = if(user=""n/a"", null(), user) 
| `dmc_audit_get_search_type` 
| eval search=if(isnull(savedsearch_name) OR savedsearch_name=="""", search, savedsearch_name)","search_group","splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_audit_searchlocal(1)","search `dmc_set_index_audit` action=search (id=* OR search_id=*) | eval search_id = if(isnull(search_id), id, search_id) | replace '*' with * in search_id | search $filter$",filter,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_background_flush_rangemap","rangemap field=percent ""0-10%""=0-10 ""10-50%""=10.001-50 ""50-100%""=50.001-100 default=abnormal",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_build_forwarder_assets(1)","`dmc_get_forwarder_tcpin` 
| stats values(fwdType) as forwarder_type, latest(version) as version, values(arch) as arch, values(os) as os, max(_time) as last_connected, sum(kb) as new_sum_kb, sparkline(avg(tcp_KBps), $sparkline_span$) as new_avg_tcp_kbps_sparkline, avg(tcp_KBps) as new_avg_tcp_kbps, avg(tcp_eps) as new_avg_tcp_eps by guid, hostname","sparkline_span","splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_classify_processes","eval process_class = case(    
    process==""splunk-optimize"",""index service"",    
    process==""sh"" OR process==""ksh"" OR process==""bash"" OR like(process,""python%"") OR process==""powershell"",""scripted input"",    
    process==""mongod"", ""KVStore"") 
| eval process_class = case(    
    process==""splunkd"" AND (like(args,""-p %start%"") OR like(args,""service"") OR like(args,""%_internal_launch_under_systemd%"")),""splunkd server"",    
    process==""splunkd"" AND isnotnull(sid),""search"",    
    process==""splunkd"" AND (like(args,""fsck%"") OR like(args,""recover-metadata%"") OR like(args,""cluster_thing"")),""index service"",    
    process==""splunkd"" AND args==""instrument-resource-usage"", ""scripted input"",
    (like(process,""python%"") AND like(args,""%/appserver/mrsparkle/root.py%"")) OR like(process,""splunkweb""),""Splunk Web"",    
    isnotnull(process_class), process_class)    
| eval process_class = if(isnull(process_class),""other"",process_class)",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_collection_interval","collection_interval = 10",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_convert_count_unit(1)","case( 
$x$ >= 1000000000000, round($x$ / 1000000000000, 2).""T"", 
$x$ >= 1000000000, round($x$ / 1000000000, 2).""B"", 
$x$ >= 1000000, round($x$ / 1000000, 2).""M"", 
$x$ >= 1000, round($x$ / 1000, 2).""K"", 
true(), $x$ 
)",x,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_convert_disk_usage_unit(1)","case( 
$x$ > 1000000, round($x$ / 1024 / 1024, 2)."" TB"" 
$x$ > 1000, round($x$ / 1024, 2)."" GB"" 
1 == 1, $x$."" MB"" 
)",x,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_convert_runtime(1)","case( 
round($runtime$ / (3600*24) - 0.5) > 0, round($runtime$ / (3600*24) - 0.5).""d "".round(($runtime$ % (3600*24)) / 3600 - 0.5).""h "".round(($runtime$ % 3600) / 60 - 0.5).""min "".round($runtime$ % 60, 2).""s"", 
round(($runtime$ % (3600*24)) / 3600 - 0.5) > 0, round(($runtime$ % (3600*24)) / 3600 - 0.5).""h "".round(($runtime$ % 3600) / 60 - 0.5).""min "".round($runtime$ % 60, 2).""s"", 
round(($runtime$ % 3600) / 60 - 0.5) > 0, round(($runtime$ % 3600) / 60 - 0.5).""min "".round($runtime$ % 60, 2).""s"", 
1 = 1, round($runtime$ % 60, 2).""s"" 
)",runtime,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_cpu_usage_rangemap","rangemap field=cpu_usage ""0-60%""=0-60 ""60-80%""=60.001-80 ""80-100%""=80.001-100 ""100%+""=100.001-999999 default=abnormal",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_cpu_usage_rangemap_and_timechart","`dmc_cpu_usage_rangemap` 
| `dmc_timechart` partial=f dc(server) as server_count by range 
| fields _time, ""100%+"", ""80-100%"", ""60-80%"", ""0-60%""",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_daily_license_usage_quota","rest `dmc_dmc_group_license_master` /services/licenser/pools 
| join type=outer stack_id splunk_server [rest `dmc_dmc_group_license_master` /services/licenser/groups | search is_active=1 | eval stack_id=stack_ids | fields splunk_server stack_id is_active] 
| search is_active=1 
| fields splunk_server, stack_id, used_bytes 
| join type=outer stack_id splunk_server [rest `dmc_dmc_group_license_master` /services/licenser/stacks | eval stack_id=title | eval stack_quota=quota | fields splunk_server stack_id stack_quota] 
| stats sum(used_bytes) as used_bytes max(stack_quota) as stack_quota by splunk_server 
| eval usedGB=round(used_bytes/1024/1024/1024,3) 
| eval totalGB=round(stack_quota/1024/1024/1024,3) 
| eval percentage=round(usedGB / totalGB, 3)*100 
| fields splunk_server, percentage, usedGB, totalGB",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_disk_usage_rangemap","rangemap field=pct_disk_usage ""0-60%""=0-0.6 ""60-80%""=0.6001-0.8 ""80-100%""=0.8001-1 default=abnormal",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_disk_usage_rangemap_and_timechart","`dmc_disk_usage_rangemap` 
| `dmc_timechart_for_disk_usage` partial=f dc(server_mount_point) as server_mount_point_count by range 
| fields _time, ""80-100%"", ""60-80%"", ""0-60%""",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_dmc_group_license_master","splunk_server_group=dmc_group_license_master",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_drilldown_indexing_performance_deployment_indexing_rate(2)","`dmc_set_index_internal` source=*metrics.log* sourcetype=splunkd search_group=dmc_group_indexer search_group=$group$ group=thruput name=index_thruput 
| stats sum(kb) AS total_kb by host 
| addinfo 
| eval time_window = info_max_time - info_min_time 
| eval kbps = round(total_kb / time_window, 0) 
| `dmc_indexing_rate_rangemap` 
| where range=""$metric$"" 
| `dmc_drilldown_join_peers_by_peerURI` 
| eval Action = Action."" dmc_group_indexer"" 
| fields serverName, machine, kbps, range, numberOfCores, ram, version, Action
| eval kbps = kbps."" KB/s"" 
| rename serverName as Instance, machine as Machine, kbps as ""Indexing Rate"", range as ""Indexing Rate Range"", version as Version, numberOfCores as Cores, ram as RAM","group, metric","splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_drilldown_indexing_performance_deployment_queue_fill_ratio(4)","`dmc_set_index_internal` source=*metrics.log sourcetype=splunkd search_group=dmc_group_indexer search_group=$group$ group=queue name=$queueType$ 
| eval max=if(isnotnull(max_size_kb),max_size_kb,max_size) 
| eval curr=if(isnotnull(current_size_kb),current_size_kb,current_size) 
| eval fill_perc=round((curr/max)*100,2) 
| stats $funcQueue$(fill_perc) AS fill_percentage by host 
| `dmc_queue_fill_ratio_rangemap` 
| where range=""$metric$"" 
| `dmc_drilldown_join_peers_by_peerURI` 
| eval Action = Action."" dmc_group_indexer"" 
| fields serverName, machine, fill_percentage, range, numberOfCores, ram, version, Action 
| rename serverName as Instance, machine as Machine, fill_percentage as ""Fill Ratio (%)"", range as ""Fill Ratio Range"", version as Version, numberOfCores as Cores, ram as RAM","group, queueType, funcQueue, metric","splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_drilldown_join_peers_by_peerURI","lookup dmc_assets host OUTPUT peerURI, serverName, machine 
| eval peerURI = mvindex(peerURI, 0) 
| eval machine = mvindex(machine, 0) 
| eval serverName = mvindex(serverName, 0) 
| join type=outer peerURI 
 [| rest splunk_server=local /services/search/distributed/peers 
  | rename title as peerURI 
  | append  
    [| rest splunk_server=local /services/server/info 
     | eval peerURI = ""localhost"" 
    ] 
  | eval ram = round(physicalMemoryMB / 1024, 2)."" GB"" 
  | fields peerURI, version, numberOfCores, ram 
 ] 
| eval Action = serverName 
| fields - _time",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_drilldown_kv_store_deployment_background_flush(2)","`dmc_set_index_introspection` search_group=$group$ search_group=dmc_group_kv_store component=kvstoreserverstats 
| stats range(data.backgroundFlushing.total_ms)  AS diff by  host 
| addinfo 
| eval time_window = info_max_time - info_min_time 
| eval ms_per_min = diff / (time_window / 60) 
| eval percent = round(ms_per_min / (60 * 1000) * 100, 2) 
| `dmc_background_flush_rangemap` 
| where range=""$metric$"" 
| `dmc_drilldown_join_peers_by_peerURI` 
| eval Action = Action."" dmc_group_kv_store"" 
| fields serverName, machine, percent, range, numberOfCores, ram, version, Action 
| rename serverName as Instance, machine as Machine, percent as ""Background Flush (%)"", range as ""Background Flush Range"", version as Version, numberOfCores as Cores, ram as RAM","group, metric","splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_drilldown_kv_store_deployment_lock_percentage(3)","`dmc_set_index_introspection` search_group=dmc_group_kv_store  search_group=$group$ component=kvstoreserverstats 
| stats range(data.globalLock.lockTime) AS globalLock range(data.globalLock.totalTime) AS total by host  
| eval percent=abs(globalLock*100/total)   
| stats $countLockFunc$(percent) as percent_locked by host 
| rangemap field=percent_locked ""0-30%""=0-30 ""30-50%""=30.001-50 ""50-100%""=50.001-1000 default=abnormal  
| where range=""$metric$"" 
| `dmc_drilldown_join_peers_by_peerURI` 
| eval Action = Action."" dmc_group_kv_store"" 
| fields serverName, machine, percent_locked, range, numberOfCores, ram, version, Action 
| rename serverName as Instance, machine as Machine, percent_locked as ""Lock (%)"", range as ""Lock Percentage Range"", version as Version, numberOfCores as Cores, ram as RAM","group, countLockFunc, metric","splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_drilldown_kv_store_deployment_memory_ratio(2)","`dmc_set_index_introspection` search_group=$group$ search_group=dmc_group_kv_store component=kvstoreserverstats 
| eval ratio='data.mem.virtual'/'data.mem.mappedWithJournal' 
| stats avg(ratio) AS myratio by host  
| eval myratio = round(myratio, 2) 
| rangemap field=myratio ""0-2x""=0-2 ""2-3x""=2.001-3 "">3x""=3.001-10000 default=abnormal 
| where range=""$metric$"" 
| `dmc_drilldown_join_peers_by_peerURI` 
| eval Action = Action."" dmc_group_kv_store"" 
| fields serverName, machine, myratio, range, numberOfCores, ram, version, Action 
| rename serverName as Instance, machine as Machine, myratio as ""Virtual to Mapped Ratio"", range as ""Ratio Range"", version as Version, numberOfCores as Cores, ram as RAM","group, metric","splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_drilldown_kv_store_deployment_network(1)","`dmc_set_index_introspection` search_group=dmc_group_kv_store search_group=$group$ component=kvstoreserverstats 
| stats range(data.network.bytesIn) as indiff range(data.network.bytesOut) as outdiff range(data.network.numRequests) as Requests by host 
| eval ""MB In""=indiff/1000000 
| eval ""MB Out""=outdiff/1000000 
| `dmc_drilldown_join_peers_by_peerURI` 
| eval Action = Action."" dmc_group_kv_store"" 
| table serverName, machine, ""MB In"", ""MB Out"", Requests, numberOfCores, ram, version, Action 
| rename serverName as Instance, machine as Machine, version as Version, numberOfCores as Cores, ram as RAM",group,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_drilldown_kv_store_deployment_page_faults(3)","`dmc_set_index_introspection` search_group=dmc_group_kv_store search_group=$group$ component=kvstoreserverstats  
| rename data.opcounters.command as c, data.opcounters.update as u, data.opcounters.queries as q, data.opcountes.deletes as d, data.opcounters.getmore as g, data.opcounters.inserts as i 
| eval commands=if(isNotNull('c'), 'c',0) 
| eval updates=if(isNotNull('u'), 'u', 0) 
| eval queries=if(isNotNull('q'), 'q', 0) 
| eval deletes=if(isNotNull('d'), 'd', 0) 
| eval getmores=if(isNotNull('g'), 'g', 0) 
| eval inserts=if(isNotNull('i'), 'i', 0) 
| eval totalops=commands+updates+queries+deletes+getmores+inserts 
| bin _time minspan=30s 
| stats latest(totalops) AS ops latest(data.extra_info.page_faults) AS pf by host _time 
| eval  percent=if(opsdiff==0, 0, round(abs(pf/ops), 2))   
| stats $countPageFaultsFunc$(percent) as percent by host  
| rangemap field=percent ""0-0.7""=0-0.7 ""0.7-1.3""=0.7001-1.3 ""1.3+""=1.3001-999999 default=abnormal  
| where range=""$metric$"" 
| `dmc_drilldown_join_peers_by_peerURI` 
| eval Action = Action."" dmc_group_kv_store"" 
| fields serverName, machine, percent, range, numberOfCores, ram, version, Action 
| rename serverName as Instance, machine as Machine, percent as ""Page Faults per Operation"", range as ""Page Fault Range"", version as Version, numberOfCores as Cores, ram as RAM","group, countPageFaultsFunc, metric","splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_drilldown_kv_store_deployment_replication_lag(2)","`dmc_set_index_introspection` search_group=$group$ search_group=dmc_group_kv_store component=kvstorereplicasetstats  data.replSetStats.myState!=1 
| stats max(data.oplogInfo.end) AS local, max(data.replSetStats.myState) AS state, max(data.replSetStats.date) AS date by host 
| eval date = date/1000 
| `dmc_time_format(date)` 
| join 
  [ search `dmc_set_index_introspection` search_group=dmc_group_kv_store component=kvstorereplicasetstats data.replSetStats.myState=1 
  | stats max(data.oplogInfo.end) AS primary] 
| eval lag=(primary-local)/1000 
| eval lag = round(lag, 2) 
| `dmc_replication_lag_rangemap` 
| where range=""$metric$"" 
| rename host as Instance, lag as Lag, range as ""Lag Range"", state as State, date as ""Oplog Date"" 
| table Instance Lag ""Oplog Date"" ""Lag Range"" State","group, metric","splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_drilldown_kv_store_primary_oplog_window(1)","`dmc_set_index_introspection` search_group=$group$ search_group=dmc_group_kv_store component=kvstorereplicasetstats data.replSetStats.myState=1 
| eval Instance=host 
| rename data.oplogInfo.start as start, data.oplogInfo.end as end 
| eval start = start/1000 
| eval end = end/1000 
| eval diff= (end-start)/3600 
| `dmc_time_format(start)` 
| `dmc_time_format(end)` 
| stats first(start) as ""Start Date"" first(end) as ""End Date"" first(diff) as ""Window (Hours)"" by Instance",group,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_drilldown_resource_usage_deployment_cpu_usage(4)","`dmc_set_index_introspection` search_group=$role$ search_group=$group$ sourcetype=splunk_resource_usage component=Hostwide 
| eval total_cpu_usage = 'data.cpu_system_pct' + 'data.cpu_user_pct' 
| stats $countCPUFunc$(total_cpu_usage) as cpu_usage by host 
| `dmc_cpu_usage_rangemap` 
| where range=""$metric$"" 
| `dmc_drilldown_join_peers_by_peerURI` 
| eval Action = Action."" $role$"" 
| fields serverName, machine, cpu_usage, range, numberOfCores, ram, version, Action 
| eval cpu_usage = cpu_usage."" %"" 
| rename serverName as Instance, machine as Machine, cpu_usage as ""CPU Usage"", range as ""CPU Usage Range"", version as Version, numberOfCores as Cores, ram as RAM","role, group, countCPUFunc, metric","splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_drilldown_resource_usage_deployment_disk_usage(4)","`dmc_set_index_introspection` search_group=$role$ search_group=$group$ sourcetype=splunk_disk_objects component=Partitions 
| eval mount_point = 'data.mount_point' 
| eval free = if(isnotnull('data.available'), 'data.available', 'data.free') 
| eval pct_disk_usage = round(1 - free / 'data.capacity', 2) 
| eval server_mount_point = host."":"".mount_point 
| stats $countDiskFunc$(pct_disk_usage) as pct_disk_usage by server_mount_point 
| `dmc_disk_usage_rangemap` 
| where range=""$metric$"" 
| eval host = replace(server_mount_point, "":.*"", """") 
| eval mount_point = replace(server_mount_point, "".*:"", """") 
| eval pct_disk_usage = pct_disk_usage * 100 
| `dmc_drilldown_join_peers_by_peerURI` 
| eval Action = Action."" $role$"" 
| fields serverName, machine, mount_point, pct_disk_usage, range, numberOfCores, ram, version, Action 
| rename serverName as Instance, machine as Machine, mount_point as ""Mount Point"", pct_disk_usage as ""Disk Usage (%)"", range as ""Disk Usage Range"", version as Version, numberOfCores as Cores, ram as RAM","role, group, countDiskFunc, metric","splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_drilldown_resource_usage_deployment_load_average(4)","`dmc_set_index_introspection` search_group=$role$ search_group=$group$ sourcetype=splunk_resource_usage component=Hostwide 
| stats $countLoadAvgFunc$(data.normalized_load_avg_1min) as load_average by host 
| `dmc_load_average_rangemap` 
| where range=""$metric$"" 
| `dmc_drilldown_join_peers_by_peerURI` 
| eval Action = Action."" $role$"" 
| fields serverName, machine, load_average, range, numberOfCores, ram, version, Action 
| rename serverName as Instance, machine as Machine, load_average as ""Load Average"", range as ""Load Average Range"", version as Version, numberOfCores as Cores, ram as RAM","role, group, countLoadAvgFunc, metric","splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_drilldown_resource_usage_deployment_memory_usage(4)","`dmc_set_index_introspection` search_group=$role$ search_group=$group$ sourcetype=splunk_resource_usage component=Hostwide 
| eval pct_mem_used = 'data.mem_used' / 'data.mem' 
| stats $countMemFunc$(pct_mem_used) as pct_mem_used by host 
| `dmc_memory_usage_rangemap` 
| where range=""$metric$"" 
| `dmc_drilldown_join_peers_by_peerURI` 
| eval Action = Action."" $role$"" 
| fields serverName, machine, pct_mem_used, range, numberOfCores, ram, version, Action 
| eval pct_mem_used = round(pct_mem_used * 100, 2) 
| eval pct_mem_used = pct_mem_used."" %"" 
| rename serverName as Instance, machine as Machine, pct_mem_used as ""Memory Usage"", range as ""Memory Usage Range"", version as Version, numberOfCores as Cores, ram as RAM","role, group, countMemFunc, metric","splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_drilldown_search_activity_deployment_resource_usage(5)","`dmc_set_index_introspection` search_group=$role$ search_group=$group$ sourcetype=splunk_resource_usage ((component=PerProcess data.search_props.sid::*) OR component=Hostwide) 
| `dmc_rename_introspection_fields` 
| eval sid = if(component==""Hostwide"", ""n/a"", sid) 
| eval pid = if(component==""Hostwide"", ""n/a"", pid) 
| eval pct_cpu = if(component==""Hostwide"", 0, pct_cpu) 
| eval mem_used = if(component==""Hostwide"", 0, 'mem_used) 
| `dmc_set_bin` 
| stats latest($resourceType$) AS resource_usage_dedup values(Action) as Action by _time, sid, pid, host 
| stats sum(resource_usage_dedup) AS sum_resource_usage values(Action) as Action by _time, host 
| stats $resourceFunction$(sum_resource_usage) as resource_usage values(Action) as Action by host 
| `dmc_$resourceType$_rangemap` 
| where range == ""$metric$"" 
| `dmc_drilldown_join_peers_by_peerURI` 
| eval Action = Action."" $role$"" 
| fields serverName, machine, resource_usage, range, numberOfCores, ram, version, Action 
| rename serverName as Instance, machine as Machine, resource_usage as ""$resourceType$ Usage"", range as ""$resourceType$ Usage Range"", version as Version, numberOfCores as Cores, ram as RAM","role, group, resourceType, resourceFunction, metric","splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_drilldown_search_activity_deployment_search_concurrency(4)","`dmc_set_index_introspection` search_group=$role$ search_group=$group$ sourcetype=splunk_resource_usage ((component=PerProcess data.search_props.sid::*) OR component=Hostwide) 
| `dmc_rename_introspection_fields` 
| `dmc_set_bin` 
| stats dc(sid) AS distinct_search_count values(Action) as Action by host, _time 
| stats $searchFunction$(distinct_search_count) as search_count values(Action) as Action by host 
| `dmc_search_count_rangemap` 
| where range=""$metric$"" 
| `dmc_drilldown_join_peers_by_peerURI` 
| eval Action = Action."" $role$"" 
| fields serverName, machine, search_count, range, numberOfCores, ram, version, Action 
| rename serverName as Instance, machine as Machine, search_count as ""Count of Searches"", range as ""Count of Searches Range"", version as Version, numberOfCores as Cores, ram as RAM","role, group, searchFunction, metric","splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_event_local_search_dispatch","`dmc_set_index_audit` sourcetype=audittrail action=search search=*",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_event_remote_search_dispatch","`dmc_set_index_internal` sourcetype=splunkd_remote_searches ""Streamed search search starting""",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_exclude_indexes","eval _dmc_title = if(isnotnull(title), title, 'data.name')
| where NOT (_dmc_title == ""history"" OR _dmc_title == ""_thefishbucket"" OR _dmc_title == ""_blocksignature"")
| fields - _dmc_title",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_exclude_volumes","eval _dmc_volume = if(isnotnull(title), title, 'data.name') 
| where NOT _dmc_volume == ""_splunk_summaries"" 
| fields - _dmc_volume",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_get_all_triggered_alerts(1)","rest splunk_server=local /servicesNS/-/splunk_monitoring_console/alerts/fired_alerts/- 
| rename savedsearch_name as title 
| join type=outer title [|rest splunk_server=local /servicesNS/-/splunk_monitoring_console/saved/searches ] 
| rename title as ""Alert Name"" 
| join type=outer sid [rest splunk_server=local /servicesNS/nobody/splunk_monitoring_console/search/jobs/] 
| eval now=relative_time(now(),""-$minute_offset$m"") 
| where trigger_time > now 
| rename trigger_time AS ""_time"", description as ""Description"", sid AS Instance 
| convert timeformat=""%b. %d, %Y %l:%M %p"" ctime(_time) AS ""Time Triggered"" 
| fields - _time 
| fields ""Alert Name"", Instance, ""Time Triggered"", ""Description""","minute_offset","splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_get_core_info","eval core_info = if(isnull(numberOfCores), ""N/A"", numberOfCores)."" / "".if(isnull(numberOfVirtualCores), ""N/A"", numberOfVirtualCores)",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_get_distsearch_group_servers(1)","rest splunk_server=local /services/search/distributed/groups 
| fields title member 
| search title=""dmc_group_$group_name$"" 
| eval title=replace(title, ""^dmc_group_"", """") 
| eval servers=mvjoin(member,"","") 
| fields title servers","group_name","splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_get_forwarder_info","inputlookup dmc_forwarder_assets",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_get_forwarder_tcpin","`dmc_set_index_internal` sourcetype=splunkd group=tcpin_connections (connectionType=cooked OR connectionType=cookedSSL) fwdType=* guid=*",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_get_groups","inputlookup dmc_assets 
| fields search_group 
| dedup search_group 
| search search_group=""dmc_*"" 
| `dmc_set_group_label_and_sort(search_group)`",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_get_groups_containing_role(1)","inputlookup dmc_assets 
| mvcombine search_group 
| search search_group=""$role$"" 
| mvexpand search_group 
| fields search_group 
| dedup search_group 
| `dmc_set_group_label_and_sort(search_group)`",role,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_get_indexer_cluster_groups","inputlookup dmc_assets 
| fields search_group 
| dedup search_group 
| search search_group=""dmc_indexerclustergroup_*"" 
| eval label = replace(search_group, ""dmc_indexerclustergroup_"", """")",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_get_instance_info(1)","inputlookup dmc_assets | mvcombine search_group | search search_group=$group$",group,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_get_instance_roles","inputlookup dmc_assets 
| mvcombine search_group 
| eval role = search_group 
| mvexpand role 
| eval role = if(like(role, ""dmc_group_%""), role, """") 
| eval role = replace(role, ""^dmc_group_"", """") 
| mvcombine role",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_get_instances_on_a_machine(1)","`dmc_get_instance_info(*)` 
| where machine = ""$machine$"" 
| dedup serverName",machine,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_get_last_hour_resource_usage_from_sid(2)","`dmc_set_index_introspection` host=$host$ sourcetype=splunk_resource_usage component=PerProcess data.search_props.sid=""$sid$"" earliest=-1h 
| `dmc_set_bin` 
| `dmc_rename_introspection_fields` 
| stats latest(pct_cpu) AS pct_cpu_dedup latest(mem_used) AS mem_used_dedup by _time, pid 
| stats sum(pct_cpu_dedup) AS pct_cpu_sum sum(mem_used_dedup) AS mem_used_sum by _time 
| timechart span=10s latest(pct_cpu_sum) AS pct_cpu latest(mem_used_sum) AS mem_used","host, sid","splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_get_local_instance_asset","`dmc_get_local_instance_asset_computed_groups` 
| join type=outer peerURI [ 
| rest splunk_server=local /services/search/distributed/groups 
| fields title member 
| where isnotnull(mvfind(member, ""localhost:localhost"")) 
| eval peerURI=""localhost"" 
| rename title AS search_groups 
| fields peerURI search_groups 
| mvcombine delim="" "" search_groups] 
| makemv delim="" "" search_groups 
| eval search_groups = if(isnotnull(search_groups),search_groups,computed_search_groups) 
| fields - computed_search_groups 
| mvexpand search_groups",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_get_local_instance_asset_computed_groups","rest splunk_server=local /services/server/info 
| eval peerURI=""localhost"" 
| eval server_roles=""indexer,search_head,license_master,kv_store"" 
| makemv delim="","" server_roles 
| mvexpand server_roles 
| eval computed_search_groups=""dmc_group_"".server_roles 
| stats first(peerURI) AS peerURI first(host) AS host first(host_fqdn) AS machine values(computed_search_groups) AS computed_search_groups by serverName",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_get_local_instance_asset_in_distributed_mode","`dmc_get_local_instance_asset_computed_groups` 
| join type=inner peerURI [ 
| rest splunk_server=local /services/search/distributed/groups 
| fields title member 
| where isnotnull(mvfind(member, ""localhost:localhost"")) 
| eval peerURI=""localhost"" 
| rename title AS search_groups 
| fields peerURI search_groups 
| mvcombine delim="" "" search_groups] 
| makemv delim="" "" search_groups 
| eval search_groups = if(isnotnull(search_groups),search_groups,computed_search_groups) 
| fields - computed_search_groups 
| mvexpand search_groups",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_get_machine_info","`dmc_get_instance_info(*)` 
| stats first(host) as host first(serverName) as serverName by machine",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_get_port_from_splunktcp_stanza(1)","| rex field=$stanza_name$ ""splunktcp(-ssl)?:(\/{1,2})?(([0-9]{1,3}\.){3}[0-9]{1,3})?(:)?(?<port>\d+)"" 
| eval port = if(match($stanza_name$, ""splunktcp-ssl""), port."" (SSL)"", port) 
| eval port = if(isnotnull(port), port, null)","stanza_name","splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_get_recently_triggered_alerts","rest splunk_server=local /servicesNS/-/splunk_monitoring_console/saved/searches 
|rename title as savedsearch_name 
| fields savedsearch_name, triggered_alert_count, description 
| where triggered_alert_count > 0 
| join type=outer savedsearch_name[|rest splunk_server=local /servicesNS/-/splunk_monitoring_console/alerts/fired_alerts/- 
| cluster field=savedsearch_name] 
| join type=outer sid [rest splunk_server=local /servicesNS/nobody/splunk_monitoring_console/search/jobs/] 
| rename savedsearch_name AS ""Alert Name"", triggered_alert_count AS ""Trigger Count"", published AS ""Last time triggered"", description as ""Description"" | fields ""Alert Name"" , ""Trigger Count"", ""Last time triggered"", ""Description"", sid",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_get_search_head_cluster_groups","inputlookup dmc_assets 
| fields search_group 
| dedup search_group 
| search search_group=""dmc_searchheadclustergroup_*"" 
| eval label = replace(search_group, ""dmc_searchheadclustergroup_"", """")",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_get_warnings_and_errors(2)","`dmc_set_index_internal` search_group=$search_group$ sourcetype=splunkd component=$component$  (log_level=WARN OR log_level=ERROR)","search_group, component","splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_indexing_rate_rangemap","rangemap field=kbps ""0-50 KB/s""=0-50 ""50-100 KB/s""=50.001-100 ""100-500 KB/s""=100.001-500 ""500 KB/s - 1 MB/s""=500.001-1024 ""1-2.5 MB/s""=1024.001-2560 ""2.5-5 MB/s""=2560.001-5120 ""5-10 MB/s""=5120.001-10240 ""10+ MB/s""=10240.001-999999 default=""NULL""",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_indexing_rate_rangemap_and_timechart","`dmc_indexing_rate_rangemap` 
| timechart minspan=30s partial=f dc(host) AS instance_count by range 
| fields _time ""10+ MB/s"" ""5-10 MB/s"" ""2.5-5 MB/s"" ""1-2.5 MB/s"" ""500 KB/s - 1 MB/s"" ""100-500 KB/s"" ""50-100 KB/s"" ""0-50 KB/s""",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_instances_view_default_search(1)","inputlookup dmc_assets 
| mvcombine search_group 
| rex max_match=0 field=search_group ""dmc_indexerclustergroup_(?<indexer_cluster>.*)"" 
| rex max_match=0 field=search_group ""dmc_searchheadclustergroup_(?<search_head_cluster>.*)"" 
| mvexpand search_group 
| search search_group = $group$ 
| mvcombine search_group 
| join type=outer peerURI 
  [| rest splunk_server=local /services/search/distributed/peers 
   | rename title as peerURI ] 
| join type=outer peerURI 
  [| rest splunk_server=local /services/server/info 
   | eval peerURI = ""localhost"" 
   | eval status = ""Up""] 
| join peerURI 
  [| `dmc_get_instance_roles` ] 
| eval status = if(status == ""Up"", status, ""Unreachable"") 
| eval Action = serverName."" "".role 
| eval OS = os_name 
| eval ram = round(physicalMemoryMB / 1024, 2)."" GB"" 
| `dmc_get_core_info` 
| fields serverName, machine, role, indexer_cluster, search_head_cluster, OS, core_info, ram, version, status, Action 
| sort status, serverName 
| rename serverName as Instance, machine as Machine, role as Role, indexer_cluster as ""Indexer Cluster"", search_head_cluster as ""Search Head Cluster"", core_info as ""CPU Cores (Physical / Virtual)"", ram as RAM, version as Version, status as Status",group,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_iostats_rangemap(1)","rangemap field=$fieldname$ ""0-60%""=0-60 ""60-80%""=60.0001-80, ""80-100%""=80.0001-100 default=abnormal",fieldname,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_licensing_base_summary(2)","`dmc_set_index_internal` host=$host$ source=*license_usage.log* type=""RolloverSummary"" earliest=-30d@d $pool_clause$","host, pool_clause","splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_licensing_base_usage(2)","`dmc_set_index_internal` source=*license_usage.log* type=""Usage"" | eval h=if(len(h)=0 OR isnull(h),""(SQUASHED)"",h) | eval s=if(len(s)=0 OR isnull(s),""(SQUASHED)"",s) | eval idx=if(len(idx)=0 OR isnull(idx),""(UNKNOWN)"",idx) | bin _time span=1d | stats sum(b) as b by _time, host, pool, s, st, h, idx | search host=$host$ $pool_clause$","host, pool_clause","splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_licensing_pool_size_srch(2)","join type=outer _time [search `dmc_set_index_internal` host=$host$ source=*license_usage.log* type=""RolloverSummary"" earliest=-30d@d $pool_clause$ | eval _time=_time - 43200 | bin _time span=1d | stats latest(poolsz) AS  ""pool size"" by _time] | fields - _timediff","host, pool_clause","splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_licensing_stack_size_srch(2)","join type=outer _time [search `dmc_set_index_internal` host=$host$ source=*license_usage.log* type=""RolloverSummary"" earliest=-30d@d | eval _time=_time - 43200 | bin _time span=1d | dedup _time stack | stats sum(stacksz) AS ""stack size"" by _time] | fields - _timediff","host, pool_clause","splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_licensing_summary_maxavg_indxr(3)","eval _time=_time - 43200 | bin _time span=1d | stats latest(b) AS b by slave, pool, _time | eval slave_guid=slave | stats sum(b) AS volume by slave_guid, _time | stats avg(volume) AS avgVolume max(volume) AS maxVolume by slave_guid | join type=outer slave_guid [rest splunk_server=$splunk_server$ /services/licenser/slaves | rename label AS slave_name title AS slave_guid | table slave_guid slave_name] | eval slave_name = if(isnotnull(slave_name),slave_name,""GUID: "".slave_guid) | foreach *Volume [eval <<FIELD>>=round('<<FIELD>>'/1024/1024/1024, 3)] |  rename slave_name as ""Indexer"" avgVolume AS ""average"" maxVolume AS ""peak"" | sort 5 - ""average"" | fields ""Indexer"", ""average"", ""peak"" | fields - _timediff, slave_guid","splunk_server, split_by_field_name, split_by_label","splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_licensing_summary_maxavg_no_split(3)","eval _time=_time - 43200 | bin _time span=1d | stats latest(b) AS b by slave, pool, _time | stats sum(b) AS volume by _time | stats avg(volume) AS avgVolume max(volume) AS maxVolume  | eval maxVolumeGB=round(maxVolume/1024/1024/1024,3) | eval avgVolumeGB=round(avgVolume/1024/1024/1024,3) | rename avgVolumeGB AS ""average"" maxVolumeGB AS ""peak"" | eval ""All Pools"" = """" | fields ""All Pools"", ""average"", ""peak""","splunk_server, split_by_field_name, split_by_label","splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_licensing_summary_maxavg_pool(3)","eval _time=_time - 43200 | bin _time span=1d | stats latest(b) AS b by slave, pool, _time | stats sum(b) AS volume by pool, _time  | stats avg(volume) AS avgVolume max(volume) AS maxVolume by pool | eval maxVolumeGB=round(maxVolume/1024/1024/1024,3) | eval avgVolumeGB=round(avgVolume/1024/1024/1024,3) | rename avgVolumeGB AS ""average"" maxVolumeGB AS ""peak"" pool as ""Pool"" | fields ""Pool"", ""average"", ""peak"" | sort 5 - ""average""","splunk_server, split_by_field_name, split_by_label","splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_licensing_summery_indxr(5)","eval _time=_time - 43200 | bin _time span=1d | stats latest(b) AS b by slave, pool, _time | eval slave_guid=slave | stats max(b) AS volume by slave_guid, _time | join type=outer slave_guid [rest splunk_server=$splunk_server$ /services/licenser/slaves | rename label AS slave_name title AS slave_guid | table slave_guid slave_name] | eval slave_name = if(isnotnull(slave_name),slave_name,""GUID: "".slave_guid) | timechart span=1d max(volume) AS ""volume"" by slave_name fixedrange=false | `$size_search$($host$, ""$pool_clause$"")` | foreach * [eval <<FIELD>>=round('<<FIELD>>'/1024/1024/1024, 3)]","splunk_server, size_search, host, pool_clause, split_by_field_name","splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_licensing_summery_no_split(5)","eval _time=_time - 43200 | bin _time span=1d | stats latest(b) AS b by slave, pool, _time | timechart span=1d sum(b) AS ""volume"" fixedrange=false | `$size_search$($host$, ""$pool_clause$"")` | foreach * [eval <<FIELD>>=round('<<FIELD>>'/1024/1024/1024, 3)]","splunk_server, size_search, host, pool_clause, split_by_field_name","splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_licensing_summery_pct_indxr(4)","eval _time=_time - 43200 | bin _time span=1d | stats latest(b) AS b latest($sz_clause$) AS $sz_clause$ by slave, pool, _time | stats sum(b) AS volumeB max($sz_clause$) AS $sz_clause$ by slave, _time | eval pctused=round(volumeB/$sz_clause$*100,2) | eval slave_guid=slave | join type=outer slave_guid [rest splunk_server=$splunk_server$ /services/licenser/slaves | rename label AS slave_name title AS slave_guid | table slave_guid slave_name] | eval slave_name = if(isnotnull(slave_name),slave_name,""GUID: "".slave_guid) | timechart span=1d max(pctused) AS ""used"" by slave_name fixedrange=false","splunk_server, sz_clause, host, split_by_field_name","splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_licensing_summery_pct_no_split(4)","eval _time=_time - 43200 | bin _time span=1d | stats latest(b) AS b latest($sz_clause$) AS $sz_clause$ by slave, pool, _time | stats sum(b) AS volumeB max($sz_clause$) AS $sz_clause$ by _time | eval pctused=round(volumeB/$sz_clause$*100,2) | timechart span=1d max(pctused) AS ""used"" fixedrange=false","splunk_server, sz_clause, host, split_by_field_name","splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_licensing_summery_pct_pool(4)","eval _time=_time - 43200 | bin _time span=1d | stats latest(b) AS b latest($sz_clause$) AS $sz_clause$ by slave, pool, _time | stats sum(b) AS volumeB max($sz_clause$) AS $sz_clause$ by pool, _time | eval pctused=round(volumeB/$sz_clause$*100,2) | timechart span=1d max(pctused) AS ""used"" by pool fixedrange=false","splunk_server, sz_clause, host, split_by_field_name","splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_licensing_summery_pool(5)","eval _time=_time - 43200 | bin _time span=1d | stats latest(b) AS b by slave, pool, _time | timechart span=1d sum(b) AS ""volume"" by pool fixedrange=false | `$size_search$($host$, ""$pool_clause$"")` | foreach * [eval <<FIELD>>=round('<<FIELD>>'/1024/1024/1024, 3)]","splunk_server, size_search, host, pool_clause, split_by_field_name","splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_licensing_usage_all(5)","timechart span=1d sum(b) AS volumeB by $split_by_field_name$ fixedrange=false | `$size_search$($host$, ""$pool_clause$"")` | foreach * [eval <<FIELD>>=round('<<FIELD>>'/1024/1024/1024, 3)]","splunk_server, size_search, host, split_by_field_name, pool_clause","splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_licensing_usage_maxavg_all(3)","stats sum(b) AS volume by $split_by_field_name$, _time | stats avg(volume) AS avgVolume max(volume) AS maxVolume by $split_by_field_name$ | eval avgVolumeGB=round(avgVolume/1024/1024/1024,3) | eval maxVolumeGB=round(maxVolume/1024/1024/1024,3) | fields $split_by_field_name$, avgVolumeGB, maxVolumeGB | rename avgVolumeGB AS ""average"" maxVolumeGB AS ""peak"" $split_by_field_name$ AS ""$split_by_label$"" | sort 5 - ""average""","splunk_server, split_by_field_name, split_by_label","splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_licensing_usage_pct_all(4)","join _time pool type=outer [search `dmc_set_index_internal` host=$host$ source=*license_usage.log* type=""RolloverSummary"" earliest=-30d@d | eval _time=_time - 43200 | bin _time span=1d | stats latest($sz_clause$) AS $sz_clause$ by slave, pool, _time | stats max($sz_clause$) AS $sz_clause$ by pool, _time] | stats sum(b) AS bytes_used max($sz_clause$) AS $sz_clause$ by $split_by_field_name$, _time | timechart span=1d max(eval(round(bytes_used/$sz_clause$*100,2))) by $split_by_field_name$ fixedrange=false","splunk_server, sz_clause, host, split_by_field_name","splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_load_average_rangemap","rangemap field=load_average ""0-20""=0-20 ""20-50""=20.001-50 ""50+""=50.001-999999 default=abnormal",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_load_average_rangemap_and_timechart","`dmc_load_average_rangemap` 
| `dmc_timechart` partial=f dc(server) as server_count by range 
| fields _time, ""50+"", ""20-50"", ""0-20""",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_match_all_scheduled_search_types","((data.search_props.type=""datamodel acceleration"" OR search_props.type=""datamodel acceleration"") OR (data.search_props.type=""report acceleration"" OR search_props.type=""report acceleration"") OR (data.search_props.type=""scheduled"" OR search_props.type=""scheduled"") OR (data.search_props.type=""summary indexing"" OR search_props.type=""summary indexing""))",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_mem_used_rangemap","rangemap field=resource_usage 
""0GB""=0-0 
""<1GB""=0.01-1024 
""1-2GB""=1024.001-2048 
""2-3GB""=2048.001-3072 
""3-4GB""=3072.001-4096 
""4-5GB""=4096.001-5120 
""5-10GB""=5120.001-10240 
""10-15GB""=10240.001-15360 
""15-20GB""=15360.001-20480 
""20-30GB""=20480.001-30720 
""30GB+""=30720.001-999999 
default=""0GB"" 
| eval resource_usage = round(resource_usage / 1024, 3)",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_mem_used_rangemap_and_timechart","`dmc_mem_used_rangemap` 
| `dmc_timechart` partial=f dc(host) AS host_count by range 
| fields _time, ""30GB+"" ""20-30GB"" ""15-20GB"" ""5-10GB"" ""4-5GB"" ""3-4GB"" ""2-3GB"" ""1-2GB"" ""<1GB"" ""0GB""",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_memory_usage_rangemap","rangemap field=pct_mem_used ""0-60%""=0-0.6 ""60-80%""=0.6001-0.8 ""80-100%""=0.8001-1 default=abnormal",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_memory_usage_rangemap_and_timechart","`dmc_memory_usage_rangemap` 
| `dmc_timechart` partial=f dc(server) as server_count by range 
| fields _time, ""80-100%"", ""60-80%"", ""0-60%""",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_pct_cpu_rangemap","rangemap field=resource_usage 
""0 cores""=0-0.009 
""0.01-1 cores""=0.01-1 
""1-2 cores""=1.01-2 
""2-3 cores""=2.01-3 
""3-4 cores""=3.01-4 
""4-5 cores""=4.01-5 
""5-10 cores""=5.01-10 
""10-15 cores""=10.01-15 
""15-20 cores""=15.01-20 
""20-25 cores""=20.01-25 
""25-30 cores""=25.01-30 
""30+ cores""=30.01-999 
""negative""=-99999--0.001 
default=""0 cores""",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_pct_cpu_rangemap_and_timechart","`dmc_pct_cpu_rangemap` 
| `dmc_timechart` partial=f dc(host) AS host_count by range 
| fields _time, ""30+ cores"" ""25-30 cores"" ""20-25 cores"" ""15-20 cores"" ""10-15 cores"" ""5-10 cores"" ""4-5 cores"" ""3-4 cores"" ""2-3 cores"" ""1-2 cores"" ""0.01-1 cores"" ""0 cores""",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_queue_fill_ratio_rangemap","rangemap field=fill_percentage ""0-60%""=0-60 ""60-80%""=60.01-80 ""80-100%""=80.01-100",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_queue_fill_ratio_rangemap_and_timechart","`dmc_queue_fill_ratio_rangemap` 
| timechart partial=f dc(host) by range 
| fields _time ""80-100%"" ""60-80%"" ""0-60%""",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_rangemap_cpu_system_pct","rangemap field=cpu_system_pct #53A051=0-59.999 #F1813F=60-79.999 default=#DC4E41",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_rangemap_default_cpu_system_pct","rangemap field=cpu_system_pct #53A051=0-59.999 #F1813F=60-79.999 default=#DC4E41",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_rangemap_default_indexing_rate","rangemap field=average_KBps #CEE4EE=0-99.999 #6BAECA=100-999.999 #0877A6=1000-4999 #005E86=5000-9999 default=#004664",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_rangemap_default_mem_used","rangemap field=mem_used #53A051=0-59.999 #F1813F=60-79.999 default=#DC4E41",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_rangemap_default_search_concurrency","rangemap field=search_concurrency #CEE4EE=0-5.999 #6BAECA=6-10.999 #0877A6=11-20.999 default=#005E86",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_rangemap_default_up_down_status","rangemap field=up_down_status #DC4E41=0-0.999 default=#53A051",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_rangemap_indexing_rate","rangemap field=average_KBps #CEE4EE=0-99.999 #6BAECA=100-999.999 #0877A6=1000-4999 #005E86=5000-9999 default=#004664",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_rangemap_mem_used","rangemap field=mem_used #53A051=0-59.999 #F1813F=60-79.999 default=#DC4E41",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_rangemap_search_concurrency","rangemap field=search_concurrency #CEE4EE=0-5.999 #6BAECA=6-10.999 #0877A6=11-20.999 default=#005E86",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_rangemap_up_down_status","rangemap field=up_down_status #DC4E41=0-0.999 default=#53A051",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_re_build_forwarder_assets(1)","`dmc_build_forwarder_assets($sparkline_span$)` 
| rename new_sum_kb as sum_kb, new_avg_tcp_kbps_sparkline as avg_tcp_kbps_sparkline, new_avg_tcp_kbps as avg_tcp_kbps, new_avg_tcp_eps as avg_tcp_eps 
| eval avg_tcp_kbps_sparkline = ""N/A"" 
| addinfo 
| eval status = if(isnull(sum_kb) or (sum_kb <= 0) or (last_connected < (info_max_time - 900)), ""missing"", ""active"") 
| eval sum_kb = round(sum_kb, 2) 
| eval avg_tcp_kbps = round(avg_tcp_kbps, 2) 
| eval avg_tcp_eps = round(avg_tcp_eps, 2) 
| fields guid, hostname, forwarder_type, version, arch, os, status, last_connected, sum_kb, avg_tcp_kbps_sparkline, avg_tcp_kbps, avg_tcp_eps 
| outputlookup dmc_forwarder_assets","sparkline_span","splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_re_build_forwarder_assets_light(1)","`dmc_build_forwarder_assets($sparkline_span$)` 
| rename new_sum_kb as sum_kb, new_avg_tcp_kbps_sparkline as avg_tcp_kbps_sparkline, new_avg_tcp_kbps as avg_tcp_kbps, new_avg_tcp_eps as avg_tcp_eps 
| eval avg_tcp_kbps_sparkline = ""N/A"" 
| addinfo 
| eval status = if(isnull(sum_kb) or (sum_kb <= 0) or (last_connected < (relative_time(now(),""-15m""))), ""missing"", ""active"") 
| eval sum_kb = round(sum_kb, 2) 
| eval avg_tcp_kbps = round(avg_tcp_kbps, 2) 
| eval avg_tcp_eps = round(avg_tcp_eps, 2) 
| fields guid, hostname, forwarder_type, version, arch, os, status, last_connected, sum_kb, avg_tcp_kbps_sparkline, avg_tcp_kbps, avg_tcp_eps 
| outputlookup dmc_forwarder_assets","sparkline_span","splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_rename_forwarder_type(1)","eval $type$ = case($type$ == ""full"", ""Heavy Forwarder"", $type$ == ""uf"", ""Universal Forwarder"", $type$ == ""lwf"", ""Light Forwarder"", 1==1, $type$)",type,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_rename_introspection_fields","eval process = 'data.process' 
| eval args = 'data.args' 
| eval pid = 'data.pid' 
| eval ppid = 'data.ppid' 
| eval elapsed = 'data.elapsed' 
| eval mem_used = 'data.mem_used' 
| eval mem = 'data.mem' 
| eval pct_memory = 'data.pct_memory' 
| eval pct_cpu = 'data.pct_cpu' 
| eval sid = 'data.search_props.sid' 
| eval app = 'data.search_props.app' 
| eval label = 'data.search_props.label' 
| eval type = 'data.search_props.type' 
| eval mode = 'data.search_props.mode' 
| eval user = 'data.search_props.user' 
| eval role = 'data.search_props.role' 
| eval label = if(isnotnull('data.search_props.label'), 'data.search_props.label', """") 
| eval provenance = if(isnotnull('data.search_props.provenance'), 'data.search_props.provenance', ""unknown"") 
| eval search_head = case(isnotnull('data.search_props.search_head') AND 'data.search_props.role' == ""peer"", 'data.search_props.search_head', isnull('data.search_props.search_head') AND 'data.search_props.role' == ""head"", ""_self"", isnull('data.search_props.search_head') AND 'data.search_props.role' == ""peer"", ""_unknown"") 
| eval workload_pool = if(isnotnull('data.workload_pool'), 'data.workload_pool', ""UNDEFINED"")",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_replication_lag_rangemap","rangemap field=lag ""0-10s""=0-10 ""10-30s""=10.001-30 "">30s""=30.001-10000000 default=abnormal",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_resource_usage_by_processes_timechart(2)","`dmc_set_bin` 
| `dmc_rename_introspection_fields` 
| stats latest($resource_type$) AS resource_usage_dedup latest(process_class) AS process_class by pid, _time 
| stats sum(resource_usage_dedup) AS resource_usage by _time, process_class 
| timechart minspan=10s $function$(resource_usage) AS ""Resource Usage"" by process_class","resource_type, function","splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_resource_usage_instance_drilldown(1)","`dmc_set_index_introspection` sourcetype=splunk_resource_usage component=PerProcess host=$host$ 
| `dmc_rename_introspection_fields` 
| `dmc_classify_processes` 
| eval args = if(isnotnull(sid),""search --id="".sid."" (...)"", args) 
| eval cmd = process."" "".args 
| stats latest(pid) as ""PID"", latest(ppid) as ""PPID"", latest(label) as Label, latest(provenance) as Provenance, latest(search_head) as ""Search Head"", latest(type) as Type, latest(user) as User, latest(app) as App, latest(mode) as Mode, latest(role) as Role, avg(pct_cpu) as avg_pct_cpu, max(mem_used) as ""Physical Memory Usage (MB)"", min(_time) as min_time, max(_time) as max_time, max(elapsed) as ""Elapsed Time"" by cmd 
| eval avg_pct_cpu = round(avg_pct_cpu, 2) 
| `dmc_time_format(min_time)` 
| `dmc_time_format(max_time)` 
| rename avg_pct_cpu as ""Average CPU Usage (%)"", min_time as ""First Time Seen"", max_time as ""Last Time Seen""",host,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_scheduler_instance_search_concurrency_drilldown(3)","`dmc_set_index_introspection` host=$host$ sourcetype=splunk_resource_usage component=PerProcess data.search_props.sid::* `dmc_match_all_scheduled_search_types` 
| `dmc_rename_introspection_fields` 
| where $concurrencySplitBy$==""$type$"" 
| stats latest(pid) as ""PID"", latest(ppid) as ""PPID"", latest(label) as Label, latest(provenance) as Provenance, latest(search_head) as ""Search Head"", latest(type) as Type, latest(user) as User, latest(app) as App, latest(mode) as Mode, latest(role) as Role, avg(pct_cpu) as avg_pct_cpu, max(mem_used) as ""Physical Memory Usage (MB)"", min(_time) as min_time, max(_time) as max_time, max(elapsed) as ""Elapsed Time"" by sid 
| eval avg_pct_cpu = round(avg_pct_cpu, 2) 
| `dmc_time_format(min_time)` 
| `dmc_time_format(max_time)` 
| rename avg_pct_cpu as ""Average CPU Usage (%)"", min_time as ""First Time Seen"", max_time as ""Last Time Seen""","host, concurrencySplitBy, type","splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_search_activity_instance_drilldown(3)","`dmc_set_index_introspection` host=$host$ sourcetype=splunk_resource_usage component=PerProcess data.search_props.sid::* 
| `dmc_rename_introspection_fields` 
| where $concurrencySplitBy$==""$type$"" 
| stats latest(pid) as ""PID"", latest(ppid) as ""PPID"", latest(label) as Label, latest(provenance) AS Provenance, latest(search_head) as ""Search Head"", latest(type) as Type, latest(user) as User, latest(app) as App, latest(mode) as Mode, latest(role) as Role, avg(pct_cpu) as avg_pct_cpu, max(mem_used) as ""Physical Memory Usage (MB)"", min(_time) as min_time, max(_time) as max_time, max(elapsed) as ""Elapsed Time"" by sid 
| eval avg_pct_cpu = round(avg_pct_cpu, 2) 
| `dmc_time_format(min_time)` 
| `dmc_time_format(max_time)` 
| rename avg_pct_cpu as ""Average CPU Usage (%)"", min_time as ""First Time Seen"", max_time as ""Last Time Seen""","host, concurrencySplitBy, type","splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_search_count_rangemap","rangemap field=search_count ""0""=0-0 ""1-5""=1-5 ""6-10""=6-10 ""11-15""=11-15 ""16-20""=16-20 ""21-30""=21-30 ""31-40""=31-40 ""41-50""=41-50 ""51-75""=51-75 ""76-100""=76-100 ""101+""=101-99999",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_search_count_rangemap_and_timechart","`dmc_search_count_rangemap` 
| `dmc_timechart` dc(host) AS count_host by range 
| fields _time ""101+"" ""76-100"" ""51-75"" ""41-50"" ""31-40"" ""21-30"" ""16-20"" ""11-15"" ""6-10"" ""1-5"" ""0""",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_set_bin","bin _time span=10s",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_set_bin_for_disk_usage","bin _time span=10min",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_set_bin_for_iostats","bin _time minspan=1min",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_set_bin_for_metrics_log","bin _time minspan=30s",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_set_bin_for_timechart","bin _time minspan=10s",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_set_bin_for_timechart_for_disk_usage","bin _time minspan=10min",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_set_group_label_and_sort(1)","eval label = replace($search_group$, ""^dmc_\w*group_"", """") 
| eval label = case( 
    $search_group$ == ""dmc_group_indexer"", ""Indexer"", 
    $search_group$ == ""dmc_group_search_head"", ""Search Head"", 
    $search_group$ == ""dmc_group_cluster_master"", ""Cluster Master"", 
    $search_group$ == ""dmc_group_license_master"", ""License Master"", 
    $search_group$ == ""dmc_group_deployment_server"", ""Deployment Server"", 
    $search_group$ == ""dmc_group_kv_store"", ""KV Store"", 
    $search_group$ == ""dmc_group_shc_deployer"", ""SHC Deployer"", 
    like($search_group$, ""dmc_customgroup_%""), label.""  (custom)"", 
    like($search_group$, ""dmc_indexerclustergroup_%""), label."" (Indexer Cluster)"", 
    like($search_group$, ""dmc_searchheadclustergroup_%""), label."" (Search Head Cluster)"", 
    1 == 1, label."" (Unrecognized)"") 
| eval order = case( 
    like($search_group$, ""dmc_group_%""), 100, 
    like($search_group$, ""dmc_customgroup_%""), 200, 
    like($search_group$, ""dmc_indexerclustergroup_%""), 300, 
    like($search_group$, ""dmc_searchheadclustergroup_%""), 400, 
    1 == 1, ""500"") 
| sort order, $search_group$ 
| fields - order","search_group","splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_set_index_audit","index=_audit",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_set_index_internal","index=_internal",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_set_index_introspection","index=_introspection",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_tcp_forwarder_count_split_by(2)","`dmc_get_forwarder_tcpin` search_group=dmc_group_indexer search_group=$group$ 
| `dmc_timechart_for_metrics_log` dc(guid) as forwarder_count by $field$ 
| rename forwarder_count as ""Forwarder Count""","field, group","splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_tcp_throughput_split_by(2)","`dmc_get_forwarder_tcpin` search_group=dmc_group_indexer search_group=$group$ 
| `dmc_timechart_for_metrics_log` per_second(kb) as avg_tcp_KBps by $field$ 
| rename avg_tcp_KBps as ""KB/s""","field, group","splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_time_format(1)","eval $time$ = strftime($time$, ""%m/%d/%Y %H:%M:%S %z"")",time,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_timechart","timechart minspan=10s",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_timechart_for_disk_usage","timechart minspan=10min",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_timechart_for_iostats","timechart minspan=60s partial=f",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_timechart_for_metrics_log","timechart minspan=30s",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","dmc_timechart_for_metrics_reaper_and_heartbeat","timechart minspan=300s",,"splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","time_modifier(1)","tostring(relative_time(time(), ""$time_modifier$""))","time_modifier","splunk_monitoring_console",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","conf_files_index","(index=""main"")",,"ta-confversion",global,system,
CM1,"PROD-CM-1|cluster_master|search_head",confdata2mv,"makemv tokenizer=""^([^\r\n]+)([\r\n]+|$)"" conf_data",,"ta-confversion",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","include_deletions(4)","OR (index=_audit action=delete host=""$host$"" path=""*/$conf_app$/$conf_context$/$conf_file$"")","host,conf_app,conf_context,conf_file","ta-confversion",app,system,
CM1,"PROD-CM-1|cluster_master|search_head",latest,"eventstats latest(_time) as latest_file_time by host, source
| where latest_file_time=_time
| fields - latest_file_time",,"ta-confversion",app,system,
CM1,"PROD-CM-1|cluster_master|search_head",mostrecent,"streamstats count as sort_order
| sort - _time
| eval conf_stanza=if(like(conf_stanza, ""%""), conf_stanza, ""null"")
| streamstats count as rev_ver by host, source, conf_stanza
| search rev_ver=1
| sort sort_order
| fields - rev_ver sort_order",,"ta-confversion",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","mostrecent_uo","sort - _time
| eval conf_stanza=if(like(conf_stanza, ""%""), conf_stanza, ""null"")
| streamstats count as rev_ver by host, source, conf_stanza
| search rev_ver=1
| fields - rev_ver",,"ta-confversion",app,system,
CM1,"PROD-CM-1|cluster_master|search_head","normalize_multiline_values","rex field=conf_data mode=sed ""s/\\\\[\r\n]+//g""",,"ta-confversion",app,system,
ES,"PROD-ES-1|search_head","useraccount_minimal_lifetime",3600,,"DA-ESS-AccessProtection",global,system,
ES,"PROD-ES-1|search_head","access_lsass_memory_for_dump_creation_filter","search *",,"DA-ESS-ContentUpdate",global,system,"Use this macro to add additional filters for access lsass memory for dump creation"
ES,"PROD-ES-1|search_head","attempt_to_set_default_powershell_execution_policy_to_unrestricted_or_bypass_filter","search *",,"DA-ESS-ContentUpdate",global,system,"Use this macro to add additional filter for attempt to set default powershell execution policy to unrestricted or bypass"
ES,"PROD-ES-1|search_head","attempted_credential_dump_from_registry_via_reg_filter","search *",,"DA-ESS-ContentUpdate",global,system,"Use this macro to add additional filter for attempted credential dump from registry via reg"
ES,"PROD-ES-1|search_head","brand_abuse_dns","lookup update=true brandMonitoring_lookup domain as query OUTPUT domain_abuse | search domain_abuse=true",,"DA-ESS-ContentUpdate",global,system,"This macro limits the output to only domains that are in the brand monitoring lookup file"
ES,"PROD-ES-1|search_head","brand_abuse_email","lookup update=true brandMonitoring_lookup domain as src_user OUTPUT domain_abuse | search domain_abuse=true",,"DA-ESS-ContentUpdate",global,system,"This macro limits the output to only domains that are in the brand monitoring lookup file"
ES,"PROD-ES-1|search_head","brand_abuse_web","lookup update=true brandMonitoring_lookup domain as urls OUTPUT domain_abuse | search domain_abuse=true",,"DA-ESS-ContentUpdate",global,system,"This macro limits the output to only domains that are in the brand monitoring lookup file"
ES,"PROD-ES-1|search_head","clients_connecting_to_multiple_dns_servers_output_filter","search *",,"DA-ESS-ContentUpdate",global,system,"Use this macro to add additional filters for monitoring clients connecting to multiple dns servers"
ES,"PROD-ES-1|search_head","create_or_delete_windows_shares_filter","search *",,"DA-ESS-ContentUpdate",global,system,"Use this macro to add additional filter for create or delete windows shares"
ES,"PROD-ES-1|search_head","create_remote_thread_into_lsass_filter","search *",,"DA-ESS-ContentUpdate",global,system,"Use this macro to add additional filter for create remote thread into lsass"
ES,"PROD-ES-1|search_head","creation_of_shadow_copy_filter","search *",,"DA-ESS-ContentUpdate",global,system,"Use this macro to add additional filter for creation of shadow copy"
ES,"PROD-ES-1|search_head","creation_of_shadow_copy_with_wmic_and_powershell_filter","search *",,"DA-ESS-ContentUpdate",global,system,"Use this macro to add additional filter for creation of shadow copy with wmic and powershell"
ES,"PROD-ES-1|search_head","cred_dump_via_copy_from_shadowcopy_filter","search *",,"DA-ESS-ContentUpdate",global,system,"Use this macro to add additional filter for cred dump via copy from shadowcopy"
ES,"PROD-ES-1|search_head","cred_dump_via_symlink_shadowcopy_filter","search *",,"DA-ESS-ContentUpdate",global,system,"Use this macro to add additional filter for cred dump via symlink shadowcopy"
ES,"PROD-ES-1|search_head","detect_activity_related_to_pass_the_hash_attacks_filter","search *",,"DA-ESS-ContentUpdate",global,system,"Use this macro to add additional filters for detect activity related to pass the hash attacks"
ES,"PROD-ES-1|search_head","detect_credential_dumping_through_LSASS_access_filter","search *",,"DA-ESS-ContentUpdate",global,system,"Use this macro to add additional filter for detect credential dumping through LSASS access"
ES,"PROD-ES-1|search_head","detect_mimikatz_using_loaded_images_filter","search *",,"DA-ESS-ContentUpdate",global,system,"Use this macro to add additional filter for detect mimikatz using loaded images"
ES,"PROD-ES-1|search_head","dns_record_changed_output_filter","search *",,"DA-ESS-ContentUpdate",global,system,"Use this macro to add additional filters for monitoring DNS records changed"
ES,"PROD-ES-1|search_head","dynamic_dns_providers","lookup update=true dynamic_dns_providers_default dynamic_dns_domains as query OUTPUTNEW isDynDNS_default | lookup update=true dynamic_dns_providers_local dynamic_dns_domains as query OUTPUTNEW isDynDNS_local| eval isDynDNS = coalesce(isDynDNS_default, isDynDNS_local)|fields - isDynDNS_default, isDynDNS_local| search isDynDNS=True",,"DA-ESS-ContentUpdate",global,system,"This macro limits the output of the query field to dynamic dns domains. It looks up the domains in a file provided by Splunk and one intended to be updated by the end user."
ES,"PROD-ES-1|search_head","dynamic_dns_web_traffic","lookup update=true dynamic_dns_providers_default dynamic_dns_domains as url OUTPUTNEW isDynDNS_default | lookup update=true dynamic_dns_providers_local dynamic_dns_domains as url OUTPUTNEW isDynDNS_local| eval isDynDNS = coalesce(isDynDNS_default, isDynDNS_local)|fields - isDynDNS_default, isDynDNS_local| search isDynDNS=True",,"DA-ESS-ContentUpdate",global,system,"This is a description"
ES,"PROD-ES-1|search_head","ec2_excessive_runinstances_mltk_input_filter","search *",,"DA-ESS-ContentUpdate",global,system,"Use this macro to add additional filters for monitoring ec2 runinstances [eg - src_user != 'someUserNameExperiencingFalsePositives']."
ES,"PROD-ES-1|search_head","ec2_excessive_terminateinstances_mltk_input_filter","search *",,"DA-ESS-ContentUpdate",global,system,"Use this macro to add additional filters for monitoring ec2 terminateinstances [eg - src_user != 'someUserNameExperiencingFalsePositives']."
ES,"PROD-ES-1|search_head","ec2_modification_api_calls","(eventName=AssociateAddress OR eventName=AssociateIamInstanceProfile OR eventName=AttachClassicLinkVpc OR eventName=AttachNetworkInterface OR eventName=AttachVolume OR eventName=BundleInstance OR eventName=DetachClassicLinkVpc OR eventName=DetachVolume OR eventName=GetConsoleOutput OR eventName=GetConsoleScreenshot OR eventName=ModifyInstanceAttribute OR eventName=ModifyInstancePlacement OR eventName=MonitorInstances OR eventName=RebootInstances OR eventName=ResetInstanceAttribute OR eventName=StartInstances OR eventName=StopInstances OR eventName=TerminateInstances OR eventName=UnmonitorInstances)",,"DA-ESS-ContentUpdate",global,system,"This is a list of AWS event names that have to do with modifying Amazon EC2 instances"
ES,"PROD-ES-1|search_head","evilginx_phishlets_0365","(query=login* AND query=www*)",,"DA-ESS-ContentUpdate",global,system,"This limits the query fields to domains that are associated with evilginx masquerading as Office 365"
ES,"PROD-ES-1|search_head","evilginx_phishlets_amazon","(query=fls-na* AND query = www* AND query=images*)",,"DA-ESS-ContentUpdate",global,system,"This limits the query fields to domains that are associated with evilginx masquerading as Amazon"
ES,"PROD-ES-1|search_head","evilginx_phishlets_aws","(query=www* AND query=aws* AND query=console.aws* AND query=signin.aws* AND api-northeast-1.console.aws* AND query=fls-na* AND query=images-na*)",,"DA-ESS-ContentUpdate",global,system,"This limits the query fields to domains that are associated with evilginx masquerading as an AWS console"
ES,"PROD-ES-1|search_head","evilginx_phishlets_facebook","(query=www* AND query = m* AND query=static*)",,"DA-ESS-ContentUpdate",global,system,"This limits the query fields to domains that are associated with evilginx masquerading as FaceBook"
ES,"PROD-ES-1|search_head","evilginx_phishlets_github","(query=api* AND query = github*)",,"DA-ESS-ContentUpdate",global,system,"This limits the query fields to domains that are associated with evilginx masquerading as GitHub"
ES,"PROD-ES-1|search_head","evilginx_phishlets_google","(query=accounts* AND query=ssl* AND query=www*)",,"DA-ESS-ContentUpdate",global,system,"This limits the query fields to domains that are associated with evilginx masquerading as Google"
ES,"PROD-ES-1|search_head","evilginx_phishlets_outlook","(query=outlook* AND query=login* AND query=account*)",,"DA-ESS-ContentUpdate",global,system,"This limits the query fields to domains that are associated with evilginx masquerading as Outlook"
ES,"PROD-ES-1|search_head","filter_rare_process_whitelist","lookup update=true lookup_rare_process_whitelist_default process as process OUTPUTNEW whitelist | where whitelist=""false"" | lookup update=true lookup_rare_process_whitelist_local process as process OUTPUT whitelist | where whitelist=""false""",,"DA-ESS-ContentUpdate",global,system,"This macro is intended to whitelist processes that have been definied as rare"
ES,"PROD-ES-1|search_head","malicious_powershell_process_obfuscation_techniques_output_filter","search *",,"DA-ESS-ContentUpdate",global,system,"Use this macro to add output filters for Malicious PowerShell Process With Obfuscation Techniques."
ES,"PROD-ES-1|search_head","network_acl_events","(eventName = CreateNetworkAcl OR eventName = CreateNetworkAclEntry OR eventName = DeleteNetworkAcl OR eventName = DeleteNetworkAclEntry OR eventName = ReplaceNetworkAclEntry OR eventName = ReplaceNetworkAclAssociation)",,"DA-ESS-ContentUpdate",global,system,"This is a list of AWS event names that are associated with Network ACLs"
ES,"PROD-ES-1|search_head","previously_seen_cloud_compute_creations_by_user_input_filter","search *",,"DA-ESS-ContentUpdate",global,system,"Use this macro to add additional filters for monitoring users that create cloud compute images"
ES,"PROD-ES-1|search_head","previously_seen_cloud_compute_creations_by_user_search_window_begin_offset","-70m@m",,"DA-ESS-ContentUpdate",global,system,"Use this macro to determine how far into the past the window should be to determine if the user is new or not"
ES,"PROD-ES-1|search_head","previously_seen_cloud_compute_image_input_filter","search *",,"DA-ESS-ContentUpdate",global,system,"Use this macro to add additional filters for monitoring cloud compute images"
ES,"PROD-ES-1|search_head","previously_seen_cloud_compute_image_search_window_begin_offset","-70m@m",,"DA-ESS-ContentUpdate",global,system,"Use this macro to determine how far into the past the window should be to determine if the image is new or not"
ES,"PROD-ES-1|search_head","previously_seen_cloud_compute_instance_types_input_filter","search *",,"DA-ESS-ContentUpdate",global,system,"Use this macro to add additional filters for monitoring cloud compute instance types"
ES,"PROD-ES-1|search_head","previously_seen_cloud_compute_instance_types_search_window_begin_offset","-70m@m",,"DA-ESS-ContentUpdate",global,system,"Use this macro to determine how far into the past the window should be to determine if the instance type is new or not"
ES,"PROD-ES-1|search_head","previously_seen_cloud_regions_input_filter","search *",,"DA-ESS-ContentUpdate",global,system,"Use this macro to add additional filters for monitoring your cloud regions"
ES,"PROD-ES-1|search_head","previously_seen_cloud_regions_search_window_begin_offset","-70m@m",,"DA-ESS-ContentUpdate",global,system,"Use this macro to determine how far into the past the window should be to determine if the region is new or not"
ES,"PROD-ES-1|search_head","prohibited_apps_launching_cmd","| inputlookup prohibited_apps_launching_cmd | rename prohibited_applications as parent_process_name | eval parent_process_name=""*"" . parent_process_name | table parent_process_name",,"DA-ESS-ContentUpdate",global,system,"This macro outputs a list of process that should not be the parent process of cmd.exe"
ES,"PROD-ES-1|search_head","prohibited_softwares","lookup interesting_processes_lookup app as process_name OUTPUT is_prohibited | search is_prohibited=True",,"DA-ESS-ContentUpdate",global,system,"This macro limits the output to process_names that have been marked as prohibited"
ES,"PROD-ES-1|search_head","ransomware_extensions","lookup update=true ransomware_extensions_lookup Extensions AS file_extension OUTPUT Name | search Name !=False",,"DA-ESS-ContentUpdate",global,system,"This macro limits the output to files that have extensions associated with ransomware"
ES,"PROD-ES-1|search_head","ransomware_notes","lookup ransomware_notes_lookup ransomware_notes as file_name OUTPUT status as ""Known Ransomware Notes"" | search ""Known Ransomware Notes""=True",,"DA-ESS-ContentUpdate",global,system,"This macro limits the output to files that have been identified as a ransomware note"
ES,"PROD-ES-1|search_head","remote_desktop_network_traffic_filter","search *",,"DA-ESS-ContentUpdate",global,system,"Use this macro to add additional filters for remote desktop network traffic"
ES,"PROD-ES-1|search_head","remote_desktop_process_running_on_system_filter","search *",,"DA-ESS-ContentUpdate",global,system,"Use this macro to add additional filters for remote desktop process running on system"
ES,"PROD-ES-1|search_head","remove_valid_domains","eval domain=trim(domain,""*"") | search NOT[| inputlookup domains]  NOT[ |inputlookup cim_corporate_email_domain_lookup] NOT[inputlookup cim_corporate_web_domain_lookup] | eval domain=""*""+domain+""*""",,"DA-ESS-ContentUpdate",global,system,"This macro removes valid domains from the output"
ES,"PROD-ES-1|search_head","schtasks_scheduling_job_on_remote_system_filter","search *",,"DA-ESS-ContentUpdate",global,system,"Use this macro to add additional filters for schtasks scheduling job on remote system"
ES,"PROD-ES-1|search_head","security_content_ctime(1)","convert timeformat=""%m/%d/%Y %H:%M:%S"" ctime($field$)",field,"DA-ESS-ContentUpdate",global,system,"convert epoch time to string"
ES,"PROD-ES-1|search_head","security_content_summariesonly","summariesonly=true allow_old_summaries=true",,"DA-ESS-ContentUpdate",global,system,"search data model's summaries only"
ES,"PROD-ES-1|search_head","security_group_api_calls","(eventName=AuthorizeSecurityGroupIngress OR eventName=CreateSecurityGroup OR eventName=DeleteSecurityGroup OR eventName=DescribeClusterSecurityGroups OR eventName=DescribeDBSecurityGroups OR eventName=DescribeSecurityGroupReferences OR eventName=DescribeSecurityGroups OR eventName=DescribeStaleSecurityGroups OR eventName=RevokeSecurityGroupIngress OR eventName=UpdateSecurityGroupRuleDescriptionsIngress)",,"DA-ESS-ContentUpdate",global,system,"This macro is a list of AWS event names associated with security groups"
ES,"PROD-ES-1|search_head","suspicious_email_attachments","lookup update=true is_suspicious_file_extension_lookup file_name OUTPUT suspicious | search suspicious=true",,"DA-ESS-ContentUpdate",global,system,"This macro limits the output to email attachments that have suspicious extensions"
ES,"PROD-ES-1|search_head","suspicious_writes","lookup suspicious_writes_lookup file as file_name OUTPUT note as ""Reference"" | search ""Reference"" != False",,"DA-ESS-ContentUpdate",global,system,"This macro limites the output to file names that have been marked as suspicious"
ES,"PROD-ES-1|search_head",sysmon,"sourcetype=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational""",,"DA-ESS-ContentUpdate",global,system,"customer specific splunk configurations(eg- index, source, sourcetype) for Windows Sysmon Logs. Replace the macro definition with configurations for your Splunk Environmnent."
ES,"PROD-ES-1|search_head","system32_executables","lookup update=true system32_executables filename as process_name OUTPUT systemFile | search systemFile=true",,"DA-ESS-ContentUpdate",global,system,"This macro limits the output to process names that are in the Windows System directory"
ES,"PROD-ES-1|search_head","system_network_configuration_discovery_tools","(process_name= ""arp.exe"" OR process_name= ""at.exe"" OR process_name= ""attrib.exe"" OR process_name= ""cscript.exe"" OR process_name= ""dsquery.exe"" OR process_name= ""hostname.exe"" OR process_name= ""ipconfig.exe"" OR process_name= ""mimikatz.exe"" OR process_name= ""nbstat.exe"" OR process_name= ""net.exe"" OR process_name= ""netsh.exe"" OR process_name= ""nslookup.exe"" OR process_name= ""ping.exe"" OR process_name= ""quser.exe"" OR process_name= ""qwinsta.exe"" OR process_name= ""reg.exe"" OR process_name= ""runas.exe"" OR process_name= ""sc.exe"" OR process_name= ""schtasks.exe"" OR process_name= ""ssh.exe"" OR process_name= ""systeminfo.exe"" OR process_name= ""taskkill.exe"" OR process_name= ""telnet.exe"" OR process_name= ""tracert.exe"" OR process_name=""wscript.exe"" OR process_name= ""xcopy.exe"")",,"DA-ESS-ContentUpdate",global,system,"This macro is a list of process that can be used to discover the network configuration"
ES,"PROD-ES-1|search_head","unauthorized_dns_servers_filter","",,"DA-ESS-ContentUpdate",global,system,"Use this macro to add additional filters for DNS Query Requests Resolved by Unauthorized DNS Servers detection"
ES,"PROD-ES-1|search_head","uncommon_processes","lookup update=true lookup_uncommon_processes_default process_name as process_name outputnew uncommon_default,category_default,analytic_story_default,kill_chain_phase_default,mitre_attack_default | lookup update=true  lookup_uncommon_processes_local process_name as process_name outputnew uncommon_local,category_local,analytic_story_local,kill_chain_phase_local,mitre_attack_local | eval uncommon = coalesce(uncommon_default, uncommon_local), analytic_story = coalesce(analytic_story_default, analytic_story_local), category=coalesce(category_default, category_local), kill_chain_phase=coalesce(kill_chain_phase_default, kill_chain_phase_local), mitre_attack=coalesce(mitre_attack_default, mitre_attack_local) | fields - analytic_story_default, analytic_story_local, category_default, category_local, kill_chain_phase_default, kill_chain_phase_local, mitre_attack_default, mitre_attack_local, uncommon_default, uncommon_local | search uncommon=true",,"DA-ESS-ContentUpdate",global,system,"This macro limits the output to processes that have been marked as uncommon"
ES,"PROD-ES-1|search_head","unload_sysmon_filter_driver_filter","search *",,"DA-ESS-ContentUpdate",global,system,"Use this macro to add additional filter for Unload sysmon filter driver search to filter out the false positives"
ES,"PROD-ES-1|search_head","unsigned_image_loaded_by_LSASS_filter","search *",,"DA-ESS-ContentUpdate",global,system,"Use this macro to add additional filter for unsigned image loaded by LSASS"
ES,"PROD-ES-1|search_head","wineventlog_security","eventtype=""wineventlog_security""",,"DA-ESS-ContentUpdate",global,system,"Customer specific splunk configurations(eg- index, source, sourcetype) for Windows Event Logs. Replace the macro definition with configurations for your Splunk Environmnent."
ES,"PROD-ES-1|search_head","get_whois","`truncate_domain(dest, domain)` | lookup update=true whois_tracker domain OUTPUT _time as newly_seen,resolved_domain,created | eval created=if(match(created,""^\d{4}-\d{2}-\d{2}$""),strptime(created,""%Y-%m-%d""),created)",,"DA-ESS-NetworkProtection",global,system,
ES,"PROD-ES-1|search_head","http_category_sparkline_earliest","-24h@h",,"DA-ESS-NetworkProtection",global,system,
ES,"PROD-ES-1|search_head","http_category_sparkline_span",1h,,"DA-ESS-NetworkProtection",global,system,
ES,"PROD-ES-1|search_head","http_user_agent_sparkline_earliest","-24h@h",,"DA-ESS-NetworkProtection",global,system,
ES,"PROD-ES-1|search_head","http_user_agent_sparkline_span",1h,,"DA-ESS-NetworkProtection",global,system,
ES,"PROD-ES-1|search_head","large_email_threshold",2097152,,"DA-ESS-NetworkProtection",global,system,
ES,"PROD-ES-1|search_head","new_domain_analysis_sparkline_span",1h,,"DA-ESS-NetworkProtection",global,system,
ES,"PROD-ES-1|search_head","outputcheckpoint_whois",noop,,"DA-ESS-NetworkProtection",global,system,
ES,"PROD-ES-1|search_head","src_stream","source=stream*",,"DA-ESS-NetworkProtection",global,system,
ES,"PROD-ES-1|search_head","swap_resolved_domain(1)","eval ""$field$""=if(isnotnull(resolved_domain) AND resolved_domain!=""unknown"",resolved_domain,'$field$')",field,"DA-ESS-NetworkProtection",global,system,
ES,"PROD-ES-1|search_head","vulnerability_tracker","inputlookup append=T vulnerability_tracker | `get_asset(dest)`",,"DA-ESS-NetworkProtection",global,system,
ES,"PROD-ES-1|search_head","vulnerability_tracker(1)","inputlookup append=T vulnerability_tracker where `tracker_trp($timefield$,$timefield$)` | `get_asset(dest)`",timefield,"DA-ESS-NetworkProtection",global,system,
ES,"PROD-ES-1|search_head","all_threat_intel","`email_intel` | `file_intel` | `process_intel` | `registry_intel` | `service_intel` | `user_intel` | `http_intel` | `ip_intel` | `certificate_intel`",,"DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","all_threat_intel_stats","`all_threat_intel` | stats [| rest splunk_server=local count=0 /services/admin/macros search=""name=*_intel_stats NOT name=all_threat_intel_stats"" | `makemv(definition,"","")` | stats values(definition) as search | `makesv(search,"","")`] | addtotals fieldname=count | table count",,"DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","all_threat_intel_stats_by_threat_key","`all_threat_intel` | stats [| rest splunk_server=local count=0 /services/admin/macros search=""name=*_intel_stats NOT name=all_threat_intel_stats"" | `makemv(definition,"","")` | stats values(definition) as search | `makesv(search,"","")`] by threat_key | addtotals fieldname=count | table threat_key,count",,"DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","certificate_intel","inputlookup append=T certificate_intel | fillnull value=0 updated,disabled | `set_threat_collection_name(""certificate_intel"")` | mvexpand certificate_serial | `get_certificate_serial` | eventstats values(certificate_serial) as certificate_serial,values(certificate_serial_clean) as certificate_serial_clean,values(certificate_serial_dec) as certificate_serial_dec by _key | dedup _key,threat_collection | `get_threat_attribution_weight(threat_key)`",,"DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","certificate_intel_stats","dc(certificate_serial),dc(certificate_issuer_common_name),dc(certificate_issuer_email),dc(certificate_issuer_organization),dc(certificate_issuer_unit),dc(certificate_subject_common_name),dc(certificate_subject_email),dc(certificate_subject_organization),dc(certificate_subject_unit),dc(certificate_file_hash),dc(ip),dc(domain)",,"DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","email_intel","inputlookup append=T email_intel | fillnull value=0 updated,disabled | `set_threat_collection_name(""email_intel"")` | `get_threat_attribution_weight(threat_key)`",,"DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","email_intel_stats","dc(src_user),dc(subject),dc(file_name),dc(file_hash),dc(embedded_domain),dc(embedded_ip),dc(src)",,"DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","exclude_disabled_entries","where NOT disabled=1",,"DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","file_intel","inputlookup append=T file_intel | fillnull value=0 updated,disabled | `set_threat_collection_name(""file_intel"")` | `get_threat_attribution_weight(threat_key)`",,"DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","file_intel_stats","dc(file_hash),dc(file_name)",,"DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","filter_by_threat_age","search [| rest splunk_server=local count=0 /services/data/inputs/threatlist | join type=left url [rest splunk_server=local count=0 /services/data/transforms/lookups | eval url=""lookup://"".title | fields url filename] | eval max_age=case(is_threatintel=0, now(), isnull(max_age), 0, like(max_age, ""%rt%""), 0, 1==1, tonumber(relative_time(now(), max_age))) | where isnum(max_age) AND max_age>0 | eval threat_key=case(match(url, ""^lookup://.""), replace(filename, ""(.+)\.(.+)"",""\1""), type==""taxii"", ""*|"".title.""_TAXII_*"", 1=1, title),searchstring=""(threat_key=\"""".threat_key.""\"" time<"".max_age."")"" |  return 100 $searchstring | eval search=if(search==""()"" OR search=="""" OR isnull(search),"""",""NOT ("".search."")"")]",,"DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","filter_by_threat_category(2)","`threat_group_intel` | search threat_category=""$value$"" | rename _key as ""$field$"" | table ""$field$"" | format","field,value","DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","filter_by_threat_group(2)","`threat_group_intel` | search threat_group=""$value$"" | rename _key as ""$field$"" | table ""$field$"" | format","field,value","DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","filter_threatintel_collection(1)","inputlookup $collection$ | `filter_by_threat_age` | outputlookup $collection$ | stats count",collection,"DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","get_certificate_serial","rex field=certificate_serial "".*(?<certificate_serial>0x.*[a-fA-F0-9]).*"" | rex mode=sed field=certificate_serial ""s/\([Nn]egative\)/-/g"" | eval certificate_serial=case(match(certificate_serial,""^[+]\d+$""),substr(certificate_serial,2),match(certificate_serial,""^[-]?\d+$""),certificate_serial,match(certificate_serial,""^[+][a-fA-F0-9]+(?:\:|$)""),""0x"".substr(certificate_serial,2),match(certificate_serial,""^[a-fA-F0-9]+(?:\:|$)""),""0x"".certificate_serial,match(certificate_serial,""^[-][a-fA-F0-9]+(?:\:|$)""),""-0x"".substr(certificate_serial,2),1=1,certificate_serial) | eval certificate_serial_dec=if(match(certificate_serial,""^[-]?\d+$""),certificate_serial,certificate_serial_dec) | eval certificate_serial=if(isnotnull(certificate_serial_dec),null(),certificate_serial) | `get_certificate_serial_clean` | lookup hex2dec hex as certificate_serial_clean OUTPUTNEW dec as certificate_serial_dec | lookup hex2dec dec as certificate_serial_dec OUTPUTNEW hex as certificate_serial | `get_certificate_serial_clean`",,"DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","get_certificate_serial_clean","eval certificate_serial_clean=certificate_serial | rex mode=sed field=certificate_serial_clean ""s/://g""",,"DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","get_threat_attribution(1)","lookup update=true threat_group_intel _key as ""$key$"" OUTPUTNEW | fillnull value=""undefined"" threat_group,threat_category",key,"DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","get_threat_attribution_weight(1)","lookup update=true threat_group_intel _key as ""$key$"" OUTPUTNEW weight",key,"DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","get_threat_download_status","rex field=threat_key "".*?\|(?<threatlist_title>.+)_TAXII"" | eval threatlist_title=if(isnull(threatlist_title),threat_key,threatlist_title) | join type=outer threatlist_title [| rest splunk_server=local count=0 /services/data/inputs/threatlist | rename title as threatlist_title | table threatlist_title, disabled] | fields - threatlist_title",,"DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","http_intel","inputlookup append=T http_intel | fillnull value=0 updated,disabled | `set_threat_collection_name(""http_intel"")` | `get_threat_attribution_weight(threat_key)`",,"DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","http_intel_stats","dc(http_user_agent),dc(http_referrer),dc(url),dc(header),dc(ip),dc(domain)",,"DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","ip_intel","inputlookup append=T ip_intel | fillnull value=0 updated,disabled | `set_threat_collection_name(""ip_intel"")` | `get_threat_attribution_weight(threat_key)`",,"DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","ip_intel_stats","dc(ip),dc(domain)",,"DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","process_intel","inputlookup append=T process_intel | fillnull value=0 updated,disabled | `set_threat_collection_name(""process_intel"")` | `get_threat_attribution_weight(threat_key)`",,"DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","process_intel_stats","dc(process),dc(process_file_name),dc(process_handle_name),dc(src),dc(dest)",,"DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","registry_intel","inputlookup append=T registry_intel | fillnull value=0 updated,disabled | `set_threat_collection_name(""registry_intel"")` | `get_threat_attribution_weight(threat_key)`",,"DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","registry_intel_stats","dc(registry_path),dc(registry_value_name),dc(registry_value_text)",,"DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","service_intel","inputlookup append=T service_intel | fillnull value=0 updated,disabled | `set_threat_collection_name(""service_intel"")` | `get_threat_attribution_weight(threat_key)`",,"DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","service_intel_stats","dc(service),dc(service_file_hash),dc(service_dll_file_hash)",,"DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","set_threat_collection_name(1)","eval threat_collection=if(isnull(threat_collection),""$string$"",threat_collection)",string,"DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","set_threat_intel_meta_now(1)","eval collection=""$collection$"",time=now() | fields - count | outputlookup key_field=collection append=T threat_intel_meta_lookup",collection,"DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","threat_artifacts_max",10000,,"DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","threat_categories","`threat_group_intel` | stats count by threat_category | fields threat_category | sort + threat_category",,"DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","threat_group_intel","inputlookup append=T threat_group_intel | fillnull value=""undefined"" threat_group,threat_category",,"DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","threat_groups","`threat_group_intel` | stats count by threat_group | fields threat_group | sort + threat_group",,"DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","threat_sources","`threat_group_intel` | fields source_id | dedup source_id | sort + source_id",,"DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","threatintel_collection_keys","inputlookup append=T threatintel_collection_key_lookup | dedup collection,key | sort + collection,key",,"DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","threatintel_domain_lookup(1)","`truncate_domain_dedup($source$)` | lookup update=true threatintel_by_domain domain as ""$source$"" OUTPUTNEW | lookup update=true threatintel_by_domain domain as ""$source$_domain"" OUTPUTNEW",source,"DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","threatintel_multilookup(1)","lookup update=true threatintel_by_system system as ""$field$"" OUTPUTNEW | lookup update=true threatintel_by_cidr cidr as ""$field$"" OUTPUTNEW | `threatintel_domain_lookup($field$)` | eval threat_match_field=case(isnotnull(threat_match_field),threat_match_field,isnotnull('$field$') AND isnotnull(threat_collection_key),""$field$"",1=1,threat_match_field) | eval threat_match_value=case(isnotnull(threat_match_value),threat_match_value,isnotnull('$field$') AND isnotnull(threat_collection_key),'$field$',1=1,threat_match_value)",field,"DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","threatintel_outputlookup(1)","`threatintel_outputlookup(""$field$"",""threatintel_by_$field$"")`",field,"DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","threatintel_outputlookup(2)","`get_threat_download_status` | `threatintel_outputlookup_exclusions` | mvexpand ""$field$"" | rename _key as threat_collection_key | dedup ""$field$"",threat_collection_key,threat_key | where isnotnull('$field$') AND NOT ('$field$' LIKE ""*%"" OR '$field$' LIKE ""%*"") | fillnull value=""X"" weight | table ""$field$"",threat_collection,threat_collection_key,threat_key,weight | outputlookup $collection$ | stats count","field,collection","DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","threatintel_outputlookup_exclusions","where NOT match(disabled, ""1|[Tt]|[Tt][Rr][Uu][Ee]"")",,"DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","threatintel_outputlookup_wildcard(1)","`threatintel_outputlookup_wildcard(""$field$"",""threatintel_by_$field$_wildcard"")`",field,"DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","threatintel_outputlookup_wildcard(2)","`get_threat_download_status` | `threatintel_outputlookup_exclusions` | mvexpand ""$field$"" | rename _key as threat_collection_key | dedup ""$field$"",threat_collection_key,threat_key | where isnotnull('$field$') AND ('$field$' LIKE ""*%"" OR '$field$' LIKE ""%*"") AND len('$field$')>=`threatintel_wildcard_minlength` | fillnull value=""X"" weight | table ""$field$"",threat_collection,threat_collection_key,threat_key,weight | outputlookup $collection$ | stats count","field,collection","DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","threatintel_url_lookup(1)","lookup update=true threatintel_by_url ""$url$"" OUTPUTNEW | lookup update=true threatintel_by_url_wildcard ""$url$"" OUTPUTNEW",url,"DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","threatintel_wildcard_minlength",3,,"DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","user_intel","inputlookup append=T user_intel | fillnull value=0 updated,disabled | `set_threat_collection_name(""user_intel"")` | `get_threat_attribution_weight(threat_key)`",,"DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","user_intel_stats","dc(user)",,"DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","zipexpand_threat_matches","eval intelzip=mvzip(threat_collection,threat_collection_key,""@@""), intelzip=mvzip(intelzip,threat_key,""@@""), intelzip=mvzip(intelzip,weight,""@@"") | fields - threat_collection,threat_collection_key,threat_key,weight | mvexpand intelzip | rex field=intelzip ""(?<threat_collection>.+?)@@(?<threat_collection_key>.+?)@@(?<threat_key>.+?)@@(?<weight>.+)"" | eval weight=if(isnum(weight),weight,null()) | fields - intelzip",,"DA-ESS-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","access_apps","inputlookup append=T access_app_tracker",,"SA-AccessProtection",global,system,
ES,"PROD-ES-1|search_head","access_tracker","inputlookup append=T access_tracker | `get_identity4events(user)` | `get_asset(dest)` | `get_identity4events(dest_owner)`",,"SA-AccessProtection",global,system,
ES,"PROD-ES-1|search_head","access_tracker(1)","inputlookup append=T access_tracker where `tracker_trp($timefield$,$timefield$)` | `get_identity4events(user)` | `get_asset(dest)` | `get_identity4events(dest_owner)`",timefield,"SA-AccessProtection",global,system,
ES,"PROD-ES-1|search_head","account_management","tag=account (tag=management OR tag=lockout) | tags outputfield=tag | fillnull value=unknown signature,src,src_nt_domain,src_user,dest,dest_nt_domain,user",,"SA-AccessProtection",global,system,
ES,"PROD-ES-1|search_head","all_default_account_usage(2)","`default_user_accounts` | eval ""$default_account$""=case(src_user_category==""default"",src_user,user_category==""default"",user,1=1,'$default_account$') | eval ""$default_account_system$""=case(src_user_category==""default"",src,user_category==""default"",dest,1=1,'$default_account_system$')","default_account,default_account_system","SA-AccessProtection",global,system,
ES,"PROD-ES-1|search_head",authentication,"tag=authentication NOT (action=success user=*$) | tags outputfield=tag | fillnull value=unknown action,app,src,src_user,dest,user",,"SA-AccessProtection",global,system,
ES,"PROD-ES-1|search_head","authentication(1)","`authentication` | search action=$action$",action,"SA-AccessProtection",global,system,
ES,"PROD-ES-1|search_head","default_local_accounts","`default_user_accounts` `useraccounts` | tags outputfield=tag",,"SA-AccessProtection",global,system,
ES,"PROD-ES-1|search_head","default_user_accounts","(tag=default OR src_user_category=default OR user_category=default)",,"SA-AccessProtection",global,system,
ES,"PROD-ES-1|search_head","get_second2lastTime_meval(3)","""$second$""=mvdedup(mvappend('$second$',NULL,'$last_vals$')),`mvfilter_field_meval($second$,$last$)`,""$second$""=max('$second$')","second,last_vals,last","SA-AccessProtection",global,system,
ES,"PROD-ES-1|search_head","inactive_account_usage(2)","inputlookup append=T access_tracker where [| makeresults | `make_ts_value(""-$lessThan$h"",lastTime_user)` | eval search=""lastTime_user>="".lastTime_user | return $search] | stats min(firstTime) as firstTime,values(second2lastTime) as second2lastTime,values(lastTime) as lastTime_vals,max(lastTime) as lastTime by user | eval `get_second2lastTime_meval(second2lastTime,lastTime_vals,lastTime)`,inactiveDays=round((lastTime-second2lastTime)/86400,2),_time=lastTime | search inactiveDays>=$greaterThan$ | `get_identity4events(user)`","greaterThan,lessThan","SA-AccessProtection",global,system,
ES,"PROD-ES-1|search_head","inactive_accounts(1)","inputlookup append=T access_tracker where [| makeresults | `make_ts_value(""-$greaterThan$d"",lastTime_user)` | eval search=""lastTime_user<="".lastTime_user | return $search] | stats min(firstTime) as firstTime,max(lastTime) as lastTime by user | eval _time=lastTime,inactiveDays=round(((time()-lastTime)/86400),2) | `get_identity4events(user)`",greaterThan,"SA-AccessProtection",global,system,
ES,"PROD-ES-1|search_head","settags_access","tag LIKE ""%""",,"SA-AccessProtection",global,system,
ES,"PROD-ES-1|search_head","asset_eventcount","`assets` | join type=outer asset_id [| `host_eventcount` | `hourDiff` | rename host_asset_id as asset_id | fields asset_id,firstTime,lastTime,hourDiff,dayDiff]",,"SA-AuditAndDataProtection",global,system,
ES,"PROD-ES-1|search_head","event_count_filter","(index!=notable index!=risk index!=*summary*)",,"SA-AuditAndDataProtection",global,system,
ES,"PROD-ES-1|search_head","expected_view_tracker(1)","tstats `summariesonly` count from datamodel=Splunk_Audit.View_Activity by _time,View_Activity.app,View_Activity.view,View_Activity.user span=1s | `drop_dm_object_name(""View_Activity"")` | `get_expected_views` | search is_expected=true | append [| `expected_views` | search is_expected=true | expectedactivity append=False fields=""app,view"" earliest=$earliest$ latest=now interval=86400 | eval count=0] | sort - _time",earliest,"SA-AuditAndDataProtection",global,system,
ES,"PROD-ES-1|search_head","expected_view_tracker(2)","`expected_view_tracker($earliest$)` | search app=""$app$""","earliest, app","SA-AuditAndDataProtection",global,system,
ES,"PROD-ES-1|search_head","expected_view_tracker(3)","`expected_view_tracker($earliest$)` | search app=""$app$"" view=""$view$""","earliest, app, view","SA-AuditAndDataProtection",global,system,
ES,"PROD-ES-1|search_head","expected_views","inputlookup append=T expected_views_lookup | dedup app,view | `str_to_bool(is_expected)` | sort + app,view",,"SA-AuditAndDataProtection",global,system,
ES,"PROD-ES-1|search_head","expected_views(1)","`expected_views` | search app=""$app$""",app,"SA-AuditAndDataProtection",global,system,
ES,"PROD-ES-1|search_head","expected_views(2)","`expected_views` | search app=""$app$"" view=""$view$""","app, view","SA-AuditAndDataProtection",global,system,
ES,"PROD-ES-1|search_head","get_expected_views","lookup local=true expected_views_lookup app,view OUTPUT app,is_expected | `str_to_bool(is_expected)`",,"SA-AuditAndDataProtection",global,system,
ES,"PROD-ES-1|search_head","host_eventcount","`host_eventcount(""*"")`",,"SA-AuditAndDataProtection",global,system,
ES,"PROD-ES-1|search_head","host_eventcount(1)","metadata type=hosts index=$index$ | `lower(host)` | stats min(firstTime) as firstTime,max(recentTime) as recentTime,max(lastTime) as lastTime,sum(totalCount) as totalCount by host | eval _time=lastTime | `get_asset(host)` | `get_identity4events(host_owner)` | eval is_expected=host_is_expected | eval dayDiff=round((now()-lastTime)/86400,2) | sort 0 -dayDiff",index,"SA-AuditAndDataProtection",global,system,
ES,"PROD-ES-1|search_head","host_eventcount(2)","`host_eventcount` | `daysago($lessThan$)` | `hoursago($greaterThan$,"">"")`","lessThan,greaterThan","SA-AuditAndDataProtection",global,system,
ES,"PROD-ES-1|search_head","index_thruput(1)","index=_internal source=""*metrics.log*"" group=per_$metric$_thruput | eval KBytes=kb | eval MBytes=KBytes/1024 | eval GBytes=MBytes/1024 | eval KBps=kbps | eval MBps=KBps/1024 | eval GBps=MBps/1024",metric,"SA-AuditAndDataProtection",global,system,
ES,"PROD-ES-1|search_head","license_info","index=_internal source=""*license_audit.log*"" todaysBytesIndexed | eval exceedTimeDiff=now()-lastExceedDate | `ctime(lastExceedDate)` | eval peakGBytes=peak/1073741824 | eval todaysGBytesIndexed=todaysBytesIndexed/1073741824",,"SA-AuditAndDataProtection",global,system,
ES,"PROD-ES-1|search_head","licensing_epd","inputlookup append=t licensing_epd | bucket _time span=1d",,"SA-AuditAndDataProtection",global,system,
ES,"PROD-ES-1|search_head","splunkd_startmode","`splunkd_startmode(""*"")`",,"SA-AuditAndDataProtection",global,system,
ES,"PROD-ES-1|search_head","splunkd_startmode(1)","`service($host$)` | search (app=Splunkd OR app=splunk)",host,"SA-AuditAndDataProtection",global,system,
ES,"PROD-ES-1|search_head","splunkd_utilization","`splunkd_utilization(""*"")`",,"SA-AuditAndDataProtection",global,system,
ES,"PROD-ES-1|search_head","splunkd_utilization(1)","`localprocesses($host$)` | search app=""*splunkd*""",host,"SA-AuditAndDataProtection",global,system,
ES,"PROD-ES-1|search_head","view_activity","`view_activity(""*"",""*"")`",,"SA-AuditAndDataProtection",global,system,
ES,"PROD-ES-1|search_head","view_activity(1)","`view_activity(""$app$"",""*"")`",app,"SA-AuditAndDataProtection",global,system,
ES,"PROD-ES-1|search_head","view_activity(2)","index=_internal sourcetype=splunk_web_access method=GET status=200 | rex ""GET /[^/]+/app/(?<app>[^/ ?]+)/(?<view>[^/ ?]+)"" | search app=""$app$"" view=""$view$""","app, view","SA-AuditAndDataProtection",global,system,
ES,"PROD-ES-1|search_head",cputime,"(sourcetype=""*:CPUTime"" NOT sourcetype=""Perfmon:CPUTime"") OR (sourcetype=""Perfmon:CPUTime"" PercentProcessorTime=*) OR (sourcetype=cpu AND cpu=""all"") | tags outputfield=tag | fillnull value=unknown PercentProcessorTime | eval PercentProcessorTime=if(PercentProcessorTime=""unknown"",PercentSystemTime+PercentUserTime,PercentProcessorTime) | search NOT PercentProcessorTime=unknown",,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","cputime(1)","dest=$host$ `cputime`",host,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","cputime(2)","`cputime($host$)` | head $limit$","host, limit","SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head",disk,"(sourcetype=*:FreeDiskSpace NOT sourcetype=Perfmon:FreeDiskSpace) OR sourcetype=df | append [search sourcetype=Perfmon:FreeDiskSpace | transaction _time, dest, collection, object, instance | search PercentFreeSpace=* FreeMBytes=*] | tags outputfield=tag | search NOT mount=*Total | fillnull value=0 FreeMBytes,PercentFreeSpace,TotalMBytes,UsedMBytes | eval PercentFreeSpace=if(PercentFreeSpace<=0,0.01,PercentFreeSpace) | eval PercentFreeSpaceDec=PercentFreeSpace/100 | eval TotalMBytes=if(sourcetype==""WMI:FreeDiskSpace"" OR sourcetype=""Perfmon:FreeDiskSpace"",FreeMBytes/PercentFreeSpaceDec,TotalMBytes) | eval UsedMBytes = if(sourcetype==""WMI:FreeDiskSpace"" OR sourcetype=""Perfmon:FreeDiskSpace"",TotalMBytes-FreeMBytes,UsedMBytes) | eval FreeMBytes=round(FreeMBytes) | eval TotalMBytes=round(TotalMBytes) | eval UsedMBytes=round(UsedMBytes)",,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","disk(1)","dest=$host$ `disk`",host,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","disk(2)","`disk($host$)` | transaction _time,dest | head $limit$","host, limit","SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","endpoint_change","tag=endpoint tag=change | tags outputfield=tag | fillnull value=unknown action,dest,object,object_category,object_path,status,user",,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","get_interesting_ports","lookup interesting_ports_lookup transport,dest_port,dest OUTPUTNEW is_required,is_prohibited,is_secure,note | fillnull value=""undefined"" is_required,is_prohibited,is_secure | `lower(is_required)` | `lower(is_prohibited)` | `lower(is_secure)`",,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","get_interesting_processes","lookup interesting_processes_lookup app as process,dest OUTPUTNEW is_required,is_prohibited,is_secure,note | fillnull value=""undefined"" is_required,is_prohibited,is_secure | `lower(is_required)` | `lower(is_prohibited)` | `lower(is_secure)`",,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","get_interesting_services","lookup interesting_services_lookup app as service,dest OUTPUTNEW is_required,is_prohibited,is_secure,note | fillnull value=""undefined"" is_required,is_prohibited,is_secure | `lower(is_required)` | `lower(is_prohibited)` | `lower(is_secure)`",,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","get_primary_function(1)","lookup primary_function_lookup $type$ OUTPUTNEW is_primary,function | `str_to_bool(is_primary)`",type,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","get_primary_function-port","`get_primary_function(""transport,port as dest_port"")`",,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","get_update_signature","lookup update=true update_signature_reference_lookup signature_id,vendor_product OUTPUTNEW signature",,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","index_time_delta","index=endpoint_summary source=""Endpoint - Index Time Delta 2 - Summary Gen"" | rename orig_* as * | rename tag::orig_* as tag::*",,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head",listeningports,"tag=listening tag=port | tags outputfield=tag | fillnull value=0 dest_port | fillnull value=""unknown"" dest,transport | eval transport=lower(transport) | `get_transport_dest_port`",,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","listeningports(1)","dest=$host$ `listeningports`",host,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","listeningports(2)","`listeningports($host$)` | transaction _time,dest | head $limit$","host, limit","SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","listeningports_tracker","inputlookup append=T listeningports_tracker | `get_asset(dest)` | `get_identity4events(dest_owner)`",,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","listeningports_tracker(1)","inputlookup append=T listeningports_tracker where `tracker_trp($timefield$,$timefield$)` | `get_asset(dest)` | `get_identity4events(dest_owner)`",timefield,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head",localprocesses,"tag=process tag=report | tags outputfield=tag | fillnull value=""unknown"" dest,process | eval UsedMBytes=UsedBytes/1048576",,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","localprocesses(1)","dest=$host$ `localprocesses`",host,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","localprocesses(2)","`localprocesses($host$)` | transaction _time,dest | head $limit$","host, limit","SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","localprocesses_tracker","inputlookup append=T localprocesses_tracker | `get_asset(dest)` | `get_identity4events(dest_owner)`",,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","localprocesses_tracker(1)","inputlookup append=T localprocesses_tracker where `tracker_trp($timefield$,$timefield$)` | `get_asset(dest)` | `get_identity4events(dest_owner)`",timefield,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head",malware,"tag=malware tag=attack | tags outputfield=tag | fillnull value=unknown action,category,signature,dest,dest_nt_domain,user,file_name,file_path,file_hash | `get_vendor_product`",,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","malware_operations","tag=malware tag=operations | eval dest_nt_domain=if(isnull(dest_nt_domain),""unknown"",dest_nt_domain) | eval vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!=""unknown"" AND isnotnull(product) AND product!=""unknown"",vendor."" "".product,isnotnull(vendor) AND vendor!=""unknown"" AND (isnull(product) OR product=""unknown""),vendor."" unknown"",(isnull(vendor) OR vendor=""unknown"") AND isnotnull(product) AND product!=""unknown"",""unknown "".product,isnotnull(sourcetype),sourcetype,1=1,""unknown"")",,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","malware_operations_tracker","inputlookup append=T malware_operations_tracker | `get_asset(dest)` | `get_identity4events(dest_owner)`",,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","malware_operations_tracker(1)","inputlookup append=T malware_operations_tracker where `tracker_trp($timefield$,$timefield$)` | `get_asset(dest)` | `get_identity4events(dest_owner)`",timefield,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","malware_product_deployment_tracker","`assets` | join type=outer asset_id [| `malware_operations_tracker` | eval lastTime=_time | rename dest_asset_id as asset_id | fields asset_id,lastTime] | eval _time=lastTime | `timeDiff` | `dayDiff`",,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","malware_product_versions","tag=endpoint tag=application tag=version | dedup dest | tags outputfield=tag | `get_vendor_product` | fillnull value=""unknown"" product_version",,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","malware_signature_updates","tag=endpoint tag=application tag=signature tag=update | dedup dest | tags outputfield=tag | `get_vendor_product` | fillnull value=""unknown"" signature_version",,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","malware_tracker","inputlookup append=T malware_tracker | `get_asset(dest)` | `get_identity4events(dest_owner)`",,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","malware_tracker(1)","inputlookup append=T malware_tracker where `tracker_trp($timefield$,$timefield$)` | `get_asset(dest)` | `get_identity4events(dest_owner)`",timefield,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head",memory,"(sourcetype=""*:Memory"" OR sourcetype=vmstat) NOT sourcetype=Perfmon:Memory | append [search sourcetype=Perfmon:Memory | transaction _time, dest, collection, object | search FreeMBytes=* UsedBytes=*] | tags outputfield=tag | eval UsedMBytes=UsedBytes/1048576 | eval TotalMBytes=if(sourcetype==""WMI:Memory"" OR sourcetype=""Perfmon:Memory"", FreeMBytes+UsedMBytes, TotalMBytes) | eval FreeMBytes=round(FreeMBytes) | eval UsedMBytes=round(UsedMBytes) | eval TotalMBytes=round(TotalMBytes)",,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","memory(1)","dest=$host$ `memory`",host,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","memory(2)","`memory($host$)` | head $limit$","host, limit","SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","ntp_startmode","`ntp_startmode(""*"")`",,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","ntp_startmode(1)","tag=time `service($host$)` | dedup dest",host,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","os_normalization","eval os=replace(os,""\(R\)"","""") | eval os=replace(os,""\\\\xA8"","""") | eval os=replace(os,""MS Windows"",""Microsoft Windows"") | eval os=replace(os,""^Windows"",""Microsoft Windows"")",,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","primary_functions","inputlookup append=T primary_function_lookup",,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","primary_functions_tracker","inputlookup append=T localprocesses_tracker | `get_primary_function(process)` | inputlookup append=T services_tracker | where isnotnull(process) OR (isnotnull(service) AND start_mode!=""Auto"") | `get_primary_function(service)` | inputlookup append=T listeningports_tracker | `get_primary_function-port` | `get_asset(dest)` | `get_identity4events(dest_owner)`",,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","primary_functions_tracker(1)","inputlookup append=T localprocesses_tracker where `tracker_trp($timefield$,$timefield$)` | `get_primary_function(process)` | inputlookup append=T services_tracker where `tracker_trp($timefield$,$timefield$)` | where isnotnull(process) OR (isnotnull(service) AND start_mode!=""Auto"") | `get_primary_function(service)` | inputlookup append=T listeningports_tracker where `tracker_trp($timefield$,$timefield$)` | `get_primary_function-port` | `get_asset(dest)` | `get_identity4events(dest_owner)`",timefield,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","registry_tracker","inputlookup append=T registry_tracker | `get_asset(dest)` | `get_identity4events(dest_owner)`",,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head",selinuxconfig,"sourcetype=""*:SELinuxConfig""",,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","selinuxconfig(1)","dest=$host$ `selinuxconfig`",host,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","selinuxconfig(2)","`selinuxconfig($host$)` | head $limit$","host, limit","SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head",service,"tag=service tag=report | tags outputfield=tag | fillnull value=""unknown"" dest,service,start_mode,status,State",,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","service(1)","dest=$host$ `service`",host,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","service(2)","`service($host$)` | transaction _time,dest | head $limit$","host, limit","SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","services_tracker","inputlookup append=T services_tracker | `get_asset(dest)` | `get_identity4events(dest_owner)`",,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","services_tracker(1)","inputlookup append=T services_tracker where `tracker_trp($timefield$,$timefield$)` | `get_asset(dest)` | `get_identity4events(dest_owner)`",timefield,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","settags_endpoint","tag LIKE ""%""",,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head",sshdconfig,"sourcetype=""*:SSHDConfig""",,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","sshdconfig(1)","dest=$host$ `sshdconfig`",host,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","sshdconfig(2)","`sshdconfig($host$)` | head $limit$","host, limit","SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","system_update","tag=system tag=update tag=status | tags outputfield=tag | fillnull value=unknown signature_id,signature,status,dest",,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","system_update_tracker","tstats `summariesonly` max(_time) as _time,latest(Updates.status) as status,latest(Updates.dest_should_update) as dest_should_update from datamodel=Updates.Updates by Updates.dest,Updates.signature_id,Updates.vendor_product | `drop_dm_object_name(""Updates"")` | `get_update_signature` | sort - _time,dest,signature | fields _time,status,signature_id,signature,dest,dest_should_update",,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","system_version","tag=system tag=version | tags outputfield=tag | fillnull value=unknown os | eval os=if(os==""unknown"",os_name."" "".os_release,os) | `os_normalization` | dedup dest",,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","time_sync","tag=time tag=synchronize",,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","time_sync(1)","tag=$action$ `time_sync`",action,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","update_startmode","`update_startmode(""*"")`",,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","update_startmode(1)","tag=update `service($host$)` | `tag2field_should(update)` | dedup dest",host,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head",uptime,"tag=""uptime"" | dedup dest | tags outputfield=tag | `uptime2string(SystemUpTime,label)`",,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","uptime(1)","dest=$host$ `uptime`",host,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","uptime(2)","`uptime($host$)` | head $limit$","host, limit","SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head",useraccounts,"sourcetype=""*:UserAccounts"" | tags outputfield=tag | rex field=password ""\*(?<password>)""",,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","useraccounts(1)","dest=$host$ `useraccounts`",host,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","useraccounts(2)","`useraccounts($host$)` | transaction _time,dest | head $limit$","host, limit","SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","useraccounts_tracker","inputlookup append=T useraccounts_tracker | `get_identity4events(user)` | `get_asset(dest)` | `get_identity4events(dest_owner)`",,"SA-EndpointProtection",global,system,
ES,"PROD-ES-1|search_head","asset_categories","inputlookup append=T category_lookup WHERE category_source!=""identity"" | `lower(category)` | dedup category | sort + category | fields category",,"SA-IdentityManagement",global,system,
ES,"PROD-ES-1|search_head","asset_fields","asset,asset_tag,bunit,category,city,country,dns,ip,is_expected,lat,long,mac,nt_host,owner,pci_domain,priority,requires_av,should_timesync,should_update",,"SA-IdentityManagement",global,system,
ES,"PROD-ES-1|search_head","asset_search(1)","`get_subject(""dest"", $val$)` OR `get_subject(""dvc"", $val$)` OR `get_subject(""host"", $val$)` OR `get_subject(""orig_host"", $val$)` OR `get_subject(""src"", $val$)`",val,"SA-IdentityManagement",global,system,
ES,"PROD-ES-1|search_head",assets,"inputlookup append=T asset_lookup_by_str | inputlookup append=T asset_lookup_by_cidr | rename _key as asset_id,asset_tag as tag",,"SA-IdentityManagement",global,system,
ES,"PROD-ES-1|search_head","assets(1)","inputlookup append=T asset_lookup_by_str where $filters$ | inputlookup append=T asset_lookup_by_cidr where $filters$ | rename _key as asset_id, asset_tag as tag",filters,"SA-IdentityManagement",global,system,
ES,"PROD-ES-1|search_head",categories,"inputlookup append=T category_lookup | `lower(category)` | dedup category | sort + category | fields category",,"SA-IdentityManagement",global,system,
ES,"PROD-ES-1|search_head","get_asset(1)","`get_asset_by(""str"",$subject$)` | `get_asset_by(""cidr"",$subject$)` | lookup asset_lookup_default_fields key as $subject$ OUTPUTNEW pci_domain as $subject$_pci_domain, is_expected as $subject$_is_expected, requires_av as $subject$_requires_av, should_timesync as $subject$_should_timesync, should_update as $subject$_should_update | eval ""$subject$_ip""=case(match('$subject$_ip', ""^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$""),'$subject$_ip',match('$subject$', ""^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$""),$subject$,1=1,null()),`mvappend_field_meval(tag,$subject$_asset_tag)`",subject,"SA-IdentityManagement",global,system,
ES,"PROD-ES-1|search_head","get_asset_by(2)","lookup update=true asset_lookup_by_$key$ asset as ""$subject$"" OUTPUTNEW `prepend_alias_assets($subject$)`","key,subject","SA-IdentityManagement",global,system,
ES,"PROD-ES-1|search_head","get_asset_simple(1)","(dns=""$subject$"" OR nt_host=""$subject$"" OR mac=""$subject$"" OR ip=""$subject$"")",subject,"SA-IdentityManagement",global,system,
ES,"PROD-ES-1|search_head","get_bunit(1)","(tag=""$bunit$"" OR bunit=""$bunit$"" OR ((host_bunit=""$bunit$"" OR host_owner_bunit=""$bunit$"") NOT sourcetype=stash) OR orig_host_bunit=""$bunit$"" OR src_bunit=""$bunit$"" OR dest_bunit=""$bunit$"" OR dvc_bunit=""$bunit$"" OR src_user_bunit=""$bunit$"" OR user_bunit=""$bunit$"" OR orig_host_owner_bunit=""$bunit$"" OR src_owner_bunit=""$bunit$"" OR dest_owner_bunit=""$bunit$"" OR dvc_owner_bunit=""$bunit$"")",bunit,"SA-IdentityManagement",global,system,
ES,"PROD-ES-1|search_head","get_bunit_dm(2)","(""$object$.tag""=""$bunit$"" OR ""$object$.bunit""=""$bunit$"" OR ((""$object$.host_bunit""=""$bunit$"" OR ""$object$.host_owner_bunit""=""$bunit$"") NOT sourcetype=stash) OR ""$object$.orig_host_bunit""=""$bunit$"" OR ""$object$.src_bunit""=""$bunit$"" OR ""$object$.dest_bunit""=""$bunit$"" OR ""$object$.dvc_bunit""=""$bunit$"" OR ""$object$.src_user_bunit""=""$bunit$"" OR ""$object$.user_bunit""=""$bunit$"" OR ""$object$.orig_host_owner_bunit""=""$bunit$"" OR ""$object$.src_owner_bunit""=""$bunit$"" OR ""$object$.dest_owner_bunit""=""$bunit$"" OR ""$object$.dvc_owner_bunit""=""$bunit$"")","object, bunit","SA-IdentityManagement",global,system,
ES,"PROD-ES-1|search_head","get_category(1)","(tag=""$category$"" OR category=""$category$"" OR ((host_category=""$category$"" OR host_owner_category=""$category$"") NOT sourcetype=stash) OR orig_host_category=""$category$"" OR src_category=""$category$"" OR dest_category=""$category$"" OR dvc_category=""$category$"" OR src_user_category=""$category$"" OR user_category=""$category$"" OR orig_host_owner_category=""$category$"" OR src_owner_category=""$category$"" OR dest_owner_category=""$category$"" OR dvc_owner_category=""$category$"")",category,"SA-IdentityManagement",global,system,
ES,"PROD-ES-1|search_head","get_category_dm(2)","(""$object$.tag""=""$category$"" OR ""$object$.category""=""$category$"" OR ((""$object$.host_category""=""$category$"" OR ""$object$.host_owner_category""=""$category$"") NOT sourcetype=stash) OR ""$object$.orig_host_category""=""$category$"" OR ""$object$.src_category""=""$category$"" OR ""$object$.dest_category""=""$category$"" OR ""$object$.dvc_category""=""$category$"" OR ""$object$.src_user_category""=""$category$"" OR ""$object$.user_category""=""$category$"" OR ""$object$.orig_host_owner_category""=""$category$"" OR ""$object$.src_owner_category""=""$category$"" OR ""$object$.dest_owner_category""=""$category$"" OR ""$object$.dvc_owner_category""=""$category$"")","object, category","SA-IdentityManagement",global,system,
ES,"PROD-ES-1|search_head","get_events4identity(2)","(user_$field$=""$value$"" OR src_user_$field$=""$value$"" OR (host_owner_$field$=""$value$"" NOT sourcetype=stash) OR orig_host_owner_$field$=""$value$"" OR src_owner_$field$=""$value$"" OR dest_owner_$field$=""$value$"" OR dvc_owner_$field$=""$value$"")","field,value","SA-IdentityManagement",global,system,
ES,"PROD-ES-1|search_head","get_identity4events(1)","lookup update=true identity_lookup_expanded identity as $username$ OUTPUTNEW `prepend_alias_identities($username$)` | lookup identity_lookup_default_fields key as $username$ OUTPUTNEW watchlist as $username$_watchlist  | eval `mvappend_field_meval(tag,$username$_identity_tag)`,`iden_mktime_meval($username$_startDate)`,`iden_mktime_meval($username$_endDate)`",username,"SA-IdentityManagement",global,system,
ES,"PROD-ES-1|search_head","get_pci_domain(1)","(pci_domain=""$domain$"" OR (host_pci_domain=""$domain$"" NOT sourcetype=stash) OR orig_host_pci_domain=""$domain$"" OR src_pci_domain=""$domain$"" OR dest_pci_domain=""$domain$"" OR dvc_pci_domain=""$domain$"")",domain,"SA-IdentityManagement",global,system,
ES,"PROD-ES-1|search_head","iden_mktime","eval `iden_mktime_meval(startDate)`,`iden_mktime_meval(endDate)`",,"SA-IdentityManagement",global,system,
ES,"PROD-ES-1|search_head","iden_mktime(1)","eval `iden_mktime_meval($field$)`",field,"SA-IdentityManagement",global,system,
ES,"PROD-ES-1|search_head","iden_mktime_meval(1)","""$field$""=case(isnum('$field$'),'$field$',isnum(strptime('$field$',""%m/%d/%Y %H:%M"")),strptime('$field$',""%m/%d/%Y %H:%M""),isnum(strptime('$field$',""%m/%d/%y %H:%M"")),strptime('$field$',""%m/%d/%y %H:%M""),1=1,'$field$')",field,"SA-IdentityManagement",global,system,
ES,"PROD-ES-1|search_head",identities,"inputlookup append=T identity_lookup_expanded | rename _key as identity_id | table identity_id,`identity_fields`",,"SA-IdentityManagement",global,system,
ES,"PROD-ES-1|search_head","identities(1)","inputlookup append=T identity_lookup_expanded where $filters$ | rename _key as identity_id | table identity_id,`identity_fields`",filters,"SA-IdentityManagement",global,system,
ES,"PROD-ES-1|search_head","identity_categories","inputlookup append=T category_lookup WHERE category_source!=""asset"" | `lower(category)` | dedup category | sort + category | fields category",,"SA-IdentityManagement",global,system,
ES,"PROD-ES-1|search_head","identity_correlation_timeout",30,,"SA-IdentityManagement",global,system,
ES,"PROD-ES-1|search_head","identity_fields","bunit,category,email,endDate,first,identity,identity_tag,last,managedBy,nick,phone,prefix,priority,startDate,suffix,watchlist,work_city,work_country,work_lat,work_long",,"SA-IdentityManagement",global,system,
ES,"PROD-ES-1|search_head","identity_search(1)","`get_events4identity(identity, ""$val$"")` OR `get_events4identity(prefix, ""$val$"")` OR `get_events4identity(nick, ""$val$"")` OR `get_events4identity(first, ""$val$"")` OR `get_events4identity(last, ""$val$"")` OR `get_events4identity(suffix, ""$val$"")` OR `get_events4identity(email, ""$val$"")` OR `get_events4identity(phone, ""$val$"")` OR `get_events4identity(managedBy, ""$val$"")` OR `get_events4identity(priority, ""$val$"")` OR `get_events4identity(bunit, ""$val$"")` OR `get_events4identity(category, ""$val$"")` OR `get_events4identity(watchlist, ""$val$"")` OR `get_events4identity(startDate, ""$val$"")` OR `get_events4identity(endDate, ""$val$"")`",val,"SA-IdentityManagement",global,system,
ES,"PROD-ES-1|search_head","identity_search(2)","(`get_events4identity(first, ""$first$"")` `get_events4identity(last, ""$last$"")`) OR (`get_events4identity(last, ""$first$"")` `get_events4identity(first, ""$last$"")`)","first,last","SA-IdentityManagement",global,system,
ES,"PROD-ES-1|search_head","infer_logouts(1)","streamstats current=false global=false window=1 first(startTime) as endTime by $field$ | eval endTime=if(isnotnull(endTime),endTime-1,endTime) | fields _time,ip,mac,nt_host,dns,user,startTime,endTime",field,"SA-IdentityManagement",global,system,
ES,"PROD-ES-1|search_head","make_category(1)","eval `makemv_meval($category$)`,""$category$""=if('$category$'==""cardholder"" AND '$category$'!=""pci"",mvappend('$category$',""pci""),'$category$')",category,"SA-IdentityManagement",global,system,
ES,"PROD-ES-1|search_head","make_ip_cidr","eval tmp=trim(split(ip, ""|"")), ip=mvdedup(mvfilter(tmp!="""")) | fields - tmp | expandiprange ip allow_ipv6=true | eval ip=mvfilter(match(ip, `ipv4_cidr_regex`)) | where isnotnull(ip) | eval ip=mvjoin(ip, ""|"")",,"SA-IdentityManagement",global,system,
ES,"PROD-ES-1|search_head","make_ip_str","eval tmp=trim(split(ip, ""|"")), ip=mvdedup(mvfilter(tmp!="""")) | fields - tmp | expandiprange ip allow_ipv6=true | eval ip=mvfilter(!match(ip, `ipv4_cidr_regex`)), ip=mvjoin(ip, ""|"")",,"SA-IdentityManagement",global,system,
ES,"PROD-ES-1|search_head","pci_domains","inputlookup append=T pci_domains_lookup WHERE pci_domain_source=""static"" | `lower(pci_domain)` | dedup pci_domain | sort + pci_domain | fields pci_domain",,"SA-IdentityManagement",global,system,
ES,"PROD-ES-1|search_head","prepend_alias_assets(1)","_key as $subject$_asset_id,asset as $subject$_asset,asset_tag as $subject$_asset_tag,bunit as $subject$_bunit,category as $subject$_category,city as $subject$_city,country as $subject$_country,dns as $subject$_dns,ip as $subject$_ip,is_expected as $subject$_is_expected,lat as $subject$_lat,long as $subject$_long,mac as $subject$_mac,nt_host as $subject$_nt_host,owner as $subject$_owner,pci_domain as $subject$_pci_domain,priority as $subject$_priority,requires_av as $subject$_requires_av,should_timesync as $subject$_should_timesync,should_update as $subject$_should_update",subject,"SA-IdentityManagement",global,system,
ES,"PROD-ES-1|search_head","prepend_alias_identities(1)","_key as $subject$_identity_id,bunit as $subject$_bunit,category as $subject$_category,email as $subject$_email,endDate as $subject$_endDate,first as $subject$_first,identity as $subject$_identity,identity_tag as $subject$_identity_tag,last as $subject$_last,managedBy as $subject$_managedBy,nick as $subject$_nick,phone as $subject$_phone,prefix as $subject$_prefix,priority as $subject$_priority,startDate as $subject$_startDate,suffix as $subject$_suffix,watchlist as $subject$_watchlist,work_city as $subject$_work_city,work_country as $subject$_work_country,work_lat as $subject$_work_lat,work_long as $subject$_work_long",subject,"SA-IdentityManagement",global,system,
ES,"PROD-ES-1|search_head","prepend_assets(1)","rename `prepend_alias_assets($subject$)`",subject,"SA-IdentityManagement",global,system,
ES,"PROD-ES-1|search_head","prepend_identities(1)","rename `prepend_alias_identities($subject$)`",subject,"SA-IdentityManagement",global,system,
ES,"PROD-ES-1|search_head","reverse_asset_lookup(1)","makeresults | eval key=""$value$"" | lookup update=true asset_lookup_by_str asset as key OUTPUTNEW _key as asset_id,`asset_fields` | lookup update=true asset_lookup_by_cidr asset as key OUTPUTNEW _key as asset_id,`asset_fields` | eval ip=case(match(ip, ""^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$""),ip,match(key, ""^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$""),key,1=1,null()) | where isnotnull(asset_id)",value,"SA-IdentityManagement",global,system,
ES,"PROD-ES-1|search_head","reverse_identity_lookup(1)","makeresults | eval key=""$value$"" | lookup update=true identity_lookup_expanded identity as key OUTPUTNEW _key as identity_id,`identity_fields` | where isnotnull(identity_id)",value,"SA-IdentityManagement",global,system,
ES,"PROD-ES-1|search_head","session_search(1)","(All_Sessions.dest_ip=""$bestmatch$"" OR All_Sessions.dest_mac=""$bestmatch$"" OR All_Sessions.dest_nt_host=""$bestmatch$"" OR All_Sessions.dest_dns=""$bestmatch$"" OR All_Sessions.user=""$bestmatch$"")",bestmatch,"SA-IdentityManagement",global,system,
ES,"PROD-ES-1|search_head","session_start","tag=network tag=session tag=start | fillnull value=unknown dest_ip,dest_mac,dest_nt_host,dest_dns,user",,"SA-IdentityManagement",global,system,
ES,"PROD-ES-1|search_head",sessions,"tstats `summariesonly` count from datamodel=Network_Sessions.All_Sessions where nodename=All_Sessions.Session_Start by _time,All_Sessions.dest_ip,All_Sessions.dest_mac,All_Sessions.dest_nt_host,All_Sessions.dest_dns,All_Sessions.user span=1s | `drop_dm_object_name(""All_Sessions"")` | rename dest_ip as ip, dest_mac as mac, dest_nt_host as nt_host, dest_dns as dns | sort 0 - _time | eval startTime=_time | fields _time,ip,mac,nt_host,dns,user,startTime",,"SA-IdentityManagement",global,system,
ES,"PROD-ES-1|search_head","sessions(1)","tstats `summariesonly` count from datamodel=Network_Sessions.All_Sessions where nodename=All_Sessions.Session_Start `session_search(""$bestmatch$"")` by _time,All_Sessions.dest_ip,All_Sessions.dest_mac,All_Sessions.dest_nt_host,All_Sessions.dest_dns,All_Sessions.user span=1s | `drop_dm_object_name(""All_Sessions"")` | rename dest_ip as ip, dest_mac as mac, dest_nt_host as nt_host, dest_dns as dns | sort 0 - _time | eval startTime=_time | fields _time,ip,mac,nt_host,dns,user,startTime",bestmatch,"SA-IdentityManagement",global,system,
ES,"PROD-ES-1|search_head","unprepend_alias_assets(1)","$subject$_asset_id as asset_id,$subject$_asset as asset,$subject$_asset_tag as asset_tag,$subject$_bunit as bunit,$subject$_category as category,$subject$_city as city,$subject$_country as country,$subject$_dns as dns,$subject$_ip as ip,$subject$_is_expected as is_expected,$subject$_lat as lat,$subject$_long as long,$subject$_mac as mac,$subject$_nt_host as nt_host,$subject$_owner as owner,$subject$_pci_domain as pci_domain,$subject$_priority as priority,$subject$_requires_av as requires_av,$subject$_should_timesync as should_timesync,$subject$_should_update as should_update",subject,"SA-IdentityManagement",global,system,
ES,"PROD-ES-1|search_head","unprepend_assets(1)","rename `unprepend_alias_assets($subject$)`",subject,"SA-IdentityManagement",global,system,
ES,"PROD-ES-1|search_head","certificate_tracker","inputlookup append=T certificate_tracker",,"SA-NetworkProtection",global,system,
ES,"PROD-ES-1|search_head",communicate,"tag=network tag=communicate | tags outputfield=tag | fillnull value=unknown action,dvc,rule,transport,src,dest | `lower(transport)` | fillnull value=0 bytes_in,bytes_out,src_port,dest_port | eval bytes=if(isnull(bytes),bytes_in+bytes_out,bytes) | `get_vendor_product`",,"SA-NetworkProtection",global,system,
ES,"PROD-ES-1|search_head","communicate(1)","action=$action$ `communicate`",action,"SA-NetworkProtection",global,system,
ES,"PROD-ES-1|search_head","communication_rule_tracker","inputlookup append=T communication_rule_tracker | `get_asset(dvc)` | `get_identity4events(dvc_owner)`",,"SA-NetworkProtection",global,system,
ES,"PROD-ES-1|search_head","dest_tstats","`dest_tstats(""*"")`",,"SA-NetworkProtection",global,system,
ES,"PROD-ES-1|search_head","dest_tstats(1)","`tstats` count,values(sourcetype) from datamodel=Network_Traffic.All_Traffic where All_Traffic.action=$action$ by All_Traffic.dest | `drop_dm_object_name(""All_Traffic"")` | `tstats` append=true count,values(sourcetype) from datamodel=Intrusion_Detection.IDS_Attacks by IDS_Attacks.dest | `drop_dm_object_name(""IDS_Attacks"")` | `tstats` append=true count,values(sourcetype) from datamodel=Web.Web by Web.dest | `drop_dm_object_name(""Web"")` | stats count,values(sourcetype) as sourcetype by dest",action,"SA-NetworkProtection",global,system,
ES,"PROD-ES-1|search_head","get_application_protocol","lookup local=true application_protocol_lookup transport,dest_port OUTPUTNEW app | fillnull value=unknown app",,"SA-NetworkProtection",global,system,
ES,"PROD-ES-1|search_head","get_tld","extract tld_extract | rename tld as tld_candidate | lookup update=true cim_http_tld_lookup tld as tld_candidate OUTPUT tld",,"SA-NetworkProtection",global,system,
ES,"PROD-ES-1|search_head","get_tld(1)","rex field=$domain$ "".*\.(?<tld_candidate>.+)"" | lookup update=true cim_http_tld_lookup tld as tld_candidate OUTPUT tld",domain,"SA-NetworkProtection",global,system,
ES,"PROD-ES-1|search_head","get_vuln_signature_reference","lookup local=true vuln_signature_reference signature OUTPUTNEW cve,bugtraq,cert,msft,mskb,xref | `makemv(cve)` | `makemv(bugtraq)` | `makemv(cert)` | `makemv(msft)` | `makemv(mskb)` | `makemv(xref)` | fillnull value="""" cve,bugtraq,cert,msft,mskb,xref",,"SA-NetworkProtection",global,system,
ES,"PROD-ES-1|search_head","ids_attack","tag=ids tag=attack | tags outputfield=tag | fillnull value=unknown dvc,category,ids_type,severity,signature,src,dest,user | `lower(transport)` | fillnull value=0 src_port,dest_port | `get_vendor_product` | `remap_subjects`",,"SA-NetworkProtection",global,system,
ES,"PROD-ES-1|search_head","ids_attack_tracker","inputlookup append=T ids_attack_tracker",,"SA-NetworkProtection",global,system,
ES,"PROD-ES-1|search_head","ids_attack_tracker(1)","inputlookup append=T ids_attack_tracker where `tracker_trp($timefield$,$timefield$)`",timefield,"SA-NetworkProtection",global,system,
ES,"PROD-ES-1|search_head","ids_category_tracker","inputlookup append=T ids_category_tracker | dedup category | eval category_lower=lower(category) | sort + category",,"SA-NetworkProtection",global,system,
ES,"PROD-ES-1|search_head","is_traffic_prohibited(1)","`is_traffic_prohibited($field$, ""category"")` | rename ""$field$_is_prohibited"" as is_prohibited | rename ""$field$_is_secure"" as is_secure | fillnull value=""false"" is_prohibited | fillnull value=""unknown"" is_secure | `lower(is_prohibited)` | `lower(is_secure)`",field,"SA-NetworkProtection",global,system,
ES,"PROD-ES-1|search_head","is_traffic_prohibited(2)","eval ""tmp_src_$qual$""=if(isnull('src_$qual$'), ""unknown"", 'src_$qual$') | eval ""tmp_dest_$qual$""=if(isnull('dest_$qual$'), ""unknown"", 'dest_$qual$') | lookup local=true prohibited_traffic_lookup_by_$qual$ transport,""src_$qual$"" AS ""tmp_src_$qual$"",""dest_$qual$"" AS ""tmp_dest_$qual$"",dest_port AS ""$field$"" OUTPUTNEW is_prohibited as ""$field$_is_prohibited"", is_secure as ""$field$_is_secure"", note as ""$field$_note"" | fields - ""tmp_src_$qual$"" ""tmp_dest_$qual$""","field, qual","SA-NetworkProtection",global,system,
ES,"PROD-ES-1|search_head","network_change","tag=network tag=modify | eval command=if(sourcetype==""opsec_audit"",Operation."" "".ObjectName,command) | fillnull value=unknown dvc,action,user,command",,"SA-NetworkProtection",global,system,
ES,"PROD-ES-1|search_head","port_protocol_tracker","inputlookup append=T port_protocol_tracker | `get_application_protocol`",,"SA-NetworkProtection",global,system,
ES,"PROD-ES-1|search_head","prohibited_traffic","`prohibited_traffic(""category"")`",,"SA-NetworkProtection",global,system,
ES,"PROD-ES-1|search_head","prohibited_traffic(1)","`prohibited_traffic_by_$qual$`",qual,"SA-NetworkProtection",global,system,
ES,"PROD-ES-1|search_head","prohibited_traffic_by_category","inputlookup append=T prohibited_traffic_lookup_by_category | fields transport,src_category,dest_category,dest_port,is_prohibited,is_secure,note",,"SA-NetworkProtection",global,system,
ES,"PROD-ES-1|search_head","prohibited_traffic_by_pci_domain","inputlookup append=T prohibited_traffic_lookup_by_pci_domain | fields transport,src_pci_domain,dest_pci_domain,dest_port,is_prohibited,is_secure,note",,"SA-NetworkProtection",global,system,
ES,"PROD-ES-1|search_head",proxy,"tag=web tag=proxy | tags outputfield=tag | fillnull value="""" uri_scheme,dest,uri_path,uri_query | eval url=if(isnull(url),uri_scheme.""://"".dest.uri_path.uri_query,url) | eval url=trim(url,"" "") | eval url=if(url==""://"",""-"",url) | eval url_length=len(url) | fillnull value=""-"" action,category,status,src,http_content_type,http_method,http_referrer,http_user_agent,user | fillnull value=0 bytes_in,bytes_out | eval dest=if(dest=="""",""-"",dest)",,"SA-NetworkProtection",global,system,
ES,"PROD-ES-1|search_head","settags_network","tag LIKE ""%""",,"SA-NetworkProtection",global,system,
ES,"PROD-ES-1|search_head","src_dest_tstats","`src_dest_tstats(""*"")`",,"SA-NetworkProtection",global,system,
ES,"PROD-ES-1|search_head","src_dest_tstats(1)","`tstats` count,values(sourcetype) from datamodel=Network_Traffic.All_Traffic where All_Traffic.action=$action$ by All_Traffic.src,All_Traffic.dest  | `drop_dm_object_name(""All_Traffic"")` | `tstats` append=true count,values(sourcetype) from datamodel=Intrusion_Detection.IDS_Attacks by IDS_Attacks.src,IDS_Attacks.dest | `drop_dm_object_name(""IDS_Attacks"")` | `tstats` append=true count,values(sourcetype) from datamodel=Web.Web by Web.src,Web.dest | `drop_dm_object_name(""Web"")` | stats count,values(sourcetype) as sourcetype by src,dest",action,"SA-NetworkProtection",global,system,
ES,"PROD-ES-1|search_head","src_tstats","`src_tstats(""*"")`",,"SA-NetworkProtection",global,system,
ES,"PROD-ES-1|search_head","src_tstats(1)","`tstats` count,values(sourcetype) from datamodel=Network_Traffic.All_Traffic where All_Traffic.action=$action$ by All_Traffic.src | `drop_dm_object_name(""All_Traffic"")` | `tstats` append=true count,values(sourcetype) from datamodel=Intrusion_Detection.IDS_Attacks by IDS_Attacks.src | `drop_dm_object_name(""IDS_Attacks"")` | `tstats` append=true count,values(sourcetype) from datamodel=Web.Web by Web.src | `drop_dm_object_name(""Web"")` | stats count,values(sourcetype) as sourcetype by src",action,"SA-NetworkProtection",global,system,
ES,"PROD-ES-1|search_head","vuln_signature_reference","inputlookup append=T vuln_signature_reference",,"SA-NetworkProtection",global,system,
ES,"PROD-ES-1|search_head","vuln_signature_reference(1)","inputlookup append=T vuln_signature_reference where `tracker_trp($timefield$,$timefield$)`",timefield,"SA-NetworkProtection",global,system,
ES,"PROD-ES-1|search_head",vulnerability,"tag=vulnerability tag=report | tags outputfield=tag | fillnull value=unknown category,severity,signature,dest,os | fillnull value="""" cvss | `get_vendor_product`",,"SA-NetworkProtection",global,system,
ES,"PROD-ES-1|search_head",whois,"index=whois sourcetype=Whois:* | fillnull value=unknown created,domain,expires,nameservers,registrant,registrar,resolved_domain,retrieved,updated",,"SA-NetworkProtection",global,system,
ES,"PROD-ES-1|search_head","alexa_lookup","`alexa_lookup(src)` | `alexa_lookup(dest)`",,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","alexa_lookup(1)","lookup local=true alexa_lookup_by_str domain AS ""$infield$"" OUTPUTNEW rank AS ""$infield$_rank""",infield,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","asn_lookup","`asn_lookup(src)` | `asn_lookup(dest)`",,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","asn_lookup(1)","lookup local=true asn_lookup_by_str ip AS ""$infield$"" OUTPUTNEW description AS ""$infield$_asn"" | lookup local=true asn_lookup_by_cidr ip AS ""$infield$"" OUTPUTNEW description AS ""$infield$_asn""",infield,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","bogonlist_lookup","`bogonlist_lookup(src)` | `bogonlist_lookup(dest)`",,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","bogonlist_lookup(1)","lookup local=true bogonlist_lookup_by_cidr ip AS ""$infield$"" OUTPUTNEW is_bogon AS ""$infield$_is_bogon"",is_internal AS ""$infield$_is_internal""",infield,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","bogonlist_src_dest_subsearch(1)","[| inputlookup bogonlist_lookup_by_cidr where NOT is_internal=""true"" | eval ""$lineage$.src""=ip, ""$lineage$.dest""=ip | fields ""$lineage$.src"" ""$lineage$.dest"" | format """" """" ""OR"" """" ""OR"" """"]",lineage,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","dedup_rule_id","eval rule_id=event_id | dedup rule_id",,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","get_control(1)","control=""$value$""",value,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","get_correlations","lookup update=true correlationsearches_lookup _key as source OUTPUTNEW security_domain, severity, rule_name, description as savedsearch_description, rule_title, rule_description, drilldown_name, drilldown_search, drilldown_earliest_offset, drilldown_latest_offset, default_status, default_owner, next_steps, investigation_profiles, extract_artifacts, recommended_actions | eval `get_rule_title_meval`,drilldown_earliest=case(isint(drilldown_earliest_offset),_time-drilldown_earliest_offset,drilldown_earliest_offset=""$info_min_time$"",'info_min_time',1=1,null()),drilldown_latest=case(isint(drilldown_latest_offset),_time+drilldown_latest_offset,drilldown_latest_offset=""$info_max_time$"",'info_max_time',1=1,null()),security_domain=if(isnull(security_domain),""threat"",lower(security_domain)),`get_rule_description_meval`,governance_lookup_type=""default"" | lookup update=true governance_lookup savedsearch as source, lookup_type as governance_lookup_type OUTPUT governance, control | eval governance_lookup_type=""tag"" | lookup update=true governance_lookup savedsearch as source, tag, lookup_type as governance_lookup_type OUTPUT governance as governance_tag, control as control_tag | eval ""governance""=mvappend('governance',NULL,'governance_tag'),""control""=mvappend('control',NULL,'control_tag') | fields - governance_lookup_type,governance_tag,control_tag",,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","get_current_status","eval temp_time=time()+86400 | lookup update=true event_time_field=temp_time incident_review_lookup rule_id OUTPUT owner as new_owner, urgency as new_urgency, status as new_status | lookup update=true event_time_field=temp_time incident_review_comment_lookup rule_id OUTPUT time as review_time,user as reviewer,comment | eval owner=if(isnotnull(new_owner),new_owner,owner),status=case(isnotnull(new_status),new_status,isnotnull(status),status,1==1,default_status),urgency=if(isnotnull(new_urgency),new_urgency,urgency) | fields - temp_time,new_owner,new_status,new_urgency | `get_reviewstatuses`",,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","get_governance(1)","(tag=""$value$"" OR governance=""$value$"")",value,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","get_governance(2)","`get_governance($governance$)` `get_control($control$)`","governance, control","SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","get_notable_index","index=notable",,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","get_owner","eval owner=case(isnotnull(owner),owner,isnotnull(default_owner),default_owner,1=1,""unassigned"") | `get_realname(owner)` | `get_realname(creator)`",,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","get_priority","eval `get_priority_meval` | fields - priorities",,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","get_priority_meval","priorities=lower(mvappend(priority, host_priority, orig_host_priority, src_priority, dest_priority, dvc_priority, src_user_priority, user_priority, host_owner_priority, orig_host_owner_priority, src_owner_priority, dest_owner_priority, dvc_owner_priority)),priority=case(priorities=""critical"", ""critical"", priorities=""high"", ""high"", priorities=""medium"", ""medium"", priorities=""low"", ""low"", priorities=""informational"", ""informational"", 1==1, ""unknown"")",,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","get_reviewstatuses","eval temp_status=if(isnull(status),-1,status) | lookup update=true reviewstatuses_lookup _key as temp_status OUTPUT status,label as status_label,description as status_description,default as status_default,end as status_end | eval status=if(isnull(status_label),0,status),status_label=if(isnull(status_label),""Unassigned"",status_label),status_description=if(isnull(status_description),""unknown"",status_description),`str_to_bool_meval(status_default)`,`str_to_bool_meval(status_end)`,status_group=case(status_default==""true"",""New"",status_end==""true"",""Closed"",status=0,""New"",1=1,""Open"") | fields - temp_status",,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","get_risk_index","index=risk",,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","get_rule_description","eval `get_rule_description_meval`",,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","get_rule_description_meval","rule_description=case(isnotnull(rule_description),rule_description,isnotnull(savedsearch_description),savedsearch_description,1=1,""unknown"")",,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","get_rule_id(1)","eval rule_id='$fields$'",fields,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","get_rule_title","eval `get_rule_title_meval`",,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","get_rule_title_meval","rule_name=if(isnull(rule_name),source,rule_name),rule_title=if(isnull(rule_title),rule_name,rule_title)",,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","get_suppression_end_time","rex field=search ""_time<=?(?<end_time>\d+)""",,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","get_suppression_start_time","rex field=search ""_time>=?(?<start_time>\d+)""",,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","get_urgency","eval severity=if(isnotnull(severity),lower(severity),""unknown""),`get_priority_meval` | lookup local=true urgency_lookup priority,severity OUTPUTNEW urgency | eval urgency=if(in(urgency, ""critical"", ""high"", ""medium"", ""low"", ""informational""), urgency, ""unknown"")",,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head",governance,"inputlookup append=T governance_lookup | stats count by governance | fields - count",,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","incident_review","inputlookup append=T incident_review_lookup | rename user as reviewer | `get_realname(owner)` | `get_realname(reviewer)` | eval nullstatus=if(isnull(status),""true"",""false"") | `get_reviewstatuses` | eval status=if((isnull(status) OR isnull(status_label)) AND nullstatus==""false"",0,status) | eval status_label=if(isnull(status_label) AND nullstatus==""false"",""Unassigned"",status_label) | eval status_description=if(isnull(status_description) AND nullstatus==""false"",""unknown"",status_description) | eval _time=time | `uitime(time)` | fields - nullstatus",,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","incident_review_analyst_capacity",12,,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","incident_review_capacity","`notable_owners` | search owner!=""unassigned"" | stats count as analyst_count | eval incident_review_capacity=analyst_count*`incident_review_analyst_capacity`",,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head",investigationstatuses,"inputlookup append=T investigationstatuses_lookup | rename label as status_label,description as status_description | `investigationstatuses_exclusions`",,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","investigationstatuses_exclusions","search _key!=-2 NOT ((disabled=1 OR disabled=t OR disabled=true) AND (hidden=1 OR hidden=t OR hidden=true))",,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","map_notable_fields",noop,,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head",notable,"`notable_by_id(""*"")`",,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","notable(1)","source=""$search_name$"" `notable_by_id(""*"")`","search_name","SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","notable_adhoc_invocation(3)","_time=""$time$"" source=""$search_name$"" `notable_by_id($event_id$)` | fields - _raw,*risk_score,*risk_object,*risk_object_type","time, search_name, event_id","SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","notable_by_id(1)","`get_notable_index` | eval `get_event_id_meval`,rule_id=event_id | search event_id=""$event_id$"" | fields - host_* | tags outputfield=tag | `mvappend_field(tag,orig_tag)` | dedup rule_id | `notable_xref_lookup` | `get_correlations` | `get_current_status` | `get_owner` | `get_urgency` | typer | tags outputfield=tag | `mvappend_field(tag,orig_tag)` | `suppression_extract` | `risk_correlation`","event_id","SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","notable_owners","inputlookup append=T notable_owners_lookup | join type=outer owner [| rest splunk_server=local count=0 /services/authentication/current-context | eval owner=username,current=username | fields owner,current] | eval owner_realname=if(isnull(realname),owner,realname),sort_name=if(isnotnull(current),""_"",lower(owner_realname)) | sort 0 +sort_name | fields owner,owner_realname",,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","notable_xref_lookup","lookup update=true notable_xref_lookup event_id OUTPUTNEW xref_name as notable_xref_name,xref_id as notable_xref_id | eval notable_xref=mvzip(notable_xref_name,notable_xref_id,"":"")",,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","notable_xref_subsearch(3)","inputlookup append=T notable_xref_lookup where xref_name=""$xref_name$"" xref_id=""$xref_id$"" | eval _time=notable_time | return 100 $output_fields$","xref_name,xref_id,output_fields","SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","notable_xrefs","from inputlookup:notable_xref_lookup","","SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","notable_xrefs(2)","inputlookup append=T notable_xref_lookup where xref_name=""$xref_name$"" xref_id=""$xref_id$""","xref_name,xref_id","SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","notable_xrefs_by_event_id(1)","inputlookup append=T notable_xref_lookup where event_id=""$event_id$""","event_id","SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","reviewstatus_exclusions","search _key!=-1 NOT ((disabled=1 OR disabled=t OR disabled=true) AND (hidden=1 OR hidden=t OR hidden=true))",,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","reviewstatus_groups","inputlookup append=T expected_status_group_lookup",,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head",reviewstatuses,"inputlookup append=T reviewstatuses_lookup | rename label as status_label,description as status_description | `reviewstatus_exclusions`",,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","risk_correlation","`risk_correlation_assets(""host"")` | `risk_correlation_assets(""orig_host"")` | `risk_correlation_assets(""dvc"")` | `risk_correlation_assets(""src"")` | `risk_correlation_assets(""dest"")` | `risk_correlation_identities(""src_user"")` | `risk_correlation_identities(""user"")` | eval `risk_correlation_object_types_meval`,`risk_correlation_score_meval`",,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","risk_correlation_assets(1)","lookup update=true risk_correlation_by_system_lookup risk_object as ""$subject$"" OUTPUT risk_score as ""_$subject$_risk_score"" | eval ""$subject$_risk_score""=if(isnotnull($subject$_risk_score),$subject$_risk_score,_$subject$_risk_score) | fields - _$subject$_risk_score",subject,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","risk_correlation_identities(1)","lookup update=true risk_correlation_by_user_lookup risk_object as ""$user$"" OUTPUT risk_score as ""_$user$_risk_score"" | eval ""$user$_risk_score""=if(isnotnull($user$_risk_score),$user$_risk_score,_$user$_risk_score) | fields - _$user$_risk_score",user,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","risk_correlation_object_type_meval(2)","""$field$_risk_object_type""=if(isnotnull('$field$_risk_score'),""$value$"",null())","field, value","SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","risk_correlation_object_types_meval","`risk_correlation_object_type_meval(host,""system"")`,`risk_correlation_object_type_meval(orig_host,""system"")`,`risk_correlation_object_type_meval(dvc,""system"")`,`risk_correlation_object_type_meval(src,""system"")`,`risk_correlation_object_type_meval(dest,""system"")`,`risk_correlation_object_type_meval(src_user,""user"")`,`risk_correlation_object_type_meval(user,""user"")`",,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","risk_correlation_others(2)","lookup update=true risk_correlation_by_other_lookup risk_object as ""$other$"", risk_object_type as ""$risk_object_type$"" OUTPUT risk_score as ""_$other$_risk_score"" | eval ""$other$_risk_score""=if(isnotnull($other$_risk_score),$other$_risk_score,_$other$_risk_score) | fields - _$other$_risk_score","other,risk_object_type","SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","risk_correlation_score","eval `risk_correlation_score_meval`",,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","risk_correlation_score_meval","risk_score=max(host_risk_score,orig_host_risk_score,dvc_risk_score,src_risk_score,dest_risk_score,src_user_risk_score,user_risk_score)",,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","risk_object_types","inputlookup risk_object_types_lookup",,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","security_domains","inputlookup append=T security_domain_lookup | fillnull value=true is_expected | rename label as security_domain_label",,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","sort_reviewstatus_groups","eval sortorder=case(status_group==""New"",1,status_group==""Open"",2,status_group==""Closed"",3) | sort sortorder | fields - sortorder",,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","suppressed_notables","`suppressed_notables(""*"")`",,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","suppressed_notables(1)","`notable($search_name$)` | search `suppression`","search_name","SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head",suppression,"(eventtype=notable_suppression-* OR suppression=*)",,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","suppression_audit","eventtype=suppression_audit | fillnull value=unknown suppression, action, status, signature, user",,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","suppression_audit-expired","eventtype=suppression_audit-expired | fillnull value=unknown signature,suppression",,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","suppression_eventtypes","rest splunk_server=local count=0 /services/saved/eventtypes | search title=notable_suppression* | rename title as eventtype | `suppression_extract` | `get_suppression_start_time` | `get_suppression_end_time`",,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","suppression_extract","rex field=eventtype ""notable_suppression-(?<suppression>.+)""",,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","top_1m_sites","cisco_top_one_million_sites",,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","truncate_domain(1)","`truncate_domain($source$, $source$)`",source,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","truncate_domain(2)","eval SEGMENTS=split(ltrim('$source$', "".""), ""."") | eval SEG1=mvindex(SEGMENTS, -1) | eval SEG2 = mvjoin(mvindex(SEGMENTS, -2, -1), ""."") | eval SEG3 = mvjoin(mvindex(SEGMENTS, -3, -1), ""."") | eval SEG4 = mvjoin(mvindex(SEGMENTS, -4, -1), ""."") | lookup update=true mozilla_public_suffix_lookup domain AS SEG1 OUTPUTNEW length AS SEG1_LENGTH | lookup update=true mozilla_public_suffix_lookup domain AS SEG2 OUTPUTNEW length AS SEG2_LENGTH | lookup update=true mozilla_public_suffix_lookup domain AS SEG3 OUTPUTNEW length AS SEG3_LENGTH | lookup update=true mozilla_public_suffix_lookup domain AS SEG4 OUTPUTNEW length AS SEG4_LENGTH | lookup update=true cim_http_tld_lookup tld AS SEG1 OUTPUT tld AS TLD | eval TGT_LENGTH = coalesce(SEG4_LENGTH,SEG3_LENGTH,SEG2_LENGTH,SEG1_LENGTH, if(cidrmatch(""0.0.0.0/0"", '$source$'), if(`truncate_domain_allows_ips`==0, 4, 0), if(isnull(TLD), 2, 0))) | eval SRC_LENGTH=mvcount(SEGMENTS) | eval ""$target$""=if(TGT_LENGTH==0, null, if(SRC_LENGTH>=TGT_LENGTH, mvjoin(mvindex(SEGMENTS, -TGT_LENGTH, -1), "".""), null)) | fields - TLD SEG1 SEG2 SEG3 SEG4 SEG1_LENGTH SEG2_LENGTH SEG3_LENGTH SEG4_LENGTH TGT_LENGTH SRC_LENGTH SEGMENTS","source,target","SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","truncate_domain_allows_ips",1,,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","truncate_domain_dedup(1)","`truncate_domain_dedup($source$, $source$)`",source,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","truncate_domain_dedup(2)","`truncate_domain($source$, $target$_domain)` | eval ""$target$_domain""=if(""$target$_domain""=""$source$"" OR '$target$_domain'='$source$', null(), '$target$_domain')","source,target","SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head",urgency,"inputlookup append=T urgency_lookup",,"SA-ThreatIntelligence",global,system,
ES,"PROD-ES-1|search_head","allow_old_summaries_bool",true,,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head",autopause,120,,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","bytes2gbytes(1)","`bytes2gbytes($field$,$field$)`",field,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","bytes2gbytes(2)","eval ""$outField$""='$inField$'/1073741824","inField,outField","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","bytes2kbytes(1)","`bytes2kbytes($field$,$field$)`",field,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","bytes2kbytes(2)","eval ""$outField$""='$inField$'/1024","inField,outField","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","bytes2mbytes(1)","`bytes2mbytes($field$,$field$)`",field,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","bytes2mbytes(2)","eval ""$outField$""='$inField$'/1048576","inField,outField","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","content_length_appendcol","appendcols [| rest splunk_server=local count=0 /services/configs/conf-server/httpServer | table max_content_length] | filldown max_content_length | fillnull value=""2147483648"" max_content_length",,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","convert_ksi_nonnumeric(4)","eval ""$outfield$""=if(""$convert$""==""true"" and !isnum('$infield$'), ""$value$"", '$infield$')","infield,outfield,convert,value","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","ctime(1)","`ctime($field$,""%m/%d/%Y %H:%M:%S"")`",field,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","ctime(2)","convert timeformat=""$format$"" ctime($field$)","field,format","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","ctime(3)","`ctime($inField$,""$format$"")` as $outField$","inField,outField,format","SA-Utils",global,system,
ES,"PROD-ES-1|search_head",dayDiff,"`dayDiff(_time)`",,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","dayDiff(1)","eval dayDiff=((time()-'$field$')/86400)",field,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","daysago(1)","`daysago($num$,""<"")`",num,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","daysago(2)","`dayDiff` | search dayDiff$comparator$$num$","num, comparator","SA-Utils",global,system,
ES,"PROD-ES-1|search_head",filter,"NOT tag=filtered",,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","filtertags(1)","`filtertags(""$domain$"",""tag"")`",domain,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","filtertags(2)","eval ""$outField$""=mvfilter(`settags_$domain$` OR `settags_governance`)","domain,outField","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","get_date(1)","eval date='$field$' | `ctime(date,""%m-%d-%Y"")`",field,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","get_delta","`get_delta(current_count,historical_count)`","","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","get_delta(2)","eval ""$field1$""=if(isnum('$field1$'),'$field1$',0) | eval ""$field2$""=if(isnum('$field2$'),'$field2$',0) | eval delta='$field1$'-'$field2$'","field1,field2","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","get_event_hash","eval `get_event_hash_meval`",,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","get_event_hash_meval","event_hash=`hash_alg`(_time._raw)",,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","get_event_id","eval `get_event_id_meval`",,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","get_event_id_meval","`get_indexer_guid_meval`,`get_event_hash_meval`,event_id=indexer_guid.""@@"".index.""@@"".event_hash",,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","get_findbest_qualitative","inputlookup append=T qualitative_thresholds_lookup | sort - threshold | eval n=1 | streamstats sum(n) as rank | eval threshold=if(rank==1 and threshold<1,1.0,threshold),threshold_id=""findbest_th="".threshold | sort threshold | eval subcase=""'"".threshold_id.""'=\""1.0\"",\"""".qualitative_label.""\"""" | stats values(subcase) as search | eval search=""current_count_qual=case("".mvjoin(search, "","")."",1=1,\""unknown\"")""",,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","get_findbest_thresholds","inputlookup append=T qualitative_thresholds_lookup | sort - threshold | eval n=1 | streamstats sum(n) as rank | eval threshold=if(rank==1 and threshold<1,1.0,threshold) | stats values(threshold) as search | eval search=""threshold=\"""".mvjoin(mvsort(search), "","").""\""""",,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","get_indexer_guid","rex field=_bkt "".*~(?<indexer_guid>.+)""",,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","get_indexer_guid_meval","indexer_guid=replace(_bkt,"".*~(.+)"",""\1"")",,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","get_integer_seq","eval sub_raw=substr(_raw,11) | rex field=sub_raw max_match=10 ""(?<integer_seq>(?:\d+[\s]*){14,}|(?:\d+[-]*){14,})""",,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","get_ksi_direction(3)","eval ""$outfield$""=if(!(isnum('$curr$') and isnum('$prev$')), ""undefined"", if('$curr$' > '$prev$', ""increasing"", if('$curr$' < '$prev$', ""decreasing"", ""unchanged"")))","curr,prev,outfield","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","get_ksi_fields(2)","`get_ksi_fields($curr$,$prev$,""true"",0)`","curr,prev","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","get_ksi_fields(4)","`convert_ksi_nonnumeric($curr$,$curr$,""$convert$"",$convert_to$)` | `convert_ksi_nonnumeric($prev$,$prev$,""$convert$"",$convert_to$)` | `get_ksi_direction($curr$,$prev$,""direction"")` | `get_ksi_percent_change($curr$,$prev$,""delta"")`","curr,prev,convert,convert_to","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","get_ksi_percent_change(3)","`get_ksi_percent_change($curr$,$prev$,$outfield$,""true"")`","curr,prev,outfield","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","get_ksi_percent_change(4)","eval ""$outfield$""=case((isnull('$curr$') or isnull('$prev$')) and convert!=""true"", ""undefined"", '$curr$'=='$prev$', 0, isnum('$curr$') and '$curr$'!=0 and ('$prev$'==0 or !isnum('$prev$')), '$curr$'/abs('$curr$') * 100.00, isnum('$prev$') and '$prev$'!=0 and ('$curr$'==0 or !isnum('$curr$')), (0-'$prev$')/abs('$prev$') * 100, isnum('$curr$') and isnum('$prev$') and '$prev$'!=0 and '$curr$'!=0, ('$curr$'-'$prev$')/'$prev$' * 100.0, 1==1, 0) | eval ""$outfield$""=if(isnum('$outfield$'),round('$outfield$', 2), '$outfield$')","curr,prev,outfield,convert","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","get_namespace","lookup local=true sourcetype2namespace sourcetype OUTPUT namespace",,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","get_percentage_qualitative(2)","eval ""$output$""=case(!isnum('$input$'),""unknown"",abs('$input$')>=90,""extremely"",abs('$input$')>=75,""greatly"",abs('$input$')>=50,""moderately"",abs('$input$')>=25,""slightly"",1=1,""minimally"")","input,output","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","get_qualitative_lower_threshold(1)","inputlookup append=T qualitative_thresholds_lookup where qualitative_id=""$qualitative_id$"" | rename threshold as lower_threshold | return lower_threshold | eval search=replace(search,""\"""","""")","qualitative_id","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","get_qualitative_threshold(1)","inputlookup append=T qualitative_thresholds_lookup where qualitative_id=""$qualitative_id$"" | return threshold | eval search=replace(search,""\"""","""")","qualitative_id","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","get_qualitative_upper_threshold(1)","inputlookup append=T qualitative_thresholds_lookup where qualitative_id=""$qualitative_id$"" | rename threshold as upper_threshold | return upper_threshold | eval search=replace(search,""\"""","""")","qualitative_id","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","get_realname(1)","lookup update=true user_realnames_lookup user as ""$user$"" OUTPUTNEW realname as ""$user$_realname"" | eval ""$user$_realname""=if(isnull('$user$_realname'),'$user$','$user$_realname')",user,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","get_stdev_index(1)","eval Z=(('$intField$'-'mean_$intField$')/stdev)",intField,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","get_summary(2)","index=""$index$"" search_name=""$search_name$"" `filter` | `makemv(orig_tag)` | `mvappend_field(tag,orig_tag)`","index,search_name","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","get_transport_dest_port","fillnull value=unknown transport | fillnull value=0 dest_port | eval transport_dest_port=transport.""/"".dest_port","","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","globedistance(5)","`globedistance(""distance"",$lat1$,$long1$,$lat2$,$long2$,$units$,2)`","lat1,long1,lat2,long2,units","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","globedistance(7)","eval lat1_r='$lat1$'*pi()/180 | eval lat2_r='$lat2$'*pi()/180 | eval delta=('$long2$'-'$long1$')*pi()/180 | eval R=if('$units$'=""m"",3959, 6372.8) | eval ""$outfield$""=R*acos(sin(lat1_r)*sin(lat2_r) + cos(lat1_r) * cos(lat2_r) * cos(delta)) | eval ""$outfield$""=round('$outfield$', $precision$) | fields - lat1_r,lat2_r,long1_r,long2_r,R,delta","outfield,lat1,long1,lat2,long2,units,precision","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","hash_alg",md5,,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","host_equal_local","rest splunk_server=local count=0 /services/server/info | table serverName | rename serverName as host",,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head",hourDiff,"`hourDiff(_time)`",,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","hourDiff(1)","eval hourDiff=((time()-'$field$')/3600)",field,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","hoursago(1)","`hoursago($num$,""<"")`",num,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","hoursago(2)","`hourDiff` | search hourDiff$comparator$$num$","num, comparator","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","ipv4_cidr_regex","""^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}/(\d|[12]\d|3[012])$""",,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","lookup_tables_with_size","rest splunk_server=local count=0 /services/data/transforms/lookups | join type=inner title [| rest splunk_server=local count=0 /services/data/transforms/managed_lookups | rex field=endpoint "".*\/(?<title>.+)"" | table title,size]",,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","lower(1)","eval ""$field1$""=lower('$field1$')",field1,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","make_previous_time_range(2)","makeresults | `make_ts_value($earliest$,earliest)` | `make_ts_value($latest$,latest)` | eval time_span_diff=latest-earliest,latest=if(round(earliest)<0,0,round(earliest)),earliest=if(round(earliest-time_span_diff)<0,0,round(earliest-time_span_diff)),search=""earliest="".earliest."" latest="".latest | table search","earliest, latest","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","make_ts_field(2)","eval ""$fieldOut$""=case(match('$fieldIn$', ""^\d""), tostring('$fieldIn$'),  match('$fieldIn$', ""^([@\+-]){1}""), relative_time(time(), '$fieldIn$'),  true(), time())","fieldIn, fieldOut","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","make_ts_value(2)","eval ""$fieldOut$""=case(match(""$value$"", ""^\d""), tostring(""$value$""),  match(""$value$"", ""^([@\+-]){1}""), relative_time(time(), ""$value$""),  true(), time())","value, fieldOut","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","makemv(1)","`makemv($field$,""|"")`",field,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","makemv(2)","eval ""$field$""=split('$field$',""$sep$"")","field, sep","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","makemv_meval(1)","`makemv_meval($field$,""|"")`",field,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","makemv_meval(2)","""$field$""=split('$field$',""$sep$"")","field, sep","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","makesv(1)","`makesv($field$,""|"")`",field,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","makesv(2)","eval ""$field$""=mvjoin('$field$',""$sep$"")","field, sep","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","memtable_bytes_appendcol","appendcols [| rest splunk_server=local count=0 /services/configs/conf-limits/lookup | table max_memtable_bytes] | filldown max_memtable_bytes | fillnull value=""10000000"" max_memtable_bytes",,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","mktime(1)","`mktime($field$,""%m/%d/%Y %H:%M:%S"")`",field,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","mktime(2)","convert timeformat=""$format$"" mktime($field$)","field,format","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","mktime(3)","`mktime($inField$,""$format$"")` as $outField$","inField,outField,format","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","mltk_apply(3)","apply $model$ [| `get_qualitative_threshold($qualitative_id$)`] | search ""IsOutlier($field$)""=1","model,qualitative_id,field","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","mltk_apply_lower(3)","apply $model$ [| `get_qualitative_lower_threshold($qualitative_id$)`] | search ""IsOutlier($field$)""=1","model,qualitative_id,field","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","mltk_apply_upper(3)","apply $model$ [| `get_qualitative_upper_threshold($qualitative_id$)`] | search ""IsOutlier($field$)""=1","model,qualitative_id,field","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","mltk_findbest(1)","apply $model$ as findbest [| `get_findbest_thresholds`] | eval [| `get_findbest_qualitative`] | fields - BoundaryRanges,findbest*",model,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","mvappend_bool(3)","eval ""$field$""=if(match('$bool$', ""1|[Tt]|[Tt][Rr][Uu][Ee]""),mvdedup(mvappend('$field$',""$value$"",NULL)),'$field$')","field, value, bool","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","mvappend_bool_meval(3)","""$field$""=if('$bool$'==""true"",mvdedup(mvappend('$field$',""$value$"",NULL)),'$field$')","field, value, bool","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","mvappend_field(2)","eval ""$field1$""=mvdedup(mvappend('$field1$',NULL,'$field2$'))","field1, field2","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","mvappend_field_meval(2)","""$field1$""=mvdedup(mvappend('$field1$',NULL,'$field2$'))","field1, field2","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","mvappend_is(2)","`mvappend_bool($field$,$value$,""is_$value$"")`","field, value","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","mvappend_is_meval(2)","`mvappend_bool_meval($field$,$value$,""is_$value$"")`","field, value","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","mvappend_requires(2)","`mvappend_bool($field$,requires_$value$,""requires_$value$"")`","field, value","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","mvappend_requires_meval(2)","`mvappend_bool_meval($field$,requires_$value$,""requires_$value$"")`","field, value","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","mvappend_should(2)","`mvappend_bool($field$,should_$value$,""should_$value$"")`","field, value","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","mvappend_should_meval(2)","`mvappend_bool_meval($field$,should_$value$,""should_$value$"")`","field, value","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","mvappend_value(2)","eval ""$field$""=mvdedup(mvappend('$field$',""$value$"",NULL))","field, value","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","mvdedup(1)","`mvdedup($input$,$input$)`",input,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","mvdedup(2)","eval ""$output$""=mvdedup('$input$')","input, output","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","mvfilter_field(2)","eval `mvfilter_field_meval($field$,$filter_field$)`","field, filter_field","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","mvfilter_field_meval(2)","""$field$""=if(mvcount('$filter_field$')=1 AND mvcount('$field$')>1 AND '$field$'='$filter_field$',split(ltrim(replace(""|"".mvjoin('$field$',""|""),""\|"".'$filter_field$',""""),""|""), ""|""),'$field$')","field, filter_field","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","mvfilter_value(2)","eval ""$field$""=if(mvcount('$field$')>1 AND '$field$'=""$value$"", mvfilter('$field$'!=""$value$""), '$field$')","field, value","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","mvtruncate(1)","`mvtruncate($input$,$input$,10)`",input,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","mvtruncate(3)","eval ""$output$""=if(mvcount('$input$')>$count$,mvappend(mvindex('$input$',0,$count$-1),NULL,""...truncated...""),'$input$')","input, output, count","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","parse_event_id(1)","rex field=""$event_id$"" ""(?<orig_indexer_guid>.*?)\@\@(?<orig_index>.*?)\@\@(?<orig_event_hash>.*)""","event_id","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","per_panel_filter(2)","`per_panel_filter(""$lookup$"",""$inputFields$"",time())`","lookup,inputFields","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","per_panel_filter(3)","`per_panel_filter_lookup(""$lookup$"",""$inputFields$"",$compareTime$)` | search NOT ppf_filter=whitelist | fields - ppf_lookup_type,ppf_st,ppf_et,temp_time | eval ppf_cell=if(isnull(ppf_filter),mvappend("""", $inputFields$),mvappend(ppf_filter,$inputFields$))","lookup,inputFields,compareTime","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","per_panel_filter_lookup(3)","eval temp_time=time(),ppf_lookup_type=""blacklist"" | lookup update=true event_time_field=temp_time $lookup$ $inputFields$,filter as ppf_lookup_type OUTPUT start_time as ppf_st,end_time as ppf_et,filter as ppf_filter | eval ppf_filter=if(ppf_filter=""blacklist"" AND ppf_st<$compareTime$ AND (ppf_et>$compareTime$ OR isnull(ppf_et)),ppf_filter,null()) | fields - ppf_st,ppf_et | eval ppf_lookup_type=""whitelist"" | lookup update=true event_time_field=temp_time $lookup$ $inputFields$,filter as ppf_lookup_type OUTPUTNEW start_time as ppf_st,end_time as ppf_et,filter as ppf_filter | eval ppf_filter=if(ppf_filter=""blacklist"" OR (ppf_filter=""whitelist"" AND ppf_st<$compareTime$ AND (ppf_et>$compareTime$ OR isnull(ppf_et))),ppf_filter,null())","lookup,inputFields,compareTime","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","ppf_subsearch(3)","inputlookup append=t $lookup$ | table $inputFields$ | dedup $inputFields$ | `per_panel_filter_lookup(""$lookup$"",""$inputFields$"",$compareTime$)` | search ppf_filter=whitelist | table $inputFields$ | format | table search","lookup,inputFields,compareTime","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","ppf_subsearch_dm(4)","inputlookup append=t $lookup$ | table $inputFields$ | dedup $inputFields$ | `per_panel_filter_lookup(""$lookup$"",""$inputFields$"",$compareTime$)` | search ppf_filter=whitelist | table $inputFields$ | rename * as $object$.* | format | table search","lookup,inputFields,compareTime,object","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","ppf_updates","eventtype=ppf_updates | fillnull value=unknown filter | fillnull value=edit action",,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","rest_handler_transactions","index=_internal sourcetype=*:rest_handler (Entering OR ""completed successfully"") | `get_namespace` | rex field=sourcetype ""(?<handler>\w+):rest_handler"" | rex ""ACTION_(?<action>\w+)"" | transaction handler,action startswith=Entering endswith=""completed successfully"" maxspan=30s maxpause=30s maxevents=2",,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","round(1)","`round(""$field$"",2)`",field,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","round(2)","`round(""$field$"",""$field$"",$precision$)`","field,precision","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","round(3)","eval ""$outField$""=round('$inField$',$precision$)","inField,outField,precision","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","script_error_msg_ignore","(match(script, ""(streamfwd|splunk-(wmi\.path|MonitorNoHandle\.exe|winevtlog\.exe|netmon\.exe|perfmon\.exe|regmon\.exe|winprintmon\.exe|admon\.exe|powershell\.exe))"") AND exit_status=1) OR (script LIKE ""%instrumentation.py"" AND exit_status=114)",,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","set_time","`set_time(""-0s"")`",,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","set_time(1)","eval _time=relative_time(time(),""$qual$"")",qual,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","settags(1)","eval tag=mvfilter(`settags_$domain$` OR `settags_governance`) | rename tag as orig_tag",domain,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","settags_governance","(tag LIKE ""%"")",,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","shc_mode_appendcol","appendcols [| rest splunk_server=local count=0 /services/shcluster/config/config | rename mode as shc_mode | table shc_mode] | filldown shc_mode | fillnull value=""disabled"" shc_mode",,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","shc_replication_change(1)","[| `host_equal_local`] index=_internal source=*conf.log (data.process=""pullFrom"" OR data.process=""acceptPush"") data.asset_uri{}=""$config$"" data.status=""applied""",config,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","sistats_max_rename(2)","eval ""psrsvd_ct_$output$""=if(isnull('psrsvd_ct_$output$'),'psrsvd_ct_$input$','psrsvd_ct_$output$') | eval ""psrsvd_nc_$output$""=if(isnull('psrsvd_nc_$output$'),'psrsvd_nc_$input$','psrsvd_nc_$output$') | eval ""psrsvd_nx_$output$""=if(isnull('psrsvd_nx_$output$'),'psrsvd_nx_$input$','psrsvd_nx_$output$') | eval ""psrsvd_sx_$output$""=if(isnull('psrsvd_sx_$output$'),'psrsvd_sx_$input$','psrsvd_sx_$output$') | eval ""psrsvd_vt_$output$""=if(isnull('psrsvd_vt_$output$'),'psrsvd_vt_$input$','psrsvd_vt_$output$')","input, output","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","sistats_min_rename(2)","eval ""psrsvd_ct_$output$""=if(isnull('psrsvd_ct_$output$'),'psrsvd_ct_$input$','psrsvd_ct_$output$') | eval ""psrsvd_nc_$output$""=if(isnull('psrsvd_nc_$output$'),'psrsvd_nc_$input$','psrsvd_nc_$output$') | eval ""psrsvd_nn_$output$""=if(isnull('psrsvd_nn_$output$'),'psrsvd_nn_$input$','psrsvd_nn_$output$') | eval ""psrsvd_sn_$output$""=if(isnull('psrsvd_sn_$output$'),'psrsvd_sn_$input$','psrsvd_sn_$output$') | eval ""psrsvd_vt_$output$""=if(isnull('psrsvd_vt_$output$'),'psrsvd_vt_$input$','psrsvd_vt_$output$')","input, output","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","sistats_values_rename(2)","eval ""psrsvd_ct_$output$""=if(isnull('psrsvd_ct_$output$'),'psrsvd_ct_$input$','psrsvd_ct_$output$') | eval ""psrsvd_nc_$output$""=if(isnull('psrsvd_nc_$output$'),'psrsvd_nc_$input$','psrsvd_nc_$output$') | eval ""psrsvd_vm_$output$""=if(isnull('psrsvd_vm_$output$'),'psrsvd_vm_$input$','psrsvd_vm_$output$')","input, output","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","sort_chart","`sort_chart(10)`",,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","sort_chart(1)","addtotals fieldname=Total | eval Total=if(isnotnull(src_port),Total-src_port,Total) | eval Total=if(isnotnull(dest_port),Total-dest_port,Total) | sort $head$ - Total | fields - Total",head,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","sort_chart(2)","addtotals fieldname=Total $fields$ | sort $head$ - Total | fields - Total","head, fields","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","split_transport_dest_port(1)","rex field=""$field$"" ""(?<transport>[^/]+)/(?<port>\d+)"" | fillnull value=unknown transport | fillnull value=0 dest_port",field,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","standard_deviations","inputlookup append=T standard_deviations",,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","stats2chart(1)","eval temp="""" | chart useother=`useother` first(count) over temp by $str_field$ | rename temp as count","str_field","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","stdev(2)","eventstats min($intField$) as min_$intField$,max($intField$) as max_$intField$,sum($countField$) as total | eventstats sum(eval($intField$*$countField$/total)) as mean_$intField$ | eventstats sum(eval(pow($intField$-mean_$intField$,2)*$countField$)) as sumsq | eval stdev=sqrt(sumsq/(total-1)) | `get_stdev_index($intField$)` | eval stdev=if(isnull(stdev),0,stdev)","intField,countField","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","stdev_desired_result(3)","eval ""$outField$""=($Z$*stdev)+'$mean$'","Z,mean,outField","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","str_to_bool(1)","`str_to_bool($field$,$field$)`",field,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","str_to_bool(2)","eval `str_to_bool_meval($inField$,$outField$)`","inField,outField","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","str_to_bool_meval(1)","`str_to_bool_meval($field$,$field$)`",field,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","str_to_bool_meval(2)","""$outField$""=case(match('$inField$', ""1|[Tt]|[Tt][Rr][Uu][Ee]""),""true"",match('$inField$', ""0|[Ff]|[Ff][Aa][Ll][Ss][Ee]""),""false"",1=1,'$inField$')","inField,outField","SA-Utils",global,system,
ES,"PROD-ES-1|search_head",summariesonly,"summariesonly=`summariesonly_bool`",,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","summariesonly_bool",true,,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","tag2field(1)","eval ""is_$field$""=if(tag==""$field$"",""true"",""false"")",field,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","tag2field_requires(1)","eval ""requires_$field$""=if(tag==""requires_$field$"",""true"",""false"")",field,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","tag2field_should(1)","eval ""should_$field$""=if(tag==""should_$field$"",""true"",""false"")",field,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head",timeDiff,"`timeDiff(_time)`",,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","timeDiff(1)","eval timeDiff=(time()-'$field$')",field,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","time_subsearch(2)","makeresults | eval search=""_time>"".floor(relative_time(time(),""$earliest$""))."" _time<"".floor(relative_time(time(),""$latest$"")) | table search","earliest,latest","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","tracker_timerange_by_field(2)","`tracker_timerange_by_field($begin$, $end$, firstTime, lastTime)`","begin, end","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","tracker_timerange_by_field(4)","`make_ts_field($begin$, earliestQual)` | `make_ts_field($end$, latestQual)` | where ('$lastTime$'>earliestQual AND '$firstTime$'<latestQual) | fields - earliestQual, latestQual","begin, end, firstTime, lastTime","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","tracker_timerange_by_value(2)","`tracker_timerange_by_value($begin$, $end$, firstTime, lastTime)`","begin, end","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","tracker_timerange_by_value(4)","`make_ts_value($begin$, earliestQual)` | `make_ts_value($end$, latestQual)` | where ('$lastTime$'>earliestQual AND '$firstTime$'<latestQual) | fields - earliestQual, latestQual","begin, end, firstTime, lastTime","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","tracker_trp","`tracker_trp(firstTime,lastTime)`",,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","tracker_trp(2)","[| makeresults | addinfo | eval search=""$begin$>="".if(isnotnull(info_min_time),info_min_time,0).if(isnull(info_max_time) OR info_max_time=""+Infinity"","""","" AND $end$<="".info_max_time) | return $search]","begin, end","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","trim(1)","eval ""$field$""=trim('$field$',"" "")",field,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","truncate(2)","eval ""$field$""=if(length('$field$')>$length$, substr('$field$', 0, $length$) + ""..."", '$field$')","field,length","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","tscollect(1)","`tscollect(""$namespace$"",""true"",""false"")`",namespace,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","tscollect(2)","`tscollect($namespace$,$squashcase$,""false"")`","namespace,squashcase","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","tscollect(3)","tscollect namespace=$namespace$ squashcase=$squashcase$ keepresults=$keepresults$","namespace,squashcase,keepresults","SA-Utils",global,system,
ES,"PROD-ES-1|search_head",tstats,"tstats prestats=true local=`tstats_local` `summariesonly`",,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","tstats_local",false,,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","uitime(1)","`uitime($field$,""%m/%d/%Y %H:%M:%S"")`",field,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","uitime(2)","fieldformat ""$field$""=strftime('$field$', ""$format$"")","field,format","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","uptime2string(2)","eval days_dec='$inField$'/86400 | eval days=floor(days_dec) | eval hours_dec=('$inField$'/3600)-(days*24) | eval hours=floor(hours_dec) | eval minutes_dec=('$inField$'/60)-(days*1440)-(hours*60) | eval minutes=floor(minutes_dec) | eval ""$outField$""=case(days==1,days."" day, "",days>0,days."" days, "",1==1,"""").case(hours=1,hours."" hour, "",hours>0,hours."" hours, "",1=1,"""").case(minutes=1,minutes."" minute"",minutes>0,minutes."" minutes"",1==1,"""").case('$inField$'==1,'$inField$'."" second"",'$inField$'>=0 AND '$inField$'<60,replace('$inField$',""^(\d+(\.\d)?).*$"",""\1"")."" seconds"",days=0 AND hours=0 AND ('$inField$'%60)=1,"", "".ceil('$inField$'%60)."" second"",days=0 AND hours=0 AND ('$inField$'%60)>0,"", "".ceil('$inField$'%60)."" seconds"",1=1,"""") | eval ""$outField$""=rtrim(rtrim('$outField$'), "","") | fields - days,hours,minutes","inField,outField","SA-Utils",global,system,
ES,"PROD-ES-1|search_head",useother,true,,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","wrap(2)","rex field=""$field$"" max_match=0 ""(?<$field$>.{1,$length$})""","field,length","SA-Utils",global,system,
ES,"PROD-ES-1|search_head","xs_default_change_concepts","""minimally,slightly,moderately,greatly,extremely""",,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","xs_default_direction_concepts","""decreasing,unchanged,increasing""",,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","xs_default_magnitude_concepts","""minimal,low,medium,high,extreme""",,"SA-Utils",global,system,
ES,"PROD-ES-1|search_head","seckit_idm_common_event_cidr_category_from_dm_network_session_dhcp_custom",noop,,"SecKit_SA_idm_common",global,system,
ES,"PROD-ES-1|search_head","seckit_idm_common_external_geocode","iplocation ip",,"SecKit_SA_idm_common",global,system,
ES,"PROD-ES-1|search_head","seckit_idm_common_external_maxmind",noop,,"SecKit_SA_idm_common",global,system,
ES,"PROD-ES-1|search_head","seckit_idm_common_get_asset_geo","lookup seckit_idm_pre_cidr_location_by_cidr_lookup cidr as ip OUTPUTNEW lat long city country",,"SecKit_SA_idm_common",global,system,
ES,"PROD-ES-1|search_head","seckit_idm_common_get_asset_net_category","lookup seckit_idm_common_assets_networks_lookup ip OUTPUT category as net_category priority as net_priority pci_domain as net_pci_domain owner as net_owner bunit as net_bunit
| eval priority=mvappend(priority,net_priority,"""")
| rex mode=sed field=net_category ""s/ /\|/g""
| eval net_category=mvjoin(net_category,""|"")
| makemv delim=""|"" net_category
| makemv delim=""|"" net_pci_domain
| eval net_category=mvsort(mvdedup(net_category))
| eval net_category=mvfilter( NOT match(net_category,""(^(gen|source)\:)""))
| eval category=mvappend(category,net_category)
| eval pci_domain=mvdedup(mvsort(mvappend(pci_domain,net_pci_domain)))
| eval owner=case(isnull(owner) AND isnotnull(net_owner),net_owner,isnotnull(owner),owner,0=0,null())
| eval bunit=case(isnull(bunit) AND isnotnull(net_bunit),net_bunit,isnotnull(bunit),bunit,0=0,null())",,"SecKit_SA_idm_common",global,system,
ES,"PROD-ES-1|search_head","seckit_idm_common_get_asset_net_id_category","lookup seckit_idm_common_assets_networks_slookup ip OUTPUT ip as net_category_cidr
| eval category=mvappend(category,""net_id:""+net_category_cidr)",,"SecKit_SA_idm_common",global,system,
ES,"PROD-ES-1|search_head","seckit_idm_common_network_from_ip_bits(3)","rex field=$ipfield$ ""(?<$ipfield$_octet1>\d+)\.(?<$ipfield$_octet2>\d+)\.(?<$ipfield$_octet3>\d+)\.(?<$ipfield$_octet4>\d+)""
| eval $ipfield$_ipnum = ($ipfield$_octet1 * 16777216 + $ipfield$_octet2 * 65536 + $ipfield$_octet3 * 256 + $ipfield$_octet4)
| eval $ipfield$_ipnumbitness = floor($ipfield$_ipnum / pow(2,32-$bitness$)) * pow(2,32-$bitness$)
| eval $ipfield$_net1=floor($ipfield$_ipnumbitness/16777216),$ipfield$_net2=floor(($ipfield$_ipnumbitness-$ipfield$_net1*16777216)/65536),$ipfield$_net3=floor(($ipfield$_ipnumbitness-$ipfield$_net1*16777216-$ipfield$_net2*65536)/256),$ipfield$_net4=$ipfield$_ipnumbitness%256
| eval $outfield$=$ipfield$_net1.""."".$ipfield$_net2.""."".$ipfield$_net3.""."".$ipfield$_net4.""/"".$bitness$
| eval $outfield$_id=$ipfield$_net1.""."".$ipfield$_net2.""."".$ipfield$_net3.""."".$ipfield$_net4
| fields - $ipfield$_octet1 $ipfield$_octet2 $ipfield$_octet3 $ipfield$_octet4 $ipfield$_ipnum $ipfield$_net1 $ipfield$_net2 $ipfield$_net3 $ipfield$_net4 $ipfield$_ipnumbitness","ipfield,bitness,outfield","SecKit_SA_idm_common",global,system,
ES,"PROD-ES-1|search_head","seckit_idm_common_normalize_mac_address(1)","eval $mac$=lower(case(match($mac$, ""^\w{12}$""), rtrim(replace($mac$, ""^(\w{2})"", ""\1:""), "":""), 1==1, replace($mac$, ""\-|\.|\s"", "":"")))",mac,"SecKit_SA_idm_common",global,system,
ES,"PROD-ES-1|search_head","seckit_idm_common_output_assets(3)","eval priority=mvjoin(priority,""|"")
| makemv delim=""|"" priority
| eval priority=mvsort(mvdedup(priority))
| eval nt_host=upper(nt_host)
| eval dns=lower(dns)
| lookup seckit_idm_common_assets_host_expected_tracker_tlookup host as dns OUTPUT reason
| lookup seckit_idm_common_assets_host_expected_tracker_tlookup host as nt_host OUTPUT reason
| eval is_expected=if(isnotnull(reason),""true"",is_expected)

| fillnull value=0 last
| fillnull value="""" exp_category ip mac

| eval category=mvjoin(category,""|"")
| makemv delim=""|"" category
| eval exp_category=case(last>now()-(86400*14),""status:active"",last>0,""status:retired"",!match(ip,""\/""),""status:unseen"")
| eval is_expected=mvappend(is_expected,if(last>now()-(86400*14),""true"",""false""))
| eval category=mvappend(category,case(last>now()-(86400*14),""status:active"",last>0,""status:retired"",isnotnull(nt_host),""status:unseen""),"""")
| eval priority=case(priority=""critical"",""critical"",priority=""high"",""high"",priority=""medium"",""medium"",1=1,""low"")
| eval category=mvfilter(!match(category,""status\:""))
| eval category=mvappend(category,exp_category,""gen:$gen_source$"")

| eval category=mvjoin(category,""|"")
| eval is_expected=if(is_expected=""true"",""true"","""")
| eval should_timesync=nullif(should_timesync,""false"")
| eval should_update=nullif(should_update,""false"")
| eval requires_av=nullif(requires_av,""false"")
| eval ip=mvjoin(mvdedup(mvsort(mvfilter(match(ip,""(\:|\.)"")))),""|"") 
| eval mac=mvjoin(mvdedup(mvsort(mvfilter(match(mac,""(\:)"")))),""|"") 
| fields + ip,mac,nt_host,dns,owner,priority,lat,long,city,country,bunit,category,pci_domain,is_expected,should_timesync,should_update,requires_av
| outputlookup createinapp=true create_empty=true $lookup_name$
| stats count","lookup_name, key_field,gen_source","SecKit_SA_idm_common",global,system,
ES,"PROD-ES-1|search_head","seckit_idm_common_output_identities(3)","fields + identity,prefix,nick,first,last,suffix,email,phone,phone2,managedBy,priority,bunit,category,watchlist,startDate,endDate,work_city,work_country,work_lat,work_long 
| eval identity=mvjoin(identity,""|"")
| eval priority=mvsort(mvdedup(priority))
| eval priority=case(priority=""critical"",""critical"",priority=""high"",""high"",priority=""medium"",""medium"",1=1,""low"")
| eval category=mvsort(mvdedup(mvappend(category,""gen:$gen_source$"") ))
| eval category=mvjoin(category,""|"")
| rex mode=sed field=category ""s/\n/|/g""  | rex mode=sed field=category ""s/^\\||\\|$//g""
| rex mode=sed field=identity ""s/\n/|/g""  | rex mode=sed field=identity ""s/^\\||\\|$//g""
| eval nick=lower(nick)
| makemv delim=""|"" category
| eval category=mvsort(mvdedup(category))
| eval category=mvjoin(category,""|"")
| fields + identity,prefix,nick,first,last,suffix,email,phone,phone2,managedBy,priority,bunit,category,watchlist,startDate,endDate,work_city,work_country,work_lat,work_long
| outputlookup $lookup_name$ createinapp=true create_empty=false
| stats count","lookup_name, key_field,gen_source","SecKit_SA_idm_common",global,system,
ES,"PROD-ES-1|search_head","seckit_idm_common_streamindex","index=streamsdhcp",,"SecKit_SA_idm_common",global,system,
ES,"PROD-ES-1|search_head","seckit_idm_common_update_priority(2)","eval $idm_cat_field$=if(match($idm_cat_value$,""(?i)(low)"") AND NOT match($idm_cat_field$,""(?i)(medium|high|critical)""),$idm_cat_value$,$idm_cat_field$)
| eval $idm_cat_field$=if(match($idm_cat_value$,""(?i)(medium)"") AND NOT match($idm_cat_field$,""(?i)(high|critical)""),$idm_cat_value$,$idm_cat_field$)
| eval $idm_cat_field$=if(match($idm_cat_value$,""(?i)(high)"") AND NOT match($idm_cat_field$,""(?i)(critical)""),$idm_cat_value$,$idm_cat_field$)
| eval $idm_cat_field$=if(match($idm_cat_value$,""(?i)(critical)""),""critical"",$idm_cat_field$)","idm_cat_field,idm_cat_value","SecKit_SA_idm_common",global,system,
ES,"PROD-ES-1|search_head","seckit_idm_windows_activedirectory_computers","`seckit_idm_windows_adindex` sourcetype=activedirectory 
objectCategory=""CN=Computer,CN=Schema,CN=Configuration,*"" 
| eval dNSHostName=lower(dNSHostName) 
| eval cn=lower(cn)
| makemv delim=""|"" objectClass 
| makemv delim=""|"" servicePrincipalName 
| makemv delim=""|"" memberOf 
| rex field=distinguishedName ""(?<domain>DC.*)""
| eval locator=md5(lower(domain) . ""_"" . cn) 
| stats last(managedBy) as managedBy last(objectClass) as objectClass last(distinguishedName) as distinguishedName last(sAMAccountName) as sAMAccountName latest(cn) as cn last(userAccountControl) as userAccountControl last(isDisabled) as isDisabled last(isDeleted) as isDeleted latest(whenDeleted) as whenDeleted latest(whenCreated) as whenCreated latest(whenChanged) as whenChanged latest(operatingSystem) as operatingSystem latest(company) as company latest(division) as division latest(department) as department latest(dNSHostName) by locator 
|  eval _time=now() 
| outputlookup key_field=locator seckit_idm_windows_activedirectory_computers_lookup
| stats count",,"SecKit_SA_idm_windows",global,system,
ES,"PROD-ES-1|search_head","seckit_idm_windows_activedirectory_persons","`seckit_idm_windows_adindex` sourcetype=activedirectory 
objectCategory=""CN=Person,CN=Schema,CN=Configuration,*"" 
| eval sAMAccountName=lower(sAMAccountName)
| eval userPrincipalName=lower(userPrincipalName)
| eval cn=lower(cn)
| makemv delim=""|"" objectClass 
| eval watchlist=if((userAccountControl % 4)>=2,""true"","""") 
| eval startDate=strftime(strptime(startDate,""%I:%M.%S %P, %a %m/%d/%Y""),""%m/%d/%Y %H:%M"") 
| eval endDate=case(accountExpires!=""Never Expires"",accountExpires,(userAccountControl % 4)>=2,lastLogonTimestamp) 
| eval endDate=if(endDate==""0"","""",endDate) 
| eval endDate=if(endDate!="""",strftime(strptime(endDate,""%I:%M.%S %P, %a %m/%d/%Y""),""%m/%d/%Y %H:%M""),"""") 
| fillnull value="""" l 
| eval work_city = l + if(isnull(st),"""","", "" + st) 
| rex field=distinguishedName ""(?<domain>DC.*)""
| eval locator=md5(domain . ""_"" . cn) 
| stats latest(personalTitle) as prefix
    latest(givenName) as first
    latest(sn) as last
    latest(generationQualifier) as suffix
    latest(mail) as email
    latest(telephoneNumber) as phone
    latest(mobile) as phone2
    latest(manager) as managedBy 
    latest(company) as company
    latest(division) as division
    latest(department) as department
    latest(bunit) as bunit
    latest(watchlist) as watchlist
    latest(startDate) as startDate
    latest(endDate) as endDate
    latest(work_city) as work_city 
    latest(c) as work_country
    latest(distinguishedName) as distinguishedName
    latest(objectCategory) as objectCategory 
    latest(name) as name 
    latest(sAMAccountName) as sAMAccountName 
    latest(employeeType) as employeeType 
    latest(employeeID) as employeeID 
    latest(displayName) as displayName
    latest(memberOf) as memberOf
    latest(uid) as uid
    latest(uidNumber) as uidNumber
    latest(title) as title
    latest(objectSid) as objectSid
    latest(userPrincipalName) as userPrincipalName
    latest(isDeleted) as isDeleted
    latest(cn) as cn 
    by locator 
| eval _time=now() 
| makemv delim=""|"" memberOf
| outputlookup key_field=locator seckit_idm_windows_activedirectory_persons_lookup
| stats count",,"SecKit_SA_idm_windows",global,system,
ES,"PROD-ES-1|search_head","seckit_idm_windows_ad_assets","from lookup:seckit_idm_windows_activedirectory_computers_lookup
| `seckit_idm_windows_get_asset_bunit`
| rename dNSHostName as dns | rename cn as nt_host
| eval nt_host=upper(nt_host) 
| fillnull value=""true"" should_timesync should_update
| fillnull value=""false"" is_expected

| lookup seckit_idm_windows_os_lookup operatingSystem OUTPUT os_vendor,os_class,os_product,os_version,os_supported,requires_av

| lookup seckit_idm_windows_asset_os_role_lookup host as dns OUTPUT role_category role_priority,role_expected
| lookup seckit_idm_windows_asset_os_role_lookup host as nt_host OUTPUT role_category role_priority,role_expected

| lookup seckit_idm_pre_host_static_lookup static_name as dns OUTPUT static_category static_pci_domain static_priority,static_expected
| lookup seckit_idm_pre_host_static_lookup static_name as nt_host OUTPUT static_category static_pci_domain static_priority,static_expected

| lookup seckit_idm_windows_assets_bunit_lookup bunit OUTPUT bunit_category,bunit_priority,bunit_expected

| lookup seckit_idm_windows_assets_org_lookup  org as distinguishedName OUTPUT org_category,org_priority,org_expected

| `seckit_idm_windows_get_asset_category`
| `seckit_idm_windows_get_asset_priority`

| eval pci_domain = static_pci_domain

| eval is_expected=mvappend(is_expected,bunit_expected,org_expected,static_expected,role_expected)

| fillnull value="""" role_category app_category status_category static_category custom_category

| eval status_category = if (isnotnull(isDeleted),""isDeleted"","""")

| fillnull value=""unknown"" os_vendor os_class os_product os_version os_supported operatingSystem
| eval category=mvappend(""domain_member"",
    ""os_vendor:""+os_vendor,
    ""os_class:""+os_class,
    ""os_product:""+os_product,
    ""os_version:""+os_version,
    ""os_supported:""+os_supported,
    ""os_string:"" + replace(operatingSystem,""(\.|\s)"",""""),
    org_category,
    bunit_category,
    role_category,
    app_category,
    static_category,
    status_category,
    custom_category,
    ""source:ActiveDirectory""
    ) 

| eval priority=mvdedup(mvappend(priority,
    bunit_priority,
    static_priority,
    app_priority,
    role_priority,
    org_priority,
    custom_priority
  ))

| `seckit_idm_windows_get_asset_mac`
| `seckit_idm_windows_get_asset_ip`
| `seckit_idm_windows_get_asset_owner`

| `seckit_idm_common_get_asset_geo`
| `seckit_idm_common_get_asset_net_category`
| `seckit_idm_common_get_asset_net_id_category`
| `seckit_idm_common_output_assets(""seckit_idm_windows_assets_lookup"",""nt_host"",""sec_kit_idm_windows_assets"")`",,"SecKit_SA_idm_windows",global,system,
ES,"PROD-ES-1|search_head","seckit_idm_windows_ad_assets_identities","from lookup:seckit_idm_windows_activedirectory_computers_lookup
| `seckit_idm_windows_get_asset_bunit`
| rex field=distinguishedName ""DC\=(?<domain_user>[^\,]*)"" 
| eval identity=mvappend(identity,sAMAccountName,"""")
| eval identity=mvappend(identity,objectSid,"""")
| eval identity=mvappend(identity,distinguishedName,"""")
| eval identity=mvappend(identity,cn,"""")
| eval identity=mvappend(identity,upper(domain_user + ""\\"" + sAMAccountName),"""")
| rex field=dNSHostName ""[^\.]\.(?<dns_domain>.*)""
| eval identity=mvappend(identity,lower(sAMAccountName + ""@"" + dns_domain))
 
| rename distinguishedName as nick
| eval isDisabled = if(1=0 AND (userAccountControl % 4)>=2,""disabled"",""enabled"") 
| eval watchlist=if(isDisabled==""disabled"",""true"","""") 
| eval endDate=case(isnotnull(isDeleted),whenDeleted,accountExpires!=""Never Expires"",accountExpires,isDisabled==""disabled"",lastLogonTimestamp)
| rename whenCreated as startDate 
| eval startDate= strftime(strptime(startDate,""%I:%M.%S %P, %a %m/%d/%Y""),""%m/%d/%Y %H:%M"")
| eval endDate= strftime(strptime(endDate,""%I:%M.%S %P, %a %m/%d/%Y""),""%m/%d/%Y %H:%M"")
| eval category=mvappend(""computer"",""nha"","""" )
| eval priority=""low"" 
| eval dns=lower(dNSHostName)
| `seckit_idm_windows_get_identity_priority`
| fillnull value=""low"" custom_priority

| eval priority=mvappend(priority,custom_priority,"""")
| `seckit_idm_common_output_identities(""seckit_idm_windows_assets_identities_lookup"",""nick"",""seckit_idm_windows_assets_identities"")`",,"SecKit_SA_idm_windows",global,system,
ES,"PROD-ES-1|search_head","seckit_idm_windows_ad_identities","from lookup:seckit_idm_windows_activedirectory_persons_lookup
| `seckit_idm_windows_identities_custom`
| `seckit_idm_windows_get_identity_bunit`

| rex field=distinguishedName ""DC\=(?<domain_user>[^\,]*)""
| eval nick=userPrincipalName 
| fillnull value="""" objectSid name distinguishedName cn domain_user sAMAccountName email userPrincipalName category identity
| eval identity=mvappend(identity,upper(sAMAccountName),objectSid)
| eval identity=mvappend(identity,name,distinguishedName)
| eval identity=mvappend(identity,cn,upper(domain_user + ""\\"" + sAMAccountName))
| eval identity=mvappend(identity,lower(email) ,userPrincipalName)
| eval identity=mvappend(identity,if(isnotnull(employeeType) AND isnotnull(employeeID),""|"" + employeeType + ""_"" + employeeID,"""")  ,"""")
| eval identity=mvappend(identity,uid)
| eval identity=mvappend(identity,uidNumber,""uid_""+uidNumber)
| eval identity=mvsort(mvdedup(identity))

| lookup seckit_idm_windows_identities_nha_lookup identity OUTPUT nha_category,nha_watchlist,nha_priority 
| eval category=mvappend(category,nha_category,custom_category) 
| eval priority=mvappend(priority,nha_priority)
| eval watchlist=if(isnotnull(nha_watchlist),nha_watchlist,watchlist) 

| lookup seckit_idm_windows_identities_members_lookup memberOf OUTPUT member_category,member_watchlist,member_priority
| eval watchlist=if(isnotnull(member_watchlist),member_watchlist,watchlist) 
| eval category=mvappend(category,member_category)
| eval priority=mvappend(priority,member_priority)

| lookup seckit_idm_windows_identities_accounts_lookup  account as identity OUTPUT account_category,account_priority,account_watchlist
| eval watchlist=if(isnotnull(account_watchlist),account_watchlist,watchlist) 
| eval category=mvappend(category,account_category) 
| eval priority=mvappend(priority,account_priority)

| lookup seckit_idm_windows_identities_title_lookup  title OUTPUT title_category,title_priority,title_watchlist
| eval watchlist=if(isnotnull(title_watchlist),title_watchlist,watchlist) 
| eval category=mvappend(category,title_category) 
| eval priority=mvappend(priority,title_priority)

| lookup seckit_idm_windows_identities_bunit_lookup  bunit OUTPUT bunit_category,bunit_priority
| eval category=mvappend(category,bunit_category) 
| eval priority=mvappend(priority,bunit_priority)

| lookup seckit_idm_windows_identities_org_lookup  org as distinguishedName   OUTPUT org_category,org_priority
| eval category=mvappend(category,org_category)
| eval priority=mvappend(priority,org_priority)
| `seckit_idm_windows_get_identity_manager` 
| eval isDeleted=if(isDeleted==""True"",""true"",""false"")
| eval endDate=if(isnotnull(isDeleted),whenDeleted,endDate)

| `seckit_idm_common_output_identities(""seckit_idm_windows_identities_lookup"",""nick"",""seckit_idm_windows_identities"")`",,"SecKit_SA_idm_windows",global,system,
ES,"PROD-ES-1|search_head","seckit_idm_windows_adindex","index=appmsadmon",,"SecKit_SA_idm_windows",global,system,
ES,"PROD-ES-1|search_head","seckit_idm_windows_asset_interface","`seckit_idm_windows_winscripts_adindex` sourcetype=seckit:idm:windows:interface 
| lookup seckit_idm_windows_os_win_interfaces_lookup InterfaceDescription OUTPUT ExternalStatic,Private 
| search (IPv4PrefixOrigin=Manual OR IPv4PreferredLifetime=""10675199*"" OR ExternalStatic=true ) NOT Private=""true"" 
| eval host=lower(Server) 
| fields + ,_time,host,DHCPServers,Domain,IPv4Address,IPv4AddressState,IPv4Connectivity,IPv4DNS,IPv4PolicyStore,IPv4PreferredLifetime,IPv4PrefixLength,IPv4PrefixOrigin,IPv4SkipAsSource,IPv4SuffixOrigin,InterfaceAlias,InterfaceDescription,InterfaceIndex,LinkSpeed,MacAddress,NetworkCategory,ExternalStatic,Private  
| stats latest(*) by MacAddress 
| rename latest(*) as * 
| eval locator=md5(MacAddress) 
| outputlookup key_field=locator seckit_idm_windows_asset_interface_lookup 
| stats count",,"SecKit_SA_idm_windows",global,system,
ES,"PROD-ES-1|search_head","seckit_idm_windows_asset_os_role","`seckit_idm_windows_winscripts_adindex` sourcetype=winhostmon source=roles 
| lookup seckit_idm_windows_pf_roles_lookup role_name as Name OUTPUT role_category role_priority role_expected
| where isnotnull(role_category) OR isnotnull(role_priority) OR isnotnull(role_expected)
| stats latest(_time) as _time values(role_category) as role_category values(role_priority) as role_priority values(role_expected) as role_expected by host, Name
| rename  Name as role_name
| eval host=lower(host)
| eval locator=md5(host . ""_"" . role_name)
| outputlookup key_field=locator seckit_idm_windows_asset_os_role_lookup
| stats count",,"SecKit_SA_idm_windows",global,system,
ES,"PROD-ES-1|search_head","seckit_idm_windows_get_asset_bunit","eval bunit = company + ""/"" + division + ""/"" + department",,"SecKit_SA_idm_windows",global,system,
ES,"PROD-ES-1|search_head","seckit_idm_windows_get_asset_category",noop,,"SecKit_SA_idm_windows",global,system,
ES,"PROD-ES-1|search_head","seckit_idm_windows_get_asset_ip","lookup seckit_idm_windows_asset_interface_lookup host as dns OUTPUT IPv4Address as ip_script
| lookup seckit_idm_windows_asset_interface_lookup host as nt_host OUTPUT IPv4Address as ip_script
| `seckit_idm_windows_get_asset_ip_custom`
| fillnull value="""" ip_custom ip_script ip_query
| eval ip=mvappend(ip_script,ip_query,ip_custom)
| eval ip=if(match(category,""os_class:endpoint""),"""",ip)",,"SecKit_SA_idm_windows",global,system,
ES,"PROD-ES-1|search_head","seckit_idm_windows_get_asset_ip_custom",noop,,"SecKit_SA_idm_windows",global,system,
ES,"PROD-ES-1|search_head","seckit_idm_windows_get_asset_mac","lookup seckit_idm_windows_asset_interface_lookup host as dns OUTPUT MacAddress as mac_script
| lookup seckit_idm_windows_asset_interface_lookup host as nt_host OUTPUT MacAddress as mac_script
| `seckit_idm_windows_get_asset_mac_custom`
| fillnull value="""" mac_script mac_custom
| eval mac=mvappend(mac_script,mac_custom)",,"SecKit_SA_idm_windows",global,system,
ES,"PROD-ES-1|search_head","seckit_idm_windows_get_asset_mac_custom",noop,,"SecKit_SA_idm_windows",global,system,
ES,"PROD-ES-1|search_head","seckit_idm_windows_get_asset_owner",noop,,"SecKit_SA_idm_windows",global,system,
ES,"PROD-ES-1|search_head","seckit_idm_windows_get_asset_priority",noop,,"SecKit_SA_idm_windows",global,system,
ES,"PROD-ES-1|search_head","seckit_idm_windows_get_identity_bunit","eval bunit=if(isnotnull(company),company,null()) 
| eval bunit=case(isnotnull(bunit) AND isnotnull(division), bunit + ""/"" + division,isnotnull(division),division,0=0,bunit) 
| eval bunit=case(isnotnull(bunit) AND isnotnull(department), bunit + ""/"" + department,isnotnull(department),department,0=0,bunit)",,"SecKit_SA_idm_windows",global,system,
ES,"PROD-ES-1|search_head","seckit_idm_windows_get_identity_manager","lookup identity_lookup_expanded identity as managedBy OUTPUT email as manager_email 
| eval managedBy=manager_email",,"SecKit_SA_idm_windows",global,system,
ES,"PROD-ES-1|search_head","seckit_idm_windows_get_identity_priority",noop,,"SecKit_SA_idm_windows",global,system,
ES,"PROD-ES-1|search_head","seckit_idm_windows_identities_custom","fillnull value="""" custom_category custom_priority
| eval priority=mvappend(priority,member_priority,"""")",,"SecKit_SA_idm_windows",global,system,
ES,"PROD-ES-1|search_head","seckit_idm_windows_nixscripts_adindex","(index=osnixscript OR index=oswinscript)",,"SecKit_SA_idm_windows",global,system,
ES,"PROD-ES-1|search_head","seckit_idm_windows_winevents_adindex","index=oswinsec",,"SecKit_SA_idm_windows",global,system,
ES,"PROD-ES-1|search_head","seckit_idm_windows_winhostmon_adindex","index=oswinscript",,"SecKit_SA_idm_windows",global,system,
ES,"PROD-ES-1|search_head","seckit_idm_windows_winscripts_adindex","index=oswinscript",,"SecKit_SA_idm_windows",global,system,
ES,"PROD-ES-1|search_head","es_context_only(1)","($dm$.app=SplunkEnterpriseSecuritySuite OR $dm$.app=Splunk_DA-ESS_* OR $dm$.app=DA-ESS-*)",dm,SplunkEnterpriseSecuritySuite,global,system,
ES,"PROD-ES-1|search_head","es_get_cam","join type=outer action_name [| rest splunk_server=local count=0 /services/alerts/alert_actions | rename title as action_name | table action_name,param._cam*] | spath input=param._cam | rename category{} as cam_category,subject{} as cam_subject",,SplunkEnterpriseSecuritySuite,global,system,
ES,"PROD-ES-1|search_head","es_loadjob(1)","loadjob savedsearch=""admin:SplunkEnterpriseSecuritySuite:$savedsearch$""",savedsearch,SplunkEnterpriseSecuritySuite,global,system,
ES,"PROD-ES-1|search_head","es_notable_events","inputlookup append=T es_notable_events | eval count=1 | `security_domains` | eval timeDiff_type=if(isnull(timeDiff_type), mvappend(""current"", NULL, ""historical""), timeDiff_type), count=if(isnull(count),0,count) | fillnull value=""unknown"" src,dest,dvc,governance,control",,SplunkEnterpriseSecuritySuite,global,system,
ES,"PROD-ES-1|search_head","es_search_schedule","rest splunk_server=local count=0 /services/saved/searches | search (title=""*Gen"" OR title=""*Rule"" OR title=""*Action History"") NOT (dispatch.earliest_time=rt* OR dispatch.latest_time=rt*) | where isnotnull(cron_schedule) AND cron_schedule!="""" | stats values(title) as savedsearches,count by cron_schedule | lookup cron_schedule_map cron_schedule OUTPUT | eval c0=c0*count | eval c5=c5*count | eval c10=c10*count | eval c15=c15*count | eval c20=c20*count | eval c25=c25*count | eval c30=c30*count | eval c35=c35*count | eval c40=c40*count | eval c45=c45*count | eval c50=c50*count | eval c55=c55*count | addcoltotals labelfield=savedsearches label=Total | fields cron_schedule savedsearches count c0 c5 c10 c15 c20 c25 c30 c35 c40 c45 c50 c55",,SplunkEnterpriseSecuritySuite,global,system,
ES,"PROD-ES-1|search_head","event_seq_base_search","`event_seq_events` | tags outputfield=tag | `mvappend_field(tag,orig_tag)`| dedup rule_id | `get_correlations` | `get_urgency` | typer | tags outputfield=tag | `mvappend_field(tag,orig_tag)` | `suppression_extract` | search NOT suppression=* | expandtoken rule_title",,SplunkEnterpriseSecuritySuite,global,system,
ES,"PROD-ES-1|search_head","event_seq_events","`get_risk_index` OR `get_notable_index` | eval `get_event_id_meval`,rule_id=event_id | fields - host_*",,SplunkEnterpriseSecuritySuite,global,system,
ES,"PROD-ES-1|search_head","execute_sequence_template(2)","`event_seq_base_search` | esssequence template=""$template$"" create_seq_event=""$create_seq_event$""","template, create_seq_event",SplunkEnterpriseSecuritySuite,global,system,
ES,"PROD-ES-1|search_head","get_arrow(1)","search security_domain=$security_domain$ | stats sum(count) as count by security_domain,timeDiff_type | fields - security_domain | sort + timeDiff_type | transpose | search column=count | rename ""row 1"" as current_count | rename ""row 2"" as historical_count | eval count_diff=current_count-historical_count | eval arrow=if(count_diff<0,""down"",""up"") | eval arrow=if(count_diff==0,""no_change"",arrow)","security_domain",SplunkEnterpriseSecuritySuite,global,system,
ES,"PROD-ES-1|search_head","get_sequenced_index","index=sequenced_events",,SplunkEnterpriseSecuritySuite,global,system,
ES,"PROD-ES-1|search_head","investigation_annotate_status","`investigation_annotate_status(status_id, status_end)`",,SplunkEnterpriseSecuritySuite,global,system,
ES,"PROD-ES-1|search_head","investigation_annotate_status(2)","join type=outer ""$status_id_field$"" [| rest splunk_server=local count=0 /services/alerts/reviewstatuses | search status_type=investigation | rename title as ""$status_id_field$"", end as ""$output_field$""| fields ""$status_id_field$"", ""$output_field$""]","status_id_field, output_field",SplunkEnterpriseSecuritySuite,global,system,
ES,"PROD-ES-1|search_head","investigation_get_collaborator_count","`investigation_get_collaborator_count(collaborators, collaborator_count)`",,SplunkEnterpriseSecuritySuite,global,system,
ES,"PROD-ES-1|search_head","investigation_get_collaborator_count(2)","spath output=""temp_es_$collaborators_field$"" input=""$collaborators_field$"" path={} | eval ""$output_field$""=mvcount('temp_es_$collaborators_field$') | eval ""$output_field$""=if(isNull('$output_field$'), 0, '$output_field$') | fields - temp_es_*","collaborators_field, output_field",SplunkEnterpriseSecuritySuite,global,system,
ES,"PROD-ES-1|search_head","investigation_get_current_status","`investigation_get_current_status(status, current_status)`",,SplunkEnterpriseSecuritySuite,global,system,
ES,"PROD-ES-1|search_head","investigation_get_current_status(2)","spath output=""temp_es_$status_field$"" input=""$status_field$"" path={} | spath output=""$output_field_prefix$_name"" input=""temp_es_$status_field$"" path=name | spath output=""$output_field_prefix$_id"" input=""temp_es_$status_field$"" path=id | spath output=""$output_field_prefix$_time"" input=""temp_es_$status_field$"" path=time | fields - temp_es_* | `investigation_annotate_status($output_field_prefix$_id, $output_field_prefix$_end)`","status_field, output_field_prefix",SplunkEnterpriseSecuritySuite,global,system,
ES,"PROD-ES-1|search_head","investigation_get_open_duration(2)","`investigation_get_status_transistion($status_field$, temp_transition_es_$status_field$)` | eval ""temp_transition_es_$output_field$""=if('temp_transition_es_$status_field$_prev_end'=0,abs('temp_transition_es_$status_field$_time'-'temp_transition_es_$status_field$_prev_time'), 0) | stats sum(""temp_transition_es_$output_field$"") as ""$output_field$"", last(*) as * by id | eval ""$output_field$""=if(current_status_end=0,'$output_field$'+now()-current_status_time, '$output_field$') | fields - temp_transition_es_*","status_field, output_field",SplunkEnterpriseSecuritySuite,global,system,
ES,"PROD-ES-1|search_head","investigation_get_reopen_count","`investigation_get_reopen_count(status, status_reopen_count)`",,SplunkEnterpriseSecuritySuite,global,system,
ES,"PROD-ES-1|search_head","investigation_get_reopen_count(2)","`investigation_get_status_transistion($status_field$, transition_$status_field$)` | eval temp_es_reopen=if('transition_$status_field$_prev_end'=1 AND 'transition_$status_field$_end'=0, 1, 0) | fields - transition_* | stats sum(temp_es_reopen) as ""$output_field$"", first(*) as * by title | fields - temp_es_reopen","status_field, output_field",SplunkEnterpriseSecuritySuite,global,system,
ES,"PROD-ES-1|search_head","investigation_get_status_transistion(2)","spath output=""temp_es_$status_field$"" input=""$status_field$"" path={} | mvexpand ""temp_es_$status_field$"" | spath output=""$output_field_prefix$_name"" input=""temp_es_$status_field$"" path=name | spath output=""$output_field_prefix$_id"" input=""temp_es_$status_field$"" path=id | spath output=""$output_field_prefix$_time"" input=""temp_es_$status_field$"" path=time | sort 0 + title, ""$output_field_prefix$_time"" | `investigation_annotate_status($output_field_prefix$_id, $output_field_prefix$_end)` | fields - temp_es_* | streamstats current=t window=2  first(""$output_field_prefix$_end"") as $output_field_prefix$_prev_end, min($output_field_prefix$_time) as $output_field_prefix$_prev_time by title","status_field, output_field_prefix",SplunkEnterpriseSecuritySuite,global,system,
ES,"PROD-ES-1|search_head",investigations,"rest splunk_server=local count=0 /services/storage/investigation/investigation",,SplunkEnterpriseSecuritySuite,global,system,
ES,"PROD-ES-1|search_head",boxplot,"untable _x field_name value
| stats min exactperc25 median exactperc75 max by field_name
| untable field_name calculations value
| xyseries calculations field_name value
| eval calculations = rtrim(calculations, ""(value)"")",,"Splunk_ML_Toolkit",app,system,
ES,"PROD-ES-1|search_head","classificationreport(2)","rename ""$a$"" as actual, ""$p$"" as predicted
| stats count by actual predicted
| xyseries actual predicted count
| fillnull
| untable actual predicted count
| stats sum(eval(if(actual == predicted, count, 0))) as t sum(eval(if(actual != predicted, count, 0))) as f by actual predicted
| eventstats sum(eval(if(actual==predicted, t, 0))) as tp sum(eval(if(actual!=predicted, f, 0))) as fn by actual
| eventstats sum(eval(if(actual!=predicted, f, 0))) as fp by predicted
| eval count=if(actual==predicted,t,f), fp=if(actual==predicted, fp, 0), fn=if(actual==predicted, fn,0), tp=if(actual==predicted, tp, 0)
| stats sum(count) as count sum(t) as t sum(f) as f sum(tp) as tp sum(fn) as fn sum(fp) as fp by actual
| eventstats sum(count) as total
| eval precision=tp/(tp+fp)
| eval recall=tp/(tp+fn)
| eval f1=2*precision*recall/(precision+recall)
| eval accuracy=t/count
| fillnull
| appendpipe [ stats sum(count) as count sum(eval(accuracy*count/total)) as accuracy sum(eval(precision*count/total)) as precision sum(eval(recall*count/total)) as recall sum(eval(f1*count/total)) as f1 | eval actual=""Weighted Average"" ]
| rename actual as class
| table class accuracy precision recall f1 count","a, p","Splunk_ML_Toolkit",app,system,
ES,"PROD-ES-1|search_head","classificationstatistics(2)","`classificationreport(""$a$"", ""$p$"")`
| tail 1
| eval precision=round(precision, 2), recall=round(recall, 2), accuracy=round(accuracy, 2), f1=round(f1, 2)","a, p","Splunk_ML_Toolkit",app,system,
ES,"PROD-ES-1|search_head","confusionmatrix(2)","rename ""$a$"" as actual, ""$p$"" as predicted
| stats count by actual predicted
| appendpipe [ eval predicted=actual, count=0 ]
| stats sum(count) as count by actual predicted
| xyseries actual predicted count
| rename * as ""Predicted *""
| rename ""Predicted $a$"" as ""Actual $a$""
| fillnull value=0","a, p","Splunk_ML_Toolkit",app,system,
ES,"PROD-ES-1|search_head","forecastviz(4)","eval _ft=$ft$, _hb=$hb$, _vars=""$v$"", _ci=$ci$","ft, hb, v, ci","Splunk_ML_Toolkit",app,system,
ES,"PROD-ES-1|search_head","histogram(2)","bin ""$var$"" bins=$bins$ | stats count by ""$var$"" | makecontinuous ""$var$"" | fillnull","var, bins","Splunk_ML_Toolkit",app,system,
ES,"PROD-ES-1|search_head","modvizpredict(6)","predict ""$v$"" as prediction algorithm=$a$ future_timespan=$f$ holdback=$h$ $p$ lower$ci$=lower$ci$ upper$ci$=upper$ci$ | eval _ft=$f$, _hb=$h$, _vars=""$v$"", _ci=$ci$","v, a, f, h, p, ci","Splunk_ML_Toolkit",app,system,
ES,"PROD-ES-1|search_head","regressionstatistics(2)","rename ""$a$"" as _actual, ""$p$"" as _predicted | eventstats avg(_actual) as _avgActual | eval _actualMinusAvg = _actual - _avgActual, _residual = _actual - _predicted | stats sumsq(_actualMinusAvg) as _sumsqActualMinusAvg, sumsq(_residual) as _sumsqResidual, count(_residual) as _sampleCount | eval _sumsqActualMinusAvg=round(_sumsqActualMinusAvg,6), _sumsqResidual = round(_sumsqResidual, 6) | eval rSquared = if(_sumsqActualMinusAvg == 0, ""NaN"", round(1 - _sumsqResidual / _sumsqActualMinusAvg, 4)), RMSE = round(sqrt(_sumsqResidual / _sampleCount), 2) | table rSquared RMSE","a, p","Splunk_ML_Toolkit",app,system,
ES,"PROD-ES-1|search_head","smartforecastviz(1)","eval _vars=""$v1$""",v1,"Splunk_ML_Toolkit",app,system,
ES,"PROD-ES-1|search_head","smartforecastviz(2)","eval _vars=mvappend(""$v1$"", ""$v2$"")","v1, v2","Splunk_ML_Toolkit",app,system,
ES,"PROD-ES-1|search_head","smartforecastviz(3)","eval _vars=mvappend(""$v1$"", ""$v2$"", ""$v3$"")","v1, v2, v3","Splunk_ML_Toolkit",app,system,
ES,"PROD-ES-1|search_head","smartforecastviz(4)","eval _vars=mvappend(""$v1$"", ""$v2$"", ""$v3$"", ""$v4$"")","v1, v2, v3, v4","Splunk_ML_Toolkit",app,system,
ES,"PROD-ES-1|search_head","smartforecastviz(5)","eval _vars=mvappend(""$v1$"", ""$v2$"", ""$v3$"", ""$v4$"", ""$v5$"")","v1, v2, v3, v4, v5","Splunk_ML_Toolkit",app,system,
ES,"PROD-ES-1|search_head","splitby(1)","eval _split_by=""$s$""",s,"Splunk_ML_Toolkit",app,system,
ES,"PROD-ES-1|search_head","splitby(2)","eval _split_by=mvappend(""$s1$"", ""$s2$"")","s1, s2","Splunk_ML_Toolkit",app,system,
ES,"PROD-ES-1|search_head","splitby(3)","eval _split_by=mvappend(""$s1$"", ""$s2$"", ""$s3$"")","s1, s2, s3","Splunk_ML_Toolkit",app,system,
ES,"PROD-ES-1|search_head","splitby(4)","eval _split_by=mvappend(""$s1$"", ""$s2$"", ""$s3$"", ""$s4$"")","s1, s2, s3, s4","Splunk_ML_Toolkit",app,system,
ES,"PROD-ES-1|search_head","splitby(5)","eval _split_by=mvappend(""$s1$"", ""$s2$"", ""$s3$"", ""$s4$"", ""$s5$"")","s1, s2, s3, s4, s5","Splunk_ML_Toolkit",app,system,
ES,"PROD-ES-1|search_head","add_dm_object_name(1)","rename * as ""$object$.*""",object,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cam_action_modes","inputlookup append=T cam_action_mode_lookup | eval action_mode=lower(action_mode) | dedup action_mode | sort + action_mode",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cam_action_statuses","inputlookup append=T cam_action_status_lookup | eval action_status=lower(action_status) | dedup action_status | sort + action_status",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cam_categories","inputlookup append=T cam_category_lookup | dedup category | sort + category",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cam_subjects","inputlookup append=T cam_subject_lookup | eval subject=lower(subject) | dedup subject | sort + subject",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cam_tasks","inputlookup append=T cam_task_lookup | eval task=lower(task) | dedup task | sort + task",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cam_workers","inputlookup append=T cam_worker_lookup | append[| makeresults | eval worker_set=""local"",cam_workers=""[\""local\""]""] | dedup worker_set | spath input=cam_workers | where isnotnull('{}') | table worker_set,cam_workers | sort + worker_set",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_Alerts_indexes","()",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_Application_State_indexes","()",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_Authentication_indexes","(index=oswinsec OR index=osnixsec)",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_Certificates_indexes","()",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_Change_Analysis_indexes","()",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_Change_indexes","()",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_Compute_Inventory_indexes","()",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_DLP_indexes","()",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_Databases_indexes","()",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_Email_indexes","()",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_Endpoint_indexes","()",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_Event_Signatures_indexes","()",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_Interprocess_Messaging_indexes","()",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_Intrusion_Detection_indexes","(index=epav)",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_JVM_indexes","()",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_Malware_indexes","(index=epav)",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_Network_Resolution_indexes","()",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_Network_Sessions_indexes","()",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_Network_Traffic_indexes","(index=eventgen)",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_Performance_indexes","()",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_Ticket_Management_indexes","()",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_Updates_indexes","()",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_Vulnerabilities_indexes","()",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_Web_indexes","(index=eventgen)",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_access_actions","inputlookup append=T cim_access_action_lookup | eval action=lower(action) | dedup action",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_corporate_email_domain_search(1)","[| `cim_corporate_email_domains` | rename domain as $field$ | format | fields search]",field,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_corporate_email_domains","inputlookup append=T cim_corporate_email_domain_lookup",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_corporate_web_domain_search(1)","[| `cim_corporate_web_domains` | rename domain as $field$ | format | fields search]",field,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_corporate_web_domains","inputlookup append=T cim_corporate_web_domain_lookup",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_datamodelinfo","rest /services/admin/summarization by_tstats=t splunk_server=local count=0 | eval key=replace('title',""tstats:DM_"".'eai:acl.app'.""_"",""""),datamodel=replace('summary.id',""DM_"".'eai:acl.app'.""_"","""") | join type=left key [| rest /services/data/models splunk_server=local count=0 | table title acceleration.cron_schedule eai:digest | rename title as key | rename acceleration.cron_schedule AS cron] | table datamodel eai:acl.app summary.access_time summary.is_inprogress summary.size summary.latest_time summary.complete summary.buckets_size summary.buckets cron summary.last_error summary.time_range summary.id summary.mod_time eai:digest summary.earliest_time summary.last_sid summary.access_count | rename summary.id AS summary_id, summary.time_range AS retention, summary.earliest_time as earliest, summary.latest_time as latest, eai:digest as digest | rename summary.* AS *, eai:acl.* AS * | sort datamodel",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_dlp_actions","inputlookup append=T cim_dlp_action_lookup | eval action=lower(action) | dedup action | sort + action",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_dlp_object_categories","inputlookup append=T cim_dlp_object_category_lookup | eval object_category=lower(object_category) | dedup object_category | sort + object_category",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_dlp_types","inputlookup append=T cim_dlp_type_lookup | eval dlp_type=lower(dlp_type) | dedup dlp_type | sort + dlp_type",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_dns_reply_codes","inputlookup append=T cim_dns_reply_code_lookup | dedup reply_code | sort + reply_code",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_email_protocols","inputlookup append=T cim_email_protocol_lookup | sort + protocol",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_endpoint_actions","inputlookup append=T cim_endpoint_action_lookup | eval action=lower(action) | dedup action | sort + action",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_endpoint_object_categories","inputlookup append=T cim_endpoint_object_category_lookup | eval object_category=lower(object_category) | dedup object_category | sort + object_category",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_endpoint_severities","inputlookup append=T cim_endpoint_severity_lookup | eval severity=lower(severity) | dedup severity",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_endpoint_statuses","inputlookup append=T cim_endpoint_status_lookup | eval status=lower(status) | dedup status | sort + status",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_endpoint_user_types","inputlookup append=T cim_endpoint_user_type_lookup | eval user_type=lower(user_type) | dedup user_type | sort + user_type",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_filter_known_scanners","NOT (host_category=""known_scanner"" OR orig_host_category=""known_scanner"" OR dvc_category=""known_scanner"" OR src_category=""known_scanner"" OR dest_category=""known_scanner"")",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_filter_known_scanners(1)","NOT ($object$.host_category=""known_scanner"" OR $object$.orig_host_category=""known_scanner"" OR $object$.dvc_category=""known_scanner"" OR $object$.src_category=""known_scanner"" OR $object$.dest_category=""known_scanner"")",object,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_filter_unknown_values(1)","($field$!=""-"" $field$!=""n/a"" $field$!=""unknown"")",field,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_filter_vuln_severity","(severity!=""informational"" AND severity!=""low"")",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_filter_vuln_severity(1)","($object$.severity!=""informational"" AND $object$.severity!=""low"")",object,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_http_methods","inputlookup append=T cim_http_method_lookup | eval http_method=lower(http_method) | dedup http_method",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_http_statuses","inputlookup append=T cim_http_status_lookup",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_ids_severities","inputlookup append=T cim_ids_severity_lookup | eval severity=lower(severity) | dedup severity",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_ids_types","inputlookup append=T cim_ids_type_lookup | eval ids_type=lower(ids_type) | dedup ids_type | sort + ids_type",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_malware_actions","inputlookup append=T cim_malware_action_lookup | eval action=lower(action) | dedup action | sort + action",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_traffic_actions","inputlookup append=T cim_traffic_action_lookup | eval action=lower(action) | dedup action | sort + action",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_transport_protocols","inputlookup append=T cim_transport_protocol_lookup | eval transport=lower(transport) | dedup transport | sort + transport",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_update_statii","inputlookup append=T cim_update_status_lookup | eval status=lower(status) | dedup status | sort + status",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_vendor_product_tracker","inputlookup append=T cim_vendor_product_tracker",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cim_vuln_severities","inputlookup append=T cim_vuln_severity_lookup | eval severity=lower(severity) | dedup severity",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cloud_domain_search(1)","[| `cloud_domains` | rename domain as $field$ | fields $field$ | format | fields search]",field,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cloud_domains","inputlookup append=T cim_cloud_domain_lookup",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cloud_email_search(1)","[| `cloud_domains` | search is_email=true | rename domain as $field$ | fields $field$ | format | fields search]",field,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","cloud_storage_search(1)","[| `cloud_domains` | search is_storage=true | rename domain as $field$ | fields $field$ | format | fields search]",field,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","datamodel(2)","datamodel $model$ $object$ search","model,object","Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","drop_dm_object_name(1)","rename ""$object$.*"" as *",object,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","get_signature(1)","(signature=""*$value$*"" OR signature_id=""*$value$*"")",value,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","get_src_user_only(1)","(src_user=""$src_user$"" OR src_user_identity=""$src_user$"")","src_user","Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","get_subject(2)","($subjectField$=""$bestmatch$"" OR $subjectField$_ip=""$bestmatch$"" OR $subjectField$_mac=""$bestmatch$"" OR $subjectField$_nt_host=""$bestmatch$"" OR $subjectField$_dns=""$bestmatch$"")","subjectField, bestmatch","Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","get_user(1)","(`get_src_user_only($user$)` OR `get_user_only($user$)`)",user,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","get_user_only(1)","(user=""$user$"" OR user_identity=""$user$"")",user,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","get_vendor_product","eval vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!=""unknown"" AND isnotnull(product) AND product!=""unknown"",vendor."" "".product,isnotnull(vendor) AND vendor!=""unknown"" AND (isnull(product) OR product=""unknown""),vendor."" unknown"",(isnull(vendor) OR vendor=""unknown"") AND isnotnull(product) AND product!=""unknown"",""unknown "".product,isnotnull(sourcetype),sourcetype,1=1,""unknown"")",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","make_subject(1)","eval ""$subjectField$""=case(isnotnull('$subjectField$'), '$subjectField$', isnotnull('$subjectField$_dns'), '$subjectField$_dns', isnotnull('$subjectField$_nt_host'), '$subjectField$_nt_host', isnotnull('$subjectField$_mac'), '$subjectField$_mac', isnotnull('$subjectField$_ip'), '$subjectField$_ip')",subjectField,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","modular_action_invocations(2)","tstats summariesonly=false latest(Modular_Actions.action_status) as action_status from datamodel=Splunk_Audit.Modular_Actions where Modular_Actions.action_name!=""unknown"" (Modular_Actions.sid=$sid$ Modular_Actions.rid=$rid$) OR (Modular_Actions.orig_sid=$sid$ Modular_Actions.orig_rid=$rid$) by _time,nodename,Modular_Actions.action_name,Modular_Actions.sid,Modular_Actions.rid,Modular_Actions.action_mode,Modular_Actions.user span=1s | `drop_dm_object_name(""Modular_Actions"")` | eventstats latest(action_status) as action_status by action_name,sid,rid | search nodename=""Modular_Actions.Modular_Action_Invocations"" | sort 0 -_time | join type=outer action_name [| rest splunk_server=local count=0 /services/alerts/alert_actions | spath input=param._cam path=drilldown_uri output=action_drilldown_uri | rename title as action_name,label as action_label | fields action_name,action_label,action_drilldown_uri] | eval action_label=if(isnotnull(action_label),action_label,action_name),epoch_time=_time | fields _time,epoch_time,action_status,action_name,action_label,action_mode,action_drilldown_uri,sid,rid,user","sid,rid","Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","recommended_datamodel_attributes(2)","datamodel ""$model$"" ""$object$"" | spath output=calcs path=calculations{} | spath output=fields path=fields{} | eval outfields=mvappend(fields,NULL,calcs) | mvexpand outfields | spath output=fields input=outfields path=outputFields{} | eval fields=if(isnull(fields),outfields,fields) | mvexpand fields | spath output=field input=fields path=fieldName | spath output=recommended input=fields path=comment.recommended | search recommended=""true"" | table field | sort field","model,object","Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","remap_subjects","tags outputfield=evtTags | `swap_if_tagged(src, dest, evtTags)` | fields - evtTags",,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","swap_if_tagged(3)","eval swapTmp='$second$' | eval ""$second$""=if('$tagField$'=""swap_$first$_$second$"", '$first$', '$second$') | eval ""$first$""=if('$tagField$'=""swap_$first$_$second$"", swapTmp, '$first$') | fields - swapTmp","first, second, tagField","Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","vendor_product_tracker(1)","inputlookup append=T cim_vendor_product_tracker | search model=""$model$""",model,"Splunk_SA_CIM",global,system,
ES,"PROD-ES-1|search_head","Init_All_MITRE_Rows(2)","append [| makeresults | eval $fieldname$=""Initial Access"", $countfield$=0 | fields - _time ] | append [| makeresults | eval $fieldname$=""Execution"", $countfield$=0 | fields - _time ] | append [| makeresults | eval $fieldname$=""Persistence"", $countfield$=0 | fields - _time ] | append [| makeresults | eval $fieldname$=""Privilege Escalation"", $countfield$=0 | fields - _time ] | append [| makeresults | eval $fieldname$=""Defense Evasion"", $countfield$=0 | fields - _time ] | append [| makeresults | eval $fieldname$=""Credential Access"", $countfield$=0 | fields - _time ] | append [| makeresults | eval $fieldname$=""Discovery"", $countfield$=0 | fields - _time ] | append [| makeresults | eval $fieldname$=""Lateral Movement"", $countfield$=0 | fields - _time ] | append [| makeresults | eval $fieldname$=""Collection"", $countfield$=0 | fields - _time ] | append [| makeresults | eval $fieldname$=""Command and Control"", $countfield$=0 | fields - _time ] | append [| makeresults | eval $fieldname$=""Exfiltration"", $countfield$=0 | fields - _time ] | append [| makeresults | eval $fieldname$=""Impact"", $countfield$=0 | fields - _time ]","fieldname,countfield","Splunk_Security_Essentials",app,system,
ES,"PROD-ES-1|search_head","Load_Sample_Log_Data(1)","inputlookup [| inputlookup SampleDataList | search label=""$label$"" | rename lookup as search | table search]",label,"Splunk_Security_Essentials",global,system,
ES,"PROD-ES-1|search_head","Sort_MITRE","fields ""Initial Access"" ""Execution"" ""Persistence"" ""Privilege Escalation"" ""Defense Evasion"" ""Credential Access"" ""Discovery"" ""Lateral Movement"" ""Collection"" ""Command and Control"" ""Exfiltration"" ""Impact""",,"Splunk_Security_Essentials",app,system,
ES,"PROD-ES-1|search_head","Sort_MITRE_Rows(1)","eval eventOrderTactic = case($fieldname$=""Initial Access"", 1, $fieldname$=""Execution"", 2, $fieldname$=""Persistence"", 3, $fieldname$=""Privilege Escalation"", 4, $fieldname$=""Defense Evasion"", 5, $fieldname$=""Credential Access"", 6, $fieldname$=""Discovery"", 7, $fieldname$=""Lateral Movement"", 8, $fieldname$=""Collection"", 9, $fieldname$=""Command and Control"", 10, $fieldname$=""Exfiltration"", 11, $fieldname$=""Impact"", 12, 1=1, 13) | sort eventOrderTactic | fields - eventOrderTactic",fieldname,"Splunk_Security_Essentials",app,system,
ES,"PROD-ES-1|search_head","User_to_Index_Provisioning_From_Data_Governance_App","rest splunk_server=local /services/authentication/users 
| eval roles=mvjoin(roles,"", "") 
| fields title, roles 
| rename title as username 
| makemv delim="", "" roles 
| mvexpand roles 
| rename roles as role 
| join max=1 overwrite=1 type=inner usetime=0 role 
    [| rest splunk_server=local /services/authorization/roles 
    | rename title as role 
    | fillnull value="""" 
    | fields role, srchIndexesAllowed] 
| fields username, srchIndexesAllowed 
| rex field=srchIndexesAllowed mode=sed ""s/\s/,/g"" 
| makemv delim="","" srchIndexesAllowed 
| mvcombine srchIndexesAllowed 
| mvcombine srchIndexesAllowed 
| rex field=srchIndexesAllowed mode=sed ""s/\s/,/g"" 
| makemv delim="","" srchIndexesAllowed 
| eventstats values(srchIndexesAllowed) AS didx by username 
| fields username, didx 
| mvcombine didx 
| rex field=didx mode=sed ""s/\s/, /g"" 
| rename didx as accessible_indexes 
| join max=1 overwrite=1 type=inner usetime=0 username 
    [| rest splunk_server=local /services/authentication/users 
    | eval roles=mvjoin(roles,"", "") 
    | rename title as username 
    | fields username, roles] 
| makemv delim="", "" accessible_indexes 
| mvexpand accessible_indexes 
| join max=1 overwrite=1 type=outer usetime=0 accessible_indexes 
    [| rest /services/data/indexes 
    | fields title 
    | dedup title 
    | where match(title,""^_\\w+$"") 
    | mvcombine title 
    | eval title=mvjoin(title,"", "") 
    | rename title as expanded_indexes 
    | eval accessible_indexes=""_*""] 
| join max=1 overwrite=1 type=outer usetime=0 accessible_indexes 
    [| rest /services/data/indexes 
    | fields title 
    | dedup title 
    | where match(title,""^[^_]+$"") 
    | mvcombine title 
    | eval title=mvjoin(title,"", "") 
    | rename title as expanded_indexes 
    | eval accessible_indexes=""*""] 
| eval accessible_indexes=if(match(accessible_indexes,""^(?:_\\*|\\*)$""),expanded_indexes,accessible_indexes) 
| fields - expanded_indexes 
| makemv delim="", "" accessible_indexes 
| mvexpand accessible_indexes",,"Splunk_Security_Essentials",app,admin,
ES,"PROD-ES-1|search_head","nix-netmon-hosts-search","eventtype=netstat | stats count by host | sort +host",,"Splunk_TA_nix",global,system,
ES,"PROD-ES-1|search_head","compute-ingestion-stats","eval temp=1/300.0, event_size=len(_raw) | eval event_size_temp=len(_raw)/300.0 | stats sparkline(sum(temp), 5m) as ""Events per second"", sparkline(sum(event_size_temp), 5m) as ""Event throughput (kbps)"", sum(event_size) as TotalBytes, sum(temp) as tempsum by sourcetype | eval ""Total MB""=round(TotalBytes/1024.0/1024.0,2) | addinfo | eval APS=tempsum/(info_max_time-info_min_time) | eval ""Average events per second""=round(APS*300.0,2) | fields sourcetype ""Events per second"" ""Event throughput (kbps)"" ""Average events per second"" ""Total MB""",,"Splunk_TA_windows",global,system,
ES,"PROD-ES-1|search_head","event-codes-search(3)","eventtype=wineventlog_windows LogName=""$LogName$"" SourceName=""$SourceName$"" TaskCategory=""$TaskCategory$"" | stats count by EventCode | sort +EventCode","LogName, SourceName, TaskCategory","Splunk_TA_windows",global,system,
ES,"PROD-ES-1|search_head","event-hosts-search","eventtype=wineventlog_windows | stats count by host | sort +host",,"Splunk_TA_windows",global,system,
ES,"PROD-ES-1|search_head","event-types-search(4)","eventtype=wineventlog_windows LogName=""$LogName$"" SourceName=""$SourceName$"" TaskCategory=""$TaskCategory$"" EventCode=""$EventCode$"" | stats count by Type | sort +Type","LogName, SourceName, TaskCategory, EventCode","Splunk_TA_windows",global,system,
ES,"PROD-ES-1|search_head","events-search(6)","eventtype=""wineventlog_windows"" source=""*inEventLog:$LogName$"" (host=""$EventHost$"" OR ComputerName=""$EventHost$"") TaskCategory=""$TaskCategory$"" SourceName=""$SourceName$"" EventCode=""$EventCode$"" Type=""$Type$""","LogName, EventHost, TaskCategory, SourceName, EventCode, Type","Splunk_TA_windows",global,system,
ES,"PROD-ES-1|search_head","log-names-search","eventtype=wineventlog_windows | stats count by LogName | sort +LogName",,"Splunk_TA_windows",global,system,
ES,"PROD-ES-1|search_head","netmon-hosts-search","eventtype=netmon_windows | stats count by host | sort +host",,"Splunk_TA_windows",global,system,
ES,"PROD-ES-1|search_head","source-names-search(1)","eventtype=wineventlog_windows LogName=""$LogName$"" | stats count by SourceName | sort +SourceName",LogName,"Splunk_TA_windows",global,system,
ES,"PROD-ES-1|search_head","task-categories-search(2)","eventtype=wineventlog_windows LogName=""$LogName$"" SourceName=""$SourceName$"" | stats count by TaskCategory | sort +TaskCategory","LogName, SourceName","Splunk_TA_windows",global,system,
ES,"PROD-ES-1|search_head","audit_rexsearch","rex ""search='(?<search>.*?)', autojoin""",,search,app,system,
ES,"PROD-ES-1|search_head","audit_searchlocal","`audit_searchlocal(""search_id!=rt_*"")`",,search,app,system,
ES,"PROD-ES-1|search_head","audit_searchlocal(1)","search index=_audit action=search (id=* OR search_id=*) | eval search_id = if(isnull(search_id), id, search_id) | replace '*' with * in search_id | search $filter$",filter,search,app,system,
ES,"PROD-ES-1|search_head","comment(1)","""""",text,search,app,system,
ES,"PROD-ES-1|search_head","histperc(3)","sort $le$
| eventstats max($hist_rate$) as total_hist_rate, last($le$) as uppermost_bound, count as num_buckets
| eval rank=exact($perc$)*total_hist_rate
| streamstats current=f last($le$) as gr, last($hist_rate$) as last_hist_rate
| eval gr=if(isnull(gr), 0, gr), last_hist_rate=if(isnull(last_hist_rate), 0, last_hist_rate)
| where $hist_rate$ >= rank
| head 1
| eval res=case(lower(uppermost_bound) != ""+inf"" or num_buckets < 2, ""NaN"", lower($le$) == ""+inf"", gr, gr == 0 and $le$ <= 0, $le$, true(), exact(gr + ($le$-gr)*(rank - last_hist_rate) / ($hist_rate$ - last_hist_rate)))
| fields res
| rename res as ""histperc""","perc, hist_rate, le",search,app,system,
ES,"PROD-ES-1|search_head","histperc(4)","sort $groupby$, $le$
| eventstats max($hist_rate$) as total_hist_rate, last($le$) as uppermost_bound, count as num_buckets by $groupby$
| eval rank=exact($perc$)*total_hist_rate
| streamstats current=f last($le$) as gr, last($hist_rate$) as last_hist_rate by $groupby$
| eval gr=if(isnull(gr), 0, gr), last_hist_rate=if(isnull(last_hist_rate), 0, last_hist_rate)
| where $hist_rate$ >= rank
| dedup $groupby$
| eval res=case(lower(uppermost_bound) != ""+inf"" or num_buckets < 2, ""NaN"", lower($le$) == ""+inf"", gr, gr == 0 and $le$ <= 0, $le$, true(), exact(gr + ($le$-gr)*(rank - last_hist_rate) / ($hist_rate$ - last_hist_rate)))
| fields $groupby$, res
| rename res as ""histperc""","perc, hist_rate, le, groupby",search,app,system,
ES,"PROD-ES-1|search_head","set_local_host","rest splunk_server=local /services/server/info | return host",,search,app,system,
ES,"PROD-ES-1|search_head","truncate_search","eval search=if(length(search) > 150, substr(search, 0, 150) + ""..."", search)",,search,app,system,
ES,"PROD-ES-1|search_head","instrumentation_distribution_strings(3)","""\""avg\"":""+`instrumentation_number_format($name$_avg,$multiplier$,$round_digits$)` + "","" + ""\""min\"":""+`instrumentation_number_format($name$_min,$multiplier$,$round_digits$)` + "","" + ""\""max\"":""+`instrumentation_number_format($name$_max,$multiplier$,$round_digits$)` + "","" + ""\""p10\"":""+`instrumentation_number_format($name$_p10,$multiplier$,$round_digits$)` + "","" + ""\""p20\"":""+`instrumentation_number_format($name$_p20,$multiplier$,$round_digits$)` + "","" + ""\""p30\"":""+`instrumentation_number_format($name$_p30,$multiplier$,$round_digits$)` + "","" + ""\""p40\"":""+`instrumentation_number_format($name$_p40,$multiplier$,$round_digits$)` + "","" + ""\""p50\"":""+`instrumentation_number_format($name$_p50,$multiplier$,$round_digits$)` + "","" + ""\""p60\"":""+`instrumentation_number_format($name$_p60,$multiplier$,$round_digits$)` + "","" + ""\""p70\"":""+`instrumentation_number_format($name$_p70,$multiplier$,$round_digits$)` + "","" + ""\""p80\"":""+`instrumentation_number_format($name$_p80,$multiplier$,$round_digits$)` + "","" + ""\""p90\"":""+`instrumentation_number_format($name$_p90,$multiplier$,$round_digits$)`","name,multiplier,round_digits","splunk_instrumentation",app,system,
ES,"PROD-ES-1|search_head","instrumentation_distribution_values(1)","avg($name$) as $name$_avg min($name$) as $name$_min max($name$) as $name$_max perc10($name$) as $name$_p10 perc20($name$) as $name$_p20 perc30($name$) as $name$_p30 perc40($name$) as $name$_p40 perc50($name$) as $name$_p50 perc60($name$) as $name$_p60 perc70($name$) as $name$_p70 perc80($name$) as $name$_p80 perc90($name$) as $name$_p90",name,"splunk_instrumentation",app,system,
ES,"PROD-ES-1|search_head","instrumentation_number_format(3)","tostring(coalesce(round($name$*$multiplier$,$round_digits$), ""null""))","name,multiplier,round_digits","splunk_instrumentation",app,system,
ES,"PROD-ES-1|search_head","dmc_audit_get_search_type","eval search_type = case( 
match(search_id, ""^SummaryDirector_""), ""summarization"", 
match(search_id, ""^((rt_)?scheduler__|alertsmanager_)""), ""scheduled"", 
match(search_id, ""\d{10}\.\d+(_[0-9A-F]{8}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{12})?$""), ""ad hoc"", 
true(), ""other"")",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_audit_get_searches(1)","`dmc_set_index_audit` host=$host$ action=search sourcetype=audittrail search_id!=""rsa_*"" 
| eval user = if(user=""n/a"", null(), user) 
| `dmc_audit_get_search_type` 
| eval search=if(isnull(savedsearch_name) OR savedsearch_name=="""", search, savedsearch_name)",host,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_audit_get_searches_for_groups(1)","`dmc_set_index_audit` search_group=dmc_group_search_head search_group=$search_group$ action=search sourcetype=audittrail search_id!=""rsa_*"" 
| eval user = if(user=""n/a"", null(), user) 
| `dmc_audit_get_search_type` 
| eval search=if(isnull(savedsearch_name) OR savedsearch_name=="""", search, savedsearch_name)","search_group","splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_audit_searchlocal(1)","search `dmc_set_index_audit` action=search (id=* OR search_id=*) | eval search_id = if(isnull(search_id), id, search_id) | replace '*' with * in search_id | search $filter$",filter,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_background_flush_rangemap","rangemap field=percent ""0-10%""=0-10 ""10-50%""=10.001-50 ""50-100%""=50.001-100 default=abnormal",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_build_forwarder_assets(1)","`dmc_get_forwarder_tcpin` 
| stats values(fwdType) as forwarder_type, latest(version) as version, values(arch) as arch, values(os) as os, max(_time) as last_connected, sum(kb) as new_sum_kb, sparkline(avg(tcp_KBps), $sparkline_span$) as new_avg_tcp_kbps_sparkline, avg(tcp_KBps) as new_avg_tcp_kbps, avg(tcp_eps) as new_avg_tcp_eps by guid, hostname","sparkline_span","splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_classify_processes","eval process_class = case(    
    process==""splunk-optimize"",""index service"",    
    process==""sh"" OR process==""ksh"" OR process==""bash"" OR like(process,""python%"") OR process==""powershell"",""scripted input"",    
    process==""mongod"", ""KVStore"") 
| eval process_class = case(    
    process==""splunkd"" AND (like(args,""-p %start%"") OR like(args,""service"") OR like(args,""%_internal_launch_under_systemd%"")),""splunkd server"",    
    process==""splunkd"" AND isnotnull(sid),""search"",    
    process==""splunkd"" AND (like(args,""fsck%"") OR like(args,""recover-metadata%"") OR like(args,""cluster_thing"")),""index service"",    
    process==""splunkd"" AND args==""instrument-resource-usage"", ""scripted input"",
    (like(process,""python%"") AND like(args,""%/appserver/mrsparkle/root.py%"")) OR like(process,""splunkweb""),""Splunk Web"",    
    isnotnull(process_class), process_class)    
| eval process_class = if(isnull(process_class),""other"",process_class)",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_collection_interval","collection_interval = 10",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_convert_count_unit(1)","case( 
$x$ >= 1000000000000, round($x$ / 1000000000000, 2).""T"", 
$x$ >= 1000000000, round($x$ / 1000000000, 2).""B"", 
$x$ >= 1000000, round($x$ / 1000000, 2).""M"", 
$x$ >= 1000, round($x$ / 1000, 2).""K"", 
true(), $x$ 
)",x,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_convert_disk_usage_unit(1)","case( 
$x$ > 1000000, round($x$ / 1024 / 1024, 2)."" TB"" 
$x$ > 1000, round($x$ / 1024, 2)."" GB"" 
1 == 1, $x$."" MB"" 
)",x,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_convert_runtime(1)","case( 
round($runtime$ / (3600*24) - 0.5) > 0, round($runtime$ / (3600*24) - 0.5).""d "".round(($runtime$ % (3600*24)) / 3600 - 0.5).""h "".round(($runtime$ % 3600) / 60 - 0.5).""min "".round($runtime$ % 60, 2).""s"", 
round(($runtime$ % (3600*24)) / 3600 - 0.5) > 0, round(($runtime$ % (3600*24)) / 3600 - 0.5).""h "".round(($runtime$ % 3600) / 60 - 0.5).""min "".round($runtime$ % 60, 2).""s"", 
round(($runtime$ % 3600) / 60 - 0.5) > 0, round(($runtime$ % 3600) / 60 - 0.5).""min "".round($runtime$ % 60, 2).""s"", 
1 = 1, round($runtime$ % 60, 2).""s"" 
)",runtime,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_cpu_usage_rangemap","rangemap field=cpu_usage ""0-60%""=0-60 ""60-80%""=60.001-80 ""80-100%""=80.001-100 ""100%+""=100.001-999999 default=abnormal",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_cpu_usage_rangemap_and_timechart","`dmc_cpu_usage_rangemap` 
| `dmc_timechart` partial=f dc(server) as server_count by range 
| fields _time, ""100%+"", ""80-100%"", ""60-80%"", ""0-60%""",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_daily_license_usage_quota","rest `dmc_dmc_group_license_master` /services/licenser/pools 
| join type=outer stack_id splunk_server [rest `dmc_dmc_group_license_master` /services/licenser/groups | search is_active=1 | eval stack_id=stack_ids | fields splunk_server stack_id is_active] 
| search is_active=1 
| fields splunk_server, stack_id, used_bytes 
| join type=outer stack_id splunk_server [rest `dmc_dmc_group_license_master` /services/licenser/stacks | eval stack_id=title | eval stack_quota=quota | fields splunk_server stack_id stack_quota] 
| stats sum(used_bytes) as used_bytes max(stack_quota) as stack_quota by splunk_server 
| eval usedGB=round(used_bytes/1024/1024/1024,3) 
| eval totalGB=round(stack_quota/1024/1024/1024,3) 
| eval percentage=round(usedGB / totalGB, 3)*100 
| fields splunk_server, percentage, usedGB, totalGB",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_disk_usage_rangemap","rangemap field=pct_disk_usage ""0-60%""=0-0.6 ""60-80%""=0.6001-0.8 ""80-100%""=0.8001-1 default=abnormal",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_disk_usage_rangemap_and_timechart","`dmc_disk_usage_rangemap` 
| `dmc_timechart_for_disk_usage` partial=f dc(server_mount_point) as server_mount_point_count by range 
| fields _time, ""80-100%"", ""60-80%"", ""0-60%""",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_dmc_group_license_master","splunk_server_group=dmc_group_license_master",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_drilldown_indexing_performance_deployment_indexing_rate(2)","`dmc_set_index_internal` source=*metrics.log* sourcetype=splunkd search_group=dmc_group_indexer search_group=$group$ group=thruput name=index_thruput 
| stats sum(kb) AS total_kb by host 
| addinfo 
| eval time_window = info_max_time - info_min_time 
| eval kbps = round(total_kb / time_window, 0) 
| `dmc_indexing_rate_rangemap` 
| where range=""$metric$"" 
| `dmc_drilldown_join_peers_by_peerURI` 
| eval Action = Action."" dmc_group_indexer"" 
| fields serverName, machine, kbps, range, numberOfCores, ram, version, Action
| eval kbps = kbps."" KB/s"" 
| rename serverName as Instance, machine as Machine, kbps as ""Indexing Rate"", range as ""Indexing Rate Range"", version as Version, numberOfCores as Cores, ram as RAM","group, metric","splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_drilldown_indexing_performance_deployment_queue_fill_ratio(4)","`dmc_set_index_internal` source=*metrics.log sourcetype=splunkd search_group=dmc_group_indexer search_group=$group$ group=queue name=$queueType$ 
| eval max=if(isnotnull(max_size_kb),max_size_kb,max_size) 
| eval curr=if(isnotnull(current_size_kb),current_size_kb,current_size) 
| eval fill_perc=round((curr/max)*100,2) 
| stats $funcQueue$(fill_perc) AS fill_percentage by host 
| `dmc_queue_fill_ratio_rangemap` 
| where range=""$metric$"" 
| `dmc_drilldown_join_peers_by_peerURI` 
| eval Action = Action."" dmc_group_indexer"" 
| fields serverName, machine, fill_percentage, range, numberOfCores, ram, version, Action 
| rename serverName as Instance, machine as Machine, fill_percentage as ""Fill Ratio (%)"", range as ""Fill Ratio Range"", version as Version, numberOfCores as Cores, ram as RAM","group, queueType, funcQueue, metric","splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_drilldown_join_peers_by_peerURI","lookup dmc_assets host OUTPUT peerURI, serverName, machine 
| eval peerURI = mvindex(peerURI, 0) 
| eval machine = mvindex(machine, 0) 
| eval serverName = mvindex(serverName, 0) 
| join type=outer peerURI 
 [| rest splunk_server=local /services/search/distributed/peers 
  | rename title as peerURI 
  | append  
    [| rest splunk_server=local /services/server/info 
     | eval peerURI = ""localhost"" 
    ] 
  | eval ram = round(physicalMemoryMB / 1024, 2)."" GB"" 
  | fields peerURI, version, numberOfCores, ram 
 ] 
| eval Action = serverName 
| fields - _time",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_drilldown_kv_store_deployment_background_flush(2)","`dmc_set_index_introspection` search_group=$group$ search_group=dmc_group_kv_store component=kvstoreserverstats 
| stats range(data.backgroundFlushing.total_ms)  AS diff by  host 
| addinfo 
| eval time_window = info_max_time - info_min_time 
| eval ms_per_min = diff / (time_window / 60) 
| eval percent = round(ms_per_min / (60 * 1000) * 100, 2) 
| `dmc_background_flush_rangemap` 
| where range=""$metric$"" 
| `dmc_drilldown_join_peers_by_peerURI` 
| eval Action = Action."" dmc_group_kv_store"" 
| fields serverName, machine, percent, range, numberOfCores, ram, version, Action 
| rename serverName as Instance, machine as Machine, percent as ""Background Flush (%)"", range as ""Background Flush Range"", version as Version, numberOfCores as Cores, ram as RAM","group, metric","splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_drilldown_kv_store_deployment_lock_percentage(3)","`dmc_set_index_introspection` search_group=dmc_group_kv_store  search_group=$group$ component=kvstoreserverstats 
| stats range(data.globalLock.lockTime) AS globalLock range(data.globalLock.totalTime) AS total by host  
| eval percent=abs(globalLock*100/total)   
| stats $countLockFunc$(percent) as percent_locked by host 
| rangemap field=percent_locked ""0-30%""=0-30 ""30-50%""=30.001-50 ""50-100%""=50.001-1000 default=abnormal  
| where range=""$metric$"" 
| `dmc_drilldown_join_peers_by_peerURI` 
| eval Action = Action."" dmc_group_kv_store"" 
| fields serverName, machine, percent_locked, range, numberOfCores, ram, version, Action 
| rename serverName as Instance, machine as Machine, percent_locked as ""Lock (%)"", range as ""Lock Percentage Range"", version as Version, numberOfCores as Cores, ram as RAM","group, countLockFunc, metric","splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_drilldown_kv_store_deployment_memory_ratio(2)","`dmc_set_index_introspection` search_group=$group$ search_group=dmc_group_kv_store component=kvstoreserverstats 
| eval ratio='data.mem.virtual'/'data.mem.mappedWithJournal' 
| stats avg(ratio) AS myratio by host  
| eval myratio = round(myratio, 2) 
| rangemap field=myratio ""0-2x""=0-2 ""2-3x""=2.001-3 "">3x""=3.001-10000 default=abnormal 
| where range=""$metric$"" 
| `dmc_drilldown_join_peers_by_peerURI` 
| eval Action = Action."" dmc_group_kv_store"" 
| fields serverName, machine, myratio, range, numberOfCores, ram, version, Action 
| rename serverName as Instance, machine as Machine, myratio as ""Virtual to Mapped Ratio"", range as ""Ratio Range"", version as Version, numberOfCores as Cores, ram as RAM","group, metric","splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_drilldown_kv_store_deployment_network(1)","`dmc_set_index_introspection` search_group=dmc_group_kv_store search_group=$group$ component=kvstoreserverstats 
| stats range(data.network.bytesIn) as indiff range(data.network.bytesOut) as outdiff range(data.network.numRequests) as Requests by host 
| eval ""MB In""=indiff/1000000 
| eval ""MB Out""=outdiff/1000000 
| `dmc_drilldown_join_peers_by_peerURI` 
| eval Action = Action."" dmc_group_kv_store"" 
| table serverName, machine, ""MB In"", ""MB Out"", Requests, numberOfCores, ram, version, Action 
| rename serverName as Instance, machine as Machine, version as Version, numberOfCores as Cores, ram as RAM",group,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_drilldown_kv_store_deployment_page_faults(3)","`dmc_set_index_introspection` search_group=dmc_group_kv_store search_group=$group$ component=kvstoreserverstats  
| rename data.opcounters.command as c, data.opcounters.update as u, data.opcounters.queries as q, data.opcountes.deletes as d, data.opcounters.getmore as g, data.opcounters.inserts as i 
| eval commands=if(isNotNull('c'), 'c',0) 
| eval updates=if(isNotNull('u'), 'u', 0) 
| eval queries=if(isNotNull('q'), 'q', 0) 
| eval deletes=if(isNotNull('d'), 'd', 0) 
| eval getmores=if(isNotNull('g'), 'g', 0) 
| eval inserts=if(isNotNull('i'), 'i', 0) 
| eval totalops=commands+updates+queries+deletes+getmores+inserts 
| bin _time minspan=30s 
| stats latest(totalops) AS ops latest(data.extra_info.page_faults) AS pf by host _time 
| eval  percent=if(opsdiff==0, 0, round(abs(pf/ops), 2))   
| stats $countPageFaultsFunc$(percent) as percent by host  
| rangemap field=percent ""0-0.7""=0-0.7 ""0.7-1.3""=0.7001-1.3 ""1.3+""=1.3001-999999 default=abnormal  
| where range=""$metric$"" 
| `dmc_drilldown_join_peers_by_peerURI` 
| eval Action = Action."" dmc_group_kv_store"" 
| fields serverName, machine, percent, range, numberOfCores, ram, version, Action 
| rename serverName as Instance, machine as Machine, percent as ""Page Faults per Operation"", range as ""Page Fault Range"", version as Version, numberOfCores as Cores, ram as RAM","group, countPageFaultsFunc, metric","splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_drilldown_kv_store_deployment_replication_lag(2)","`dmc_set_index_introspection` search_group=$group$ search_group=dmc_group_kv_store component=kvstorereplicasetstats  data.replSetStats.myState!=1 
| stats max(data.oplogInfo.end) AS local, max(data.replSetStats.myState) AS state, max(data.replSetStats.date) AS date by host 
| eval date = date/1000 
| `dmc_time_format(date)` 
| join 
  [ search `dmc_set_index_introspection` search_group=dmc_group_kv_store component=kvstorereplicasetstats data.replSetStats.myState=1 
  | stats max(data.oplogInfo.end) AS primary] 
| eval lag=(primary-local)/1000 
| eval lag = round(lag, 2) 
| `dmc_replication_lag_rangemap` 
| where range=""$metric$"" 
| rename host as Instance, lag as Lag, range as ""Lag Range"", state as State, date as ""Oplog Date"" 
| table Instance Lag ""Oplog Date"" ""Lag Range"" State","group, metric","splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_drilldown_kv_store_primary_oplog_window(1)","`dmc_set_index_introspection` search_group=$group$ search_group=dmc_group_kv_store component=kvstorereplicasetstats data.replSetStats.myState=1 
| eval Instance=host 
| rename data.oplogInfo.start as start, data.oplogInfo.end as end 
| eval start = start/1000 
| eval end = end/1000 
| eval diff= (end-start)/3600 
| `dmc_time_format(start)` 
| `dmc_time_format(end)` 
| stats first(start) as ""Start Date"" first(end) as ""End Date"" first(diff) as ""Window (Hours)"" by Instance",group,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_drilldown_resource_usage_deployment_cpu_usage(4)","`dmc_set_index_introspection` search_group=$role$ search_group=$group$ sourcetype=splunk_resource_usage component=Hostwide 
| eval total_cpu_usage = 'data.cpu_system_pct' + 'data.cpu_user_pct' 
| stats $countCPUFunc$(total_cpu_usage) as cpu_usage by host 
| `dmc_cpu_usage_rangemap` 
| where range=""$metric$"" 
| `dmc_drilldown_join_peers_by_peerURI` 
| eval Action = Action."" $role$"" 
| fields serverName, machine, cpu_usage, range, numberOfCores, ram, version, Action 
| eval cpu_usage = cpu_usage."" %"" 
| rename serverName as Instance, machine as Machine, cpu_usage as ""CPU Usage"", range as ""CPU Usage Range"", version as Version, numberOfCores as Cores, ram as RAM","role, group, countCPUFunc, metric","splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_drilldown_resource_usage_deployment_disk_usage(4)","`dmc_set_index_introspection` search_group=$role$ search_group=$group$ sourcetype=splunk_disk_objects component=Partitions 
| eval mount_point = 'data.mount_point' 
| eval free = if(isnotnull('data.available'), 'data.available', 'data.free') 
| eval pct_disk_usage = round(1 - free / 'data.capacity', 2) 
| eval server_mount_point = host."":"".mount_point 
| stats $countDiskFunc$(pct_disk_usage) as pct_disk_usage by server_mount_point 
| `dmc_disk_usage_rangemap` 
| where range=""$metric$"" 
| eval host = replace(server_mount_point, "":.*"", """") 
| eval mount_point = replace(server_mount_point, "".*:"", """") 
| eval pct_disk_usage = pct_disk_usage * 100 
| `dmc_drilldown_join_peers_by_peerURI` 
| eval Action = Action."" $role$"" 
| fields serverName, machine, mount_point, pct_disk_usage, range, numberOfCores, ram, version, Action 
| rename serverName as Instance, machine as Machine, mount_point as ""Mount Point"", pct_disk_usage as ""Disk Usage (%)"", range as ""Disk Usage Range"", version as Version, numberOfCores as Cores, ram as RAM","role, group, countDiskFunc, metric","splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_drilldown_resource_usage_deployment_load_average(4)","`dmc_set_index_introspection` search_group=$role$ search_group=$group$ sourcetype=splunk_resource_usage component=Hostwide 
| stats $countLoadAvgFunc$(data.normalized_load_avg_1min) as load_average by host 
| `dmc_load_average_rangemap` 
| where range=""$metric$"" 
| `dmc_drilldown_join_peers_by_peerURI` 
| eval Action = Action."" $role$"" 
| fields serverName, machine, load_average, range, numberOfCores, ram, version, Action 
| rename serverName as Instance, machine as Machine, load_average as ""Load Average"", range as ""Load Average Range"", version as Version, numberOfCores as Cores, ram as RAM","role, group, countLoadAvgFunc, metric","splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_drilldown_resource_usage_deployment_memory_usage(4)","`dmc_set_index_introspection` search_group=$role$ search_group=$group$ sourcetype=splunk_resource_usage component=Hostwide 
| eval pct_mem_used = 'data.mem_used' / 'data.mem' 
| stats $countMemFunc$(pct_mem_used) as pct_mem_used by host 
| `dmc_memory_usage_rangemap` 
| where range=""$metric$"" 
| `dmc_drilldown_join_peers_by_peerURI` 
| eval Action = Action."" $role$"" 
| fields serverName, machine, pct_mem_used, range, numberOfCores, ram, version, Action 
| eval pct_mem_used = round(pct_mem_used * 100, 2) 
| eval pct_mem_used = pct_mem_used."" %"" 
| rename serverName as Instance, machine as Machine, pct_mem_used as ""Memory Usage"", range as ""Memory Usage Range"", version as Version, numberOfCores as Cores, ram as RAM","role, group, countMemFunc, metric","splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_drilldown_search_activity_deployment_resource_usage(5)","`dmc_set_index_introspection` search_group=$role$ search_group=$group$ sourcetype=splunk_resource_usage ((component=PerProcess data.search_props.sid::*) OR component=Hostwide) 
| `dmc_rename_introspection_fields` 
| eval sid = if(component==""Hostwide"", ""n/a"", sid) 
| eval pid = if(component==""Hostwide"", ""n/a"", pid) 
| eval pct_cpu = if(component==""Hostwide"", 0, pct_cpu) 
| eval mem_used = if(component==""Hostwide"", 0, 'mem_used) 
| `dmc_set_bin` 
| stats latest($resourceType$) AS resource_usage_dedup values(Action) as Action by _time, sid, pid, host 
| stats sum(resource_usage_dedup) AS sum_resource_usage values(Action) as Action by _time, host 
| stats $resourceFunction$(sum_resource_usage) as resource_usage values(Action) as Action by host 
| `dmc_$resourceType$_rangemap` 
| where range == ""$metric$"" 
| `dmc_drilldown_join_peers_by_peerURI` 
| eval Action = Action."" $role$"" 
| fields serverName, machine, resource_usage, range, numberOfCores, ram, version, Action 
| rename serverName as Instance, machine as Machine, resource_usage as ""$resourceType$ Usage"", range as ""$resourceType$ Usage Range"", version as Version, numberOfCores as Cores, ram as RAM","role, group, resourceType, resourceFunction, metric","splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_drilldown_search_activity_deployment_search_concurrency(4)","`dmc_set_index_introspection` search_group=$role$ search_group=$group$ sourcetype=splunk_resource_usage ((component=PerProcess data.search_props.sid::*) OR component=Hostwide) 
| `dmc_rename_introspection_fields` 
| `dmc_set_bin` 
| stats dc(sid) AS distinct_search_count values(Action) as Action by host, _time 
| stats $searchFunction$(distinct_search_count) as search_count values(Action) as Action by host 
| `dmc_search_count_rangemap` 
| where range=""$metric$"" 
| `dmc_drilldown_join_peers_by_peerURI` 
| eval Action = Action."" $role$"" 
| fields serverName, machine, search_count, range, numberOfCores, ram, version, Action 
| rename serverName as Instance, machine as Machine, search_count as ""Count of Searches"", range as ""Count of Searches Range"", version as Version, numberOfCores as Cores, ram as RAM","role, group, searchFunction, metric","splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_event_local_search_dispatch","`dmc_set_index_audit` sourcetype=audittrail action=search search=*",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_event_remote_search_dispatch","`dmc_set_index_internal` sourcetype=splunkd_remote_searches ""Streamed search search starting""",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_exclude_indexes","eval _dmc_title = if(isnotnull(title), title, 'data.name')
| where NOT (_dmc_title == ""history"" OR _dmc_title == ""_thefishbucket"" OR _dmc_title == ""_blocksignature"")
| fields - _dmc_title",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_exclude_volumes","eval _dmc_volume = if(isnotnull(title), title, 'data.name') 
| where NOT _dmc_volume == ""_splunk_summaries"" 
| fields - _dmc_volume",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_get_all_triggered_alerts(1)","rest splunk_server=local /servicesNS/-/splunk_monitoring_console/alerts/fired_alerts/- 
| rename savedsearch_name as title 
| join type=outer title [|rest splunk_server=local /servicesNS/-/splunk_monitoring_console/saved/searches ] 
| rename title as ""Alert Name"" 
| join type=outer sid [rest splunk_server=local /servicesNS/nobody/splunk_monitoring_console/search/jobs/] 
| eval now=relative_time(now(),""-$minute_offset$m"") 
| where trigger_time > now 
| rename trigger_time AS ""_time"", description as ""Description"", sid AS Instance 
| convert timeformat=""%b. %d, %Y %l:%M %p"" ctime(_time) AS ""Time Triggered"" 
| fields - _time 
| fields ""Alert Name"", Instance, ""Time Triggered"", ""Description""","minute_offset","splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_get_core_info","eval core_info = if(isnull(numberOfCores), ""N/A"", numberOfCores)."" / "".if(isnull(numberOfVirtualCores), ""N/A"", numberOfVirtualCores)",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_get_distsearch_group_servers(1)","rest splunk_server=local /services/search/distributed/groups 
| fields title member 
| search title=""dmc_group_$group_name$"" 
| eval title=replace(title, ""^dmc_group_"", """") 
| eval servers=mvjoin(member,"","") 
| fields title servers","group_name","splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_get_forwarder_info","inputlookup dmc_forwarder_assets",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_get_forwarder_tcpin","`dmc_set_index_internal` sourcetype=splunkd group=tcpin_connections (connectionType=cooked OR connectionType=cookedSSL) fwdType=* guid=*",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_get_groups","inputlookup dmc_assets 
| fields search_group 
| dedup search_group 
| search search_group=""dmc_*"" 
| `dmc_set_group_label_and_sort(search_group)`",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_get_groups_containing_role(1)","inputlookup dmc_assets 
| mvcombine search_group 
| search search_group=""$role$"" 
| mvexpand search_group 
| fields search_group 
| dedup search_group 
| `dmc_set_group_label_and_sort(search_group)`",role,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_get_indexer_cluster_groups","inputlookup dmc_assets 
| fields search_group 
| dedup search_group 
| search search_group=""dmc_indexerclustergroup_*"" 
| eval label = replace(search_group, ""dmc_indexerclustergroup_"", """")",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_get_instance_info(1)","inputlookup dmc_assets | mvcombine search_group | search search_group=$group$",group,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_get_instance_roles","inputlookup dmc_assets 
| mvcombine search_group 
| eval role = search_group 
| mvexpand role 
| eval role = if(like(role, ""dmc_group_%""), role, """") 
| eval role = replace(role, ""^dmc_group_"", """") 
| mvcombine role",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_get_instances_on_a_machine(1)","`dmc_get_instance_info(*)` 
| where machine = ""$machine$"" 
| dedup serverName",machine,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_get_last_hour_resource_usage_from_sid(2)","`dmc_set_index_introspection` host=$host$ sourcetype=splunk_resource_usage component=PerProcess data.search_props.sid=""$sid$"" earliest=-1h 
| `dmc_set_bin` 
| `dmc_rename_introspection_fields` 
| stats latest(pct_cpu) AS pct_cpu_dedup latest(mem_used) AS mem_used_dedup by _time, pid 
| stats sum(pct_cpu_dedup) AS pct_cpu_sum sum(mem_used_dedup) AS mem_used_sum by _time 
| timechart span=10s latest(pct_cpu_sum) AS pct_cpu latest(mem_used_sum) AS mem_used","host, sid","splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_get_local_instance_asset","`dmc_get_local_instance_asset_computed_groups` 
| join type=outer peerURI [ 
| rest splunk_server=local /services/search/distributed/groups 
| fields title member 
| where isnotnull(mvfind(member, ""localhost:localhost"")) 
| eval peerURI=""localhost"" 
| rename title AS search_groups 
| fields peerURI search_groups 
| mvcombine delim="" "" search_groups] 
| makemv delim="" "" search_groups 
| eval search_groups = if(isnotnull(search_groups),search_groups,computed_search_groups) 
| fields - computed_search_groups 
| mvexpand search_groups",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_get_local_instance_asset_computed_groups","rest splunk_server=local /services/server/info 
| eval peerURI=""localhost"" 
| eval server_roles=""indexer,search_head,license_master,kv_store"" 
| makemv delim="","" server_roles 
| mvexpand server_roles 
| eval computed_search_groups=""dmc_group_"".server_roles 
| stats first(peerURI) AS peerURI first(host) AS host first(host_fqdn) AS machine values(computed_search_groups) AS computed_search_groups by serverName",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_get_local_instance_asset_in_distributed_mode","`dmc_get_local_instance_asset_computed_groups` 
| join type=inner peerURI [ 
| rest splunk_server=local /services/search/distributed/groups 
| fields title member 
| where isnotnull(mvfind(member, ""localhost:localhost"")) 
| eval peerURI=""localhost"" 
| rename title AS search_groups 
| fields peerURI search_groups 
| mvcombine delim="" "" search_groups] 
| makemv delim="" "" search_groups 
| eval search_groups = if(isnotnull(search_groups),search_groups,computed_search_groups) 
| fields - computed_search_groups 
| mvexpand search_groups",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_get_machine_info","`dmc_get_instance_info(*)` 
| stats first(host) as host first(serverName) as serverName by machine",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_get_port_from_splunktcp_stanza(1)","| rex field=$stanza_name$ ""splunktcp(-ssl)?:(\/{1,2})?(([0-9]{1,3}\.){3}[0-9]{1,3})?(:)?(?<port>\d+)"" 
| eval port = if(match($stanza_name$, ""splunktcp-ssl""), port."" (SSL)"", port) 
| eval port = if(isnotnull(port), port, null)","stanza_name","splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_get_recently_triggered_alerts","rest splunk_server=local /servicesNS/-/splunk_monitoring_console/saved/searches 
|rename title as savedsearch_name 
| fields savedsearch_name, triggered_alert_count, description 
| where triggered_alert_count > 0 
| join type=outer savedsearch_name[|rest splunk_server=local /servicesNS/-/splunk_monitoring_console/alerts/fired_alerts/- 
| cluster field=savedsearch_name] 
| join type=outer sid [rest splunk_server=local /servicesNS/nobody/splunk_monitoring_console/search/jobs/] 
| rename savedsearch_name AS ""Alert Name"", triggered_alert_count AS ""Trigger Count"", published AS ""Last time triggered"", description as ""Description"" | fields ""Alert Name"" , ""Trigger Count"", ""Last time triggered"", ""Description"", sid",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_get_search_head_cluster_groups","inputlookup dmc_assets 
| fields search_group 
| dedup search_group 
| search search_group=""dmc_searchheadclustergroup_*"" 
| eval label = replace(search_group, ""dmc_searchheadclustergroup_"", """")",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_get_warnings_and_errors(2)","`dmc_set_index_internal` search_group=$search_group$ sourcetype=splunkd component=$component$  (log_level=WARN OR log_level=ERROR)","search_group, component","splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_indexing_rate_rangemap","rangemap field=kbps ""0-50 KB/s""=0-50 ""50-100 KB/s""=50.001-100 ""100-500 KB/s""=100.001-500 ""500 KB/s - 1 MB/s""=500.001-1024 ""1-2.5 MB/s""=1024.001-2560 ""2.5-5 MB/s""=2560.001-5120 ""5-10 MB/s""=5120.001-10240 ""10+ MB/s""=10240.001-999999 default=""NULL""",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_indexing_rate_rangemap_and_timechart","`dmc_indexing_rate_rangemap` 
| timechart minspan=30s partial=f dc(host) AS instance_count by range 
| fields _time ""10+ MB/s"" ""5-10 MB/s"" ""2.5-5 MB/s"" ""1-2.5 MB/s"" ""500 KB/s - 1 MB/s"" ""100-500 KB/s"" ""50-100 KB/s"" ""0-50 KB/s""",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_instances_view_default_search(1)","inputlookup dmc_assets 
| mvcombine search_group 
| rex max_match=0 field=search_group ""dmc_indexerclustergroup_(?<indexer_cluster>.*)"" 
| rex max_match=0 field=search_group ""dmc_searchheadclustergroup_(?<search_head_cluster>.*)"" 
| mvexpand search_group 
| search search_group = $group$ 
| mvcombine search_group 
| join type=outer peerURI 
  [| rest splunk_server=local /services/search/distributed/peers 
   | rename title as peerURI ] 
| join type=outer peerURI 
  [| rest splunk_server=local /services/server/info 
   | eval peerURI = ""localhost"" 
   | eval status = ""Up""] 
| join peerURI 
  [| `dmc_get_instance_roles` ] 
| eval status = if(status == ""Up"", status, ""Unreachable"") 
| eval Action = serverName."" "".role 
| eval OS = os_name 
| eval ram = round(physicalMemoryMB / 1024, 2)."" GB"" 
| `dmc_get_core_info` 
| fields serverName, machine, role, indexer_cluster, search_head_cluster, OS, core_info, ram, version, status, Action 
| sort status, serverName 
| rename serverName as Instance, machine as Machine, role as Role, indexer_cluster as ""Indexer Cluster"", search_head_cluster as ""Search Head Cluster"", core_info as ""CPU Cores (Physical / Virtual)"", ram as RAM, version as Version, status as Status",group,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_iostats_rangemap(1)","rangemap field=$fieldname$ ""0-60%""=0-60 ""60-80%""=60.0001-80, ""80-100%""=80.0001-100 default=abnormal",fieldname,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_licensing_base_summary(2)","`dmc_set_index_internal` host=$host$ source=*license_usage.log* type=""RolloverSummary"" earliest=-30d@d $pool_clause$","host, pool_clause","splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_licensing_base_usage(2)","`dmc_set_index_internal` source=*license_usage.log* type=""Usage"" | eval h=if(len(h)=0 OR isnull(h),""(SQUASHED)"",h) | eval s=if(len(s)=0 OR isnull(s),""(SQUASHED)"",s) | eval idx=if(len(idx)=0 OR isnull(idx),""(UNKNOWN)"",idx) | bin _time span=1d | stats sum(b) as b by _time, host, pool, s, st, h, idx | search host=$host$ $pool_clause$","host, pool_clause","splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_licensing_pool_size_srch(2)","join type=outer _time [search `dmc_set_index_internal` host=$host$ source=*license_usage.log* type=""RolloverSummary"" earliest=-30d@d $pool_clause$ | eval _time=_time - 43200 | bin _time span=1d | stats latest(poolsz) AS  ""pool size"" by _time] | fields - _timediff","host, pool_clause","splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_licensing_stack_size_srch(2)","join type=outer _time [search `dmc_set_index_internal` host=$host$ source=*license_usage.log* type=""RolloverSummary"" earliest=-30d@d | eval _time=_time - 43200 | bin _time span=1d | dedup _time stack | stats sum(stacksz) AS ""stack size"" by _time] | fields - _timediff","host, pool_clause","splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_licensing_summary_maxavg_indxr(3)","eval _time=_time - 43200 | bin _time span=1d | stats latest(b) AS b by slave, pool, _time | eval slave_guid=slave | stats sum(b) AS volume by slave_guid, _time | stats avg(volume) AS avgVolume max(volume) AS maxVolume by slave_guid | join type=outer slave_guid [rest splunk_server=$splunk_server$ /services/licenser/slaves | rename label AS slave_name title AS slave_guid | table slave_guid slave_name] | eval slave_name = if(isnotnull(slave_name),slave_name,""GUID: "".slave_guid) | foreach *Volume [eval <<FIELD>>=round('<<FIELD>>'/1024/1024/1024, 3)] |  rename slave_name as ""Indexer"" avgVolume AS ""average"" maxVolume AS ""peak"" | sort 5 - ""average"" | fields ""Indexer"", ""average"", ""peak"" | fields - _timediff, slave_guid","splunk_server, split_by_field_name, split_by_label","splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_licensing_summary_maxavg_no_split(3)","eval _time=_time - 43200 | bin _time span=1d | stats latest(b) AS b by slave, pool, _time | stats sum(b) AS volume by _time | stats avg(volume) AS avgVolume max(volume) AS maxVolume  | eval maxVolumeGB=round(maxVolume/1024/1024/1024,3) | eval avgVolumeGB=round(avgVolume/1024/1024/1024,3) | rename avgVolumeGB AS ""average"" maxVolumeGB AS ""peak"" | eval ""All Pools"" = """" | fields ""All Pools"", ""average"", ""peak""","splunk_server, split_by_field_name, split_by_label","splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_licensing_summary_maxavg_pool(3)","eval _time=_time - 43200 | bin _time span=1d | stats latest(b) AS b by slave, pool, _time | stats sum(b) AS volume by pool, _time  | stats avg(volume) AS avgVolume max(volume) AS maxVolume by pool | eval maxVolumeGB=round(maxVolume/1024/1024/1024,3) | eval avgVolumeGB=round(avgVolume/1024/1024/1024,3) | rename avgVolumeGB AS ""average"" maxVolumeGB AS ""peak"" pool as ""Pool"" | fields ""Pool"", ""average"", ""peak"" | sort 5 - ""average""","splunk_server, split_by_field_name, split_by_label","splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_licensing_summery_indxr(5)","eval _time=_time - 43200 | bin _time span=1d | stats latest(b) AS b by slave, pool, _time | eval slave_guid=slave | stats max(b) AS volume by slave_guid, _time | join type=outer slave_guid [rest splunk_server=$splunk_server$ /services/licenser/slaves | rename label AS slave_name title AS slave_guid | table slave_guid slave_name] | eval slave_name = if(isnotnull(slave_name),slave_name,""GUID: "".slave_guid) | timechart span=1d max(volume) AS ""volume"" by slave_name fixedrange=false | `$size_search$($host$, ""$pool_clause$"")` | foreach * [eval <<FIELD>>=round('<<FIELD>>'/1024/1024/1024, 3)]","splunk_server, size_search, host, pool_clause, split_by_field_name","splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_licensing_summery_no_split(5)","eval _time=_time - 43200 | bin _time span=1d | stats latest(b) AS b by slave, pool, _time | timechart span=1d sum(b) AS ""volume"" fixedrange=false | `$size_search$($host$, ""$pool_clause$"")` | foreach * [eval <<FIELD>>=round('<<FIELD>>'/1024/1024/1024, 3)]","splunk_server, size_search, host, pool_clause, split_by_field_name","splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_licensing_summery_pct_indxr(4)","eval _time=_time - 43200 | bin _time span=1d | stats latest(b) AS b latest($sz_clause$) AS $sz_clause$ by slave, pool, _time | stats sum(b) AS volumeB max($sz_clause$) AS $sz_clause$ by slave, _time | eval pctused=round(volumeB/$sz_clause$*100,2) | eval slave_guid=slave | join type=outer slave_guid [rest splunk_server=$splunk_server$ /services/licenser/slaves | rename label AS slave_name title AS slave_guid | table slave_guid slave_name] | eval slave_name = if(isnotnull(slave_name),slave_name,""GUID: "".slave_guid) | timechart span=1d max(pctused) AS ""used"" by slave_name fixedrange=false","splunk_server, sz_clause, host, split_by_field_name","splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_licensing_summery_pct_no_split(4)","eval _time=_time - 43200 | bin _time span=1d | stats latest(b) AS b latest($sz_clause$) AS $sz_clause$ by slave, pool, _time | stats sum(b) AS volumeB max($sz_clause$) AS $sz_clause$ by _time | eval pctused=round(volumeB/$sz_clause$*100,2) | timechart span=1d max(pctused) AS ""used"" fixedrange=false","splunk_server, sz_clause, host, split_by_field_name","splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_licensing_summery_pct_pool(4)","eval _time=_time - 43200 | bin _time span=1d | stats latest(b) AS b latest($sz_clause$) AS $sz_clause$ by slave, pool, _time | stats sum(b) AS volumeB max($sz_clause$) AS $sz_clause$ by pool, _time | eval pctused=round(volumeB/$sz_clause$*100,2) | timechart span=1d max(pctused) AS ""used"" by pool fixedrange=false","splunk_server, sz_clause, host, split_by_field_name","splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_licensing_summery_pool(5)","eval _time=_time - 43200 | bin _time span=1d | stats latest(b) AS b by slave, pool, _time | timechart span=1d sum(b) AS ""volume"" by pool fixedrange=false | `$size_search$($host$, ""$pool_clause$"")` | foreach * [eval <<FIELD>>=round('<<FIELD>>'/1024/1024/1024, 3)]","splunk_server, size_search, host, pool_clause, split_by_field_name","splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_licensing_usage_all(5)","timechart span=1d sum(b) AS volumeB by $split_by_field_name$ fixedrange=false | `$size_search$($host$, ""$pool_clause$"")` | foreach * [eval <<FIELD>>=round('<<FIELD>>'/1024/1024/1024, 3)]","splunk_server, size_search, host, split_by_field_name, pool_clause","splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_licensing_usage_maxavg_all(3)","stats sum(b) AS volume by $split_by_field_name$, _time | stats avg(volume) AS avgVolume max(volume) AS maxVolume by $split_by_field_name$ | eval avgVolumeGB=round(avgVolume/1024/1024/1024,3) | eval maxVolumeGB=round(maxVolume/1024/1024/1024,3) | fields $split_by_field_name$, avgVolumeGB, maxVolumeGB | rename avgVolumeGB AS ""average"" maxVolumeGB AS ""peak"" $split_by_field_name$ AS ""$split_by_label$"" | sort 5 - ""average""","splunk_server, split_by_field_name, split_by_label","splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_licensing_usage_pct_all(4)","join _time pool type=outer [search `dmc_set_index_internal` host=$host$ source=*license_usage.log* type=""RolloverSummary"" earliest=-30d@d | eval _time=_time - 43200 | bin _time span=1d | stats latest($sz_clause$) AS $sz_clause$ by slave, pool, _time | stats max($sz_clause$) AS $sz_clause$ by pool, _time] | stats sum(b) AS bytes_used max($sz_clause$) AS $sz_clause$ by $split_by_field_name$, _time | timechart span=1d max(eval(round(bytes_used/$sz_clause$*100,2))) by $split_by_field_name$ fixedrange=false","splunk_server, sz_clause, host, split_by_field_name","splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_load_average_rangemap","rangemap field=load_average ""0-20""=0-20 ""20-50""=20.001-50 ""50+""=50.001-999999 default=abnormal",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_load_average_rangemap_and_timechart","`dmc_load_average_rangemap` 
| `dmc_timechart` partial=f dc(server) as server_count by range 
| fields _time, ""50+"", ""20-50"", ""0-20""",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_match_all_scheduled_search_types","((data.search_props.type=""datamodel acceleration"" OR search_props.type=""datamodel acceleration"") OR (data.search_props.type=""report acceleration"" OR search_props.type=""report acceleration"") OR (data.search_props.type=""scheduled"" OR search_props.type=""scheduled"") OR (data.search_props.type=""summary indexing"" OR search_props.type=""summary indexing""))",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_mem_used_rangemap","rangemap field=resource_usage 
""0GB""=0-0 
""<1GB""=0.01-1024 
""1-2GB""=1024.001-2048 
""2-3GB""=2048.001-3072 
""3-4GB""=3072.001-4096 
""4-5GB""=4096.001-5120 
""5-10GB""=5120.001-10240 
""10-15GB""=10240.001-15360 
""15-20GB""=15360.001-20480 
""20-30GB""=20480.001-30720 
""30GB+""=30720.001-999999 
default=""0GB"" 
| eval resource_usage = round(resource_usage / 1024, 3)",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_mem_used_rangemap_and_timechart","`dmc_mem_used_rangemap` 
| `dmc_timechart` partial=f dc(host) AS host_count by range 
| fields _time, ""30GB+"" ""20-30GB"" ""15-20GB"" ""5-10GB"" ""4-5GB"" ""3-4GB"" ""2-3GB"" ""1-2GB"" ""<1GB"" ""0GB""",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_memory_usage_rangemap","rangemap field=pct_mem_used ""0-60%""=0-0.6 ""60-80%""=0.6001-0.8 ""80-100%""=0.8001-1 default=abnormal",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_memory_usage_rangemap_and_timechart","`dmc_memory_usage_rangemap` 
| `dmc_timechart` partial=f dc(server) as server_count by range 
| fields _time, ""80-100%"", ""60-80%"", ""0-60%""",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_pct_cpu_rangemap","rangemap field=resource_usage 
""0 cores""=0-0.009 
""0.01-1 cores""=0.01-1 
""1-2 cores""=1.01-2 
""2-3 cores""=2.01-3 
""3-4 cores""=3.01-4 
""4-5 cores""=4.01-5 
""5-10 cores""=5.01-10 
""10-15 cores""=10.01-15 
""15-20 cores""=15.01-20 
""20-25 cores""=20.01-25 
""25-30 cores""=25.01-30 
""30+ cores""=30.01-999 
""negative""=-99999--0.001 
default=""0 cores""",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_pct_cpu_rangemap_and_timechart","`dmc_pct_cpu_rangemap` 
| `dmc_timechart` partial=f dc(host) AS host_count by range 
| fields _time, ""30+ cores"" ""25-30 cores"" ""20-25 cores"" ""15-20 cores"" ""10-15 cores"" ""5-10 cores"" ""4-5 cores"" ""3-4 cores"" ""2-3 cores"" ""1-2 cores"" ""0.01-1 cores"" ""0 cores""",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_queue_fill_ratio_rangemap","rangemap field=fill_percentage ""0-60%""=0-60 ""60-80%""=60.01-80 ""80-100%""=80.01-100",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_queue_fill_ratio_rangemap_and_timechart","`dmc_queue_fill_ratio_rangemap` 
| timechart partial=f dc(host) by range 
| fields _time ""80-100%"" ""60-80%"" ""0-60%""",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_rangemap_cpu_system_pct","rangemap field=cpu_system_pct #53A051=0-59.999 #F1813F=60-79.999 default=#DC4E41",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_rangemap_default_cpu_system_pct","rangemap field=cpu_system_pct #53A051=0-59.999 #F1813F=60-79.999 default=#DC4E41",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_rangemap_default_indexing_rate","rangemap field=average_KBps #CEE4EE=0-99.999 #6BAECA=100-999.999 #0877A6=1000-4999 #005E86=5000-9999 default=#004664",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_rangemap_default_mem_used","rangemap field=mem_used #53A051=0-59.999 #F1813F=60-79.999 default=#DC4E41",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_rangemap_default_search_concurrency","rangemap field=search_concurrency #CEE4EE=0-5.999 #6BAECA=6-10.999 #0877A6=11-20.999 default=#005E86",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_rangemap_default_up_down_status","rangemap field=up_down_status #DC4E41=0-0.999 default=#53A051",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_rangemap_indexing_rate","rangemap field=average_KBps #CEE4EE=0-99.999 #6BAECA=100-999.999 #0877A6=1000-4999 #005E86=5000-9999 default=#004664",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_rangemap_mem_used","rangemap field=mem_used #53A051=0-59.999 #F1813F=60-79.999 default=#DC4E41",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_rangemap_search_concurrency","rangemap field=search_concurrency #CEE4EE=0-5.999 #6BAECA=6-10.999 #0877A6=11-20.999 default=#005E86",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_rangemap_up_down_status","rangemap field=up_down_status #DC4E41=0-0.999 default=#53A051",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_re_build_forwarder_assets(1)","`dmc_build_forwarder_assets($sparkline_span$)` 
| rename new_sum_kb as sum_kb, new_avg_tcp_kbps_sparkline as avg_tcp_kbps_sparkline, new_avg_tcp_kbps as avg_tcp_kbps, new_avg_tcp_eps as avg_tcp_eps 
| eval avg_tcp_kbps_sparkline = ""N/A"" 
| addinfo 
| eval status = if(isnull(sum_kb) or (sum_kb <= 0) or (last_connected < (info_max_time - 900)), ""missing"", ""active"") 
| eval sum_kb = round(sum_kb, 2) 
| eval avg_tcp_kbps = round(avg_tcp_kbps, 2) 
| eval avg_tcp_eps = round(avg_tcp_eps, 2) 
| fields guid, hostname, forwarder_type, version, arch, os, status, last_connected, sum_kb, avg_tcp_kbps_sparkline, avg_tcp_kbps, avg_tcp_eps 
| outputlookup dmc_forwarder_assets","sparkline_span","splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_re_build_forwarder_assets_light(1)","`dmc_build_forwarder_assets($sparkline_span$)` 
| rename new_sum_kb as sum_kb, new_avg_tcp_kbps_sparkline as avg_tcp_kbps_sparkline, new_avg_tcp_kbps as avg_tcp_kbps, new_avg_tcp_eps as avg_tcp_eps 
| eval avg_tcp_kbps_sparkline = ""N/A"" 
| addinfo 
| eval status = if(isnull(sum_kb) or (sum_kb <= 0) or (last_connected < (relative_time(now(),""-15m""))), ""missing"", ""active"") 
| eval sum_kb = round(sum_kb, 2) 
| eval avg_tcp_kbps = round(avg_tcp_kbps, 2) 
| eval avg_tcp_eps = round(avg_tcp_eps, 2) 
| fields guid, hostname, forwarder_type, version, arch, os, status, last_connected, sum_kb, avg_tcp_kbps_sparkline, avg_tcp_kbps, avg_tcp_eps 
| outputlookup dmc_forwarder_assets","sparkline_span","splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_rename_forwarder_type(1)","eval $type$ = case($type$ == ""full"", ""Heavy Forwarder"", $type$ == ""uf"", ""Universal Forwarder"", $type$ == ""lwf"", ""Light Forwarder"", 1==1, $type$)",type,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_rename_introspection_fields","eval process = 'data.process' 
| eval args = 'data.args' 
| eval pid = 'data.pid' 
| eval ppid = 'data.ppid' 
| eval elapsed = 'data.elapsed' 
| eval mem_used = 'data.mem_used' 
| eval mem = 'data.mem' 
| eval pct_memory = 'data.pct_memory' 
| eval pct_cpu = 'data.pct_cpu' 
| eval sid = 'data.search_props.sid' 
| eval app = 'data.search_props.app' 
| eval label = 'data.search_props.label' 
| eval type = 'data.search_props.type' 
| eval mode = 'data.search_props.mode' 
| eval user = 'data.search_props.user' 
| eval role = 'data.search_props.role' 
| eval label = if(isnotnull('data.search_props.label'), 'data.search_props.label', """") 
| eval provenance = if(isnotnull('data.search_props.provenance'), 'data.search_props.provenance', ""unknown"") 
| eval search_head = case(isnotnull('data.search_props.search_head') AND 'data.search_props.role' == ""peer"", 'data.search_props.search_head', isnull('data.search_props.search_head') AND 'data.search_props.role' == ""head"", ""_self"", isnull('data.search_props.search_head') AND 'data.search_props.role' == ""peer"", ""_unknown"") 
| eval workload_pool = if(isnotnull('data.workload_pool'), 'data.workload_pool', ""UNDEFINED"")",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_replication_lag_rangemap","rangemap field=lag ""0-10s""=0-10 ""10-30s""=10.001-30 "">30s""=30.001-10000000 default=abnormal",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_resource_usage_by_processes_timechart(2)","`dmc_set_bin` 
| `dmc_rename_introspection_fields` 
| stats latest($resource_type$) AS resource_usage_dedup latest(process_class) AS process_class by pid, _time 
| stats sum(resource_usage_dedup) AS resource_usage by _time, process_class 
| timechart minspan=10s $function$(resource_usage) AS ""Resource Usage"" by process_class","resource_type, function","splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_resource_usage_instance_drilldown(1)","`dmc_set_index_introspection` sourcetype=splunk_resource_usage component=PerProcess host=$host$ 
| `dmc_rename_introspection_fields` 
| `dmc_classify_processes` 
| eval args = if(isnotnull(sid),""search --id="".sid."" (...)"", args) 
| eval cmd = process."" "".args 
| stats latest(pid) as ""PID"", latest(ppid) as ""PPID"", latest(label) as Label, latest(provenance) as Provenance, latest(search_head) as ""Search Head"", latest(type) as Type, latest(user) as User, latest(app) as App, latest(mode) as Mode, latest(role) as Role, avg(pct_cpu) as avg_pct_cpu, max(mem_used) as ""Physical Memory Usage (MB)"", min(_time) as min_time, max(_time) as max_time, max(elapsed) as ""Elapsed Time"" by cmd 
| eval avg_pct_cpu = round(avg_pct_cpu, 2) 
| `dmc_time_format(min_time)` 
| `dmc_time_format(max_time)` 
| rename avg_pct_cpu as ""Average CPU Usage (%)"", min_time as ""First Time Seen"", max_time as ""Last Time Seen""",host,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_scheduler_instance_search_concurrency_drilldown(3)","`dmc_set_index_introspection` host=$host$ sourcetype=splunk_resource_usage component=PerProcess data.search_props.sid::* `dmc_match_all_scheduled_search_types` 
| `dmc_rename_introspection_fields` 
| where $concurrencySplitBy$==""$type$"" 
| stats latest(pid) as ""PID"", latest(ppid) as ""PPID"", latest(label) as Label, latest(provenance) as Provenance, latest(search_head) as ""Search Head"", latest(type) as Type, latest(user) as User, latest(app) as App, latest(mode) as Mode, latest(role) as Role, avg(pct_cpu) as avg_pct_cpu, max(mem_used) as ""Physical Memory Usage (MB)"", min(_time) as min_time, max(_time) as max_time, max(elapsed) as ""Elapsed Time"" by sid 
| eval avg_pct_cpu = round(avg_pct_cpu, 2) 
| `dmc_time_format(min_time)` 
| `dmc_time_format(max_time)` 
| rename avg_pct_cpu as ""Average CPU Usage (%)"", min_time as ""First Time Seen"", max_time as ""Last Time Seen""","host, concurrencySplitBy, type","splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_search_activity_instance_drilldown(3)","`dmc_set_index_introspection` host=$host$ sourcetype=splunk_resource_usage component=PerProcess data.search_props.sid::* 
| `dmc_rename_introspection_fields` 
| where $concurrencySplitBy$==""$type$"" 
| stats latest(pid) as ""PID"", latest(ppid) as ""PPID"", latest(label) as Label, latest(provenance) AS Provenance, latest(search_head) as ""Search Head"", latest(type) as Type, latest(user) as User, latest(app) as App, latest(mode) as Mode, latest(role) as Role, avg(pct_cpu) as avg_pct_cpu, max(mem_used) as ""Physical Memory Usage (MB)"", min(_time) as min_time, max(_time) as max_time, max(elapsed) as ""Elapsed Time"" by sid 
| eval avg_pct_cpu = round(avg_pct_cpu, 2) 
| `dmc_time_format(min_time)` 
| `dmc_time_format(max_time)` 
| rename avg_pct_cpu as ""Average CPU Usage (%)"", min_time as ""First Time Seen"", max_time as ""Last Time Seen""","host, concurrencySplitBy, type","splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_search_count_rangemap","rangemap field=search_count ""0""=0-0 ""1-5""=1-5 ""6-10""=6-10 ""11-15""=11-15 ""16-20""=16-20 ""21-30""=21-30 ""31-40""=31-40 ""41-50""=41-50 ""51-75""=51-75 ""76-100""=76-100 ""101+""=101-99999",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_search_count_rangemap_and_timechart","`dmc_search_count_rangemap` 
| `dmc_timechart` dc(host) AS count_host by range 
| fields _time ""101+"" ""76-100"" ""51-75"" ""41-50"" ""31-40"" ""21-30"" ""16-20"" ""11-15"" ""6-10"" ""1-5"" ""0""",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_set_bin","bin _time span=10s",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_set_bin_for_disk_usage","bin _time span=10min",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_set_bin_for_iostats","bin _time minspan=1min",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_set_bin_for_metrics_log","bin _time minspan=30s",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_set_bin_for_timechart","bin _time minspan=10s",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_set_bin_for_timechart_for_disk_usage","bin _time minspan=10min",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_set_group_label_and_sort(1)","eval label = replace($search_group$, ""^dmc_\w*group_"", """") 
| eval label = case( 
    $search_group$ == ""dmc_group_indexer"", ""Indexer"", 
    $search_group$ == ""dmc_group_search_head"", ""Search Head"", 
    $search_group$ == ""dmc_group_cluster_master"", ""Cluster Master"", 
    $search_group$ == ""dmc_group_license_master"", ""License Master"", 
    $search_group$ == ""dmc_group_deployment_server"", ""Deployment Server"", 
    $search_group$ == ""dmc_group_kv_store"", ""KV Store"", 
    $search_group$ == ""dmc_group_shc_deployer"", ""SHC Deployer"", 
    like($search_group$, ""dmc_customgroup_%""), label.""  (custom)"", 
    like($search_group$, ""dmc_indexerclustergroup_%""), label."" (Indexer Cluster)"", 
    like($search_group$, ""dmc_searchheadclustergroup_%""), label."" (Search Head Cluster)"", 
    1 == 1, label."" (Unrecognized)"") 
| eval order = case( 
    like($search_group$, ""dmc_group_%""), 100, 
    like($search_group$, ""dmc_customgroup_%""), 200, 
    like($search_group$, ""dmc_indexerclustergroup_%""), 300, 
    like($search_group$, ""dmc_searchheadclustergroup_%""), 400, 
    1 == 1, ""500"") 
| sort order, $search_group$ 
| fields - order","search_group","splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_set_index_audit","index=_audit",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_set_index_internal","index=_internal",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_set_index_introspection","index=_introspection",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_tcp_forwarder_count_split_by(2)","`dmc_get_forwarder_tcpin` search_group=dmc_group_indexer search_group=$group$ 
| `dmc_timechart_for_metrics_log` dc(guid) as forwarder_count by $field$ 
| rename forwarder_count as ""Forwarder Count""","field, group","splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_tcp_throughput_split_by(2)","`dmc_get_forwarder_tcpin` search_group=dmc_group_indexer search_group=$group$ 
| `dmc_timechart_for_metrics_log` per_second(kb) as avg_tcp_KBps by $field$ 
| rename avg_tcp_KBps as ""KB/s""","field, group","splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_time_format(1)","eval $time$ = strftime($time$, ""%m/%d/%Y %H:%M:%S %z"")",time,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_timechart","timechart minspan=10s",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_timechart_for_disk_usage","timechart minspan=10min",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_timechart_for_iostats","timechart minspan=60s partial=f",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_timechart_for_metrics_log","timechart minspan=30s",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","dmc_timechart_for_metrics_reaper_and_heartbeat","timechart minspan=300s",,"splunk_monitoring_console",app,system,
ES,"PROD-ES-1|search_head","time_modifier(1)","tostring(relative_time(time(), ""$time_modifier$""))","time_modifier","splunk_monitoring_console",app,system,
GMC,"PROD-GMC-1|search_head","default_index","index=tutorial_data",,SplunkJSApp,app,admin,
GMC,"PROD-GMC-1|search_head","add_dm_object_name(1)","rename * as ""$object$.*""",object,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cam_action_modes","inputlookup append=T cam_action_mode_lookup | eval action_mode=lower(action_mode) | dedup action_mode | sort + action_mode",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cam_action_statuses","inputlookup append=T cam_action_status_lookup | eval action_status=lower(action_status) | dedup action_status | sort + action_status",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cam_categories","inputlookup append=T cam_category_lookup | dedup category | sort + category",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cam_subjects","inputlookup append=T cam_subject_lookup | eval subject=lower(subject) | dedup subject | sort + subject",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cam_tasks","inputlookup append=T cam_task_lookup | eval task=lower(task) | dedup task | sort + task",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cam_workers","inputlookup append=T cam_worker_lookup | append[| makeresults | eval worker_set=""local"",cam_workers=""[\""local\""]""] | dedup worker_set | spath input=cam_workers | where isnotnull('{}') | table worker_set,cam_workers | sort + worker_set",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_Alerts_indexes","()",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_Application_State_indexes","()",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_Authentication_indexes","()",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_Certificates_indexes","()",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_Change_Analysis_indexes","()",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_Change_indexes","()",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_Compute_Inventory_indexes","()",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_DLP_indexes","()",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_Databases_indexes","()",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_Email_indexes","()",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_Endpoint_indexes","()",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_Event_Signatures_indexes","()",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_Interprocess_Messaging_indexes","()",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_Intrusion_Detection_indexes","()",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_JVM_indexes","()",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_Malware_indexes","()",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_Network_Resolution_indexes","()",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_Network_Sessions_indexes","()",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_Network_Traffic_indexes","()",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_Performance_indexes","()",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_Ticket_Management_indexes","()",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_Updates_indexes","()",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_Vulnerabilities_indexes","()",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_Web_indexes","()",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_access_actions","inputlookup append=T cim_access_action_lookup | eval action=lower(action) | dedup action",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_corporate_email_domain_search(1)","[| `cim_corporate_email_domains` | rename domain as $field$ | format | fields search]",field,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_corporate_email_domains","inputlookup append=T cim_corporate_email_domain_lookup",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_corporate_web_domain_search(1)","[| `cim_corporate_web_domains` | rename domain as $field$ | format | fields search]",field,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_corporate_web_domains","inputlookup append=T cim_corporate_web_domain_lookup",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_datamodelinfo","rest /services/admin/summarization by_tstats=t splunk_server=local count=0 | eval key=replace('title',""tstats:DM_"".'eai:acl.app'.""_"",""""),datamodel=replace('summary.id',""DM_"".'eai:acl.app'.""_"","""") | join type=left key [| rest /services/data/models splunk_server=local count=0 | table title acceleration.cron_schedule eai:digest | rename title as key | rename acceleration.cron_schedule AS cron] | table datamodel eai:acl.app summary.access_time summary.is_inprogress summary.size summary.latest_time summary.complete summary.buckets_size summary.buckets cron summary.last_error summary.time_range summary.id summary.mod_time eai:digest summary.earliest_time summary.last_sid summary.access_count | rename summary.id AS summary_id, summary.time_range AS retention, summary.earliest_time as earliest, summary.latest_time as latest, eai:digest as digest | rename summary.* AS *, eai:acl.* AS * | sort datamodel",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_dlp_actions","inputlookup append=T cim_dlp_action_lookup | eval action=lower(action) | dedup action | sort + action",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_dlp_object_categories","inputlookup append=T cim_dlp_object_category_lookup | eval object_category=lower(object_category) | dedup object_category | sort + object_category",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_dlp_types","inputlookup append=T cim_dlp_type_lookup | eval dlp_type=lower(dlp_type) | dedup dlp_type | sort + dlp_type",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_dns_reply_codes","inputlookup append=T cim_dns_reply_code_lookup | dedup reply_code | sort + reply_code",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_email_protocols","inputlookup append=T cim_email_protocol_lookup | sort + protocol",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_endpoint_actions","inputlookup append=T cim_endpoint_action_lookup | eval action=lower(action) | dedup action | sort + action",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_endpoint_object_categories","inputlookup append=T cim_endpoint_object_category_lookup | eval object_category=lower(object_category) | dedup object_category | sort + object_category",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_endpoint_severities","inputlookup append=T cim_endpoint_severity_lookup | eval severity=lower(severity) | dedup severity",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_endpoint_statuses","inputlookup append=T cim_endpoint_status_lookup | eval status=lower(status) | dedup status | sort + status",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_endpoint_user_types","inputlookup append=T cim_endpoint_user_type_lookup | eval user_type=lower(user_type) | dedup user_type | sort + user_type",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_filter_known_scanners","NOT (host_category=""known_scanner"" OR orig_host_category=""known_scanner"" OR dvc_category=""known_scanner"" OR src_category=""known_scanner"" OR dest_category=""known_scanner"")",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_filter_known_scanners(1)","NOT ($object$.host_category=""known_scanner"" OR $object$.orig_host_category=""known_scanner"" OR $object$.dvc_category=""known_scanner"" OR $object$.src_category=""known_scanner"" OR $object$.dest_category=""known_scanner"")",object,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_filter_unknown_values(1)","($field$!=""-"" $field$!=""n/a"" $field$!=""unknown"")",field,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_filter_vuln_severity","(severity!=""informational"" AND severity!=""low"")",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_filter_vuln_severity(1)","($object$.severity!=""informational"" AND $object$.severity!=""low"")",object,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_http_methods","inputlookup append=T cim_http_method_lookup | eval http_method=lower(http_method) | dedup http_method",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_http_statuses","inputlookup append=T cim_http_status_lookup",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_ids_severities","inputlookup append=T cim_ids_severity_lookup | eval severity=lower(severity) | dedup severity",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_ids_types","inputlookup append=T cim_ids_type_lookup | eval ids_type=lower(ids_type) | dedup ids_type | sort + ids_type",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_malware_actions","inputlookup append=T cim_malware_action_lookup | eval action=lower(action) | dedup action | sort + action",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_traffic_actions","inputlookup append=T cim_traffic_action_lookup | eval action=lower(action) | dedup action | sort + action",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_transport_protocols","inputlookup append=T cim_transport_protocol_lookup | eval transport=lower(transport) | dedup transport | sort + transport",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_update_statii","inputlookup append=T cim_update_status_lookup | eval status=lower(status) | dedup status | sort + status",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_vendor_product_tracker","inputlookup append=T cim_vendor_product_tracker",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cim_vuln_severities","inputlookup append=T cim_vuln_severity_lookup | eval severity=lower(severity) | dedup severity",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cloud_domain_search(1)","[| `cloud_domains` | rename domain as $field$ | fields $field$ | format | fields search]",field,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cloud_domains","inputlookup append=T cim_cloud_domain_lookup",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cloud_email_search(1)","[| `cloud_domains` | search is_email=true | rename domain as $field$ | fields $field$ | format | fields search]",field,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","cloud_storage_search(1)","[| `cloud_domains` | search is_storage=true | rename domain as $field$ | fields $field$ | format | fields search]",field,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","datamodel(2)","datamodel $model$ $object$ search","model,object","Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","drop_dm_object_name(1)","rename ""$object$.*"" as *",object,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","get_signature(1)","(signature=""*$value$*"" OR signature_id=""*$value$*"")",value,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","get_src_user_only(1)","(src_user=""$src_user$"" OR src_user_identity=""$src_user$"")","src_user","Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","get_subject(2)","($subjectField$=""$bestmatch$"" OR $subjectField$_ip=""$bestmatch$"" OR $subjectField$_mac=""$bestmatch$"" OR $subjectField$_nt_host=""$bestmatch$"" OR $subjectField$_dns=""$bestmatch$"")","subjectField, bestmatch","Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","get_user(1)","(`get_src_user_only($user$)` OR `get_user_only($user$)`)",user,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","get_user_only(1)","(user=""$user$"" OR user_identity=""$user$"")",user,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","get_vendor_product","eval vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!=""unknown"" AND isnotnull(product) AND product!=""unknown"",vendor."" "".product,isnotnull(vendor) AND vendor!=""unknown"" AND (isnull(product) OR product=""unknown""),vendor."" unknown"",(isnull(vendor) OR vendor=""unknown"") AND isnotnull(product) AND product!=""unknown"",""unknown "".product,isnotnull(sourcetype),sourcetype,1=1,""unknown"")",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","make_subject(1)","eval ""$subjectField$""=case(isnotnull('$subjectField$'), '$subjectField$', isnotnull('$subjectField$_dns'), '$subjectField$_dns', isnotnull('$subjectField$_nt_host'), '$subjectField$_nt_host', isnotnull('$subjectField$_mac'), '$subjectField$_mac', isnotnull('$subjectField$_ip'), '$subjectField$_ip')",subjectField,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","modular_action_invocations(2)","tstats summariesonly=false latest(Modular_Actions.action_status) as action_status from datamodel=Splunk_Audit.Modular_Actions where Modular_Actions.action_name!=""unknown"" (Modular_Actions.sid=$sid$ Modular_Actions.rid=$rid$) OR (Modular_Actions.orig_sid=$sid$ Modular_Actions.orig_rid=$rid$) by _time,nodename,Modular_Actions.action_name,Modular_Actions.sid,Modular_Actions.rid,Modular_Actions.action_mode,Modular_Actions.user span=1s | `drop_dm_object_name(""Modular_Actions"")` | eventstats latest(action_status) as action_status by action_name,sid,rid | search nodename=""Modular_Actions.Modular_Action_Invocations"" | sort 0 -_time | join type=outer action_name [| rest splunk_server=local count=0 /services/alerts/alert_actions | spath input=param._cam path=drilldown_uri output=action_drilldown_uri | rename title as action_name,label as action_label | fields action_name,action_label,action_drilldown_uri] | eval action_label=if(isnotnull(action_label),action_label,action_name),epoch_time=_time | fields _time,epoch_time,action_status,action_name,action_label,action_mode,action_drilldown_uri,sid,rid,user","sid,rid","Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","recommended_datamodel_attributes(2)","datamodel ""$model$"" ""$object$"" | spath output=calcs path=calculations{} | spath output=fields path=fields{} | eval outfields=mvappend(fields,NULL,calcs) | mvexpand outfields | spath output=fields input=outfields path=outputFields{} | eval fields=if(isnull(fields),outfields,fields) | mvexpand fields | spath output=field input=fields path=fieldName | spath output=recommended input=fields path=comment.recommended | search recommended=""true"" | table field | sort field","model,object","Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","remap_subjects","tags outputfield=evtTags | `swap_if_tagged(src, dest, evtTags)` | fields - evtTags",,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","swap_if_tagged(3)","eval swapTmp='$second$' | eval ""$second$""=if('$tagField$'=""swap_$first$_$second$"", '$first$', '$second$') | eval ""$first$""=if('$tagField$'=""swap_$first$_$second$"", swapTmp, '$first$') | fields - swapTmp","first, second, tagField","Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","vendor_product_tracker(1)","inputlookup append=T cim_vendor_product_tracker | search model=""$model$""",model,"Splunk_SA_CIM",global,system,
GMC,"PROD-GMC-1|search_head","nix-netmon-hosts-search","eventtype=netstat | stats count by host | sort +host",,"Splunk_TA_nix",global,system,
GMC,"PROD-GMC-1|search_head","audit_rexsearch","rex ""search='(?<search>.*?)', autojoin""",,search,app,system,
GMC,"PROD-GMC-1|search_head","audit_searchlocal","`audit_searchlocal(""search_id!=rt_*"")`",,search,app,system,
GMC,"PROD-GMC-1|search_head","audit_searchlocal(1)","search index=_audit action=search (id=* OR search_id=*) | eval search_id = if(isnull(search_id), id, search_id) | replace '*' with * in search_id | search $filter$",filter,search,app,system,
GMC,"PROD-GMC-1|search_head","comment(1)","""""",text,search,global,system,
GMC,"PROD-GMC-1|search_head","histperc(3)","sort $le$
| eventstats max($hist_rate$) as total_hist_rate, last($le$) as uppermost_bound, count as num_buckets
| eval rank=exact($perc$)*total_hist_rate
| streamstats current=f last($le$) as gr, last($hist_rate$) as last_hist_rate
| eval gr=if(isnull(gr), 0, gr), last_hist_rate=if(isnull(last_hist_rate), 0, last_hist_rate)
| where $hist_rate$ >= rank
| head 1
| eval res=case(lower(uppermost_bound) != ""+inf"" or num_buckets < 2, ""NaN"", lower($le$) == ""+inf"", gr, gr == 0 and $le$ <= 0, $le$, true(), exact(gr + ($le$-gr)*(rank - last_hist_rate) / ($hist_rate$ - last_hist_rate)))
| fields res
| rename res as ""histperc""","perc, hist_rate, le",search,app,system,
GMC,"PROD-GMC-1|search_head","histperc(4)","sort $groupby$, $le$
| eventstats max($hist_rate$) as total_hist_rate, last($le$) as uppermost_bound, count as num_buckets by $groupby$
| eval rank=exact($perc$)*total_hist_rate
| streamstats current=f last($le$) as gr, last($hist_rate$) as last_hist_rate by $groupby$
| eval gr=if(isnull(gr), 0, gr), last_hist_rate=if(isnull(last_hist_rate), 0, last_hist_rate)
| where $hist_rate$ >= rank
| dedup $groupby$
| eval res=case(lower(uppermost_bound) != ""+inf"" or num_buckets < 2, ""NaN"", lower($le$) == ""+inf"", gr, gr == 0 and $le$ <= 0, $le$, true(), exact(gr + ($le$-gr)*(rank - last_hist_rate) / ($hist_rate$ - last_hist_rate)))
| fields $groupby$, res
| rename res as ""histperc""","perc, hist_rate, le, groupby",search,app,system,
GMC,"PROD-GMC-1|search_head","set_local_host","rest splunk_server=local /services/server/info | return host",,search,app,system,
GMC,"PROD-GMC-1|search_head","truncate_search","eval search=if(length(search) > 150, substr(search, 0, 150) + ""..."", search)",,search,app,system,
GMC,"PROD-GMC-1|search_head","cron_schedule(1)","rex field=$cron_schedule$ ""(?<Minute>^.*?)\\s(?<Hour>.*?)\\s(?<Day_of_Month>.*?)\\s(?<Month>.*?)\\s(?<Day_of_Week>.*?)$"" 
| eval 
    Minute = case ( 
    (Minute == ""*""),""Any"", 
    true(), Minute ), 
    Hour = if ( match(Hour,""^\\*""),""Any"",Hour ),
    Day_of_Week = case ( 
    (Day_of_Week == 0 OR Day_of_Week == 7),""Sunday"", 
    (Day_of_Week == 1), ""Monday"",
    (Day_of_Week == 2), ""Tuesday"",
    (Day_of_Week == 3), ""Wednesday"",
    (Day_of_Week == 4), ""Thursday"",
    (Day_of_Week == 5), ""Friday"",
    (Day_of_Week == 6), ""Saturday"", 
    (Day_of_Week == ""*""),""Any"", 
    true(), Day_of_Week),
    Day_of_Month = if ( match(Day_of_Month,""^\\*""), ""Any"", Day_of_Month), 
    Month = case ( 
    (Month == 1),""January"",
    (Month == 2),""February"",
    (Month == 3),""March"",
    (Month == 4),""April"",
    (Month == 5),""May"",
    (Month == 6),""June"",
    (Month == 7),""July"",
    (Month == 8),""August"",
    (Month == 9),""September"",
    (Month == 10),""October"",
    (Month == 11),""November"",
    (Month == 12),""December"", 
    (Month == ""*""),""Any"", 
    true(), Month ), 
    Cron_Schedule_translated=(((((((((""Minute: "" . Minute) . "" | Hour: "") . Hour) . "" | Day_of_Month: "") . Day_of_Month) . "" | Month: "") . Month) . "" | Day_of_Week: "") . Day_of_Week)
| fields - Minute, Hour, Day_of_Month, Month, Day_of_Week","cron_schedule","splunk_global_monitoring_console",app,system,"cron_schedule"
GMC,"PROD-GMC-1|search_head","from_audit","from datamodel:GMC.Audit_Search 
| `get_splunk_env(host)` 
| fields _time Splunk_Roles host available_count considered_events datamodel decompressed_slices event_count dispatch_time exec_time info result_count roles savedsearch_name scan_count search search_et search_id search_lt search_startup_time search_type searched_buckets total_run_time total_slices user",,"splunk_global_monitoring_console",app,system,"from_audit"
GMC,"PROD-GMC-1|search_head","from_internal","from datamodel:GMC.Internal_Scheduler 
| `get_splunk_env(host)` 
| fields _time Splunk_Roles host app search_id_normalized concurrency_category concurrency_context concurrency_limit dispatch_time priority reason result_count total_run_time savedsearch_id savedsearch_name scheduled_time search_id search_type skipped_count info user window_time alert_actions Total_Executions Skipped_Executions",,"splunk_global_monitoring_console",app,system,"from_internal"
GMC,"PROD-GMC-1|search_head","from_introspection","from datamodel:GMC.Introspection_Search_Usage 
| `get_splunk_env(host)` 
| fields _time Splunk_Roles host search_id search_head app user acceleration_id delta_scan_count total_run_time fd_used mem_used normalized_pct_cpu page_faults pct_cpu pct_memory pid ppid provenance read_mb savedsearch_name scan_count search_type status t_count written_mb mode",,"splunk_global_monitoring_console",app,system,"from_introspection"
GMC,"PROD-GMC-1|search_head","get_dashboards_info(1)","lookup splunk_rest_data_ui_views_sh_kv_store_lookup title AS $Dashboard_Name$ OUTPUTNEW label description Report_Reference Dashboard_Reference Lookup_Reference Datamodel_Reference Search BaseSearch","Dashboard_Name","splunk_global_monitoring_console",app,system,
GMC,"PROD-GMC-1|search_head","get_dashboards_info(2)","lookup splunk_rest_data_ui_views_sh_kv_store_lookup app AS $App$ title AS $Dashboard_Name$ OUTPUTNEW label description Report_Reference Dashboard_Reference Lookup_Reference Datamodel_Reference Search BaseSearch","App,Dashboard_Name","splunk_global_monitoring_console",app,system,"get_dashboards_info"
GMC,"PROD-GMC-1|search_head","get_dashboards_info(3)","lookup splunk_rest_data_ui_views_sh_kv_store_lookup Splunk_Instance AS $Splunk_Instance$ app AS $App$ title AS $Dashboard_Name$ OUTPUTNEW label description Report_Reference Dashboard_Reference Lookup_Reference Datamodel_Reference Search BaseSearch","Splunk_Instance,App,Dashboard_Name","splunk_global_monitoring_console",app,system,
GMC,"PROD-GMC-1|search_head","get_dashboards_usage(3)","lookup splunk_index_internal_web_access_sh_kv_store_lookup Splunk_Instance AS $Splunk_Instance$ App AS $app$ Dashboard_Name AS $Dashboard_Name$ OUTPUTNEW Earliest_Access_Updated Latest_Access_Updated min_spent max_spent avg_spent

| eval Days_Latest_Dashboard_Access = round((now() - Latest_Access_Updated) / 86400 , 0) 
| eval Days_Latest_Dashboard_Access = case( Days_Latest_Dashboard_Access = ""0"", ""00"", Days_Latest_Dashboard_Access = ""1"", ""01"", Days_Latest_Dashboard_Access = ""2"", ""02"", Days_Latest_Dashboard_Access = ""3"", ""03"", Days_Latest_Dashboard_Access = ""4"", ""04"", Days_Latest_Dashboard_Access = ""5"", ""05"", Days_Latest_Dashboard_Access = ""6"", ""06"", Days_Latest_Dashboard_Access = ""7"", ""07"", Days_Latest_Dashboard_Access = ""8"", ""08"", Days_Latest_Dashboard_Access = ""9"", ""09"", true(), Days_Latest_Dashboard_Access ) 

| eval Earliest_Access_Updated = strftime(Earliest_Access_Updated,""%m/%d/%Y %H:%M:%S"") , Latest_Access_Updated = strftime(Latest_Access_Updated,""%m/%d/%Y %H:%M:%S"")

| fillnull value=999999 Days_Latest_Dashboard_Access
","Splunk_Instance,app,Dashboard_Name","splunk_global_monitoring_console",app,system,"get_dashboards_usage"
GMC,"PROD-GMC-1|search_head","get_dm_field(2)","tstats SUMMARIESONLY=TRUE ALLOW_OLD_SUMMARIES=FALSE 
    count
    FROM DATAMODEL=GMC
    WHERE nodename=Search_Activity.$dataset$
    BY Search_Activity.$dataset$.$field$
| `drop_dm_object_name(Search_Activity.$dataset$)`
| table $field$ count","dataset,field","splunk_global_monitoring_console",app,system,"get_dm_field"
GMC,"PROD-GMC-1|search_head","get_field_desc(1)","lookup splunk_fields_all_csv_lookup Field_Name AS $Field_Name$ OUTPUTNEW Field_Description","Field_Name","splunk_global_monitoring_console",app,system,"get_field_desc"
GMC,"PROD-GMC-1|search_head","get_fields_list","rename ""eai:acl.*"" as ""*"" , ""eai:*"" AS ""*""
| fields - ""perms.*"", ""can_*"", id, published, removable, modifiable, updated 
| fieldsummary 
| rename field AS Fields_List 
| fields Fields_List 
| where Fields_List!=""Fields_List"" 
| mvcombine Fields_List 
| eval Fields_List=mvjoin(Fields_List,"" "")",,"splunk_global_monitoring_console",app,system,
GMC,"PROD-GMC-1|search_head","get_identity_info(1)","lookup update=true splunk_identities_sh_csv_lookup identity as $identity$ OUTPUTNEW first last full_name email managedBy bunit startDate endDate work_city work_region work_country work_lat work_long Title LOB Department Emp_Type Emp_Status Cost_Center Location_Code Floor_Number Contractor_Expiration",identity,"splunk_global_monitoring_console",app,system,"get_identity_info"
GMC,"PROD-GMC-1|search_head","get_identity_usage(1)","eval $username$ = upper($username$)
| lookup splunk_index_audit_user_login_sh_kv_store_lookup User AS $username$ OUTPUTNEW Earliest_Login_Updated AS User_Earliest_Login_Updated Latest_Login_Updated AS User_Latest_Login_Updated Splunk_Roles AS User_Splunk_Roles Login_Source AS User_Login_Source

| makemv delim=""|"" Splunk_Roles

| eval User_Earliest_Login_Updated = strftime(User_Earliest_Login_Updated,""%m/%d/%Y %H:%M:%S"") , User_Latest_Login_Updated = strftime(User_Latest_Login_Updated,""%m/%d/%Y %H:%M:%S"")

| fillnull value=""Undefined"" User_Earliest_Login_Updated User_Latest_Login_Updated User_Splunk_Roles User_Login_Source",username,"splunk_global_monitoring_console",app,system,"get_identity_usage"
GMC,"PROD-GMC-1|search_head","get_instance_info(1)","lookup splunk_rest_server_info_all_csv_lookup Splunk_Instance AS $Splunk_Instance$ OUTPUTNEW Splunk_Roles serverName host host_fqdn host_resolved mode guid version build os_name os_name_extended cpu_arch os_version os_build startup_time cluster_label kvStoreStatus numberOfCores numberOfVirtualCores physicalMemoryMB rtsearch_enabled master_uri master_guid licenseState isForwarding isTrial license_labels transparent_hugepages_defrag transparent_hugepages_effective_state transparent_hugepages_enabled ulimits_core_file_size ulimits_cpu_time ulimits_data_file_size ulimits_data_segment_size ulimits_nice ulimits_open_files ulimits_resident_memory_size ulimits_stack_size ulimits_user_processes ulimits_virtual_address_space_size

| makemv delim=""|"" Splunk_Roles

","Splunk_Instance","splunk_global_monitoring_console",app,system,"get_instance_info"
GMC,"PROD-GMC-1|search_head","get_instance_info_simple(1)","lookup splunk_rest_server_info_all_csv_lookup Splunk_Instance AS $Splunk_Instance$ OUTPUTNEW Splunk_Roles | makemv delim=""|"" Splunk_Roles","Splunk_Instance","splunk_global_monitoring_console",app,system,"get_instance_info_simple"
GMC,"PROD-GMC-1|search_head","get_lookup_reference(1)","rex field=$field$ max_match=0 ""\|\s*lookup\s*(?<Lookup_Reference1>\w+)"" 
| rex field=$field$ max_match=0 ""\|\s*(in|out)putlookup\s*(append=\w+\s*)?(?<Lookup_Reference2>\w+)"" 
| rex field=$field$ max_match=0 ""\|\s*from\s+inputlookup:\""?(?<Lookup_Reference3>\w+)"" 
| eval Lookup_Reference=mvsort(mvdedup(mvappend(lower(Lookup_Reference1), lower(Lookup_Reference2), lower(Lookup_Reference3))))

| fields - Lookup_Reference1 Lookup_Reference2 Lookup_Reference3

| eval Lookup_Reference = mvfilter ( ! match (Lookup_Reference, ""event_time_field|output_format|createinapp|update|local|append|create_empty|key_field|override_if_empty|start|max|where"") )

| fillnull value=""no-reference"" Lookup_Reference",field,"splunk_global_monitoring_console",app,system,"get_lookup_reference"
GMC,"PROD-GMC-1|search_head","get_provenance_fields(1)","rex field=$provenance$ ""(?<Provenance_Type>.*?):(?<Provenance_KO_Type>.*?):(?<Provenance_KO>.*?)$""
| eval provenance_tmp=if(isnull(Provenance_Type), provenance, null())
| rex field=provenance_tmp ""(?<Provenance_Type>.*?):(?<Provenance_KO_Type>.*?)$""
| eval provenance_tmp=if(isnull(Provenance_Type), provenance, null())
| rex field=provenance_tmp ""(?<Provenance_Type>.*?)$""
| eval Dashboard_Name = if(Provenance_KO_Type=""Dashboard"", Provenance_KO, null() )
| fields - provenance_tmp",provenance,"splunk_global_monitoring_console",app,system,"get_provenance_fields"
GMC,"PROD-GMC-1|search_head","get_saved_searches_info(1)","lookup splunk_rest_saved_searches_sh_kv_store_lookup savedsearch_name AS $Savedsearch_Name$ OUTPUTNEW description savedsearch_type is_scheduled cron_schedule auto_summarize dispatch_earliest_time dispatch_latest_time schedule_priority max_concurrent schedule_window allow_skew realtime_schedule run_n_times run_on_startup Lookup_Reference Datamodel_Reference search AS Search

| eval description=mvdedup(description), savedsearch_type=mvdedup(savedsearch_type), is_scheduled=mvdedup(is_scheduled), cron_schedule=mvdedup(cron_schedule), auto_summarize=mvdedup(auto_summarize), dispatch_earliest_time=mvdedup(dispatch_earliest_time), dispatch_latest_time=mvdedup(dispatch_latest_time), schedule_priority=mvdedup(schedule_priority), max_concurrent=mvdedup(max_concurrent), schedule_window=mvdedup(schedule_window), allow_skew=mvdedup(allow_skew), realtime_schedule=mvdedup(realtime_schedule), run_n_times=mvdedup(run_n_times) , run_on_startup=mvdedup(run_on_startup), Lookup_Reference=mvdedup(Lookup_Reference), Datamodel_Reference=mvdedup(Datamodel_Reference) , search=mvdedup(search)","Savedsearch_Name","splunk_global_monitoring_console",app,system,"Retrieves information about Scheduled Searches from the splunk_rest_saved_searches_sh_kv_store KV Store Lookup Table"
GMC,"PROD-GMC-1|search_head","get_saved_searches_info(2)","lookup splunk_rest_saved_searches_sh_kv_store_lookup app AS ""$App$"" savedsearch_name AS $Savedsearch_Name$ OUTPUTNEW description savedsearch_type is_scheduled cron_schedule auto_summarize dispatch_earliest_time dispatch_latest_time schedule_priority max_concurrent schedule_window allow_skew realtime_schedule run_n_times run_on_startup Lookup_Reference Datamodel_Reference search AS Search

| eval description=mvdedup(description), savedsearch_type=mvdedup(savedsearch_type), is_scheduled=mvdedup(is_scheduled), cron_schedule=mvdedup(cron_schedule), auto_summarize=mvdedup(auto_summarize), dispatch_earliest_time=mvdedup(dispatch_earliest_time), dispatch_latest_time=mvdedup(dispatch_latest_time), schedule_priority=mvdedup(schedule_priority), max_concurrent=mvdedup(max_concurrent), schedule_window=mvdedup(schedule_window), allow_skew=mvdedup(allow_skew), realtime_schedule=mvdedup(realtime_schedule), run_n_times=mvdedup(run_n_times) , run_on_startup=mvdedup(run_on_startup), Lookup_Reference=mvdedup(Lookup_Reference), Datamodel_Reference=mvdedup(Datamodel_Reference) , search=mvdedup(search)","App,Savedsearch_Name","splunk_global_monitoring_console",app,system,"get_saved_searches_info"
GMC,"PROD-GMC-1|search_head","get_saved_searches_info(3)","lookup splunk_rest_saved_searches_sh_kv_store_lookup Splunk_Instance AS $Splunk_Instance$ app AS $App$ savedsearch_name AS ""$Savedsearch_Name$"" OUTPUTNEW description savedsearch_type is_scheduled cron_schedule auto_summarize dispatch_earliest_time dispatch_latest_time schedule_priority max_concurrent schedule_window allow_skew realtime_schedule run_n_times run_on_startup Lookup_Reference Datamodel_Reference search AS Search

| eval description=mvdedup(description), savedsearch_type=mvdedup(savedsearch_type), is_scheduled=mvdedup(is_scheduled), cron_schedule=mvdedup(cron_schedule), auto_summarize=mvdedup(auto_summarize), dispatch_earliest_time=mvdedup(dispatch_earliest_time), dispatch_latest_time=mvdedup(dispatch_latest_time), schedule_priority=mvdedup(schedule_priority), max_concurrent=mvdedup(max_concurrent), schedule_window=mvdedup(schedule_window), allow_skew=mvdedup(allow_skew), realtime_schedule=mvdedup(realtime_schedule), run_n_times=mvdedup(run_n_times) , run_on_startup=mvdedup(run_on_startup), Lookup_Reference=mvdedup(Lookup_Reference), Datamodel_Reference=mvdedup(Datamodel_Reference) , search=mvdedup(search)","Splunk_Instance,App,Savedsearch_Name","splunk_global_monitoring_console",app,system,"get_saved_searches_info"
GMC,"PROD-GMC-1|search_head","get_saved_searches_usage(3)","lookup splunk_index_internal_scheduler_jobs_sh_kv_store_lookup Splunk_Instance AS $Splunk_Instance$ App AS $app$ Savedsearch_Name AS $Savedsearch_Name$ OUTPUTNEW User Scheduled_Time Priority Dispatch_Time Window_Time Latest_Run_Time Run_Time Result_Count 
| makemv delim=""|"" Splunk_Roles

| eval Days_Latest_Access = round((now() - Latest_Run_Time) / 86400 , 0) 
| eval Days_Latest_Access = case( Days_Latest_Access = ""0"", ""00"", Days_Latest_Access = ""1"", ""01"", Days_Latest_Access = ""2"", ""02"", Days_Latest_Access = ""3"", ""03"", Days_Latest_Access = ""4"", ""04"", Days_Latest_Access = ""5"", ""05"", Days_Latest_Access = ""6"", ""06"", Days_Latest_Access = ""7"", ""07"", Days_Latest_Access = ""8"", ""08"", Days_Latest_Access = ""9"", ""09"", true(), Days_Latest_Access ) 

| eval Scheduled_Time = strftime(Scheduled_Time,""%m/%d/%Y %H:%M:%S"") , Dispatch_Time = strftime(Dispatch_Time,""%m/%d/%Y %H:%M:%S"") , Latest_Run_Time = strftime(Latest_Run_Time,""%m/%d/%Y %H:%M:%S"")

| fillnull value=999999 Days_Latest_Access","Splunk_Roles,app,Savedsearch_Name","splunk_global_monitoring_console",app,system,"get_saved_searches_usage"
GMC,"PROD-GMC-1|search_head","get_search_concurrency(2)","eval title=""$title$""
| lookup splunk_rest_admin_search_concurrency_settings_handler_sh_csv_lookup Splunk_Instance AS $Splunk_Instance$ title OUTPUTNEW Splunk_Roles max_searches_perc auto_summary_perc base_max_searches max_rt_search_multiplier max_searches_per_cpu max_auto_summary_searches max_hist_scheduled_searches max_hist_searches max_rt_scheduled_searches max_rt_searches
| fields - title
| makemv delim=""|"" Splunk_Roles","Splunk_Instance,title","splunk_global_monitoring_console",app,system,
GMC,"PROD-GMC-1|search_head","gmc_convert_runtime(1)","eval $runtime$=case(round($runtime$ / (3600*24) - 0.5) > 0, round($runtime$ / (3600*24)- 0.5).""d"".round(($runtime$ % (3600*24)) / 3600 - 0.5).""h "".round(($runtime$ % 3600) / 60 - 0.5).""min "".round($runtime$ % 60, 2).""s"",round(($runtime$ % (3600*24)) / 3600 - 0.5) > 0,round(($runtime$ % (3600*24)) / 3600 - 0.5).""h "".round(($runtime$ % 3600) / 60 - 0.5).""min "".round($runtime$ % 60, 2).""s"",round(($runtime$ % 3600) / 60 - 0.5) > 0, round(($runtime$ % 3600) / 60 - 0.5).""min"".round($runtime$ % 60, 2).""s"", 1 = 1, round($runtime$ % 60, 2).""s"")",runtime,"splunk_global_monitoring_console",app,system,"gmc_convert_runtime"
GMC,"PROD-GMC-1|search_head","gmc_drop_dm_object_name(1)","rename ""$object$.*"" as *",object,"splunk_global_monitoring_console",app,system,"gmc_drop_dm_object_name"
GMC,"PROD-GMC-1|search_head","gmc_time_format(1)","$time$ = strftime($time$, ""%m/%d/%Y %H:%M:%S"")",time,"splunk_global_monitoring_console",app,system,"gmc_time_format"
GMC,"PROD-GMC-1|search_head",identities,"inputlookup splunk_sh_identities_csv_lookup 
| makemv delim=""|"" identity_Splunk_Roles 
| makemv delim=""|"" identity_Splunk_Instance 
| table identity prefix nick first last full_name suffix email phone phone2 managedBy priority bunit category watchlist startDate endDate work_city work_region work_country work_lat work_long Title LOB Department Emp_Type Emp_Status Cost_Center Location_Code Floor_Number Contractor_Expiration Splunk_Roles Splunk_Instance",,"splunk_global_monitoring_console",app,system,identities
GMC,"PROD-GMC-1|search_head","normalize_search_id(1)","rex field=$search_id$ ""_(?<search_id_normalized1>\d+[._]\d+)_"" 
| rex field=$search_id$ ""(?<search_id_normalized2>\d+[._]\d+$)"" 
| rex field=$search_id$ ""(?<search_id_normalized3>^\d+[._]\d+)"" 
| eval search_id_normalized = if(isnull(search_id_normalized1), search_id_normalized2, search_id_normalized1) 
| eval search_id_normalized = if(isnull(search_id_normalized), search_id_normalized3, search_id_normalized) 
| eval search_id_normalized = if(isnull(search_id_normalized), search_id, search_id_normalized)
| rex field=search_id_normalized mode=sed ""s/\./_/g""
| rex field=search_id_normalized mode=sed ""s/^\w+;\w+;//g""
| fields - search_id_normalized1, search_id_normalized2, search_id_normalized3","search_id","splunk_global_monitoring_console",app,system,"normalize_search_id"
GMC,"PROD-GMC-1|search_head","rename_common_fields","rename host as ""Splunk Instance"" , search_id as ""Search ID"" , search_id_normalized as ""Normalized Search ID"" , user as User , search_type as ""Search Type"" , savedsearch_name as ""Savedsearch Name"" , 'total_run_time' as Runtime, total_run_time as Runtime_Sec , info as Info",,"splunk_global_monitoring_console",app,system,"rename_common_fields"
GMC,"PROD-GMC-1|search_head","rest_time_format(1)","rex field=$time$ mode=sed ""s/^1970.*/2003-10-01T00:00:00+00:00/g""
| eval $time$ = strftime(strptime($time$,""%Y-%m-%dT%H:%M:%S""),""%m/%d/%Y %H:%M:%S"")",time,"splunk_global_monitoring_console",app,system,"rest_time_format"
GMC,"PROD-GMC-1|search_head","skip_ratio(1)","tstats SUMMARIESONLY=TRUE ALLOW_OLD_SUMMARIES=TRUE 
    sum(Search_Activity.Internal_Scheduler.is_Internal_Total_Executions) as Total_Executions
    sum(Search_Activity.Internal_Scheduler.is_Internal_Skipped_Executions) as Skipped_Executions
    FROM DATAMODEL=GMC
    WHERE nodename=Search_Activity.Internal_Scheduler
    index=_internal
    AND Search_Activity.Internal_Scheduler.savedsearch_name2 = ""*""
    AND Search_Activity.Internal_Scheduler.app2 = ""*""
    AND Search_Activity.Internal_Scheduler.search_type2 = ""*"" 
    AND Search_Activity.Internal_Scheduler.info2 = ""*""
    AND Search_Activity.Internal_Scheduler.user2 = ""*""
    AND host = ""*""
    Search_Activity.Internal_Scheduler.info2 IN ( ""completed"" , ""skipped"")
    BY host 
| `drop_dm_object_name(Search_Activity.Internal_Scheduler)` 
| rename info2 AS info , host AS Instance 
| `get_splunk_env(Instance)` 
| eval Skip_Ratio = ( (Skipped_Executions / Total_Executions) * 100), Skip_Ratio = ( round(Skip_Ratio, 2) . ""%"") 
| table Splunk_Roles Instance Total_Executions Skipped_Executions Skip_Ratio 
| search Splunk_Roles = ""$Splunk_Roles$""","Splunk_Roles","splunk_global_monitoring_console",app,system,"skip_ratio"
GMC,"PROD-GMC-1|search_head","instrumentation_distribution_strings(3)","""\""avg\"":""+`instrumentation_number_format($name$_avg,$multiplier$,$round_digits$)` + "","" + ""\""min\"":""+`instrumentation_number_format($name$_min,$multiplier$,$round_digits$)` + "","" + ""\""max\"":""+`instrumentation_number_format($name$_max,$multiplier$,$round_digits$)` + "","" + ""\""p10\"":""+`instrumentation_number_format($name$_p10,$multiplier$,$round_digits$)` + "","" + ""\""p20\"":""+`instrumentation_number_format($name$_p20,$multiplier$,$round_digits$)` + "","" + ""\""p30\"":""+`instrumentation_number_format($name$_p30,$multiplier$,$round_digits$)` + "","" + ""\""p40\"":""+`instrumentation_number_format($name$_p40,$multiplier$,$round_digits$)` + "","" + ""\""p50\"":""+`instrumentation_number_format($name$_p50,$multiplier$,$round_digits$)` + "","" + ""\""p60\"":""+`instrumentation_number_format($name$_p60,$multiplier$,$round_digits$)` + "","" + ""\""p70\"":""+`instrumentation_number_format($name$_p70,$multiplier$,$round_digits$)` + "","" + ""\""p80\"":""+`instrumentation_number_format($name$_p80,$multiplier$,$round_digits$)` + "","" + ""\""p90\"":""+`instrumentation_number_format($name$_p90,$multiplier$,$round_digits$)`","name,multiplier,round_digits","splunk_instrumentation",app,system,
GMC,"PROD-GMC-1|search_head","instrumentation_distribution_values(1)","avg($name$) as $name$_avg min($name$) as $name$_min max($name$) as $name$_max perc10($name$) as $name$_p10 perc20($name$) as $name$_p20 perc30($name$) as $name$_p30 perc40($name$) as $name$_p40 perc50($name$) as $name$_p50 perc60($name$) as $name$_p60 perc70($name$) as $name$_p70 perc80($name$) as $name$_p80 perc90($name$) as $name$_p90",name,"splunk_instrumentation",app,system,
GMC,"PROD-GMC-1|search_head","instrumentation_number_format(3)","tostring(coalesce(round($name$*$multiplier$,$round_digits$), ""null""))","name,multiplier,round_digits","splunk_instrumentation",app,system,
GMC,"PROD-GMC-1|search_head","dmc_audit_get_search_type","eval search_type = case( 
match(search_id, ""^SummaryDirector_""), ""summarization"", 
match(search_id, ""^((rt_)?scheduler__|alertsmanager_)""), ""scheduled"", 
match(search_id, ""\d{10}\.\d+(_[0-9A-F]{8}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{12})?$""), ""ad hoc"", 
true(), ""other"")",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_audit_get_searches(1)","`dmc_set_index_audit` host=$host$ action=search sourcetype=audittrail search_id!=""rsa_*"" 
| eval user = if(user=""n/a"", null(), user) 
| `dmc_audit_get_search_type` 
| eval search=if(isnull(savedsearch_name) OR savedsearch_name=="""", search, savedsearch_name)",host,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_audit_get_searches_for_groups(1)","`dmc_set_index_audit` search_group=dmc_group_search_head search_group=$search_group$ action=search sourcetype=audittrail search_id!=""rsa_*"" 
| eval user = if(user=""n/a"", null(), user) 
| `dmc_audit_get_search_type` 
| eval search=if(isnull(savedsearch_name) OR savedsearch_name=="""", search, savedsearch_name)","search_group","splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_audit_searchlocal(1)","search `dmc_set_index_audit` action=search (id=* OR search_id=*) | eval search_id = if(isnull(search_id), id, search_id) | replace '*' with * in search_id | search $filter$",filter,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_background_flush_rangemap","rangemap field=percent ""0-10%""=0-10 ""10-50%""=10.001-50 ""50-100%""=50.001-100 default=abnormal",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_build_forwarder_assets(1)","`dmc_get_forwarder_tcpin` 
| stats values(fwdType) as forwarder_type, latest(version) as version, values(arch) as arch, values(os) as os, max(_time) as last_connected, sum(kb) as new_sum_kb, sparkline(avg(tcp_KBps), $sparkline_span$) as new_avg_tcp_kbps_sparkline, avg(tcp_KBps) as new_avg_tcp_kbps, avg(tcp_eps) as new_avg_tcp_eps by guid, hostname","sparkline_span","splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_classify_processes","eval process_class = case(    
    process==""splunk-optimize"",""index service"",    
    process==""sh"" OR process==""ksh"" OR process==""bash"" OR like(process,""python%"") OR process==""powershell"",""scripted input"",    
    process==""mongod"", ""KVStore"") 
| eval process_class = case(    
    process==""splunkd"" AND (like(args,""-p %start%"") OR like(args,""service"") OR like(args,""%_internal_launch_under_systemd%"")),""splunkd server"",    
    process==""splunkd"" AND isnotnull(sid),""search"",    
    process==""splunkd"" AND (like(args,""fsck%"") OR like(args,""recover-metadata%"") OR like(args,""cluster_thing"")),""index service"",    
    process==""splunkd"" AND args==""instrument-resource-usage"", ""scripted input"",
    (like(process,""python%"") AND like(args,""%/appserver/mrsparkle/root.py%"")) OR like(process,""splunkweb""),""Splunk Web"",    
    isnotnull(process_class), process_class)    
| eval process_class = if(isnull(process_class),""other"",process_class)",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_collection_interval","collection_interval = 10",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_convert_count_unit(1)","case( 
$x$ >= 1000000000000, round($x$ / 1000000000000, 2).""T"", 
$x$ >= 1000000000, round($x$ / 1000000000, 2).""B"", 
$x$ >= 1000000, round($x$ / 1000000, 2).""M"", 
$x$ >= 1000, round($x$ / 1000, 2).""K"", 
true(), $x$ 
)",x,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_convert_disk_usage_unit(1)","case( 
$x$ > 1000000, round($x$ / 1024 / 1024, 2)."" TB"" 
$x$ > 1000, round($x$ / 1024, 2)."" GB"" 
1 == 1, $x$."" MB"" 
)",x,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_convert_runtime(1)","case( 
round($runtime$ / (3600*24) - 0.5) > 0, round($runtime$ / (3600*24) - 0.5).""d "".round(($runtime$ % (3600*24)) / 3600 - 0.5).""h "".round(($runtime$ % 3600) / 60 - 0.5).""min "".round($runtime$ % 60, 2).""s"", 
round(($runtime$ % (3600*24)) / 3600 - 0.5) > 0, round(($runtime$ % (3600*24)) / 3600 - 0.5).""h "".round(($runtime$ % 3600) / 60 - 0.5).""min "".round($runtime$ % 60, 2).""s"", 
round(($runtime$ % 3600) / 60 - 0.5) > 0, round(($runtime$ % 3600) / 60 - 0.5).""min "".round($runtime$ % 60, 2).""s"", 
1 = 1, round($runtime$ % 60, 2).""s"" 
)",runtime,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_cpu_usage_rangemap","rangemap field=cpu_usage ""0-60%""=0-60 ""60-80%""=60.001-80 ""80-100%""=80.001-100 ""100%+""=100.001-999999 default=abnormal",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_cpu_usage_rangemap_and_timechart","`dmc_cpu_usage_rangemap` 
| `dmc_timechart` partial=f dc(server) as server_count by range 
| fields _time, ""100%+"", ""80-100%"", ""60-80%"", ""0-60%""",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_daily_license_usage_quota","rest `dmc_dmc_group_license_master` /services/licenser/pools 
| join type=outer stack_id splunk_server [rest `dmc_dmc_group_license_master` /services/licenser/groups | search is_active=1 | eval stack_id=stack_ids | fields splunk_server stack_id is_active] 
| search is_active=1 
| fields splunk_server, stack_id, used_bytes 
| join type=outer stack_id splunk_server [rest `dmc_dmc_group_license_master` /services/licenser/stacks | eval stack_id=title | eval stack_quota=quota | fields splunk_server stack_id stack_quota] 
| stats sum(used_bytes) as used_bytes max(stack_quota) as stack_quota by splunk_server 
| eval usedGB=round(used_bytes/1024/1024/1024,3) 
| eval totalGB=round(stack_quota/1024/1024/1024,3) 
| eval percentage=round(usedGB / totalGB, 3)*100 
| fields splunk_server, percentage, usedGB, totalGB",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_disk_usage_rangemap","rangemap field=pct_disk_usage ""0-60%""=0-0.6 ""60-80%""=0.6001-0.8 ""80-100%""=0.8001-1 default=abnormal",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_disk_usage_rangemap_and_timechart","`dmc_disk_usage_rangemap` 
| `dmc_timechart_for_disk_usage` partial=f dc(server_mount_point) as server_mount_point_count by range 
| fields _time, ""80-100%"", ""60-80%"", ""0-60%""",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_dmc_group_license_master","splunk_server_group=dmc_group_license_master",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_drilldown_indexing_performance_deployment_indexing_rate(2)","`dmc_set_index_internal` source=*metrics.log* sourcetype=splunkd search_group=dmc_group_indexer search_group=$group$ group=thruput name=index_thruput 
| stats sum(kb) AS total_kb by host 
| addinfo 
| eval time_window = info_max_time - info_min_time 
| eval kbps = round(total_kb / time_window, 0) 
| `dmc_indexing_rate_rangemap` 
| where range=""$metric$"" 
| `dmc_drilldown_join_peers_by_peerURI` 
| eval Action = Action."" dmc_group_indexer"" 
| fields serverName, machine, kbps, range, numberOfCores, ram, version, Action
| eval kbps = kbps."" KB/s"" 
| rename serverName as Instance, machine as Machine, kbps as ""Indexing Rate"", range as ""Indexing Rate Range"", version as Version, numberOfCores as Cores, ram as RAM","group, metric","splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_drilldown_indexing_performance_deployment_queue_fill_ratio(4)","`dmc_set_index_internal` source=*metrics.log sourcetype=splunkd search_group=dmc_group_indexer search_group=$group$ group=queue name=$queueType$ 
| eval max=if(isnotnull(max_size_kb),max_size_kb,max_size) 
| eval curr=if(isnotnull(current_size_kb),current_size_kb,current_size) 
| eval fill_perc=round((curr/max)*100,2) 
| stats $funcQueue$(fill_perc) AS fill_percentage by host 
| `dmc_queue_fill_ratio_rangemap` 
| where range=""$metric$"" 
| `dmc_drilldown_join_peers_by_peerURI` 
| eval Action = Action."" dmc_group_indexer"" 
| fields serverName, machine, fill_percentage, range, numberOfCores, ram, version, Action 
| rename serverName as Instance, machine as Machine, fill_percentage as ""Fill Ratio (%)"", range as ""Fill Ratio Range"", version as Version, numberOfCores as Cores, ram as RAM","group, queueType, funcQueue, metric","splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_drilldown_join_peers_by_peerURI","lookup dmc_assets host OUTPUT peerURI, serverName, machine 
| eval peerURI = mvindex(peerURI, 0) 
| eval machine = mvindex(machine, 0) 
| eval serverName = mvindex(serverName, 0) 
| join type=outer peerURI 
 [| rest splunk_server=local /services/search/distributed/peers 
  | rename title as peerURI 
  | append  
    [| rest splunk_server=local /services/server/info 
     | eval peerURI = ""localhost"" 
    ] 
  | eval ram = round(physicalMemoryMB / 1024, 2)."" GB"" 
  | fields peerURI, version, numberOfCores, ram 
 ] 
| eval Action = serverName 
| fields - _time",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_drilldown_kv_store_deployment_background_flush(2)","`dmc_set_index_introspection` search_group=$group$ search_group=dmc_group_kv_store component=kvstoreserverstats 
| stats range(data.backgroundFlushing.total_ms)  AS diff by  host 
| addinfo 
| eval time_window = info_max_time - info_min_time 
| eval ms_per_min = diff / (time_window / 60) 
| eval percent = round(ms_per_min / (60 * 1000) * 100, 2) 
| `dmc_background_flush_rangemap` 
| where range=""$metric$"" 
| `dmc_drilldown_join_peers_by_peerURI` 
| eval Action = Action."" dmc_group_kv_store"" 
| fields serverName, machine, percent, range, numberOfCores, ram, version, Action 
| rename serverName as Instance, machine as Machine, percent as ""Background Flush (%)"", range as ""Background Flush Range"", version as Version, numberOfCores as Cores, ram as RAM","group, metric","splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_drilldown_kv_store_deployment_lock_percentage(3)","`dmc_set_index_introspection` search_group=dmc_group_kv_store  search_group=$group$ component=kvstoreserverstats 
| stats range(data.globalLock.lockTime) AS globalLock range(data.globalLock.totalTime) AS total by host  
| eval percent=abs(globalLock*100/total)   
| stats $countLockFunc$(percent) as percent_locked by host 
| rangemap field=percent_locked ""0-30%""=0-30 ""30-50%""=30.001-50 ""50-100%""=50.001-1000 default=abnormal  
| where range=""$metric$"" 
| `dmc_drilldown_join_peers_by_peerURI` 
| eval Action = Action."" dmc_group_kv_store"" 
| fields serverName, machine, percent_locked, range, numberOfCores, ram, version, Action 
| rename serverName as Instance, machine as Machine, percent_locked as ""Lock (%)"", range as ""Lock Percentage Range"", version as Version, numberOfCores as Cores, ram as RAM","group, countLockFunc, metric","splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_drilldown_kv_store_deployment_memory_ratio(2)","`dmc_set_index_introspection` search_group=$group$ search_group=dmc_group_kv_store component=kvstoreserverstats 
| eval ratio='data.mem.virtual'/'data.mem.mappedWithJournal' 
| stats avg(ratio) AS myratio by host  
| eval myratio = round(myratio, 2) 
| rangemap field=myratio ""0-2x""=0-2 ""2-3x""=2.001-3 "">3x""=3.001-10000 default=abnormal 
| where range=""$metric$"" 
| `dmc_drilldown_join_peers_by_peerURI` 
| eval Action = Action."" dmc_group_kv_store"" 
| fields serverName, machine, myratio, range, numberOfCores, ram, version, Action 
| rename serverName as Instance, machine as Machine, myratio as ""Virtual to Mapped Ratio"", range as ""Ratio Range"", version as Version, numberOfCores as Cores, ram as RAM","group, metric","splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_drilldown_kv_store_deployment_network(1)","`dmc_set_index_introspection` search_group=dmc_group_kv_store search_group=$group$ component=kvstoreserverstats 
| stats range(data.network.bytesIn) as indiff range(data.network.bytesOut) as outdiff range(data.network.numRequests) as Requests by host 
| eval ""MB In""=indiff/1000000 
| eval ""MB Out""=outdiff/1000000 
| `dmc_drilldown_join_peers_by_peerURI` 
| eval Action = Action."" dmc_group_kv_store"" 
| table serverName, machine, ""MB In"", ""MB Out"", Requests, numberOfCores, ram, version, Action 
| rename serverName as Instance, machine as Machine, version as Version, numberOfCores as Cores, ram as RAM",group,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_drilldown_kv_store_deployment_page_faults(3)","`dmc_set_index_introspection` search_group=dmc_group_kv_store search_group=$group$ component=kvstoreserverstats  
| rename data.opcounters.command as c, data.opcounters.update as u, data.opcounters.queries as q, data.opcountes.deletes as d, data.opcounters.getmore as g, data.opcounters.inserts as i 
| eval commands=if(isNotNull('c'), 'c',0) 
| eval updates=if(isNotNull('u'), 'u', 0) 
| eval queries=if(isNotNull('q'), 'q', 0) 
| eval deletes=if(isNotNull('d'), 'd', 0) 
| eval getmores=if(isNotNull('g'), 'g', 0) 
| eval inserts=if(isNotNull('i'), 'i', 0) 
| eval totalops=commands+updates+queries+deletes+getmores+inserts 
| bin _time minspan=30s 
| stats latest(totalops) AS ops latest(data.extra_info.page_faults) AS pf by host _time 
| eval  percent=if(opsdiff==0, 0, round(abs(pf/ops), 2))   
| stats $countPageFaultsFunc$(percent) as percent by host  
| rangemap field=percent ""0-0.7""=0-0.7 ""0.7-1.3""=0.7001-1.3 ""1.3+""=1.3001-999999 default=abnormal  
| where range=""$metric$"" 
| `dmc_drilldown_join_peers_by_peerURI` 
| eval Action = Action."" dmc_group_kv_store"" 
| fields serverName, machine, percent, range, numberOfCores, ram, version, Action 
| rename serverName as Instance, machine as Machine, percent as ""Page Faults per Operation"", range as ""Page Fault Range"", version as Version, numberOfCores as Cores, ram as RAM","group, countPageFaultsFunc, metric","splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_drilldown_kv_store_deployment_replication_lag(2)","`dmc_set_index_introspection` search_group=$group$ search_group=dmc_group_kv_store component=kvstorereplicasetstats  data.replSetStats.myState!=1 
| stats max(data.oplogInfo.end) AS local, max(data.replSetStats.myState) AS state, max(data.replSetStats.date) AS date by host 
| eval date = date/1000 
| `dmc_time_format(date)` 
| join 
  [ search `dmc_set_index_introspection` search_group=dmc_group_kv_store component=kvstorereplicasetstats data.replSetStats.myState=1 
  | stats max(data.oplogInfo.end) AS primary] 
| eval lag=(primary-local)/1000 
| eval lag = round(lag, 2) 
| `dmc_replication_lag_rangemap` 
| where range=""$metric$"" 
| rename host as Instance, lag as Lag, range as ""Lag Range"", state as State, date as ""Oplog Date"" 
| table Instance Lag ""Oplog Date"" ""Lag Range"" State","group, metric","splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_drilldown_kv_store_primary_oplog_window(1)","`dmc_set_index_introspection` search_group=$group$ search_group=dmc_group_kv_store component=kvstorereplicasetstats data.replSetStats.myState=1 
| eval Instance=host 
| rename data.oplogInfo.start as start, data.oplogInfo.end as end 
| eval start = start/1000 
| eval end = end/1000 
| eval diff= (end-start)/3600 
| `dmc_time_format(start)` 
| `dmc_time_format(end)` 
| stats first(start) as ""Start Date"" first(end) as ""End Date"" first(diff) as ""Window (Hours)"" by Instance",group,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_drilldown_resource_usage_deployment_cpu_usage(4)","`dmc_set_index_introspection` search_group=$role$ search_group=$group$ sourcetype=splunk_resource_usage component=Hostwide 
| eval total_cpu_usage = 'data.cpu_system_pct' + 'data.cpu_user_pct' 
| stats $countCPUFunc$(total_cpu_usage) as cpu_usage by host 
| `dmc_cpu_usage_rangemap` 
| where range=""$metric$"" 
| `dmc_drilldown_join_peers_by_peerURI` 
| eval Action = Action."" $role$"" 
| fields serverName, machine, cpu_usage, range, numberOfCores, ram, version, Action 
| eval cpu_usage = cpu_usage."" %"" 
| rename serverName as Instance, machine as Machine, cpu_usage as ""CPU Usage"", range as ""CPU Usage Range"", version as Version, numberOfCores as Cores, ram as RAM","role, group, countCPUFunc, metric","splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_drilldown_resource_usage_deployment_disk_usage(4)","`dmc_set_index_introspection` search_group=$role$ search_group=$group$ sourcetype=splunk_disk_objects component=Partitions 
| eval mount_point = 'data.mount_point' 
| eval free = if(isnotnull('data.available'), 'data.available', 'data.free') 
| eval pct_disk_usage = round(1 - free / 'data.capacity', 2) 
| eval server_mount_point = host."":"".mount_point 
| stats $countDiskFunc$(pct_disk_usage) as pct_disk_usage by server_mount_point 
| `dmc_disk_usage_rangemap` 
| where range=""$metric$"" 
| eval host = replace(server_mount_point, "":.*"", """") 
| eval mount_point = replace(server_mount_point, "".*:"", """") 
| eval pct_disk_usage = pct_disk_usage * 100 
| `dmc_drilldown_join_peers_by_peerURI` 
| eval Action = Action."" $role$"" 
| fields serverName, machine, mount_point, pct_disk_usage, range, numberOfCores, ram, version, Action 
| rename serverName as Instance, machine as Machine, mount_point as ""Mount Point"", pct_disk_usage as ""Disk Usage (%)"", range as ""Disk Usage Range"", version as Version, numberOfCores as Cores, ram as RAM","role, group, countDiskFunc, metric","splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_drilldown_resource_usage_deployment_load_average(4)","`dmc_set_index_introspection` search_group=$role$ search_group=$group$ sourcetype=splunk_resource_usage component=Hostwide 
| stats $countLoadAvgFunc$(data.normalized_load_avg_1min) as load_average by host 
| `dmc_load_average_rangemap` 
| where range=""$metric$"" 
| `dmc_drilldown_join_peers_by_peerURI` 
| eval Action = Action."" $role$"" 
| fields serverName, machine, load_average, range, numberOfCores, ram, version, Action 
| rename serverName as Instance, machine as Machine, load_average as ""Load Average"", range as ""Load Average Range"", version as Version, numberOfCores as Cores, ram as RAM","role, group, countLoadAvgFunc, metric","splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_drilldown_resource_usage_deployment_memory_usage(4)","`dmc_set_index_introspection` search_group=$role$ search_group=$group$ sourcetype=splunk_resource_usage component=Hostwide 
| eval pct_mem_used = 'data.mem_used' / 'data.mem' 
| stats $countMemFunc$(pct_mem_used) as pct_mem_used by host 
| `dmc_memory_usage_rangemap` 
| where range=""$metric$"" 
| `dmc_drilldown_join_peers_by_peerURI` 
| eval Action = Action."" $role$"" 
| fields serverName, machine, pct_mem_used, range, numberOfCores, ram, version, Action 
| eval pct_mem_used = round(pct_mem_used * 100, 2) 
| eval pct_mem_used = pct_mem_used."" %"" 
| rename serverName as Instance, machine as Machine, pct_mem_used as ""Memory Usage"", range as ""Memory Usage Range"", version as Version, numberOfCores as Cores, ram as RAM","role, group, countMemFunc, metric","splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_drilldown_search_activity_deployment_resource_usage(5)","`dmc_set_index_introspection` search_group=$role$ search_group=$group$ sourcetype=splunk_resource_usage ((component=PerProcess data.search_props.sid::*) OR component=Hostwide) 
| `dmc_rename_introspection_fields` 
| eval sid = if(component==""Hostwide"", ""n/a"", sid) 
| eval pid = if(component==""Hostwide"", ""n/a"", pid) 
| eval pct_cpu = if(component==""Hostwide"", 0, pct_cpu) 
| eval mem_used = if(component==""Hostwide"", 0, 'mem_used) 
| `dmc_set_bin` 
| stats latest($resourceType$) AS resource_usage_dedup values(Action) as Action by _time, sid, pid, host 
| stats sum(resource_usage_dedup) AS sum_resource_usage values(Action) as Action by _time, host 
| stats $resourceFunction$(sum_resource_usage) as resource_usage values(Action) as Action by host 
| `dmc_$resourceType$_rangemap` 
| where range == ""$metric$"" 
| `dmc_drilldown_join_peers_by_peerURI` 
| eval Action = Action."" $role$"" 
| fields serverName, machine, resource_usage, range, numberOfCores, ram, version, Action 
| rename serverName as Instance, machine as Machine, resource_usage as ""$resourceType$ Usage"", range as ""$resourceType$ Usage Range"", version as Version, numberOfCores as Cores, ram as RAM","role, group, resourceType, resourceFunction, metric","splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_drilldown_search_activity_deployment_search_concurrency(4)","`dmc_set_index_introspection` search_group=$role$ search_group=$group$ sourcetype=splunk_resource_usage ((component=PerProcess data.search_props.sid::*) OR component=Hostwide) 
| `dmc_rename_introspection_fields` 
| `dmc_set_bin` 
| stats dc(sid) AS distinct_search_count values(Action) as Action by host, _time 
| stats $searchFunction$(distinct_search_count) as search_count values(Action) as Action by host 
| `dmc_search_count_rangemap` 
| where range=""$metric$"" 
| `dmc_drilldown_join_peers_by_peerURI` 
| eval Action = Action."" $role$"" 
| fields serverName, machine, search_count, range, numberOfCores, ram, version, Action 
| rename serverName as Instance, machine as Machine, search_count as ""Count of Searches"", range as ""Count of Searches Range"", version as Version, numberOfCores as Cores, ram as RAM","role, group, searchFunction, metric","splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_event_local_search_dispatch","`dmc_set_index_audit` sourcetype=audittrail action=search search=*",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_event_remote_search_dispatch","`dmc_set_index_internal` sourcetype=splunkd_remote_searches ""Streamed search search starting""",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_exclude_indexes","eval _dmc_title = if(isnotnull(title), title, 'data.name')
| where NOT (_dmc_title == ""history"" OR _dmc_title == ""_thefishbucket"" OR _dmc_title == ""_blocksignature"")
| fields - _dmc_title",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_exclude_volumes","eval _dmc_volume = if(isnotnull(title), title, 'data.name') 
| where NOT _dmc_volume == ""_splunk_summaries"" 
| fields - _dmc_volume",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_get_all_triggered_alerts(1)","rest splunk_server=local /servicesNS/-/splunk_monitoring_console/alerts/fired_alerts/- 
| rename savedsearch_name as title 
| join type=outer title [|rest splunk_server=local /servicesNS/-/splunk_monitoring_console/saved/searches ] 
| rename title as ""Alert Name"" 
| join type=outer sid [rest splunk_server=local /servicesNS/nobody/splunk_monitoring_console/search/jobs/] 
| eval now=relative_time(now(),""-$minute_offset$m"") 
| where trigger_time > now 
| rename trigger_time AS ""_time"", description as ""Description"", sid AS Instance 
| convert timeformat=""%b. %d, %Y %l:%M %p"" ctime(_time) AS ""Time Triggered"" 
| fields - _time 
| fields ""Alert Name"", Instance, ""Time Triggered"", ""Description""","minute_offset","splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_get_core_info","eval core_info = if(isnull(numberOfCores), ""N/A"", numberOfCores)."" / "".if(isnull(numberOfVirtualCores), ""N/A"", numberOfVirtualCores)",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_get_distsearch_group_servers(1)","rest splunk_server=local /services/search/distributed/groups 
| fields title member 
| search title=""dmc_group_$group_name$"" 
| eval title=replace(title, ""^dmc_group_"", """") 
| eval servers=mvjoin(member,"","") 
| fields title servers","group_name","splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_get_forwarder_info","inputlookup dmc_forwarder_assets",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_get_forwarder_tcpin","`dmc_set_index_internal` sourcetype=splunkd group=tcpin_connections (connectionType=cooked OR connectionType=cookedSSL) fwdType=* guid=*",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_get_groups","inputlookup dmc_assets 
| fields search_group 
| dedup search_group 
| search search_group=""dmc_*"" 
| `dmc_set_group_label_and_sort(search_group)`",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_get_groups_containing_role(1)","inputlookup dmc_assets 
| mvcombine search_group 
| search search_group=""$role$"" 
| mvexpand search_group 
| fields search_group 
| dedup search_group 
| `dmc_set_group_label_and_sort(search_group)`",role,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_get_indexer_cluster_groups","inputlookup dmc_assets 
| fields search_group 
| dedup search_group 
| search search_group=""dmc_indexerclustergroup_*"" 
| eval label = replace(search_group, ""dmc_indexerclustergroup_"", """")",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_get_instance_info(1)","inputlookup dmc_assets | mvcombine search_group | search search_group=$group$",group,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_get_instance_roles","inputlookup dmc_assets 
| mvcombine search_group 
| eval role = search_group 
| mvexpand role 
| eval role = if(like(role, ""dmc_group_%""), role, """") 
| eval role = replace(role, ""^dmc_group_"", """") 
| mvcombine role",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_get_instances_on_a_machine(1)","`dmc_get_instance_info(*)` 
| where machine = ""$machine$"" 
| dedup serverName",machine,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_get_last_hour_resource_usage_from_sid(2)","`dmc_set_index_introspection` host=$host$ sourcetype=splunk_resource_usage component=PerProcess data.search_props.sid=""$sid$"" earliest=-1h 
| `dmc_set_bin` 
| `dmc_rename_introspection_fields` 
| stats latest(pct_cpu) AS pct_cpu_dedup latest(mem_used) AS mem_used_dedup by _time, pid 
| stats sum(pct_cpu_dedup) AS pct_cpu_sum sum(mem_used_dedup) AS mem_used_sum by _time 
| timechart span=10s latest(pct_cpu_sum) AS pct_cpu latest(mem_used_sum) AS mem_used","host, sid","splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_get_local_instance_asset","`dmc_get_local_instance_asset_computed_groups` 
| join type=outer peerURI [ 
| rest splunk_server=local /services/search/distributed/groups 
| fields title member 
| where isnotnull(mvfind(member, ""localhost:localhost"")) 
| eval peerURI=""localhost"" 
| rename title AS search_groups 
| fields peerURI search_groups 
| mvcombine delim="" "" search_groups] 
| makemv delim="" "" search_groups 
| eval search_groups = if(isnotnull(search_groups),search_groups,computed_search_groups) 
| fields - computed_search_groups 
| mvexpand search_groups",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_get_local_instance_asset_computed_groups","rest splunk_server=local /services/server/info 
| eval peerURI=""localhost"" 
| eval server_roles=""indexer,search_head,license_master,kv_store"" 
| makemv delim="","" server_roles 
| mvexpand server_roles 
| eval computed_search_groups=""dmc_group_"".server_roles 
| stats first(peerURI) AS peerURI first(host) AS host first(host_fqdn) AS machine values(computed_search_groups) AS computed_search_groups by serverName",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_get_local_instance_asset_in_distributed_mode","`dmc_get_local_instance_asset_computed_groups` 
| join type=inner peerURI [ 
| rest splunk_server=local /services/search/distributed/groups 
| fields title member 
| where isnotnull(mvfind(member, ""localhost:localhost"")) 
| eval peerURI=""localhost"" 
| rename title AS search_groups 
| fields peerURI search_groups 
| mvcombine delim="" "" search_groups] 
| makemv delim="" "" search_groups 
| eval search_groups = if(isnotnull(search_groups),search_groups,computed_search_groups) 
| fields - computed_search_groups 
| mvexpand search_groups",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_get_machine_info","`dmc_get_instance_info(*)` 
| stats first(host) as host first(serverName) as serverName by machine",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_get_port_from_splunktcp_stanza(1)","| rex field=$stanza_name$ ""splunktcp(-ssl)?:(\/{1,2})?(([0-9]{1,3}\.){3}[0-9]{1,3})?(:)?(?<port>\d+)"" 
| eval port = if(match($stanza_name$, ""splunktcp-ssl""), port."" (SSL)"", port) 
| eval port = if(isnotnull(port), port, null)","stanza_name","splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_get_recently_triggered_alerts","rest splunk_server=local /servicesNS/-/splunk_monitoring_console/saved/searches 
|rename title as savedsearch_name 
| fields savedsearch_name, triggered_alert_count, description 
| where triggered_alert_count > 0 
| join type=outer savedsearch_name[|rest splunk_server=local /servicesNS/-/splunk_monitoring_console/alerts/fired_alerts/- 
| cluster field=savedsearch_name] 
| join type=outer sid [rest splunk_server=local /servicesNS/nobody/splunk_monitoring_console/search/jobs/] 
| rename savedsearch_name AS ""Alert Name"", triggered_alert_count AS ""Trigger Count"", published AS ""Last time triggered"", description as ""Description"" | fields ""Alert Name"" , ""Trigger Count"", ""Last time triggered"", ""Description"", sid",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_get_search_head_cluster_groups","inputlookup dmc_assets 
| fields search_group 
| dedup search_group 
| search search_group=""dmc_searchheadclustergroup_*"" 
| eval label = replace(search_group, ""dmc_searchheadclustergroup_"", """")",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_get_warnings_and_errors(2)","`dmc_set_index_internal` search_group=$search_group$ sourcetype=splunkd component=$component$  (log_level=WARN OR log_level=ERROR)","search_group, component","splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_indexing_rate_rangemap","rangemap field=kbps ""0-50 KB/s""=0-50 ""50-100 KB/s""=50.001-100 ""100-500 KB/s""=100.001-500 ""500 KB/s - 1 MB/s""=500.001-1024 ""1-2.5 MB/s""=1024.001-2560 ""2.5-5 MB/s""=2560.001-5120 ""5-10 MB/s""=5120.001-10240 ""10+ MB/s""=10240.001-999999 default=""NULL""",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_indexing_rate_rangemap_and_timechart","`dmc_indexing_rate_rangemap` 
| timechart minspan=30s partial=f dc(host) AS instance_count by range 
| fields _time ""10+ MB/s"" ""5-10 MB/s"" ""2.5-5 MB/s"" ""1-2.5 MB/s"" ""500 KB/s - 1 MB/s"" ""100-500 KB/s"" ""50-100 KB/s"" ""0-50 KB/s""",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_instances_view_default_search(1)","inputlookup dmc_assets 
| mvcombine search_group 
| rex max_match=0 field=search_group ""dmc_indexerclustergroup_(?<indexer_cluster>.*)"" 
| rex max_match=0 field=search_group ""dmc_searchheadclustergroup_(?<search_head_cluster>.*)"" 
| mvexpand search_group 
| search search_group = $group$ 
| mvcombine search_group 
| join type=outer peerURI 
  [| rest splunk_server=local /services/search/distributed/peers 
   | rename title as peerURI ] 
| join type=outer peerURI 
  [| rest splunk_server=local /services/server/info 
   | eval peerURI = ""localhost"" 
   | eval status = ""Up""] 
| join peerURI 
  [| `dmc_get_instance_roles` ] 
| eval status = if(status == ""Up"", status, ""Unreachable"") 
| eval Action = serverName."" "".role 
| eval OS = os_name 
| eval ram = round(physicalMemoryMB / 1024, 2)."" GB"" 
| `dmc_get_core_info` 
| fields serverName, machine, role, indexer_cluster, search_head_cluster, OS, core_info, ram, version, status, Action 
| sort status, serverName 
| rename serverName as Instance, machine as Machine, role as Role, indexer_cluster as ""Indexer Cluster"", search_head_cluster as ""Search Head Cluster"", core_info as ""CPU Cores (Physical / Virtual)"", ram as RAM, version as Version, status as Status",group,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_iostats_rangemap(1)","rangemap field=$fieldname$ ""0-60%""=0-60 ""60-80%""=60.0001-80, ""80-100%""=80.0001-100 default=abnormal",fieldname,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_licensing_base_summary(2)","`dmc_set_index_internal` host=$host$ source=*license_usage.log* type=""RolloverSummary"" earliest=-30d@d $pool_clause$","host, pool_clause","splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_licensing_base_usage(2)","`dmc_set_index_internal` source=*license_usage.log* type=""Usage"" | eval h=if(len(h)=0 OR isnull(h),""(SQUASHED)"",h) | eval s=if(len(s)=0 OR isnull(s),""(SQUASHED)"",s) | eval idx=if(len(idx)=0 OR isnull(idx),""(UNKNOWN)"",idx) | bin _time span=1d | stats sum(b) as b by _time, host, pool, s, st, h, idx | search host=$host$ $pool_clause$","host, pool_clause","splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_licensing_pool_size_srch(2)","join type=outer _time [search `dmc_set_index_internal` host=$host$ source=*license_usage.log* type=""RolloverSummary"" earliest=-30d@d $pool_clause$ | eval _time=_time - 43200 | bin _time span=1d | stats latest(poolsz) AS  ""pool size"" by _time] | fields - _timediff","host, pool_clause","splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_licensing_stack_size_srch(2)","join type=outer _time [search `dmc_set_index_internal` host=$host$ source=*license_usage.log* type=""RolloverSummary"" earliest=-30d@d | eval _time=_time - 43200 | bin _time span=1d | dedup _time stack | stats sum(stacksz) AS ""stack size"" by _time] | fields - _timediff","host, pool_clause","splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_licensing_summary_maxavg_indxr(3)","eval _time=_time - 43200 | bin _time span=1d | stats latest(b) AS b by slave, pool, _time | eval slave_guid=slave | stats sum(b) AS volume by slave_guid, _time | stats avg(volume) AS avgVolume max(volume) AS maxVolume by slave_guid | join type=outer slave_guid [rest splunk_server=$splunk_server$ /services/licenser/slaves | rename label AS slave_name title AS slave_guid | table slave_guid slave_name] | eval slave_name = if(isnotnull(slave_name),slave_name,""GUID: "".slave_guid) | foreach *Volume [eval <<FIELD>>=round('<<FIELD>>'/1024/1024/1024, 3)] |  rename slave_name as ""Indexer"" avgVolume AS ""average"" maxVolume AS ""peak"" | sort 5 - ""average"" | fields ""Indexer"", ""average"", ""peak"" | fields - _timediff, slave_guid","splunk_server, split_by_field_name, split_by_label","splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_licensing_summary_maxavg_no_split(3)","eval _time=_time - 43200 | bin _time span=1d | stats latest(b) AS b by slave, pool, _time | stats sum(b) AS volume by _time | stats avg(volume) AS avgVolume max(volume) AS maxVolume  | eval maxVolumeGB=round(maxVolume/1024/1024/1024,3) | eval avgVolumeGB=round(avgVolume/1024/1024/1024,3) | rename avgVolumeGB AS ""average"" maxVolumeGB AS ""peak"" | eval ""All Pools"" = """" | fields ""All Pools"", ""average"", ""peak""","splunk_server, split_by_field_name, split_by_label","splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_licensing_summary_maxavg_pool(3)","eval _time=_time - 43200 | bin _time span=1d | stats latest(b) AS b by slave, pool, _time | stats sum(b) AS volume by pool, _time  | stats avg(volume) AS avgVolume max(volume) AS maxVolume by pool | eval maxVolumeGB=round(maxVolume/1024/1024/1024,3) | eval avgVolumeGB=round(avgVolume/1024/1024/1024,3) | rename avgVolumeGB AS ""average"" maxVolumeGB AS ""peak"" pool as ""Pool"" | fields ""Pool"", ""average"", ""peak"" | sort 5 - ""average""","splunk_server, split_by_field_name, split_by_label","splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_licensing_summery_indxr(5)","eval _time=_time - 43200 | bin _time span=1d | stats latest(b) AS b by slave, pool, _time | eval slave_guid=slave | stats max(b) AS volume by slave_guid, _time | join type=outer slave_guid [rest splunk_server=$splunk_server$ /services/licenser/slaves | rename label AS slave_name title AS slave_guid | table slave_guid slave_name] | eval slave_name = if(isnotnull(slave_name),slave_name,""GUID: "".slave_guid) | timechart span=1d max(volume) AS ""volume"" by slave_name fixedrange=false | `$size_search$($host$, ""$pool_clause$"")` | foreach * [eval <<FIELD>>=round('<<FIELD>>'/1024/1024/1024, 3)]","splunk_server, size_search, host, pool_clause, split_by_field_name","splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_licensing_summery_no_split(5)","eval _time=_time - 43200 | bin _time span=1d | stats latest(b) AS b by slave, pool, _time | timechart span=1d sum(b) AS ""volume"" fixedrange=false | `$size_search$($host$, ""$pool_clause$"")` | foreach * [eval <<FIELD>>=round('<<FIELD>>'/1024/1024/1024, 3)]","splunk_server, size_search, host, pool_clause, split_by_field_name","splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_licensing_summery_pct_indxr(4)","eval _time=_time - 43200 | bin _time span=1d | stats latest(b) AS b latest($sz_clause$) AS $sz_clause$ by slave, pool, _time | stats sum(b) AS volumeB max($sz_clause$) AS $sz_clause$ by slave, _time | eval pctused=round(volumeB/$sz_clause$*100,2) | eval slave_guid=slave | join type=outer slave_guid [rest splunk_server=$splunk_server$ /services/licenser/slaves | rename label AS slave_name title AS slave_guid | table slave_guid slave_name] | eval slave_name = if(isnotnull(slave_name),slave_name,""GUID: "".slave_guid) | timechart span=1d max(pctused) AS ""used"" by slave_name fixedrange=false","splunk_server, sz_clause, host, split_by_field_name","splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_licensing_summery_pct_no_split(4)","eval _time=_time - 43200 | bin _time span=1d | stats latest(b) AS b latest($sz_clause$) AS $sz_clause$ by slave, pool, _time | stats sum(b) AS volumeB max($sz_clause$) AS $sz_clause$ by _time | eval pctused=round(volumeB/$sz_clause$*100,2) | timechart span=1d max(pctused) AS ""used"" fixedrange=false","splunk_server, sz_clause, host, split_by_field_name","splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_licensing_summery_pct_pool(4)","eval _time=_time - 43200 | bin _time span=1d | stats latest(b) AS b latest($sz_clause$) AS $sz_clause$ by slave, pool, _time | stats sum(b) AS volumeB max($sz_clause$) AS $sz_clause$ by pool, _time | eval pctused=round(volumeB/$sz_clause$*100,2) | timechart span=1d max(pctused) AS ""used"" by pool fixedrange=false","splunk_server, sz_clause, host, split_by_field_name","splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_licensing_summery_pool(5)","eval _time=_time - 43200 | bin _time span=1d | stats latest(b) AS b by slave, pool, _time | timechart span=1d sum(b) AS ""volume"" by pool fixedrange=false | `$size_search$($host$, ""$pool_clause$"")` | foreach * [eval <<FIELD>>=round('<<FIELD>>'/1024/1024/1024, 3)]","splunk_server, size_search, host, pool_clause, split_by_field_name","splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_licensing_usage_all(5)","timechart span=1d sum(b) AS volumeB by $split_by_field_name$ fixedrange=false | `$size_search$($host$, ""$pool_clause$"")` | foreach * [eval <<FIELD>>=round('<<FIELD>>'/1024/1024/1024, 3)]","splunk_server, size_search, host, split_by_field_name, pool_clause","splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_licensing_usage_maxavg_all(3)","stats sum(b) AS volume by $split_by_field_name$, _time | stats avg(volume) AS avgVolume max(volume) AS maxVolume by $split_by_field_name$ | eval avgVolumeGB=round(avgVolume/1024/1024/1024,3) | eval maxVolumeGB=round(maxVolume/1024/1024/1024,3) | fields $split_by_field_name$, avgVolumeGB, maxVolumeGB | rename avgVolumeGB AS ""average"" maxVolumeGB AS ""peak"" $split_by_field_name$ AS ""$split_by_label$"" | sort 5 - ""average""","splunk_server, split_by_field_name, split_by_label","splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_licensing_usage_pct_all(4)","join _time pool type=outer [search `dmc_set_index_internal` host=$host$ source=*license_usage.log* type=""RolloverSummary"" earliest=-30d@d | eval _time=_time - 43200 | bin _time span=1d | stats latest($sz_clause$) AS $sz_clause$ by slave, pool, _time | stats max($sz_clause$) AS $sz_clause$ by pool, _time] | stats sum(b) AS bytes_used max($sz_clause$) AS $sz_clause$ by $split_by_field_name$, _time | timechart span=1d max(eval(round(bytes_used/$sz_clause$*100,2))) by $split_by_field_name$ fixedrange=false","splunk_server, sz_clause, host, split_by_field_name","splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_load_average_rangemap","rangemap field=load_average ""0-20""=0-20 ""20-50""=20.001-50 ""50+""=50.001-999999 default=abnormal",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_load_average_rangemap_and_timechart","`dmc_load_average_rangemap` 
| `dmc_timechart` partial=f dc(server) as server_count by range 
| fields _time, ""50+"", ""20-50"", ""0-20""",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_match_all_scheduled_search_types","((data.search_props.type=""datamodel acceleration"" OR search_props.type=""datamodel acceleration"") OR (data.search_props.type=""report acceleration"" OR search_props.type=""report acceleration"") OR (data.search_props.type=""scheduled"" OR search_props.type=""scheduled"") OR (data.search_props.type=""summary indexing"" OR search_props.type=""summary indexing""))",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_mem_used_rangemap","rangemap field=resource_usage 
""0GB""=0-0 
""<1GB""=0.01-1024 
""1-2GB""=1024.001-2048 
""2-3GB""=2048.001-3072 
""3-4GB""=3072.001-4096 
""4-5GB""=4096.001-5120 
""5-10GB""=5120.001-10240 
""10-15GB""=10240.001-15360 
""15-20GB""=15360.001-20480 
""20-30GB""=20480.001-30720 
""30GB+""=30720.001-999999 
default=""0GB"" 
| eval resource_usage = round(resource_usage / 1024, 3)",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_mem_used_rangemap_and_timechart","`dmc_mem_used_rangemap` 
| `dmc_timechart` partial=f dc(host) AS host_count by range 
| fields _time, ""30GB+"" ""20-30GB"" ""15-20GB"" ""5-10GB"" ""4-5GB"" ""3-4GB"" ""2-3GB"" ""1-2GB"" ""<1GB"" ""0GB""",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_memory_usage_rangemap","rangemap field=pct_mem_used ""0-60%""=0-0.6 ""60-80%""=0.6001-0.8 ""80-100%""=0.8001-1 default=abnormal",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_memory_usage_rangemap_and_timechart","`dmc_memory_usage_rangemap` 
| `dmc_timechart` partial=f dc(server) as server_count by range 
| fields _time, ""80-100%"", ""60-80%"", ""0-60%""",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_pct_cpu_rangemap","rangemap field=resource_usage 
""0 cores""=0-0.009 
""0.01-1 cores""=0.01-1 
""1-2 cores""=1.01-2 
""2-3 cores""=2.01-3 
""3-4 cores""=3.01-4 
""4-5 cores""=4.01-5 
""5-10 cores""=5.01-10 
""10-15 cores""=10.01-15 
""15-20 cores""=15.01-20 
""20-25 cores""=20.01-25 
""25-30 cores""=25.01-30 
""30+ cores""=30.01-999 
""negative""=-99999--0.001 
default=""0 cores""",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_pct_cpu_rangemap_and_timechart","`dmc_pct_cpu_rangemap` 
| `dmc_timechart` partial=f dc(host) AS host_count by range 
| fields _time, ""30+ cores"" ""25-30 cores"" ""20-25 cores"" ""15-20 cores"" ""10-15 cores"" ""5-10 cores"" ""4-5 cores"" ""3-4 cores"" ""2-3 cores"" ""1-2 cores"" ""0.01-1 cores"" ""0 cores""",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_queue_fill_ratio_rangemap","rangemap field=fill_percentage ""0-60%""=0-60 ""60-80%""=60.01-80 ""80-100%""=80.01-100",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_queue_fill_ratio_rangemap_and_timechart","`dmc_queue_fill_ratio_rangemap` 
| timechart partial=f dc(host) by range 
| fields _time ""80-100%"" ""60-80%"" ""0-60%""",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_rangemap_cpu_system_pct","rangemap field=cpu_system_pct #53A051=0-59.999 #F1813F=60-79.999 default=#DC4E41",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_rangemap_default_cpu_system_pct","rangemap field=cpu_system_pct #53A051=0-59.999 #F1813F=60-79.999 default=#DC4E41",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_rangemap_default_indexing_rate","rangemap field=average_KBps #CEE4EE=0-99.999 #6BAECA=100-999.999 #0877A6=1000-4999 #005E86=5000-9999 default=#004664",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_rangemap_default_mem_used","rangemap field=mem_used #53A051=0-59.999 #F1813F=60-79.999 default=#DC4E41",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_rangemap_default_search_concurrency","rangemap field=search_concurrency #CEE4EE=0-5.999 #6BAECA=6-10.999 #0877A6=11-20.999 default=#005E86",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_rangemap_default_up_down_status","rangemap field=up_down_status #DC4E41=0-0.999 default=#53A051",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_rangemap_indexing_rate","rangemap field=average_KBps #CEE4EE=0-99.999 #6BAECA=100-999.999 #0877A6=1000-4999 #005E86=5000-9999 default=#004664",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_rangemap_mem_used","rangemap field=mem_used #53A051=0-59.999 #F1813F=60-79.999 default=#DC4E41",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_rangemap_search_concurrency","rangemap field=search_concurrency #CEE4EE=0-5.999 #6BAECA=6-10.999 #0877A6=11-20.999 default=#005E86",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_rangemap_up_down_status","rangemap field=up_down_status #DC4E41=0-0.999 default=#53A051",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_re_build_forwarder_assets(1)","`dmc_build_forwarder_assets($sparkline_span$)` 
| rename new_sum_kb as sum_kb, new_avg_tcp_kbps_sparkline as avg_tcp_kbps_sparkline, new_avg_tcp_kbps as avg_tcp_kbps, new_avg_tcp_eps as avg_tcp_eps 
| eval avg_tcp_kbps_sparkline = ""N/A"" 
| addinfo 
| eval status = if(isnull(sum_kb) or (sum_kb <= 0) or (last_connected < (info_max_time - 900)), ""missing"", ""active"") 
| eval sum_kb = round(sum_kb, 2) 
| eval avg_tcp_kbps = round(avg_tcp_kbps, 2) 
| eval avg_tcp_eps = round(avg_tcp_eps, 2) 
| fields guid, hostname, forwarder_type, version, arch, os, status, last_connected, sum_kb, avg_tcp_kbps_sparkline, avg_tcp_kbps, avg_tcp_eps 
| outputlookup dmc_forwarder_assets","sparkline_span","splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_re_build_forwarder_assets_light(1)","`dmc_build_forwarder_assets($sparkline_span$)` 
| rename new_sum_kb as sum_kb, new_avg_tcp_kbps_sparkline as avg_tcp_kbps_sparkline, new_avg_tcp_kbps as avg_tcp_kbps, new_avg_tcp_eps as avg_tcp_eps 
| eval avg_tcp_kbps_sparkline = ""N/A"" 
| addinfo 
| eval status = if(isnull(sum_kb) or (sum_kb <= 0) or (last_connected < (relative_time(now(),""-15m""))), ""missing"", ""active"") 
| eval sum_kb = round(sum_kb, 2) 
| eval avg_tcp_kbps = round(avg_tcp_kbps, 2) 
| eval avg_tcp_eps = round(avg_tcp_eps, 2) 
| fields guid, hostname, forwarder_type, version, arch, os, status, last_connected, sum_kb, avg_tcp_kbps_sparkline, avg_tcp_kbps, avg_tcp_eps 
| outputlookup dmc_forwarder_assets","sparkline_span","splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_rename_forwarder_type(1)","eval $type$ = case($type$ == ""full"", ""Heavy Forwarder"", $type$ == ""uf"", ""Universal Forwarder"", $type$ == ""lwf"", ""Light Forwarder"", 1==1, $type$)",type,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_rename_introspection_fields","eval process = 'data.process' 
| eval args = 'data.args' 
| eval pid = 'data.pid' 
| eval ppid = 'data.ppid' 
| eval elapsed = 'data.elapsed' 
| eval mem_used = 'data.mem_used' 
| eval mem = 'data.mem' 
| eval pct_memory = 'data.pct_memory' 
| eval pct_cpu = 'data.pct_cpu' 
| eval sid = 'data.search_props.sid' 
| eval app = 'data.search_props.app' 
| eval label = 'data.search_props.label' 
| eval type = 'data.search_props.type' 
| eval mode = 'data.search_props.mode' 
| eval user = 'data.search_props.user' 
| eval role = 'data.search_props.role' 
| eval label = if(isnotnull('data.search_props.label'), 'data.search_props.label', """") 
| eval provenance = if(isnotnull('data.search_props.provenance'), 'data.search_props.provenance', ""unknown"") 
| eval search_head = case(isnotnull('data.search_props.search_head') AND 'data.search_props.role' == ""peer"", 'data.search_props.search_head', isnull('data.search_props.search_head') AND 'data.search_props.role' == ""head"", ""_self"", isnull('data.search_props.search_head') AND 'data.search_props.role' == ""peer"", ""_unknown"") 
| eval workload_pool = if(isnotnull('data.workload_pool'), 'data.workload_pool', ""UNDEFINED"")",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_replication_lag_rangemap","rangemap field=lag ""0-10s""=0-10 ""10-30s""=10.001-30 "">30s""=30.001-10000000 default=abnormal",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_resource_usage_by_processes_timechart(2)","`dmc_set_bin` 
| `dmc_rename_introspection_fields` 
| stats latest($resource_type$) AS resource_usage_dedup latest(process_class) AS process_class by pid, _time 
| stats sum(resource_usage_dedup) AS resource_usage by _time, process_class 
| timechart minspan=10s $function$(resource_usage) AS ""Resource Usage"" by process_class","resource_type, function","splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_resource_usage_instance_drilldown(1)","`dmc_set_index_introspection` sourcetype=splunk_resource_usage component=PerProcess host=$host$ 
| `dmc_rename_introspection_fields` 
| `dmc_classify_processes` 
| eval args = if(isnotnull(sid),""search --id="".sid."" (...)"", args) 
| eval cmd = process."" "".args 
| stats latest(pid) as ""PID"", latest(ppid) as ""PPID"", latest(label) as Label, latest(provenance) as Provenance, latest(search_head) as ""Search Head"", latest(type) as Type, latest(user) as User, latest(app) as App, latest(mode) as Mode, latest(role) as Role, avg(pct_cpu) as avg_pct_cpu, max(mem_used) as ""Physical Memory Usage (MB)"", min(_time) as min_time, max(_time) as max_time, max(elapsed) as ""Elapsed Time"" by cmd 
| eval avg_pct_cpu = round(avg_pct_cpu, 2) 
| `dmc_time_format(min_time)` 
| `dmc_time_format(max_time)` 
| rename avg_pct_cpu as ""Average CPU Usage (%)"", min_time as ""First Time Seen"", max_time as ""Last Time Seen""",host,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_scheduler_instance_search_concurrency_drilldown(3)","`dmc_set_index_introspection` host=$host$ sourcetype=splunk_resource_usage component=PerProcess data.search_props.sid::* `dmc_match_all_scheduled_search_types` 
| `dmc_rename_introspection_fields` 
| where $concurrencySplitBy$==""$type$"" 
| stats latest(pid) as ""PID"", latest(ppid) as ""PPID"", latest(label) as Label, latest(provenance) as Provenance, latest(search_head) as ""Search Head"", latest(type) as Type, latest(user) as User, latest(app) as App, latest(mode) as Mode, latest(role) as Role, avg(pct_cpu) as avg_pct_cpu, max(mem_used) as ""Physical Memory Usage (MB)"", min(_time) as min_time, max(_time) as max_time, max(elapsed) as ""Elapsed Time"" by sid 
| eval avg_pct_cpu = round(avg_pct_cpu, 2) 
| `dmc_time_format(min_time)` 
| `dmc_time_format(max_time)` 
| rename avg_pct_cpu as ""Average CPU Usage (%)"", min_time as ""First Time Seen"", max_time as ""Last Time Seen""","host, concurrencySplitBy, type","splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_search_activity_instance_drilldown(3)","`dmc_set_index_introspection` host=$host$ sourcetype=splunk_resource_usage component=PerProcess data.search_props.sid::* 
| `dmc_rename_introspection_fields` 
| where $concurrencySplitBy$==""$type$"" 
| stats latest(pid) as ""PID"", latest(ppid) as ""PPID"", latest(label) as Label, latest(provenance) AS Provenance, latest(search_head) as ""Search Head"", latest(type) as Type, latest(user) as User, latest(app) as App, latest(mode) as Mode, latest(role) as Role, avg(pct_cpu) as avg_pct_cpu, max(mem_used) as ""Physical Memory Usage (MB)"", min(_time) as min_time, max(_time) as max_time, max(elapsed) as ""Elapsed Time"" by sid 
| eval avg_pct_cpu = round(avg_pct_cpu, 2) 
| `dmc_time_format(min_time)` 
| `dmc_time_format(max_time)` 
| rename avg_pct_cpu as ""Average CPU Usage (%)"", min_time as ""First Time Seen"", max_time as ""Last Time Seen""","host, concurrencySplitBy, type","splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_search_count_rangemap","rangemap field=search_count ""0""=0-0 ""1-5""=1-5 ""6-10""=6-10 ""11-15""=11-15 ""16-20""=16-20 ""21-30""=21-30 ""31-40""=31-40 ""41-50""=41-50 ""51-75""=51-75 ""76-100""=76-100 ""101+""=101-99999",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_search_count_rangemap_and_timechart","`dmc_search_count_rangemap` 
| `dmc_timechart` dc(host) AS count_host by range 
| fields _time ""101+"" ""76-100"" ""51-75"" ""41-50"" ""31-40"" ""21-30"" ""16-20"" ""11-15"" ""6-10"" ""1-5"" ""0""",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_set_bin","bin _time span=10s",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_set_bin_for_disk_usage","bin _time span=10min",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_set_bin_for_iostats","bin _time minspan=1min",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_set_bin_for_metrics_log","bin _time minspan=30s",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_set_bin_for_timechart","bin _time minspan=10s",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_set_bin_for_timechart_for_disk_usage","bin _time minspan=10min",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_set_group_label_and_sort(1)","eval label = replace($search_group$, ""^dmc_\w*group_"", """") 
| eval label = case( 
    $search_group$ == ""dmc_group_indexer"", ""Indexer"", 
    $search_group$ == ""dmc_group_search_head"", ""Search Head"", 
    $search_group$ == ""dmc_group_cluster_master"", ""Cluster Master"", 
    $search_group$ == ""dmc_group_license_master"", ""License Master"", 
    $search_group$ == ""dmc_group_deployment_server"", ""Deployment Server"", 
    $search_group$ == ""dmc_group_kv_store"", ""KV Store"", 
    $search_group$ == ""dmc_group_shc_deployer"", ""SHC Deployer"", 
    like($search_group$, ""dmc_customgroup_%""), label.""  (custom)"", 
    like($search_group$, ""dmc_indexerclustergroup_%""), label."" (Indexer Cluster)"", 
    like($search_group$, ""dmc_searchheadclustergroup_%""), label."" (Search Head Cluster)"", 
    1 == 1, label."" (Unrecognized)"") 
| eval order = case( 
    like($search_group$, ""dmc_group_%""), 100, 
    like($search_group$, ""dmc_customgroup_%""), 200, 
    like($search_group$, ""dmc_indexerclustergroup_%""), 300, 
    like($search_group$, ""dmc_searchheadclustergroup_%""), 400, 
    1 == 1, ""500"") 
| sort order, $search_group$ 
| fields - order","search_group","splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_set_index_audit","index=_audit",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_set_index_internal","index=_internal",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_set_index_introspection","index=_introspection",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_tcp_forwarder_count_split_by(2)","`dmc_get_forwarder_tcpin` search_group=dmc_group_indexer search_group=$group$ 
| `dmc_timechart_for_metrics_log` dc(guid) as forwarder_count by $field$ 
| rename forwarder_count as ""Forwarder Count""","field, group","splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_tcp_throughput_split_by(2)","`dmc_get_forwarder_tcpin` search_group=dmc_group_indexer search_group=$group$ 
| `dmc_timechart_for_metrics_log` per_second(kb) as avg_tcp_KBps by $field$ 
| rename avg_tcp_KBps as ""KB/s""","field, group","splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_time_format(1)","eval $time$ = strftime($time$, ""%m/%d/%Y %H:%M:%S %z"")",time,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_timechart","timechart minspan=10s",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_timechart_for_disk_usage","timechart minspan=10min",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_timechart_for_iostats","timechart minspan=60s partial=f",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_timechart_for_metrics_log","timechart minspan=30s",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","dmc_timechart_for_metrics_reaper_and_heartbeat","timechart minspan=300s",,"splunk_monitoring_console",global,system,
GMC,"PROD-GMC-1|search_head","time_modifier(1)","tostring(relative_time(time(), ""$time_modifier$""))","time_modifier","splunk_monitoring_console",global,system,
