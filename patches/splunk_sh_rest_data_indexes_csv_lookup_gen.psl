| rest /servicesNS/-/-/data/indexes splunk_server_group=dmc_group_indexer timeout=0 
| rename eai:acl.* as *, field.* as * , splunk_server AS Splunk_Instance 
| fields Splunk_Roles Splunk_Instance title currentDBSizeMB maxTotalDataSizeMB frozenTimePeriodInSecs quarantineFutureSecs quarantinePastSecs totalEventCount minTime maxTime maxHotSpanSecs 
| eval author = if(author="nobody", "system", author) 
| `get_instance_info_simple(Splunk_Instance)` 
| stats sum(currentDBSizeMB) as currentDBSizeMB last(maxTotalDataSizeMB) as maxTotalDataSizeMB last(frozenTimePeriodInSecs) as frozenTimePeriodInSecs last(quarantineFutureSecs) as quarantineFutureSecs last(quarantinePastSecs) as quarantinePastSecs last(totalEventCount) as "Total Event Count" min(minTime) as minTime max(maxTime) as maxTime last(maxHotSpanSecs) as maxHotSpanSecs values(Splunk_Roles) AS Splunk_Roles by Splunk_Instance title 
| eval Retention_Days = round(frozenTimePeriodInSecs/24/60/60), Retention_Month = round(frozenTimePeriodInSecs/24/60/60/30), Retention_Years = round(frozenTimePeriodInSecs/24/60/60/365, 2), Hot_Warm_Bucket_Retention_Days = round(maxHotSpanSecs/24/60/60) 
| eval "Quarantine Past Days" = round(quarantinePastSecs/24/60/60), "Quarantine Future Days" = round(quarantineFutureSecs/24/60/60) 
| eval "Index Size (GB)" = round(currentDBSizeMB / 1024, 2), "Index Size (TB)" = round(currentDBSizeMB / 1024 / 1024, 2) , "Max Total Index Size (TB)" = round(maxTotalDataSizeMB / 1024 / 1024) , "Max Total Index Size (PB)" = round(maxTotalDataSizeMB / 1024 / 1024 / 1024) 
| eval "Earliest Event"=strftime(strptime(minTime,"%Y-%m-%dT%H:%M:%S"),"%B %e, %Y"), "Latest Event"=strftime(strptime(maxTime,"%Y-%m-%dT%H:%M:%S"),"%B %e, %Y") 
| eval Time_Diff_Years = round((strptime(maxTime,"%Y-%m-%dT%H:%M:%S") - strptime(minTime,"%Y-%m-%dT%H:%M:%S")) / 60 / 60 / 24 / 365, 2), Time_Diff_Month = round((strptime(maxTime,"%Y-%m-%dT%H:%M:%S") - strptime(minTime,"%Y-%m-%dT%H:%M:%S")) / 60 / 60 / 24 / 30, 2), Time_Diff_Days = round((strptime(maxTime,"%Y-%m-%dT%H:%M:%S") - strptime(minTime,"%Y-%m-%dT%H:%M:%S")) / 60 / 60 / 24) 
| eval Days_Diff_From_Retention = Time_Diff_Days - Retention_Days 
| rename title as Index 
| table Splunk_Instance Splunk_Roles Index "Index Size (GB)" "Index Size (TB)" Retention_Days Retention_Month Retention_Years "Earliest Event" "Latest Event" Time_Diff_Years Time_Diff_Month Time_Diff_Days Days_Diff_From_Retention "Total Event Count" 
| outputlookup splunk_sh_rest_data_indexes_csv_lookup createinapp=true create_empty=true override_if_empty=false 
| stats count
